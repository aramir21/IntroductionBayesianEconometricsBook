[["Chap3.html", "Chapter 3 Cornerstone models: Conjugate families", " Chapter 3 Cornerstone models: Conjugate families We will introduce conjugate families, which are distributions for which the posterior distribution belongs to the same family as the prior distribution, given the likelihood. We provide some examples and solve them both analytically and computationally. We begin with simple examples of discrete and continuous distributions and then study the linear model in detail, both univariate and multivariate, deriving the posterior distributions, the marginal likelihood, and the predictive distribution analytically. Additionally, we will include mathematical and computational exercises in R. "],["sec41.html", "3.1 Motivation of conjugate families", " 3.1 Motivation of conjugate families By observing the three fundamental pieces of Bayesian analysis –the posterior distribution (parameter inference), the marginal likelihood (hypothesis testing), and the predictive distribution (prediction)– as given in equations (3.1), (3.2), and (3.3), respectively, we can understand that some of the initial limitations of Bayesian analysis were due to the absence of algorithms for sampling from non-standard posterior distributions (equation (3.1)), and the lack of analytical solutions for the marginal likelihood (equation (3.2)) and the predictive distribution (equation (3.3)), both of which require significant computational power. \\[\\begin{align} \\pi(\\boldsymbol{\\theta}\\mid \\boldsymbol{y})&amp;=\\frac{p(\\boldsymbol{y}\\mid \\boldsymbol{\\theta}) \\times \\pi(\\boldsymbol{\\theta})}{p(\\boldsymbol{y})}, \\tag{3.1} \\end{align}\\] \\[\\begin{equation} p(\\boldsymbol{y})=\\int_{\\boldsymbol{\\Theta}}p(\\boldsymbol{y}\\mid \\boldsymbol{\\theta})\\pi(\\boldsymbol{\\theta})d\\boldsymbol{\\theta}, \\tag{3.2} \\end{equation}\\] and \\[\\begin{equation} p(\\boldsymbol{y}_0\\mid \\boldsymbol{y})=\\int_{\\boldsymbol{\\Theta}}p(\\boldsymbol{y}_0\\mid \\boldsymbol{\\theta})\\pi(\\boldsymbol{\\theta}\\mid \\boldsymbol{y})d\\boldsymbol{\\theta}, \\tag{3.3} \\end{equation}\\] Although algorithms for sampling from non-standard posterior distributions have existed since the second half of the last century (Metropolis et al. 1953; Hastings 1970; Geman and Geman 1984), their application within the Bayesian framework emerged later (A. E. Gelfand and Smith 1990; Tierney 1994), likely coinciding with the rise in computational power of desktop computers. However, it is still common practice today to use models with standard conditional posterior distributions in order to reduce computational requirements. In addition, mathematical techniques coupled with computational algorithms (Alan E. Gelfand and Dey 1994; Chib 1995; Chib and Jeliazkov 2001) and approximations (Tierney and Kadane 1986, Jordan1999) are employed to obtain the marginal likelihood (prior predictive). Despite these advances, two potentially conflicting desirable model specification features are evident from equations (3.1), (3.2), and (3.3): (1) analytical solutions and (2) the posterior distribution belonging to the same family as the prior distribution for a given likelihood. The latter is known as conjugate priors, a family of priors that is closed under sampling (Schlaifer and Raiffa 1961). These features are desirable because the former facilitates hypothesis testing and predictive analysis, while the latter ensures invariance in the prior-to-posterior updating process. Both features reduce computational burden. Although each of these features can be achieved independently –such as using improper priors for analytical tractability and broadly defining the family of priors for conjugacy– these features are in conflict. Fortunately, we can achieve both characteristics if we assume that the data-generating process follows a distribution function in the exponential family. That is, given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\), a probability density function \\(p(\\boldsymbol{y}\\mid \\boldsymbol{\\theta})\\) belongs to the exponential family if it has the form: \\[\\begin{align} p(\\boldsymbol{y}\\mid \\boldsymbol{\\theta})&amp;=\\prod_{i=1}^N h(y_i) C(\\boldsymbol{\\theta}) \\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{T}(y_i)\\right\\}\\tag{3.4}\\\\ &amp;=h(\\boldsymbol{y}) C(\\boldsymbol{\\theta})^N\\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{T}(\\boldsymbol{y})\\right\\}\\nonumber \\\\ &amp;=h(\\boldsymbol{y})\\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{T}(\\boldsymbol{y})-A(\\boldsymbol{\\theta})\\right\\}\\nonumber, \\end{align}\\] where \\(h(\\boldsymbol{y}) = \\prod_{i=1}^N h(y_i)\\) is a non-negative function, \\(\\eta(\\boldsymbol{\\theta})\\) is a known function of the parameters, and \\(A(\\boldsymbol{\\theta}) = \\log\\left\\{ \\int_{\\boldsymbol{Y}} h(\\boldsymbol{y}) \\exp\\left\\{ \\eta(\\boldsymbol{\\theta})^{\\top} \\boldsymbol{T}(\\boldsymbol{y}) \\right\\} d\\boldsymbol{y} \\right\\} = -N \\log\\left(C(\\boldsymbol{\\theta})\\right)\\) is the normalization factor. Additionally, \\(\\boldsymbol{T}(\\boldsymbol{y}) = \\sum_{i=1}^N \\boldsymbol{T}(y_i)\\) is the vector of sufficient statistics for the distribution (by the factorization theorem). If the support of \\(\\boldsymbol{Y}\\) is independent of \\(\\boldsymbol{\\theta}\\), the family is said to be regular; otherwise, it is irregular. Furthermore, if we set \\(\\eta = \\eta(\\boldsymbol{\\theta})\\), the exponential family is said to be in the canonical form. \\[\\begin{align} p(\\boldsymbol{y}\\mid \\boldsymbol{\\eta})&amp;=h(\\boldsymbol{y})D(\\boldsymbol{\\eta})^N\\exp\\left\\{\\eta^{\\top}\\boldsymbol{T}(\\boldsymbol{y})\\right\\}\\nonumber\\\\ &amp;=h(\\boldsymbol{y})\\exp\\left\\{\\eta^{\\top}\\boldsymbol{T}(\\boldsymbol{y})-B(\\boldsymbol{\\eta})\\right\\}.\\nonumber \\end{align}\\] A nice feature of this representation is that \\(\\mathbb{E}[\\boldsymbol{T}(\\boldsymbol{y})\\mid \\boldsymbol{\\eta}]=\\nabla B(\\boldsymbol{\\eta})\\) and \\(Var[\\boldsymbol{T}(\\boldsymbol{y})\\mid \\boldsymbol{\\eta}]=\\nabla^2 B(\\boldsymbol{\\eta})\\). 3.1.1 Examples of exponential family distributions Discrete distributions Let’s show that some of the most common distributions for random variables, which can take values on a finite or countably infinite set, are part of the exponential family. Poisson distribution Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a Poisson distribution let’s show that \\(p(\\boldsymbol{y}\\mid \\lambda)\\) is in the exponential family. \\[\\begin{align} p(\\boldsymbol{y}\\mid \\lambda)&amp;=\\prod_{i=1}^N \\frac{\\lambda^{y_i} \\exp(-\\lambda)}{y_i!}\\nonumber\\\\ &amp;=\\frac{\\lambda^{\\sum_{i=1}^N y_i}\\exp(-N\\lambda)}{\\prod_{i=1}^N y_i!}\\nonumber\\\\ &amp;=\\frac{\\exp(-N\\lambda)\\exp(\\sum_{i=1}^Ny_i\\log(\\lambda))}{\\prod_{i=1}^N y_i!}\\nonumber, \\end{align}\\] then \\(h(\\boldsymbol{y})=\\left[\\prod_{i=1}^N y_i!\\right]^{-1}\\), \\(\\eta(\\lambda)=\\log(\\lambda)\\), \\(T(\\boldsymbol{y})=\\sum_{i=1}^N y_i\\) (sufficient statistic) and \\(C(\\lambda)=\\exp(-\\lambda)\\). If we set \\(\\eta=\\log(\\lambda)\\), then \\[\\begin{align} p(\\boldsymbol{y}\\mid \\eta)&amp;=\\frac{\\exp(\\eta\\sum_{i=1}^Ny_i-N\\exp(\\eta))}{\\prod_{i=1}^N y_i!},\\nonumber \\end{align}\\] such that \\(B(\\eta)=N\\exp(\\eta)\\), then \\(\\nabla(B(\\eta))=N\\exp(\\eta)=N\\lambda=\\mathbb{E}\\left[\\sum_{i=1}^N y_i\\biggr\\rvert\\lambda\\right]\\), that is, \\(\\mathbb{E}\\left[\\frac{\\sum_{i=1}^N y_i}{N}\\biggr\\rvert\\lambda\\right]=\\mathbb{E}[\\bar{y}\\mid \\lambda]=\\lambda\\), and \\(\\nabla^2(B(\\eta))=N\\exp(\\eta)=N\\lambda=Var\\left[\\sum_{i=1}^N y_i\\biggr\\rvert\\lambda\\right]=N^2 \\times Var\\left[\\bar{y}\\rvert\\lambda\\right]\\), then \\(Var\\left[\\bar{y}\\rvert\\lambda\\right]=\\frac{\\lambda}{N}\\). Bernoulli distribution Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a Bernoulli distribution let’s show that \\(p(\\boldsymbol{y}\\mid \\theta)\\) is in the exponential family. \\[\\begin{align} p(\\boldsymbol{y}\\mid \\theta)&amp;=\\prod_{i=1}^N \\theta^{y_i}(1-\\theta)^{1-y_i}\\nonumber\\\\ &amp;=\\theta^{\\sum_{i=1}^N y_i}(1-\\theta)^{N-\\sum_{i=1}^N y_i}\\nonumber\\\\ &amp;=(1-\\theta)^N\\exp\\left\\{\\sum_{i=1}^N y_i\\log\\left(\\frac{\\theta}{1-\\theta}\\right)\\right\\}\\nonumber, \\end{align}\\] then \\(h(\\boldsymbol{y})=\\mathbb{1}[y_i\\in\\left\\{0,1\\right\\}]\\) (indicator function), \\(\\eta(\\theta)=\\log\\left(\\frac{\\theta}{1-\\theta}\\right)\\), \\(T(\\boldsymbol{y})=\\sum_{i=1}^N y_i\\) and \\(C(\\theta)=1-\\theta\\). Write this distribution in the canonical form, and find the mean and variance of the sufficient statistic (Exercise 1). Multinomial distribution Given a random sample \\(\\boldsymbol{Y}=[\\boldsymbol{Y}_1 \\ \\boldsymbol{Y}_2 \\ \\dots \\ \\boldsymbol{Y}_N]\\) from a m-dimensional multinomial distribution, where \\(\\boldsymbol{Y}_i=\\left[Y_{i1} \\ Y_{i2} \\ \\dots \\ Y_{im}\\right]\\), \\(\\sum_{l=1}^m Y_{il}=n\\), \\(n\\) independent trials each of which leads to a success for exactly one of \\(m\\) categories with probabilities \\(\\boldsymbol{\\theta}=[\\theta_1 \\ \\theta_2 \\ \\dots \\ \\theta_m]\\), \\(\\sum_{l=1}^m \\theta_l=1\\). Let’s show that \\(p(\\boldsymbol{y}\\mid \\boldsymbol{\\theta})\\) is in the exponential family. \\[\\begin{align} p(\\boldsymbol{y}\\mid \\boldsymbol{\\theta})&amp;=\\prod_{i=1}^N \\frac{n!}{\\prod_{l=1}^m y_{il}!} \\prod_{l=1}^m\\theta_l^{y_{il}}\\nonumber\\\\ &amp;=\\frac{(n!)^N}{\\prod_{i=1}^N\\prod_{l=1}^m y_{il}!}\\exp\\left\\{\\sum_{i=1}^N\\sum_{l=1}^m y_{il}\\log(\\theta_l)\\right\\}\\nonumber\\\\ &amp;=\\frac{(n!)^N}{\\prod_{i=1}^N\\prod_{l=1}^m y_{il}!}\\exp\\left\\{\\left(N\\times n-\\sum_{i=1}^N\\sum_{l=1}^{m-1}y_{il}\\right)\\log(\\theta_m)\\nonumber\\right. \\\\ &amp;\\left.+\\sum_{i=1}^N\\sum_{l=1}^{m-1}y_{il}\\log(\\theta_l)\\right\\}\\nonumber\\\\ &amp;=\\frac{(n!)^N}{\\prod_{i=1}^N\\prod_{l=1}^m y_{il}!}\\theta_m^{N\\times n}\\exp\\left\\{\\sum_{i=1}^N\\sum_{l=1}^{m-1}y_{il}\\log(\\theta_l/\\theta_m)\\right\\}\\nonumber, \\end{align}\\] then \\(h(\\boldsymbol{y})=\\frac{(n!)^N}{\\prod_{i=1}^N\\prod_{l=1}^m y_{il}!}\\), \\(\\eta(\\boldsymbol{\\theta})=\\left[\\log\\left(\\frac{\\theta_1}{\\theta_m}\\right)\\dots \\log\\left(\\frac{\\theta_{m-1}}{\\theta_m}\\right)\\right]\\), \\(T(\\boldsymbol{y})=\\left[\\sum_{i=1}^N y_{i1}\\dots \\sum_{i=1}^N y_{im-1}\\right]\\) and \\(C(\\boldsymbol{\\theta})=\\theta_m^n\\). Continuous distributions Let’s show that some of the most common distributions for random variables, which can take any value within a certain range or interval –an infinite number of possible values– are part of the exponential family. Normal distribution Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a normal distribution let’s show that \\(p(\\boldsymbol{y}\\mid \\mu,\\sigma^2)\\) is in the exponential family. \\[\\begin{align} p(\\boldsymbol{y}\\mid \\mu,\\sigma^2)&amp;=\\prod_{i=1}^N \\frac{1}{2\\pi\\sigma^2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\left(y_i-\\mu\\right)^2\\right\\}\\nonumber\\\\ &amp;= (2\\pi)^{-N/2}(\\sigma^2)^{-N/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\sum_{i=1}^N\\left(y_i-\\mu\\right)^2\\right\\}\\nonumber\\\\ &amp;= (2\\pi)^{-N/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\sum_{i=1}^Ny_i^2+\\frac{\\mu}{\\sigma^2}\\sum_{i=1}^N y_i\\right.\\nonumber\\\\ &amp;-\\left.N\\frac{\\mu^2}{2\\sigma^2}-\\frac{N}{2}\\log(\\sigma^2)\\right\\}\\nonumber, \\end{align}\\] then \\(h(\\boldsymbol{y})=(2\\pi)^{-N/2}\\), \\(\\eta(\\mu,\\sigma^2)=\\left[\\frac{\\mu}{\\sigma^2} \\ \\frac{-1}{2\\sigma^2}\\right]\\), \\(T(\\boldsymbol{y})=\\left[\\sum_{i=1}^N y_i \\ \\sum_{i=1}^N y_i^2\\right]\\) and \\(C(\\mu,\\sigma^2)=\\exp\\left\\{-\\frac{\\mu^2}{2\\sigma^2}-\\frac{\\log(\\sigma^2)}{2}\\right\\}\\). Observe that \\[\\begin{align} p(\\boldsymbol{y}\\mid \\mu,\\sigma^2)&amp;= (2\\pi)^{-N/2}\\exp\\left\\{\\eta_1\\sum_{i=1}^N y_i+\\eta_2\\sum_{i=1}^Ny_i^2-\\frac{N}{2}\\log(-2\\eta_2)+\\frac{N}{4}\\frac{\\eta_1^2}{\\eta_2}\\right\\}\\nonumber, \\end{align}\\] where \\(B(\\boldsymbol{\\eta})=\\frac{N}{2}\\log(-2\\eta_2)-\\frac{N}{4}\\frac{\\eta_1^2}{\\eta_2}\\). Then, \\[\\begin{align*} \\nabla B(\\boldsymbol{\\eta}) &amp; = \\begin{bmatrix} -\\frac{N}{2}\\frac{\\eta_1}{\\eta_2}\\\\ -\\frac{N}{2}\\frac{1}{\\eta_2}+\\frac{N}{4}\\frac{\\eta_1^2}{\\eta_2^2} \\end{bmatrix} = \\begin{bmatrix} N\\times\\mu\\\\ N\\times(\\mu^2+\\sigma^2) \\end{bmatrix} = \\begin{bmatrix} \\mathbb{E}\\left[\\sum_{i=1}^N y_i\\bigr\\rvert \\mu,\\sigma^2\\right]\\\\ \\mathbb{E}\\left[\\sum_{i=1}^N y_i^2\\bigr\\rvert \\mu,\\sigma^2\\right] \\end{bmatrix}. \\end{align*}\\] Multivariate normal distribution Given \\(\\boldsymbol{Y}=[\\boldsymbol{Y}_1 \\ \\boldsymbol{Y}_2 \\ \\dots \\ \\boldsymbol{Y}_p]\\) a \\(N\\times p\\) matrix such that \\(\\boldsymbol{Y}_i\\sim N_p(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})\\), \\(i=1,2,\\dots,N\\), that is, each \\(i\\)-th row of \\(\\boldsymbol{Y}\\) follows a multivariate normal distribution. Then, assuming independence between rows, let’s show that \\(p(\\boldsymbol{y}_1,\\boldsymbol{y}_2,\\dots,\\boldsymbol{y}_N\\mid \\boldsymbol{\\mu},\\boldsymbol{\\Sigma})\\) is in the exponential family. \\[\\begin{align} p(\\boldsymbol{y}_1,\\dots,\\boldsymbol{y}_N\\mid \\boldsymbol{\\mu},\\boldsymbol{\\Sigma})&amp;=\\prod_{i=1}^N (2\\pi)^{-p/2}| \\Sigma|^{-1/2}\\exp\\left\\{-\\frac{1}{2}\\left(\\boldsymbol{y}_i-\\boldsymbol{\\mu}\\right)^{\\top}\\boldsymbol{\\Sigma}^{-1}\\left(\\boldsymbol{y}_i-\\boldsymbol{\\mu}\\right)\\right\\}\\nonumber\\\\ &amp;= (2\\pi)^{-pN/2}|\\Sigma|^{-N/2}\\exp\\left\\{-\\frac{1}{2}tr\\left[\\sum_{i=1}^N\\left(\\boldsymbol{y}_i-\\boldsymbol{\\mu}\\right)^{\\top}\\boldsymbol{\\Sigma}^{-1}\\left(\\boldsymbol{y}_i-\\boldsymbol{\\mu}\\right)\\right]\\right\\}\\nonumber\\\\ &amp;= (2\\pi)^{-p N/2}|\\Sigma|^{-N/2}\\exp\\left\\{-\\frac{1}{2}tr\\left[\\left(\\boldsymbol{S}+N\\left(\\boldsymbol{\\mu}-\\hat{\\boldsymbol{\\mu}}\\right)\\left(\\boldsymbol{\\mu}-\\hat{\\boldsymbol{\\mu}}\\right)^{\\top}\\right)\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\}\\nonumber\\\\ &amp;= (2\\pi)^{-p N/2}\\exp\\left\\{-\\frac{1}{2}\\left[\\left(vec\\left(\\boldsymbol{S}\\right)^{\\top}+N vec\\left(\\hat{\\boldsymbol{\\mu}}\\hat{\\boldsymbol{\\mu}}^{\\top}\\right)^{\\top}\\right)vec \\left(\\boldsymbol{\\Sigma}^{-1}\\right)\\right.\\right.\\nonumber\\\\ &amp;\\left.\\left.-2N\\hat{\\boldsymbol{\\mu}}^{\\top}vec\\left(\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)+N tr\\left(\\boldsymbol{\\mu}\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)+N\\log (|\\boldsymbol{\\Sigma}|)\\right]\\right\\}\\nonumber, \\end{align}\\] where the second line uses the trace operator (\\(\\text{tr}\\)), and its invariance under cyclic permutation is applied in the third line. Additionally, we add and subtract \\(\\hat{\\boldsymbol{\\mu}} = \\frac{1}{N}\\sum_{i=1}^N \\boldsymbol{y}_i\\) inside each parenthesis, resulting in \\(\\boldsymbol{S} = \\sum_{i=1}^N \\left(\\boldsymbol{y}_i - \\hat{\\boldsymbol{\\mu}}\\right) \\left(\\boldsymbol{y}_i - \\hat{\\boldsymbol{\\mu}}\\right)^{\\top}\\). The fourth line is obtained after collecting terms and using properties of the trace operator to introduce the vectorization operator (\\(\\text{vec}\\)), specifically, \\(\\text{tr}(\\boldsymbol{A}^{\\top}\\boldsymbol{B}) = \\text{vec}(\\boldsymbol{A})^{\\top} \\text{vec}(\\boldsymbol{B})\\), and \\(\\text{vec}(\\boldsymbol{A} + \\boldsymbol{B}) = \\text{vec}(\\boldsymbol{A}) + \\text{vec}(\\boldsymbol{B})\\). Then \\(h(\\boldsymbol{y})=(2\\pi)^{-pN/2}\\), \\(\\eta(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})^{\\top}=\\left[\\left(vec\\left(\\boldsymbol{\\Sigma}^{-1}\\right)\\right)^{\\top} \\ \\ \\left(vec\\left(\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)\\right)^{\\top}\\right]\\), \\(T(\\boldsymbol{y})=\\left[-\\frac{1}{2}\\left(vec\\left(\\boldsymbol{S}\\right)^{\\top}+N vec\\left(\\hat{\\boldsymbol{\\mu}}\\hat{\\boldsymbol{\\mu}}^{\\top}\\right)^{\\top}\\right) \\ \\ -N\\hat{\\boldsymbol{\\mu}}^{\\top}\\right]^{\\top}\\) and \\(C(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})=\\exp\\left\\{-\\frac{1}{2}\\left(tr\\left(\\boldsymbol{\\mu}\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)+\\log(|\\Sigma|)\\right)\\right\\}\\). References Chib, Siddhartha. 1995. “Marginal Likelihood from the Gibbs Output.” Journal of the American Statistical Association 90 (432): 1313–21. Chib, Siddhartha, and Ivan Jeliazkov. 2001. “Marginal Likelihood from the Metropolis–Hastings Output.” Journal of the American Statistical Association 96 (453): 270–81. Gelfand, A. E., and A. F. M. Smith. 1990. “Sampling-Based Approaches to Calculating Marginal Densities.” Journal of the American Statistical Association 85: 398–409. Gelfand, Alan E, and Dipak K Dey. 1994. “Bayesian Model Choice: Asymptotics and Exact Calculations.” Journal of the Royal Statistical Society: Series B (Methodological) 56 (3): 501–14. Geman, S, and D. Geman. 1984. “Stochastic Relaxation, Gibbs Distributions and the Bayesian Restoration of Images.” IEEE Transactions on Pattern Analysis and Machine Intelligence 6: 721–41. Hastings, W. 1970. “Monte Carlo Sampling Methods Using Markov Chains and Their Application.” Biometrika 57: 97–109. Metropolis, N., A. Rosenbluth, M. Rosenbluth, A. Teller, and E. Teller. 1953. “Equations of State Calculations by Fast Computing Machines.” J. Chem. Phys 21: 1087–92. Schlaifer, Robert, and Howard Raiffa. 1961. Applied Statistical Decision Theory. Tierney, Luke. 1994. “Markov Chains for Exploring Posterior Distributions.” The Annals of Statistics, 1701–28. Tierney, Luke, and Joseph B Kadane. 1986. “Accurate Approximations for Posterior Moments and Marginal Densities.” Journal of the American Statistical Association 81 (393): 82–86. "],["sec42.html", "3.2 Conjugate prior to exponential family", " 3.2 Conjugate prior to exponential family Theorem 4.2.1 The prior distribution \\(\\pi(\\boldsymbol{\\theta})\\propto C(\\boldsymbol{\\theta})^{b_0}\\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{a}_0\\right\\}\\) is conjugate to the exponential family (equation (3.4)). Proof \\[\\begin{align} \\pi(\\boldsymbol{\\theta}\\mid \\boldsymbol{y})&amp; \\propto C(\\boldsymbol{\\theta})^{b_0}\\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{a}_0\\right\\} \\times h(\\boldsymbol{y}) C(\\boldsymbol{\\theta})^N\\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{T}(\\boldsymbol{y})\\right\\}\\nonumber\\\\ &amp; \\propto C(\\boldsymbol{\\theta})^{N+b_0} \\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}(\\boldsymbol{T}(\\boldsymbol{y})+\\boldsymbol{a}_0)\\right\\}.\\nonumber \\end{align}\\] Observe that the posterior is in the exponential family, \\(\\pi(\\boldsymbol{\\theta}\\mid \\boldsymbol{y})\\propto C(\\boldsymbol{\\theta})^{\\beta_n} \\exp\\left\\{\\eta(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{\\alpha}_n\\right\\}\\), \\(\\beta_n=N+b_0\\) and \\(\\boldsymbol{\\alpha}_n=\\boldsymbol{T}(\\boldsymbol{y})+\\boldsymbol{a}_0\\). Remarks We observe, by comparing the prior and the likelihood, that \\(b_0\\) plays the role of a hypothetical sample size, and \\(\\boldsymbol{a}_0\\) plays the role of hypothetical sufficient statistics. This perspective aids the elicitation process, that is, integrating non-sample information into the prior distribution. We established this result in the standard form of the exponential family. We can also establish it in the canonical form of the exponential family. Observe that, given \\(\\boldsymbol{\\eta} = \\boldsymbol{\\eta}(\\boldsymbol{\\theta})\\), another way to derive a prior for \\(\\boldsymbol{\\eta}\\) is to use the change of variable theorem, given a bijective function. In the case where there is a regular conjugate prior, Diaconis, Ylvisaker, et al. (1979) show that the posterior expectation of the sufficient statistics is a weighted average between the prior expectation and the likelihood estimate. 3.2.1 Examples: Theorem 4.2.1 Likelihood functions from discrete distributions The Poisson-gamma model Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a Poisson distribution then a conjugate prior density for \\(\\lambda\\) has the form \\[\\begin{align} \\pi(\\lambda)&amp;\\propto \\left(\\exp(-\\lambda)\\right)^{b_0} \\exp\\left\\{a_0\\log(\\lambda)\\right\\}\\nonumber\\\\ &amp; = \\exp(-\\lambda b_0) \\lambda^{a_0}\\nonumber\\\\ &amp; = \\exp(-\\lambda \\beta_0) \\lambda^{\\alpha_0-1}.\\nonumber \\end{align}\\] This is the kernel of a gamma density in the rate parametrization, \\(G(\\alpha_0, \\beta_0)\\), where \\(\\alpha_0 = a_0 + 1\\) and \\(\\beta_0 = b_0\\).1 Thus, a prior conjugate distribution for the Poisson likelihood is a gamma distribution. Since \\(\\sum_{i=1}^N Y_i\\) is a sufficient statistic for the Poisson distribution, we can interpret \\(a_0\\) as the number of occurrences in \\(b_0\\) experiments. Observe that \\[\\begin{align} \\pi(\\lambda\\mid \\boldsymbol{y})&amp;\\propto \\exp(-\\lambda \\beta_0) \\lambda^{\\alpha_0-1} \\times \\exp(-N\\lambda)\\lambda^{\\sum_{i=1}^Ny_i}\\nonumber\\\\ &amp;= \\exp(-\\lambda(N+\\beta_0)) \\lambda^{\\sum_{i=1}^Ny_i+\\alpha_0-1}.\\nonumber \\end{align}\\] As expected, this is the kernel of a gamma distribution, which means \\(\\lambda\\mid \\boldsymbol{y}\\sim G(\\alpha_n,\\beta_n)\\), \\(\\alpha_n=\\sum_{i=1}^Ny_i+\\alpha_0\\) and \\(\\beta_n=N+\\beta_0\\). Observe that \\(\\alpha_0/\\beta_0\\) is the prior mean, and \\(\\alpha_0/\\beta_0^2\\) is the prior variance. Then, \\(\\alpha_0\\rightarrow 0\\) and \\(\\beta_0\\rightarrow 0\\) imply a non-informative prior such that the posterior mean converges to the maximum likelihood estimate \\(\\bar{y}=\\frac{\\sum_{i=1}^N y_i}{N}\\), \\[\\begin{align} \\mathbb{E}\\left[\\lambda\\mid \\boldsymbol{y}\\right]&amp;=\\frac{\\alpha_n}{\\beta_n}\\nonumber\\\\ &amp;=\\frac{\\sum_{i=1}^Ny_i+\\alpha_0}{N+\\beta_0}\\nonumber\\\\ &amp;=\\frac{N\\bar{y}}{N+\\beta_0}+\\frac{\\alpha_0}{N+\\beta_0}.\\nonumber \\end{align}\\] The posterior mean is a weighted average of the sample and prior information. This is a general result for regular conjugate priors (Diaconis, Ylvisaker, et al. 1979). Note that \\(\\lim_{N \\to \\infty} \\mathbb{E}[\\lambda \\mid \\boldsymbol{y}] = \\bar{y}\\). Additionally, \\(\\alpha_0 \\to 0\\) and \\(\\beta_0 \\to 0\\) corresponds to \\(\\pi(\\lambda) \\propto \\frac{1}{\\lambda}\\), which is an improper prior. Improper priors may have undesirable consequences for Bayes factors (hypothesis testing); see below for a discussion of this in the linear regression framework. In this example, we can obtain analytical solutions for the marginal likelihood and the predictive distribution (see the health insurance example and Exercise 3 in Chapter 1). The Bernoulli-beta model Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a Bernoulli distribution then a conjugate prior density for \\(\\theta\\) has the form \\[\\begin{align} \\pi(\\theta)&amp;\\propto (1-\\theta)^{b_0} \\exp\\left\\{a_0\\log\\left(\\frac{\\theta}{1-\\theta}\\right)\\right\\}\\nonumber\\\\ &amp; = (1-\\theta)^{b_0-a_0}\\theta^{a_0}\\nonumber\\\\ &amp; = \\theta^{\\alpha_0-1}(1-\\theta)^{\\beta_0-1}.\\nonumber \\end{align}\\] This is the kernel of a beta density, \\(B(\\alpha_0, \\beta_0)\\), where \\(\\alpha_0 = a_0 + 1\\) and \\(\\beta_0 = b_0 - a_0 + 1\\). A prior conjugate distribution for the Bernoulli likelihood is a beta distribution. Given that \\(b_0\\) is the hypothetical sample size and \\(a_0\\) is the hypothetical sufficient statistic (the number of successes), \\(b_0 - a_0\\) represents the number of failures. This implies that \\(\\alpha_0\\) is the number of prior successes plus one, and \\(\\beta_0\\) is the number of prior failures plus one. Since the mode of a beta-distributed random variable is given by \\(\\frac{\\alpha_0 - 1}{\\alpha_0 + \\beta_0 - 2} = \\frac{a_0}{b_0}\\), we can interpret this as the prior probability of success. Setting \\(\\alpha_0 = 1\\) and \\(\\beta_0 = 1\\), which corresponds to a uniform distribution on the interval [0, 1], represents a setting with 0 successes (and 0 failures) in 0 experiments. Observe that \\[\\begin{align} \\pi(\\theta\\mid \\boldsymbol{y})&amp;\\propto \\theta^{\\alpha_0-1}(1-\\theta)^{\\beta_0-1} \\times \\theta^{\\sum_{i=1}^N y_i}(1-\\theta)^{N-\\sum_{i=1}^Ny_i}\\nonumber\\\\ &amp;= \\theta^{\\alpha_0+\\sum_{i=1}^N y_i-1}(1-\\theta)^{\\beta_0+N-\\sum_{i=1}^Ny_i-1}.\\nonumber \\end{align}\\] The posterior distribution is beta, \\(\\theta\\mid \\boldsymbol{y}\\sim B(\\alpha_n,\\beta_n)\\), \\(\\alpha_n=\\alpha_0+\\sum_{i=1}^N y_i\\) and \\(\\beta_n=\\beta_0+N-\\sum_{i=1}^Ny_i\\), where the posterior mean \\(\\mathbb{E}[\\theta\\mid \\boldsymbol{y}]=\\frac{\\alpha_n}{\\alpha_n+\\beta_n}=\\frac{\\alpha_0+N\\bar{y}}{\\alpha_0+\\beta_0+N}=\\frac{\\alpha_0+\\beta_0}{\\alpha_0+\\beta_0+N}\\frac{\\alpha_0}{\\alpha_0+\\beta_0}+\\frac{N}{\\alpha_0+\\beta_0+N}\\bar{y}\\). The posterior mean is a weighted average between the prior mean and the maximum likelihood estimate. El marginal likelihood in this setting is \\[\\begin{align} p(\\boldsymbol{y})=&amp;\\int_{0}^1 \\frac{\\theta^{\\alpha_0-1}(1-\\theta)^{\\beta_0-1}}{B(\\alpha_0,\\beta_0)}\\times \\theta^{\\sum_{i=1}^N y_i}(1-\\theta)^{N-\\sum_{i=1}^N y_i}d\\theta\\nonumber\\\\ =&amp; \\frac{B(\\alpha_n,\\beta_n)}{B(\\alpha_0,\\beta_0)},\\nonumber \\end{align}\\] where \\(B(\\cdot ,\\cdot)\\) is the beta function. In addition, the predictive density is \\[\\begin{align} p(y_0\\mid \\boldsymbol{y})&amp;=\\int_0^1 \\theta^{y_0}(1-\\theta)^{1-y_0}\\times \\frac{\\theta^{\\alpha_n-1}(1-\\theta)^{\\beta_n-1}}{B(\\alpha_n,\\beta_n)}d\\theta\\nonumber\\\\ &amp;=\\frac{B(\\alpha_n+y_0,\\beta_n+1-y_0)}{B(\\alpha_n,\\beta_n)}\\nonumber\\\\ &amp;=\\frac{\\Gamma(\\alpha_n+\\beta_n)\\Gamma(\\alpha_n+y_0)\\Gamma(\\beta_n+1-y_0)}{\\Gamma(\\alpha_n+\\beta_n+1)\\Gamma(\\alpha_n)\\Gamma(\\beta_n)}\\nonumber\\\\ &amp;=\\begin{Bmatrix} \\frac{\\alpha_n}{\\alpha_n+\\beta_n}, &amp; y_0=1\\\\ \\frac{\\beta_n}{\\alpha_n+\\beta_n}, &amp; y_0=0\\\\ \\end{Bmatrix}.\\nonumber \\end{align}\\] This is a Bernoulli distribution with probability of success equal to \\(\\frac{\\alpha_n}{\\alpha_n+\\beta_n}\\). The multinomial-Dirichlet model Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a multinomial distribution then a conjugate prior density for \\(\\boldsymbol{\\theta}=\\left[\\theta_1 \\ \\theta_2 \\ \\dots \\ \\theta_m\\right]\\) has the form \\[\\begin{align} \\pi(\\boldsymbol{\\theta})&amp;\\propto \\theta_m^{b_0} \\exp\\left\\{\\boldsymbol{\\eta}(\\boldsymbol{\\theta})^{\\top}\\boldsymbol{a}_0\\right\\}\\nonumber\\\\ &amp; = \\prod_{l=1}^{m-1}\\theta_l^{a_{0l}}\\theta_m^{b_0-\\sum_{l=1}^{m-1}a_{0l}}\\nonumber\\\\ &amp; = \\prod_{l=1}^{m}\\theta_l^{\\alpha_{0l}-1},\\nonumber \\end{align}\\] where \\(\\boldsymbol{\\eta}(\\boldsymbol{\\theta})=\\left[\\log\\left(\\frac{\\theta_1}{\\theta_m}\\right) \\ \\dots \\ \\log\\left(\\frac{\\theta_{m-1}}{\\theta_m}\\right)\\right]\\), \\(\\boldsymbol{a}_0=\\left[a_{01} \\ \\dots \\ a_{0m-1}\\right]^{\\top}\\), \\(\\boldsymbol{\\alpha}_0=\\left[\\alpha_{01} \\ \\alpha_{02} \\ \\dots \\ \\alpha_{0m}\\right]\\), \\(\\alpha_{0l}=a_{0l}+1\\), \\(l=1,2,\\dots,m-1\\) and \\(\\alpha_{0m}=b_0-\\sum_{l=1}^{m-1} a_{0l}+1\\). This is the kernel of a Dirichlet distribution, that is, the prior distribution is \\(D(\\boldsymbol{\\alpha}_0)\\). Observe that \\(a_{0l}\\) is the hypothetical number of times outcome \\(l\\) is observed over the hypothetical \\(b_0\\) trials. Setting \\(\\alpha_{0l} = 1\\), which corresponds to a uniform distribution over the open standard simplex, implicitly sets \\(a_{0l} = 0\\), meaning that there are 0 occurrences of category \\(l\\) in \\(b_0 = 0\\) experiments. The posterior distribution of the multinomial-Dirichlet model is given by \\[\\begin{align} \\pi(\\boldsymbol{\\theta}\\mid \\boldsymbol{y})&amp;\\propto \\prod_{l=1}^m \\theta_l^{\\alpha_{0l}-1}\\times\\prod_{l=1}^m \\theta_l^{\\sum_{i=1}^{N} y_{il}}\\nonumber\\\\ &amp;=\\prod_{l=1}^m \\theta_l^{\\alpha_{0l}+\\sum_{i=1}^{N} y_{il}-1}\\nonumber. \\end{align}\\] This is the kernel of a Dirichlet distribution \\(D(\\boldsymbol{\\alpha}_n)\\), \\(\\boldsymbol{\\alpha}_n=\\left[\\alpha_{n1} \\ \\alpha_{n2} \\ \\dots \\ \\alpha_{nm}\\right]\\), \\(\\alpha_{nl}=\\alpha_{0l}+\\sum_{i=1}^{N}y_{il}\\), \\(l=1,2,\\dots,m\\). Observe that \\[\\begin{align} \\mathbb{E}[\\theta_{j}\\mid \\boldsymbol{y}]&amp;=\\frac{\\alpha_{nj}}{\\sum_{l=1}^m \\left[\\alpha_{0l}+\\sum_{i=1}^N y_{il}\\right]}\\nonumber\\\\ &amp;=\\frac{\\sum_{l=1}^m \\alpha_{0l}}{\\sum_{l=1}^m \\left[\\alpha_{0l}+\\sum_{i=1}^N y_{il}\\right]}\\frac{\\alpha_{0j}}{\\sum_{l=1}^m \\alpha_{0l}}\\nonumber\\\\ &amp;+\\frac{\\sum_{l=1}^m\\sum_{i=1}^N y_{il}}{\\sum_{l=1}^m \\left[\\alpha_{0l}+\\sum_{i=1}^N y_{il}\\right]}\\frac{\\sum_{i=1}^N y_{ij}}{\\sum_{l=1}^m\\sum_{i=1}^N y_{il}}.\\nonumber \\end{align}\\] We have again that the posterior mean is a weighted average between the prior mean and the maximum likelihood estimate. The marginal likelihood is \\[\\begin{align} p(\\boldsymbol{y})&amp;=\\int_{\\boldsymbol{\\Theta}}\\frac{\\prod_{l=1}^m \\theta_l^{\\alpha_{0l}-1}}{B(\\boldsymbol{\\alpha}_0)}\\times \\prod_{i=1}^N\\frac{n!}{\\prod_{l=1}^m y_{il}!}\\prod_{l=1}^m \\theta_{l}^{y_{il}}d\\boldsymbol{\\theta}\\nonumber\\\\ &amp;=\\frac{N\\times n!}{B(\\boldsymbol{\\alpha}_0)\\prod_{i=1}^N\\prod_{l=1}^m y_{il}!}\\int_{\\boldsymbol{\\Theta}} \\prod_{l=1}^m \\theta_l^{\\alpha_{0l}+\\sum_{i=1}^N y_{il}-1} d\\boldsymbol{\\theta}\\nonumber\\\\ &amp;=\\frac{N\\times n!}{B(\\boldsymbol{\\alpha}_0)\\prod_{i=1}^N\\prod_{l=1}^m y_{il}!}B(\\boldsymbol{\\alpha}_n)\\nonumber\\\\ &amp;=\\frac{N\\times n! \\Gamma\\left(\\sum_{l=1}^m\\nonumber \\alpha_{0l}\\right)}{\\Gamma\\left(\\sum_{l=1}^m \\alpha_{0l}+N\\times n\\right)}\\prod_{l=1}^m \\frac{\\Gamma\\left( \\alpha_{nl}\\right)}{\\Gamma\\left(\\alpha_{0l}\\right)\\prod_{i=1}^N y_{il}!},\\nonumber \\end{align}\\] where \\(B(\\boldsymbol{\\alpha})=\\frac{\\prod_{l=1}^m\\Gamma(\\alpha_l)}{\\Gamma\\left(\\sum_{l=1}^m \\alpha_l\\right)}\\). Following similar steps we get the predictive density \\[\\begin{align} p(y_0\\mid \\boldsymbol{y})&amp;=\\frac{ n! \\Gamma\\left(\\sum_{l=1}^m \\alpha_{nl}\\right)}{\\Gamma\\left(\\sum_{l=1}^m \\alpha_{nl}+ n\\right)}\\prod_{l=1}^m \\frac{\\Gamma\\left( \\alpha_{nl}+y_{0l}\\right)}{\\Gamma\\left(\\alpha_{nl}\\right) y_{0l}!}.\\nonumber \\end{align}\\] This is a Dirichlet-multinomial distribution with parameters \\(\\boldsymbol{\\alpha}_n\\). Example: English premier league, Liverpool vs Manchester city Let’s consider an example using data from the English Premier League. In particular, we want to calculate the probability that, in the next five matches between Liverpool and Manchester City, Liverpool wins two games and Manchester City wins three. This calculation is based on historical data from the last five matches where Liverpool played at home between January 14th, 2018, and April 10th, 2022. In those matches, Liverpool secured two wins, there were two draws, and Manchester City won one match. 2 We use two strategies to estimate the hyperparameters. First, we estimate the hyperparameters of the Dirichlet distribution using betting odds from bookmakers at 19:05 on October 6th, 2022 (Colombia time). We obtained data from 24 bookmakers (see file DataOddsLIVvsMAN.csv)3, and we transform these odds into probabilities using a simple standardization approach. Then, we apply maximum likelihood estimation to estimate the hyperparameters. Second, we use empirical Bayes, where we estimate the hyperparameters by optimizing the marginal likelihood. ########### Dirichlet-Multinomial model: Liverpool vs Manchester City ############## # Clear workspace and set reproducible seed rm(list = ls()) set.seed(10101) ########################## Multinomial-Dirichlet example: Liverpool vs Manchester City ########################## # Load required libraries library(dplyr) ## ## Attaching package: &#39;dplyr&#39; ## The following objects are masked from &#39;package:stats&#39;: ## ## filter, lag ## The following objects are masked from &#39;package:base&#39;: ## ## intersect, setdiff, setequal, union library(readr) library(sirt) ## - sirt 4.1-15 (2024-02-06 00:05:40) library(MCMCpack) ## Warning: package &#39;MCMCpack&#39; was built under R version 4.5.2 ## Loading required package: coda ## Loading required package: MASS ## ## Attaching package: &#39;MASS&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## select ## ## ## ## Markov Chain Monte Carlo Package (MCMCpack) ## ## Copyright (C) 2003-2025 Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park ## ## ## ## Support provided by the U.S. National Science Foundation ## ## (Grants SES-0350646 and SES-0350613) ## ## library(Compositional) ## ## Compositional: 7.3 ## _ _ _ _ ## / _ _ _\\ ## / / ## | | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ ## | | | _ _ | / \\ / \\ | _ _ | | _ _ | | _ _ _/ |_| _| |_ |_| | _ _ | / _ _ \\ / _ _ \\ | | ## | | | | | | | \\/ | | | | | | | | | |_ _ _ | _ |_ _| _ | | | | | | | | | | | | | | ## \\ \\ _ _ _ | |_ _| | | |\\__/| | | |_ _| | | |_ _| | _ _ _| | | | | |_ | | | |_ _| | | | | | | |_ _| \\_ | | ## \\_ _ _ _ / |_ _ _ _| |_| |_| | _ _ _| |_ _ _ _| /_ _ _ _| |_| |_ _\\ |_| |_ _ _ _| |_| |_| \\_ _ _ _ _/ |_| ## | | ## |_| ## ## Attaching package: &#39;Compositional&#39; ## The following object is masked from &#39;package:sirt&#39;: ## ## pow # Load data data &lt;- read_csv( &quot;https://raw.githubusercontent.com/besmarter/BSTApp/refs/heads/master/DataApp/DataOddsLIVvsMAN.csv&quot;, show_col_types = FALSE ) # Match and odds info: # - Odds collected: 2022-10-06 19:00 (Colombia time) # - Match played: 2022-10-16 # Source: https://www.oddsportal.com/soccer/england/premier-league/liverpool-manchester-city-WrqgEz5S/ # Compute implied probabilities from odds probs &lt;- data %&gt;% mutate( pns1 = 1 / home, pns2 = 1 / draw, pns3 = 1 / away, sum_inv_odds = pns1 + pns2 + pns3, p1 = pns1 / sum_inv_odds, p2 = pns2 / sum_inv_odds, p3 = pns3 / sum_inv_odds ) %&gt;% dplyr::select(p1, p2, p3) # Estimate Dirichlet parameters from betting odds dir_mle &lt;- dirichlet.mle(probs) alpha0_odds &lt;- dir_mle$alpha print(alpha0_odds) ## p1 p2 p3 ## 1599.122 1342.703 2483.129 # Historical results: 2 wins Liverpool, 2 draws, 1 win Man City # Source: https://www.11v11.com/teams/manchester-city/tab/opposingTeams/opposition/Liverpool/ y &lt;- c(2, 2, 1) # Marginal log-likelihood function (negative for optimization) marginal_likelihood &lt;- function(alpha) { n &lt;- sum(y) res1 &lt;- sum(sapply(seq_along(y), function(i) { lgamma(alpha[i] + y[i]) - lgamma(alpha[i]) })) res &lt;- lgamma(sum(alpha)) - lgamma(sum(alpha) + n) + res1 return(-res) } # Empirical Bayes estimate using MLE emp_bayes &lt;- optim(alpha0_odds, marginal_likelihood, method = &quot;BFGS&quot;, control = list(maxit = 10000)) alpha0_eb &lt;- emp_bayes$par print(alpha0_eb) ## p1 p2 p3 ## 2362.622 2660.153 1279.510 # Compare with prior based on odds print(alpha0_odds) ## p1 p2 p3 ## 1599.122 1342.703 2483.129 # Bayes factor: empirical Bayes vs odds-based prior bf &lt;- exp(-marginal_likelihood(alpha0_eb)) / exp(-marginal_likelihood(alpha0_odds)) print(bf) ## [1] 2.085819 # Posterior parameters (empirical Bayes prior + data) alpha_n &lt;- alpha0_eb + y # Draw posterior samples set.seed(10101) S &lt;- 100000 thetas &lt;- rdirichlet(S, alpha_n) colnames(thetas) &lt;- c(&quot;Liverpool&quot;, &quot;Draw&quot;, &quot;Manchester&quot;) head(thetas) ## Liverpool Draw Manchester ## [1,] 0.3678062 0.4293378 0.2028560 ## [2,] 0.3691963 0.4309123 0.1998915 ## [3,] 0.3730995 0.4154875 0.2114129 ## [4,] 0.3795829 0.4230345 0.1973826 ## [5,] 0.3738765 0.4209246 0.2051989 ## [6,] 0.3770364 0.4208721 0.2020915 # Visualize posterior distribution bivt.contour(thetas, cont.line = FALSE, appear = FALSE) # Predictive distribution for hypothetical outcome y0 &lt;- c(2, 0, 3) pred_draws &lt;- apply(thetas, 1, function(p) { rmultinom(1, size = sum(y0), prob = p) }) prob_y0_sim &lt;- mean(apply(pred_draws, 2, function(draw) all(draw == y0))) print(prob_y0_sim) ## [1] 0.01202 # Predictive probability using closed-form expression predictive_prob_y0 &lt;- function(y0) { n &lt;- sum(y0) res1 &lt;- sum(sapply(seq_along(y), function(i) { lgamma(alpha_n[i] + y0[i]) - lgamma(alpha_n[i]) - lfactorial(y0[i]) })) res &lt;- lfactorial(n) + lgamma(sum(alpha_n)) - lgamma(sum(alpha_n) + n) + res1 return(exp(res)) } predictive_prob_y0(y0) ## [1] 0.01177531 We observe that the Bayes factor provides evidence in favor of the hyperparameters estimated via empirical Bayes, as these hyperparameters are specifically chosen to maximize the marginal likelihood. Using the hyperparameters obtained from empirical Bayes, we calculate that the probability of Liverpool winning two out of the next five games, while Manchester City wins three, is 1.2%. The result obtained from the predictive distribution via simulations is similar to the probability derived using the exact predictive distribution. Likelihood functions from continuous distributions The normal-normal/inverse-gamma model Given a random sample \\(\\boldsymbol{Y}=[Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from a normal distribution, then the conjugate prior density has the form \\[\\begin{align} \\pi(\\mu,\\sigma^2)&amp;\\propto \\exp\\left\\{b_0\\left(-\\frac{\\mu^2}{2\\sigma^2}-\\frac{\\log \\sigma^2}{2}\\right)\\right\\}\\exp\\left\\{a_{01}\\frac{\\mu}{\\sigma^2}-a_{02}\\frac{1}{\\sigma^2}\\right\\}\\nonumber\\\\ &amp;=\\exp\\left\\{b_0\\left(-\\frac{\\mu^2}{2\\sigma^2}-\\frac{\\log \\sigma^2}{2}\\right)\\right\\}\\exp\\left\\{a_{01}\\frac{\\mu}{\\sigma^2}-a_{02}\\frac{1}{\\sigma^2}\\right\\}\\nonumber\\\\ &amp;\\times \\exp\\left\\{-\\frac{a_{01}^2}{2\\sigma^2b_0}\\right\\}\\exp\\left\\{\\frac{a_{01}^2}{2\\sigma^2b_0}\\right\\}\\nonumber\\\\ &amp;=\\exp\\left\\{-\\frac{b_0}{2\\sigma^2}\\left(\\mu-\\frac{a_{01}}{b_0}\\right)^2\\right\\}\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{b_0+1-1}{2}}\\nonumber\\\\ &amp;\\times \\exp\\left\\{\\frac{1}{\\sigma^2}\\frac{-2b_0a_{02}+a_{01}^2}{2b_0}\\right\\}\\nonumber\\\\ &amp;=\\underbrace{\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{1}{2}}\\exp\\left\\{-\\frac{b_0}{2\\sigma^2}\\left(\\mu-\\frac{a_{01}}{b_0}\\right)^2\\right\\}}_{1}\\nonumber\\\\ &amp;\\times\\underbrace{\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{b_0-1}{2}}\\exp\\left\\{-\\frac{1}{\\sigma^2}\\frac{2b_0a_{02}-a_{01}^2}{2b_0}\\right\\}}_{2}.\\nonumber \\end{align}\\] The first part is the kernel of a normal density with mean \\(\\mu_0 = \\frac{a_{01}}{\\beta_0}\\) and variance \\(\\frac{\\sigma^2}{\\beta_0}\\), where \\(\\beta_0 = b_0\\). That is, \\(\\mu \\mid \\sigma^2 \\sim N\\left(\\mu_0, \\frac{\\sigma^2}{\\beta_0}\\right)\\). The second part is the kernel of an inverse gamma density with shape parameter \\(\\frac{\\alpha_0}{2} = \\frac{\\beta_0 - 3}{2}\\) and scale parameter \\(\\frac{\\delta_0}{2} = \\frac{2\\beta_0 a_{02} - a_{01}^2}{2\\beta_0}\\), so \\(\\sigma^2 \\sim IG\\left(\\frac{\\alpha_0}{2}, \\frac{\\delta_0}{2}\\right)\\). Observe that \\(b_0 = \\beta_0\\) represents the hypothetical sample size, and \\(a_{01}\\) is the hypothetical sum of prior observations. Therefore, it makes sense that \\(\\frac{a_{01}}{\\beta_0}\\) and \\(\\frac{\\sigma^2}{\\beta_0}\\) represent the prior mean and variance, respectively. Therefore, the posterior distribution is also a normal-inverse gamma distribution, \\[\\begin{align} \\pi(\\mu,\\sigma^2\\mid \\boldsymbol{y})&amp;\\propto \\left(\\frac{1}{\\sigma^2}\\right)^{1/2}\\exp\\left\\{-\\frac{\\beta_0}{2\\sigma^2}(\\mu-\\mu_0)^2\\right\\}\\left(\\frac{1}{\\sigma^2}\\right)^{\\alpha_0/2+1}\\exp\\left\\{-\\frac{\\delta_0}{2\\sigma^2}\\right\\}\\nonumber\\\\ &amp;\\times(\\sigma^2)^{-N/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\sum_{i=1}^N (y_i-\\mu)^2\\right\\}\\nonumber\\\\ &amp; = \\left(\\frac{1}{\\sigma^2}\\right)^{1/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\left(\\beta_0(\\mu-\\mu_0)^2+\\sum_{i=1}^N (y_i-\\bar{y})^2+N(\\mu-\\bar{y})^2+\\delta_0\\right.\\right.\\nonumber\\\\ &amp; + \\left.\\left.\\frac{(\\beta_0\\mu_0+N\\bar{y})^2}{\\beta_0+N} - \\frac{(\\beta_0\\mu_0+N\\bar{y})^2}{\\beta_0+N}\\right)\\right\\}\\times\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_0+N}{2}+1}\\nonumber\\\\ &amp; = \\underbrace{\\left(\\frac{1}{\\sigma^2}\\right)^{1/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\left((\\beta_0+N)\\left(\\mu-\\left(\\frac{\\beta_0\\mu_0+N\\bar{y}}{\\beta_0+N}\\right)\\right)^2\\right)\\right\\}}_{1}\\nonumber\\\\ &amp; \\times \\underbrace{\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_0+N}{2}+1}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\left(\\sum_{i=1}^N (y_i-\\bar{y})^2+\\delta_0+\\frac{\\beta_0N}{\\beta_0+N}(\\bar{y}-\\mu_0)^2\\right)\\right\\}}_{2}.\\nonumber \\end{align}\\] The first term is the kernel of a normal density, \\(\\mu\\mid \\sigma^2,\\boldsymbol{y}\\sim N \\left(\\mu_n, \\sigma_n^2\\right)\\), where \\(\\mu_n=\\frac{\\beta_0\\mu_0+N\\bar{y}}{\\beta_0+N}\\) and \\(\\sigma_n^2=\\frac{\\sigma^2}{\\beta_n}\\), \\(\\beta_n=\\beta_0+N\\). The second term is the kernel of an inverse gamma density, \\(\\sigma^2\\mid \\boldsymbol{y}\\sim IG(\\alpha_n/2,\\delta_n/2)\\) where \\(\\alpha_n=\\alpha_0+N\\) and \\(\\delta_n=\\sum_{i=1}^N (y_i-\\bar{y})^2+\\delta_0+\\frac{\\beta_0N}{\\beta_0+N}(\\bar{y}-\\mu_0)^2\\). Observe that the posterior mean is a weighted average between prior and sample information. The weights depends on the sample sizes (\\(\\beta_0\\) and \\(N\\)). The marginal posterior for \\(\\sigma^2\\) is inverse gamma with shape and scale parameters \\(\\alpha_n/2\\) and \\(\\delta_n/2\\), respectively. The marginal posterior of \\(\\mu\\) is \\[\\begin{align} \\pi(\\mu\\mid \\boldsymbol{y})&amp;\\propto \\int_{0}^{\\infty}\\left\\{ \\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_n+1}{2}+1}\\exp\\left\\{-\\frac{1}{2\\sigma^2}(\\beta_n(\\mu-\\mu_n)^2+\\delta_n)\\right\\}\\right\\}d\\sigma^2\\nonumber\\\\ &amp;=\\frac{\\Gamma\\left(\\frac{\\alpha_n+1}{2}\\right)}{\\left[\\frac{\\beta_n(\\mu-\\mu_n)^2+\\delta_n}{2}\\right]^{\\frac{\\alpha_n+1}{2}}}\\nonumber\\\\ &amp;\\propto \\left[\\frac{\\beta_n(\\mu-\\mu_n)^2+\\delta_n}{2}\\right]^{-\\frac{\\alpha_n+1}{2}}\\left(\\frac{\\delta_n}{\\delta_n}\\right)^{-\\frac{\\alpha_n+1}{2}}\\nonumber\\\\ &amp;\\propto \\left[\\frac{\\alpha_n\\beta_n(\\mu-\\mu_n)^2}{\\alpha_n\\delta_n}+1\\right]^{-\\frac{\\alpha_n+1}{2}},\\nonumber \\end{align}\\] The second line follows from having the kernel of an inverse gamma density with parameters \\(\\frac{\\alpha_n + 1}{2}\\) and \\(\\frac{1}{2} \\left( \\beta_n (\\mu - \\mu_n)^2 + \\delta_n \\right)\\). This corresponds to the kernel of a Student’s \\(t\\)-distribution: \\[ \\mu \\mid \\boldsymbol{y} \\sim t\\left(\\mu_n, \\frac{\\delta_n}{\\beta_n \\alpha_n}, \\alpha_n\\right), \\] where \\(\\mathbb{E}[\\mu \\mid \\boldsymbol{y}] = \\mu_n\\) and \\[ \\text{Var}[\\mu \\mid \\boldsymbol{y}] = \\frac{\\alpha_n}{\\alpha_n - 2} \\left( \\frac{\\delta_n}{\\beta_n \\alpha_n} \\right) = \\frac{\\delta_n}{(\\alpha_n - 2) \\beta_n}, \\quad \\alpha_n &gt; 2. \\] Observe that the marginal posterior distribution for \\(\\mu\\) has heavier tails than the conditional posterior distribution due to the incorporation of uncertainty regarding \\(\\sigma^2\\). The marginal likelihood is \\[\\begin{align} p(\\boldsymbol{y})&amp;=\\int_{-\\infty}^{\\infty}\\int_{0}^{\\infty}\\left\\{ (2\\pi\\sigma^2/\\beta_0)^{-1/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2/\\beta_0}(\\mu-\\mu_0)^2\\right\\}\\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}\\left(\\frac{1}{\\sigma^2}\\right)^{\\alpha_0/2+1}\\right.\\nonumber\\\\ &amp;\\times\\left.\\exp\\left\\{-\\frac{\\delta_0}{2\\sigma^2}\\right\\}(2\\pi\\sigma^2)^{-N/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}\\sum_{i=1}^N(y_i-\\mu)^2\\right\\}\\right\\}d\\sigma^2d\\mu\\nonumber\\\\ &amp;=\\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}(2\\pi)^{-\\left(\\frac{N+1}{2}\\right)}\\beta_0^{1/2}\\int_{-\\infty}^{\\infty}\\int_{0}^{\\infty}\\left\\{\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_0+N+1}{2}+1}\\right.\\nonumber\\\\ &amp;\\times\\left.\\exp\\left\\{-\\frac{1}{2\\sigma^2}(\\beta_0(\\mu-\\mu_0)^2+\\sum_{i=1}^N (y_i-\\mu)^2+\\delta_0)\\right\\}\\right\\}d\\sigma^2d\\mu\\nonumber\\\\ &amp;=\\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}(2\\pi)^{-\\left(\\frac{N+1}{2}\\right)}\\beta_0^{1/2}\\Gamma\\left(\\frac{N+1+\\alpha_0}{2}\\right)\\nonumber\\\\ &amp;\\times \\int_{-\\infty}^{\\infty} \\left[\\frac{\\beta_0(\\mu-\\mu_0)^2+\\sum_{i=1}^N(y_i-\\mu)^2+\\delta_0}{2}\\right]^{-\\frac{\\alpha_0+N+1}{2}}d\\mu\\nonumber\\\\ &amp;=\\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}(2\\pi)^{-\\left(\\frac{N+1}{2}\\right)}\\beta_0^{1/2}\\Gamma\\left(\\frac{N+1+\\alpha_0}{2}\\right)\\nonumber\\\\ &amp;\\times \\int_{-\\infty}^{\\infty} \\left[\\frac{\\beta_n(\\mu-\\mu_n)^2+\\delta_n}{2}\\right]^{-\\frac{\\alpha_n+1}{2}}d\\mu\\left(\\frac{\\delta_n/2}{\\delta_n/2}\\right)^{-\\frac{\\alpha_n+1}{2}}\\nonumber\\\\ &amp;=\\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}(2\\pi)^{-\\left(\\frac{N+1}{2}\\right)}\\beta_0^{1/2}\\Gamma\\left(\\frac{\\alpha_n+1}{2}\\right)\\left(\\frac{\\delta_n}{2}\\right)^{-\\frac{\\alpha_n+1}{2}}\\frac{\\left(\\frac{\\delta_n\\pi}{\\beta_n}\\right)^{1/2}\\Gamma\\left(\\frac{\\alpha_n}{2}\\right)}{\\Gamma\\left(\\frac{\\alpha_n+1}{2}\\right)}\\nonumber\\\\ &amp;=\\frac{\\Gamma\\left(\\frac{\\alpha_n}{2}\\right)}{\\Gamma\\left(\\frac{\\alpha_0}{2}\\right)}\\frac{(\\delta_0/2)^{\\alpha_0/2}}{(\\delta_n/2)^{\\alpha_n/2}}\\left(\\frac{\\beta_0}{\\beta_n}\\right)^{1/2}(\\pi)^{-N/2},\\nonumber \\end{align}\\] where we take into account that \\(\\int_{-\\infty}^{\\infty} \\left[\\frac{\\beta_n(\\mu-\\mu_n)^2+\\delta_n}{2}\\right]^{-\\frac{\\alpha_n+1}{2}}d\\mu\\left(\\frac{\\delta_n/2}{\\delta_n/2}\\right)^{-\\frac{\\alpha_n+1}{2}}=\\int_{-\\infty}^{\\infty} \\left[\\frac{\\beta_n\\alpha_n(\\mu-\\mu_n)^2}{\\delta_n\\alpha_n}+1\\right]^{-\\frac{\\alpha_n+1}{2}}d\\mu\\left(\\frac{\\delta_n}{2}\\right)^{-\\frac{\\alpha_n+1}{2}}\\). The term in the integral is the kernel of a Student’s t density, this means that the integral is equal to \\(\\frac{\\left(\\frac{\\delta_n\\pi}{\\beta_n}\\right)^{1/2}\\Gamma\\left(\\frac{\\alpha_n}{2}\\right)}{\\Gamma\\left(\\frac{\\alpha_n+1}{2}\\right)}\\). The predictive density is \\[\\begin{align} \\pi(y_0\\mid \\boldsymbol{y})&amp;\\propto\\int_{-\\infty}^{\\infty}\\int_0^{\\infty}\\left\\{ \\left(\\frac{1}{\\sigma^2}\\right)^{1/2}\\exp\\left\\{-\\frac{1}{2\\sigma^2}(y_0-\\mu)^2\\right\\}\\left(\\frac{1}{\\sigma^2}\\right)^{1/2}\\exp\\left\\{-\\frac{\\beta_n}{2\\sigma^2}(\\mu-\\mu_n)^2\\right\\}\\right.\\nonumber\\\\ &amp;\\times \\left.\\left(\\frac{1}{\\sigma^2}\\right)^{\\alpha_n/2+1}\\exp\\left\\{-\\frac{\\delta_n}{2\\sigma^2}\\right\\}\\right\\}d\\sigma^2d\\mu\\nonumber\\\\ &amp;=\\int_{-\\infty}^{\\infty}\\int_0^{\\infty}\\left\\{ \\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_n+2}{2}+1}\\exp\\left\\{-\\frac{1}{2\\sigma^2}((y_0-\\mu)^2+\\beta_n(\\mu-\\mu_n)^2+\\delta_n)\\right\\}\\right\\}d\\sigma^2d\\mu\\nonumber\\\\ &amp;\\propto\\int_{-\\infty}^{\\infty}\\left[\\beta_n(\\mu-\\mu_n)^2+(y_0-\\mu)^2+\\delta_n\\right]^{-\\left(\\frac{\\alpha_n}{2}+1\\right)}d\\mu\\nonumber\\\\ &amp;=\\int_{-\\infty}^{\\infty}\\left[(\\beta_n+1)\\left(\\mu-\\left(\\frac{\\beta_n\\mu_n+y_0}{\\beta_n+1}\\right)\\right)^2+\\frac{\\beta_n(y_0-\\mu_n)^2}{\\beta_n+1}+\\delta_n\\right]^{-\\left(\\frac{\\alpha_n}{2}+1\\right)}d\\mu\\nonumber\\\\ &amp;=\\int_{-\\infty}^{\\infty}\\left[1+\\frac{(\\alpha_n+1)(\\beta_n+1)^2\\left(\\mu-\\left(\\frac{\\beta_n\\mu_n+y_0}{\\beta_n+1}\\right)\\right)^2}{(\\alpha_n+1)(\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n)}\\right]^{-\\left(\\frac{\\alpha_n}{2}+1\\right)}d\\mu\\nonumber\\\\ &amp;\\times\\left(\\frac{\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n}{\\beta_n+1}\\right)^{-\\left(\\frac{\\alpha_n}{2}+1\\right)}\\nonumber\\\\ &amp;\\propto\\left(\\pi\\frac{\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n}{(\\beta_n+1)^2}\\right)^{\\frac{1}{2}}\\left(\\frac{\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n}{\\beta_n+1}\\right)^{-\\left(\\frac{\\alpha_n}{2}+1\\right)}\\nonumber\\\\ &amp;\\propto (\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n)^{-\\left(\\frac{\\alpha_n+1}{2}\\right)}\\nonumber\\\\ &amp;\\propto\\left[1+\\frac{\\beta_n\\alpha_n}{(\\beta_n+1)\\delta_n\\alpha_n}(y_0-\\mu_n)^2\\right]^{-\\left(\\frac{\\alpha_n+1}{2}\\right)},\\nonumber \\end{align}\\] where we have that \\(\\left[1+\\frac{(\\alpha_n+1)(\\beta_n+1)^2\\left(\\mu-\\left(\\frac{\\beta_n\\mu_n+y_0}{\\beta_n+1}\\right)\\right)^2}{(\\alpha_n+1)(\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n)}\\right]^{-\\left(\\frac{\\alpha_n}{2}+1\\right)}\\) is the kernel of a Student’s t density with degrees of freedom \\(\\alpha_n+1\\) and scale \\(\\frac{\\beta_n(y_0-\\mu_n)^2+(\\beta_n+1)\\delta_n}{(\\beta_n+1)^2(\\alpha_n+1)}\\). The last expression is the kernel of a Student’s t density, that is, \\(Y_0\\mid \\boldsymbol{y}\\sim t\\left(\\mu_n,\\frac{(\\beta_n+1)\\delta_n}{\\beta_n\\alpha_n},\\alpha_n\\right)\\). The multivariate normal-normal/inverse-Wishart model We show in subsection 3.1 that the multivariate normal distribution is in the exponential family where \\[\\begin{equation*} C(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})=\\exp\\left\\{-\\frac{1}{2}\\left(tr\\left(\\boldsymbol{\\mu}\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)+\\log(|\\Sigma|)\\right)\\right\\}, \\end{equation*}\\] \\[\\begin{equation*} \\eta(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})^{\\top}=\\left[\\left(vec\\left(\\boldsymbol{\\Sigma}^{-1}\\right)\\right)^{\\top} \\ \\ \\left(vec\\left(\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)\\right)^{\\top}\\right], \\end{equation*}\\] \\[\\begin{equation*} T(\\boldsymbol{y})=\\left[-\\frac{1}{2}\\left(vec\\left(\\boldsymbol{S}\\right)^{\\top}+N vec\\left(\\hat{\\boldsymbol{\\mu}}\\hat{\\boldsymbol{\\mu}}^{\\top}\\right)^{\\top}\\right) \\ \\ -N\\hat{\\boldsymbol{\\mu}}^{\\top}\\right]^{\\top} \\end{equation*}\\] and \\[\\begin{equation*} h(\\boldsymbol{y})=(2\\pi)^{-pN/2}. \\end{equation*}\\] Then, its conjugate prior distribution should have the form \\[\\begin{align} \\pi(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})&amp;\\propto \\exp\\left\\{-\\frac{b_0}{2}\\left(tr\\left(\\boldsymbol{\\mu}\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)+\\log(|\\Sigma|)\\right)\\right\\}\\nonumber\\\\ &amp;\\times \\exp\\left\\{\\boldsymbol{a}_{01}^{\\top} vec\\left(\\boldsymbol{\\Sigma}^{-1}\\right)+\\boldsymbol{a}_{02}^{\\top}vec\\left(\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right)\\right\\}\\nonumber\\\\ &amp;=|\\Sigma|^{-b_0/2}\\exp\\left\\{-\\frac{b_0}{2}\\left(tr\\left(\\boldsymbol{\\mu}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}\\right)\\right)+tr\\left(\\boldsymbol{a}_{02}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}\\right)\\right\\}\\nonumber\\\\ &amp;\\times \\exp\\left\\{\\boldsymbol{a}_{01}^{\\top} vec\\left(\\boldsymbol{\\Sigma}^{-1}\\right)+\\frac{\\boldsymbol{a}_{02}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{a}_{02}}{2b_0}-\\frac{\\boldsymbol{a}_{02}^{\\top}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{a}_{02}}{2b_0}\\right\\}\\nonumber\\\\ &amp;=|\\Sigma|^{-b_0/2}\\exp\\left\\{-\\frac{b_0}{2}\\left(\\boldsymbol{\\mu}-\\frac{\\boldsymbol{a}_{02}}{b_0}\\right)^{\\top}\\boldsymbol{\\Sigma}^{-1}\\left(\\boldsymbol{\\mu}-\\frac{\\boldsymbol{a}_{02}}{b_0}\\right)\\right\\}\\nonumber\\\\ &amp;\\times \\exp\\left\\{-\\frac{1}{2}tr\\left(\\left(\\boldsymbol{A}_{01}-\\frac{\\boldsymbol{a}_{02}\\boldsymbol{a}_{02}^{\\top}}{b_0}\\right)\\boldsymbol{\\Sigma}^{-1}\\right)\\right\\}\\nonumber\\\\ &amp;=\\underbrace{|\\Sigma|^{-1/2}\\exp\\left\\{-\\frac{b_0}{2}\\left(\\boldsymbol{\\mu}-\\frac{\\boldsymbol{a}_{02}}{b_0}\\right)^{\\top}\\boldsymbol{\\Sigma}^{-1}\\left(\\boldsymbol{\\mu}-\\frac{\\boldsymbol{a}_{02}}{b_0}\\right)\\right\\}}_1\\nonumber\\\\ &amp;\\times \\underbrace{|\\Sigma|^{-(\\alpha_0+p+1)/2}\\exp\\left\\{-\\frac{1}{2}tr\\left(\\left(\\boldsymbol{A}_{01}-\\frac{\\boldsymbol{a}_{02}\\boldsymbol{a}_{02}^{\\top}}{b_0}\\right)\\boldsymbol{\\Sigma}^{-1}\\right)\\right\\}}_2.\\nonumber \\end{align}\\] Here, we set \\(b_0 = 1 + \\alpha_0 + p + 1\\), and represents the hypothetical sample size, \\(\\boldsymbol{a}_{01}\\) and \\(\\boldsymbol{a}_{02}\\) are \\(p^2\\)-dimensional and \\(p\\)-dimensional vectors of prior sufficient statistics. Specifically, \\(\\boldsymbol{a}_{01} = -\\frac{1}{2} \\text{vec}(\\boldsymbol{A}_{01})\\), where \\(\\boldsymbol{A}_{01}\\) is a \\(p \\times p\\) positive semi-definite matrix. We observe that the first part of the last expression is the kernel of a multivariate normal density with mean \\(\\boldsymbol{\\mu}_0 = \\frac{\\boldsymbol{a}_{02}}{b_0}\\) and covariance \\(\\frac{\\boldsymbol{\\Sigma}}{b_0}\\), i.e., \\[ \\boldsymbol{\\mu} \\mid \\boldsymbol{\\Sigma} \\sim N_p \\left( \\boldsymbol{\\mu}_0, \\frac{\\boldsymbol{\\Sigma}}{\\beta_0} \\right), \\] where \\(b_0 = \\beta_0\\). This choice of hyperparameters is intuitive because \\(\\boldsymbol{a}_{02}\\) represents the hypothetical sum of prior observations, and \\(b_0\\) represents the hypothetical prior sample size. Additionally, the second part of the last expression corresponds to the kernel of an inverse Wishart distribution with scale matrix \\(\\boldsymbol{\\Psi}_0 = \\left( \\boldsymbol{A}_{01} - \\frac{\\boldsymbol{a}_{02} \\boldsymbol{a}_{02}^{\\top}}{b_0} \\right)\\) and \\(\\alpha_0\\) degrees of freedom, i.e., \\[ \\boldsymbol{\\Sigma} \\sim IW_p (\\boldsymbol{\\Psi}_0, \\alpha_0). \\] Observe that \\(\\boldsymbol{\\Psi}_0\\) has the same structure as the first part of the sufficient statistics in \\(T(\\boldsymbol{y})\\), except that it should be understood as arising from prior hypothetical observations. Therefore, the prior distribution in this setting is normal/inverse-Wishart, and, due to conjugacy, the posterior distribution belongs to the same family. \\[\\begin{align} \\pi(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma}\\mid \\boldsymbol{y})&amp;\\propto (2\\pi)^{-p N/2}|\\boldsymbol{\\Sigma}|^{-N/2}\\exp\\left\\{-\\frac{1}{2}tr\\left[\\left(\\boldsymbol{S}+N\\left(\\boldsymbol{\\mu}-\\hat{\\boldsymbol{\\mu}}\\right)\\left(\\boldsymbol{\\mu}-\\hat{\\boldsymbol{\\mu}}\\right)^{\\top}\\right)\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\}\\nonumber\\\\ &amp;\\times |\\boldsymbol{\\Sigma}|^{-1/2}\\exp\\left\\{-\\frac{\\beta_0}{2}tr\\left[(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_0)(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_0)^{\\top}\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\}|\\boldsymbol{\\Sigma}|^{-(\\alpha_0+p+1)/2}\\nonumber\\\\ &amp;\\times\\exp\\left\\{-\\frac{1}{2}tr(\\boldsymbol{\\Psi}_0\\boldsymbol{\\Sigma}^{-1})\\right\\}\\nonumber. \\end{align}\\] Taking into account that \\[\\begin{align} N\\left(\\boldsymbol{\\mu}-\\hat{\\boldsymbol{\\mu}}\\right)\\left(\\boldsymbol{\\mu}-\\hat{\\boldsymbol{\\mu}}\\right)^{\\top}+\\beta_0\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_0\\right)\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_0\\right)^{\\top}&amp;=(N+\\beta_0)\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)^{\\top}\\nonumber\\\\ &amp;+\\frac{N\\beta_0}{N+\\beta_0}\\left(\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{\\mu}_0\\right)\\left(\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{\\mu}_0\\right)^{\\top},\\nonumber \\end{align}\\] where \\(\\boldsymbol{\\mu}_n=\\frac{N}{N+\\beta_0}\\hat{\\boldsymbol{\\mu}}+\\frac{\\beta_0}{N+\\beta_0}\\boldsymbol{\\mu}_0\\) is the posterior mean, \\[\\begin{align} \\pi(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma}\\mid \\boldsymbol{y})&amp;\\propto |\\boldsymbol\\Sigma|^{-1/2}\\exp\\left\\{-\\frac{N+\\beta_0}{2}tr\\left[\\left(\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)^{\\top}\\right)\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\}\\nonumber\\\\ &amp;\\times |\\boldsymbol{\\Sigma}|^{-(N+\\alpha_0+p+1)/2}\\nonumber\\\\ &amp;\\times\\exp\\left\\{-\\frac{1}{2}tr\\left[\\left(\\boldsymbol{\\Psi}_0+\\boldsymbol{S}+\\frac{N\\beta_0}{N+\\beta_0}(\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{\\mu}_0)(\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{\\mu}_0)^{\\top}\\right)\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\}.\\nonumber \\end{align}\\] Then, \\(\\boldsymbol{\\mu}\\mid \\boldsymbol{\\Sigma},\\boldsymbol{y}\\sim N_p\\left(\\boldsymbol{\\mu}_n,\\frac{1}{\\beta_n}\\boldsymbol{\\Sigma}\\right)\\), and \\(\\boldsymbol{\\Sigma}\\mid \\boldsymbol{y}\\sim IW\\left(\\boldsymbol{\\Psi}_n,\\alpha_n\\right)\\) where \\(\\beta_n=N+\\beta_0\\), \\(\\alpha_n=N+\\alpha_0\\) and \\(\\boldsymbol{\\Psi}_n=\\boldsymbol{\\Psi}_0+\\boldsymbol{S}+\\frac{N\\beta_0}{N+\\beta_0}(\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{\\mu}_0)(\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{\\mu}_0)^{\\top}\\). The marginal posterior of \\(\\boldsymbol{\\mu}\\) is given by \\(\\int_{\\mathcal{S}} \\pi(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma})d\\boldsymbol{\\Sigma}\\) where \\(\\mathcal{S}\\) is the space of positive semi-definite matrices. Then, \\[\\begin{align} \\pi(\\boldsymbol{\\mu}\\mid \\boldsymbol{y})&amp;\\propto\\int_{\\mathcal{S}}\\left\\{|\\boldsymbol{\\Sigma}|^{-(\\alpha_n+p+2)/2}\\right.\\nonumber\\\\ &amp;\\left. \\exp\\left\\{-\\frac{1}{2}tr\\left[\\left(\\beta_n\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)^{\\top}+\\boldsymbol{\\Psi}_n\\right)\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\} \\right\\}d\\boldsymbol{\\Sigma}\\nonumber\\\\ &amp;\\propto \\big\\lvert\\left(\\beta_n\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)^{\\top}+\\boldsymbol{\\Psi}_n\\right)\\big\\lvert^{-(\\alpha_n+1)/2}\\nonumber\\\\ &amp;=\\left[\\big\\lvert\\boldsymbol{\\Psi}_n\\big\\lvert\\times \\big\\lvert1+\\beta_n\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)^{\\top}\\boldsymbol{\\Psi}_n^{-1}\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)\\big\\lvert\\right]^{-(\\alpha_n+1)/2}\\nonumber\\\\ &amp;\\propto \\left(1+\\frac{1}{\\alpha_n+1-p}\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)^{\\top}\\left(\\frac{\\boldsymbol{\\Psi}_n}{(\\alpha_n+1-p)\\beta_n}\\right)^{-1}\\left(\\boldsymbol{\\mu}-\\boldsymbol{\\mu}_n\\right)\\right)^{-(\\alpha_n+1-p+p)/2},\\nonumber \\end{align}\\] where the second line uses properties of the inverse Wishart distribution, and the third line uses a particular case of the Sylvester’s determinant theorem.4 We observe that the last line is the kernel of a multivariate t distribution, that is, \\(\\boldsymbol{\\mu}\\mid \\boldsymbol{y}\\sim t_p(v_n,\\boldsymbol{\\mu}_n,\\boldsymbol{\\Sigma}_n)\\) where \\(v_n=\\alpha_n+1-p\\) and \\(\\boldsymbol{\\Sigma}_n=\\frac{\\boldsymbol{\\Psi}_n}{(\\alpha_n+1-p)\\beta_n}\\). The marginal likelihood is given by \\[\\begin{align} p(\\boldsymbol{y})=\\frac{\\Gamma_p\\left(\\frac{v_n}{2}\\right)}{\\Gamma_p\\left(\\frac{\\alpha_0}{2}\\right)}\\frac{|\\boldsymbol{\\Psi}_0|^{\\alpha_0/2}}{|\\boldsymbol{\\Psi}_n|^{\\alpha_n/2}}\\left(\\frac{\\beta_0}{\\beta_n}\\right)^{p/2}(\\pi)^{-Np/2},\\nonumber \\end{align}\\] where \\(\\Gamma_p\\) is the multivariate gamma function (see Exercise 5). The posterior predictive distribution is \\(\\boldsymbol{Y}_0\\mid \\boldsymbol{y}\\sim t_p(v_n,\\boldsymbol{\\mu}_n,(\\beta_n+1)\\boldsymbol{\\Sigma}_n)\\) (see Exercise 6). Example: Tangency portfolio of US tech stocks The tangency portfolio is the portfolio that maximizes the Sharpe ratio, which is defined as the excess return of a portfolio standardized by its risk. We aim to find the portfolio weights \\(\\boldsymbol{w}\\) that maximize the Sharpe ratio, where \\(\\mu_{i,T+\\kappa} = \\mathbb{E}\\left( R_{i,T+\\kappa} - R_{f,T+\\kappa} \\mid \\mathcal{I}_T \\right)\\), with \\(R_{i,T+\\kappa}\\) and \\(R_{f,T+\\kappa}\\) representing the returns of stock \\(i\\) and the risk-free asset, respectively. Here, \\(\\mu_{i,T+\\kappa}\\) is the expected value of the excess return at period \\(T+\\kappa\\), conditional on information available up to time \\(T\\) (\\(\\mathcal{I}_T\\)), and \\(\\boldsymbol{\\Sigma}_{T+\\kappa}\\) is the covariance matrix of the excess returns, which quantifies the risk. \\[\\begin{equation*} \\text{argmax}_{{\\boldsymbol w}\\in \\mathbb{R}^{p}} \\frac{{\\boldsymbol w}^{\\top}\\boldsymbol{\\mu}_{T+\\kappa}}{\\sqrt{{\\boldsymbol w}^{\\top}{\\boldsymbol{\\Sigma}}_{T+\\kappa} {\\boldsymbol w}}}; \\hspace{1cm} \\text{s.t}\\hspace{.5cm} {\\boldsymbol w}^{\\top}{\\boldsymbol{1}}=1, \\end{equation*}\\] where the solution is \\[\\begin{equation*} {\\boldsymbol w}^*=\\frac{{\\boldsymbol{\\Sigma}}^{-1}_{T+\\kappa}\\boldsymbol{\\mu}_{T+\\kappa}}{{\\boldsymbol{1}}^{\\top}{\\boldsymbol \\Sigma}^{-1}_{T+\\kappa}\\boldsymbol{\\mu}_{T+\\kappa}}. \\end{equation*}\\] If we want to find the optimal portfolio for the next period under the assumption that the excess returns follow a multivariate normal distribution –a common assumption in these applications– we can set \\(\\kappa = 1\\) and use the predictive distribution of the excess returns. In this case, \\(\\boldsymbol{\\mu}_{T+1} = \\boldsymbol{\\mu}_n\\) and \\(\\boldsymbol{\\Sigma}_{T+1} = \\frac{v_n}{v_n - 2} (\\beta_n + 1) \\boldsymbol{\\Sigma}_n\\), based on the previous predictive result. We apply this framework to ten tech stocks of the US market between January first, 2021, and September ninth, 2022. In particular, we use information from Yahoo Finance for Apple (AAPL), Netflix (NFLX), Amazon (AMZN), Microsoft (MSFT), Google (GOOG), Meta (META), Tesla (TSLA), NVIDIA Corporation (NVDA), Intel (INTC), and PayPal (PYPL). We use non-informative hyperparameters, \\(\\boldsymbol{\\mu}_0=\\boldsymbol{0}\\), \\(\\beta_0=1\\), \\(\\boldsymbol{\\Psi}_0=100\\boldsymbol{I}\\) and \\(\\alpha_0=p+2\\), where \\(p=10\\) is the number of stocks. set.seed(12345) # Tangency portfolio # Load required libraries library(quantmod) ## Loading required package: xts ## Loading required package: zoo ## ## Attaching package: &#39;zoo&#39; ## The following objects are masked from &#39;package:base&#39;: ## ## as.Date, as.Date.numeric ## ## ######################### Warning from &#39;xts&#39; package ########################## ## # # ## # The dplyr lag() function breaks how base R&#39;s lag() function is supposed to # ## # work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or # ## # source() into this session won&#39;t work correctly. # ## # # ## # Use stats::lag() to make sure you&#39;re not using dplyr::lag(), or you can add # ## # conflictRules(&#39;dplyr&#39;, exclude = &#39;lag&#39;) to your .Rprofile to stop # ## # dplyr from breaking base R&#39;s lag() function. # ## # # ## # Code in packages is not affected. It&#39;s protected by R&#39;s namespace mechanism # ## # Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning. # ## # # ## ############################################################################### ## ## Attaching package: &#39;xts&#39; ## The following objects are masked from &#39;package:dplyr&#39;: ## ## first, last ## Loading required package: TTR ## Registered S3 method overwritten by &#39;quantmod&#39;: ## method from ## as.zoo.data.frame zoo library(xts) library(ggplot2) library(gridExtra) ## ## Attaching package: &#39;gridExtra&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## combine library(purrr) library(dplyr) # Define date range start_date &lt;- as.Date(&quot;2021-01-01&quot;) end_date &lt;- as.Date(&quot;2022-09-30&quot;) dates &lt;- seq(start_date, end_date, by = &quot;day&quot;) # Tickers of interest tickers &lt;- c(&quot;AAPL&quot;, &quot;NFLX&quot;, &quot;AMZN&quot;, &quot;GOOG&quot;, &quot;INTC&quot;, &quot;META&quot;, &quot;MSFT&quot;, &quot;TSLA&quot;, &quot;NVDA&quot;, &quot;PYPL&quot;) p &lt;- length(tickers) # Download adjusted closing prices getSymbols(tickers, from = start_date, to = end_date, auto.assign = TRUE) ## [1] &quot;AAPL&quot; &quot;NFLX&quot; &quot;AMZN&quot; &quot;GOOG&quot; &quot;INTC&quot; &quot;META&quot; &quot;MSFT&quot; &quot;TSLA&quot; &quot;NVDA&quot; &quot;PYPL&quot; prices &lt;- map(tickers, ~ Ad(get(.x))) %&gt;% reduce(merge) %&gt;% `colnames&lt;-`(tickers) %&gt;% as.data.frame() # Calculate daily log returns returns &lt;- apply(prices, 2, function(x) diff(log(x))) %&gt;% as.data.frame() # Download 10-year Treasury yield from FRED t10yr_xts &lt;- getSymbols(&quot;^TNX&quot;, src = &quot;yahoo&quot;, from = start_date, to = end_date, auto.assign = FALSE) ## Warning: ^TNX contains missing values. Some functions will not work if objects ## contain missing values in the middle of the series. Consider using na.omit(), ## na.approx(), na.fill(), etc to remove or replace them. # Annual yield in decimal t10yr_annual &lt;- Cl(t10yr_xts) / 1000 # e.g. 45 -&gt; 0.045 # Convert to daily rate (using 365 days, consistent with your code) t10yr_daily &lt;- (1 + t10yr_annual)^(1 / 365) - 1 # Align risk-free series with stock returns t10yr_daily &lt;- t10yr_daily[rownames(returns), ] # Compute excess returns excess_returns &lt;- as.matrix(returns) - kronecker(t(rep(1, p)), as.matrix(t10yr_daily)) # Convert to data frame with dates df &lt;- as.data.frame(excess_returns) df$Date &lt;- as.Date(rownames(df)) df$Month &lt;- months(df$Date) df$Year &lt;- format(df$Date, &quot;%y&quot;) # Aggregate monthly means monthly_means &lt;- map(1:p, function(i) { aggregate(df[[i]] ~ Month + Year, data = df, FUN = mean) }) # Extract values into matrix data_excess &lt;- matrix(0, nrow = nrow(monthly_means[[1]]), ncol = p) for (i in 1:p) { data_excess[, i] &lt;- as.numeric(monthly_means[[i]][, 3]) } colnames(data_excess) &lt;- tickers # Hyperparameters N &lt;- nrow(data_excess) mu_0 &lt;- rep(0, p) beta_0 &lt;- 1 psi_0 &lt;- 100 * diag(p) alpha_0 &lt;- p + 2 # Posterior parameters alpha_n &lt;- N + alpha_0 v_n &lt;- alpha_n + 1 - p mu_hat &lt;- colMeans(data_excess) mu_n &lt;- (N / (N + beta_0)) * mu_hat + (beta_0 / (N + beta_0)) * mu_0 S &lt;- t(data_excess - matrix(mu_hat, N, p, byrow = TRUE)) %*% (data_excess - matrix(mu_hat, N, p, byrow = TRUE)) psi_n &lt;- psi_0 + S + (N * beta_0 / (N + beta_0)) * tcrossprod(mu_hat - mu_0) beta_n &lt;- N + beta_0 sigma_n &lt;- psi_n / ((alpha_n + 1 - p) * beta_n) cov_n &lt;- (sigma_n * (1 + beta_n)) * v_n / (v_n - 2) cov_inv &lt;- solve(cov_n) # Optimal portfolio weights (Bayesian mean-variance) opt_weights &lt;- t(cov_inv %*% mu_n / as.numeric(t(rep(1, p)) %*% cov_inv %*% mu_n)) colnames(opt_weights) &lt;- tickers # Result opt_weights ## AAPL NFLX AMZN GOOG INTC META ## [1,] -0.02313938 0.2496306 0.1062185 -0.03825738 0.1758976 0.2357877 ## MSFT TSLA NVDA PYPL ## [1,] -0.02792127 -0.01828755 0.02929855 0.3107726 We find that the optimal tangency portfolio is composed by 24.9%, 10.6%, 17.6%, 23.6%, 2.9% and 31.1% weights of Netflix, Amazon, Intel, Meta, NVIDIA and PayPal, and -2.3%, -3.8%, -2.8% and -1.8% weights of Apple, Google, Microsoft and Tesla. A negative weight means being short in financial jargon, that is, borrowing a stock to sell it. References Diaconis, Persi, Donald Ylvisaker, et al. 1979. “Conjugate Priors for Exponential Families.” The Annals of Statistics 7 (2): 269–81. Another parametrization of the gamma density is the scale parametrization, where \\(\\kappa_0 = 1/\\beta_0\\). See the health insurance example in Chapter 1.↩︎ https://www.11v11.com/teams/manchester-city/tab/opposingTeams/opposition/Liverpool/.↩︎ https://www.oddsportal.com/soccer/england/premier-league/liverpool-manchester-city-WrqgEz5S/↩︎ \\(\\text{det}(\\boldsymbol{X}+\\boldsymbol{A}\\boldsymbol{B})=\\text{det}(\\boldsymbol{X})\\text{det}(\\boldsymbol{I}+\\boldsymbol{B}\\boldsymbol{X}^{-1}\\boldsymbol{A})\\).↩︎ "],["sec43.html", "3.3 Linear regression: The conjugate normal-normal/inverse gamma model", " 3.3 Linear regression: The conjugate normal-normal/inverse gamma model In this setting, we analyze the conjugate normal-normal/inverse gamma model, which is a cornerstone in econometrics. In this model, the dependent variable \\(y_i\\) is related to a set of regressors \\(\\boldsymbol{x}_i = [x_{i1} \\ x_{i2} \\ \\dots \\ x_{iK}]^{\\top}\\) in a linear way, that is: \\[ y_i = \\beta_1 x_{i1} + \\beta_2 x_{i2} + \\dots + \\beta_K x_{iK} + \\mu_i = \\boldsymbol{x}_i^{\\top} \\boldsymbol{\\beta} + \\mu_i, \\] where \\(\\boldsymbol{\\beta} = [\\beta_1 \\ \\beta_2 \\ \\dots \\ \\beta_K]^{\\top}\\) and \\(\\mu_i \\stackrel{iid}{\\sim} N(0, \\sigma^2)\\) is a stochastic error such that \\(\\mathbb{E}[\\mu_i \\mid \\boldsymbol{x}_i] = 0\\). Defining the vectors and matrices: \\[ \\boldsymbol{y} = \\begin{bmatrix} y_1 \\\\ y_2 \\\\ \\vdots \\\\ y_N \\end{bmatrix}, \\quad \\boldsymbol{X} = \\begin{bmatrix} x_{11} &amp; x_{12} &amp; \\dots &amp; x_{1K} \\\\ x_{21} &amp; x_{22} &amp; \\dots &amp; x_{2K} \\\\ \\vdots &amp; \\vdots &amp; \\vdots &amp; \\vdots \\\\ x_{N1} &amp; x_{N2} &amp; \\dots &amp; x_{NK} \\end{bmatrix}, \\quad \\boldsymbol{\\mu} = \\begin{bmatrix} \\mu_1 \\\\ \\mu_2 \\\\ \\vdots \\\\ \\mu_N \\end{bmatrix}, \\] we can write the model in matrix form as: \\[ \\boldsymbol{y} = \\boldsymbol{X} \\boldsymbol{\\beta} + \\boldsymbol{\\mu}, \\] where \\(\\boldsymbol{\\mu} \\sim N(\\boldsymbol{0}, \\sigma^2 \\boldsymbol{I})\\). This implies that: \\[ \\boldsymbol{y} \\sim N(\\boldsymbol{X} \\boldsymbol{\\beta}, \\sigma^2 \\boldsymbol{I}).\\] In regression analysis, to simplify notation, we depart from the conventional statistical notation, which defines lowercase letters as realizations of random variables, typically denoted by uppercase letters. We hope it is clear from the context when we refer to random vectors and matrices, and their realizations. Thus, we use bold lowercase letters for vectors and bold uppercase letters for matrices. This applies to the rest of the book. Thus, the likelihood function is: \\[\\begin{align*} p({\\boldsymbol{y}}\\mid \\boldsymbol{\\beta}, \\sigma^2, {{\\boldsymbol{X}}}) &amp; = (2\\pi\\sigma^2)^{-\\frac{N}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} ({\\boldsymbol{y}} - {\\boldsymbol{X}}\\boldsymbol{\\beta})^{\\top}({\\boldsymbol{y}} - {\\boldsymbol{X}}\\boldsymbol{\\beta}) \\right\\} \\\\ &amp; \\propto (\\sigma^2)^{-\\frac{N}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} ({\\boldsymbol{y}} - {\\boldsymbol{X}}\\boldsymbol{\\beta})^{\\top}({\\boldsymbol{y}} - {\\boldsymbol{X}}\\boldsymbol{\\beta}) \\right\\}. \\end{align*}\\] The conjugate priors for the parameters are \\[\\begin{align*} \\boldsymbol{\\beta}\\mid \\sigma^2 &amp; \\sim N(\\boldsymbol{\\beta}_0, \\sigma^2 {\\boldsymbol{B}}_0),\\\\ \\sigma^2 &amp; \\sim IG(\\alpha_0/2, \\delta_0/2). \\end{align*}\\] Then, the posterior distribution is \\[\\begin{align*} \\pi(\\boldsymbol{\\beta},\\sigma^2\\mid \\boldsymbol{y},\\boldsymbol{X})&amp;\\propto (\\sigma^2)^{-\\frac{N}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} ({\\boldsymbol{y}} - {\\boldsymbol{X}}\\boldsymbol{\\beta})^{\\top}({\\boldsymbol{y}} - {\\boldsymbol{X}}\\boldsymbol{\\beta}) \\right\\} \\\\ &amp; \\times (\\sigma^2)^{-\\frac{K}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} (\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_0)^{\\top}{\\boldsymbol{B}}_0^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_0)\\right\\} \\\\ &amp; \\times \\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}\\left(\\frac{1}{\\sigma^2}\\right)^{\\alpha_0/2+1}\\exp \\left\\{-\\frac{\\delta_0}{2\\sigma^2} \\right\\} \\\\ &amp; \\propto (\\sigma^2)^{-\\frac{K}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} [\\boldsymbol{\\beta}^{\\top}({\\boldsymbol{B}}_0^{-1} + {\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})\\boldsymbol{\\beta} - 2\\boldsymbol{\\beta}^{\\top}({\\boldsymbol{B}}_0^{-1}\\boldsymbol{\\beta}_0 + {\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}\\hat{\\boldsymbol{\\beta}})] \\right\\} \\\\ &amp; \\times \\left(\\frac{1}{\\sigma^2}\\right)^{(\\alpha_0+N)/2+1}\\exp \\left\\{-\\frac{\\delta_0+ {\\boldsymbol{y}}^{\\top}{\\boldsymbol{y}} + \\boldsymbol{\\beta}_0^{\\top}{\\boldsymbol{B}}_0^{-1}\\boldsymbol{\\beta}_0}{2\\sigma^2} \\right\\}, \\end{align*}\\] where \\(\\hat{\\boldsymbol{\\beta}}=({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{y}}\\) is the maximum likelihood estimator. Adding and subtracting \\(\\boldsymbol{\\beta}_n^{\\top}{{\\boldsymbol{B}}}_n^{-1} \\boldsymbol{\\beta}_n\\) to complete the square, where \\(\\boldsymbol{B}_n = (\\boldsymbol{B}_0^{-1} + \\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\) and \\(\\boldsymbol{\\beta}_n = \\boldsymbol{B}_n(\\boldsymbol{B}_0^{-1}\\boldsymbol{\\beta}_0 + \\boldsymbol{X}^{\\top}\\boldsymbol{X}\\hat{\\boldsymbol{\\beta}})\\), \\[\\begin{align*} \\pi(\\boldsymbol{\\beta},\\sigma^2\\mid \\boldsymbol{y},\\boldsymbol{X})&amp;\\propto \\underbrace{(\\sigma^2)^{-\\frac{K}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} (\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{B}}^{-1}_n(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_n) \\right\\}}_1 \\\\ &amp; \\times \\underbrace{(\\sigma^2)^{-\\left(\\frac{\\alpha_n}{2}+1 \\right)} \\exp \\left\\{-\\frac{\\delta_n}{2\\sigma^2} \\right\\}}_2. \\end{align*}\\] The first expression is the kernel of a normal density function, \\(\\boldsymbol{\\beta}\\mid \\sigma^2, \\boldsymbol{y}, \\boldsymbol{X} \\sim N(\\boldsymbol{\\beta}_n, \\sigma^2\\boldsymbol{B}_n)\\). The second expression is the kernel of a inverse gamma density, \\(\\sigma^2\\mid \\boldsymbol{y}, \\boldsymbol{X}\\sim IG(\\alpha_n/2, \\delta_n/2)\\), where \\(\\alpha_n = \\alpha_0 + N\\) and \\(\\delta_n = \\delta_0 + \\boldsymbol{y}^{\\top}\\boldsymbol{y} + \\boldsymbol{\\beta}_0^{\\top}\\boldsymbol{B}_0^{-1}\\boldsymbol{\\beta}_0 - \\boldsymbol{\\beta}_n^{\\top}\\boldsymbol{B}_n^{-1}\\boldsymbol{\\beta}_n\\). Taking into account that \\[\\begin{align*}\\boldsymbol{\\beta}_n &amp; = (\\boldsymbol{B}_0^{-1} + \\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}(\\boldsymbol{B}_0^{-1}\\boldsymbol{\\beta}_0 + \\boldsymbol{X}^{\\top}\\boldsymbol{X}\\hat{\\boldsymbol{\\beta}})\\\\ &amp; = (\\boldsymbol{B}_0^{-1} + \\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{B}_0^{-1}\\boldsymbol{\\beta}_0 + (\\boldsymbol{B}_0^{-1} + \\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1} \\boldsymbol{X}^{\\top}\\boldsymbol{X}\\hat{\\boldsymbol{\\beta}}, \\end{align*}\\] where \\(({\\boldsymbol{B}}_0^{-1} + {\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}{\\boldsymbol{B}}_0^{-1}=\\boldsymbol{I}_K-({\\boldsymbol{B}}_0^{-1} + {\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}\\) (Smith 1973). Setting \\({\\boldsymbol{W}}=({\\boldsymbol{B}}_0^{-1} + {\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}\\) we have \\(\\boldsymbol{\\beta}_n=(\\boldsymbol{I}_K-{\\boldsymbol{W}})\\boldsymbol{\\beta}_0+{\\boldsymbol{W}}\\hat{\\boldsymbol{\\beta}}\\), that is, the posterior mean of \\(\\boldsymbol{\\beta}\\) is a weighted average between the sample and prior information, where the weights depend on the precision of each piece of information. Observe that when the prior covariance matrix is highly vague (non–informative), such that \\({\\boldsymbol{B}}_0^{-1}\\rightarrow \\boldsymbol{0}_K\\), we obtain \\({\\boldsymbol{W}} \\rightarrow I_K\\), such that \\(\\boldsymbol{\\beta}_n \\rightarrow \\hat{\\boldsymbol{\\beta}}\\), that is, the posterior mean location parameter converges to the maximum likelihood estimator. In addition, we know that the posterior conditional covariance matrix of the location parameters \\(\\sigma^2({\\boldsymbol{B}}_0^{-1} + {\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}=\\sigma^2({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}-\\sigma^2\\left(({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}({\\boldsymbol{B}}_0 + ({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1})^{-1}({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}\\right)\\) is positive semi-definite.5 Given that \\(\\sigma^2({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}\\) is the covariance matrix of the maximum likelihood estimator, we observe that prior information reduces estimation uncertainty. Another way to see this model is by considering that both \\(\\boldsymbol{y}\\) and \\(\\boldsymbol{\\beta}\\) are treated as random variables under the Bayesian framework. Thus, we can express the joint distribution of these two vectors as follows: \\[\\begin{align*} \\begin{bmatrix} \\boldsymbol{\\beta}\\\\ \\boldsymbol{y} \\end{bmatrix}\\sim N\\left [ \\begin{pmatrix} \\boldsymbol{\\beta}_{0} \\\\ \\boldsymbol{X}\\boldsymbol{\\beta}_{0} \\end{pmatrix} , \\sigma^2\\begin{pmatrix} \\boldsymbol{B}_{0} &amp; \\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} \\\\ \\boldsymbol{X}\\boldsymbol{B}_{0}^{\\top} &amp; \\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}+\\boldsymbol{I}_N \\end{pmatrix}\\right ], \\end{align*}\\] where we use that \\[\\begin{align*} Cov[\\boldsymbol{\\beta},\\boldsymbol{y}\\mid \\boldsymbol{X}]&amp;=\\mathbb{E}[\\boldsymbol{\\beta}\\boldsymbol{y}^{\\top}]-\\mathbb{E}[\\boldsymbol{\\beta}]\\mathbb{E}[\\boldsymbol{y}^{\\top}]\\\\ &amp;=\\mathbb{E}[\\boldsymbol{\\beta}(\\boldsymbol{X}\\boldsymbol{\\beta}+\\boldsymbol{\\mu})^{\\top}]-\\mathbb{E}[\\boldsymbol{\\beta}]\\mathbb{E}[\\boldsymbol{y}^{\\top}]\\\\ &amp;=[Var[\\boldsymbol{\\beta}]+\\mathbb{E}[\\boldsymbol{\\beta}]\\mathbb{E}[\\boldsymbol{\\beta}^{\\top}]]\\boldsymbol{X}^{\\top}-\\mathbb{E}[\\boldsymbol{\\beta}]\\mathbb{E}[\\boldsymbol{y}^{\\top}]\\\\ &amp;=\\sigma^2\\boldsymbol{B}_0\\boldsymbol{X}^{\\top}+\\boldsymbol{\\beta}_0\\boldsymbol{\\beta}_0^{\\top}\\boldsymbol{X}^{\\top}-\\boldsymbol{\\beta}_0\\boldsymbol{\\beta}_0^{\\top}\\boldsymbol{X}^{\\top}\\\\ &amp;=\\sigma^2\\boldsymbol{B}_0\\boldsymbol{X}^{\\top}. \\end{align*}\\] Then, we can obtain the conditional distribution of \\(\\boldsymbol{\\beta} \\mid \\boldsymbol{y}\\) using the properties of the multivariate normal distribution. This distribution is normal with mean equal to \\[\\begin{align} \\boldsymbol{\\beta}_{0} + \\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} \\left( \\boldsymbol{X} \\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} + \\boldsymbol{I}_N \\right)^{-1} (\\boldsymbol{y} - \\boldsymbol{X} \\boldsymbol{\\beta}_{0}), \\tag{3.5} \\end{align}\\] and covariance matrix \\[ \\sigma^2 \\left( \\boldsymbol{B}_{0} - \\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} \\left( \\boldsymbol{X} \\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} + \\boldsymbol{I}_N \\right)^{-1} \\boldsymbol{X} \\boldsymbol{B}_{0}^{\\top} \\right). \\] Observe that in this representation, the posterior mean is equal to the prior mean plus a correction term that takes into account the deviation between the observations and the prior expected value (\\(\\boldsymbol{X} \\boldsymbol{\\beta}_{0}\\)). The weight of this correction is given by the matrix \\(\\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} \\left( \\boldsymbol{X} \\boldsymbol{B}_{0} \\boldsymbol{X}^{\\top} + \\boldsymbol{I}_N \\right)^{-1}\\). This form of expressing the posterior distribution is relevant for gaining some intuition on Bayesian inference in time series models within the Gaussian linear state-space representation in Chapter 8, also known as the Kalman filter in time series literature. We can show that both conditional posterior distributions are the same. In particular, the posterior mean in Equation (3.5) is \\([\\boldsymbol{I}_K-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}+ \\boldsymbol{I}_N)^{-1}\\boldsymbol{X}]\\boldsymbol{\\beta}_{0}+\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}+ \\boldsymbol{I}_N)^{-1}\\boldsymbol{y}\\), where \\[\\begin{align*} \\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}+ \\boldsymbol{I}_N)^{-1} &amp;=\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}[\\boldsymbol{I}_N-\\boldsymbol{I}_N\\boldsymbol{X}(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N]\\\\ &amp;=\\boldsymbol{B}_{0}[\\boldsymbol{I}_K-\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N\\boldsymbol{X}(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N\\boldsymbol{X})^{-1}]\\boldsymbol{X}^{\\top}\\\\ &amp;=\\boldsymbol{B}_{0}[\\boldsymbol{I}_K-[\\boldsymbol{I}_K-\\boldsymbol{B}_0^{-1}(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N\\boldsymbol{X})^{-1}]]\\boldsymbol{X}^{\\top}\\\\ &amp;=(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}, \\end{align*}\\] where the first equality uses the Woodbury matrix identity (matrix inversion lemma), and the third equality uses \\(\\boldsymbol{D}(\\boldsymbol{D}+\\boldsymbol{E})^{-1}=\\boldsymbol{I}-\\boldsymbol{E}(\\boldsymbol{D}+\\boldsymbol{E})^{-1}\\). Thus, \\[\\begin{align*} \\boldsymbol{\\beta}_n&amp;=[\\boldsymbol{I}_K-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}+ \\boldsymbol{I}_N)^{-1}\\boldsymbol{X}]\\boldsymbol{\\beta}_{0}+\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}+ \\boldsymbol{I}_N)^{-1}\\boldsymbol{y}\\\\ &amp;=[\\boldsymbol{I}_K-(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{X}]\\boldsymbol{\\beta}_{0}+(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{y}\\\\ &amp;=[\\boldsymbol{I}_K-(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{X}]\\boldsymbol{\\beta}_{0}+(\\boldsymbol{B}_0^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{X}\\hat{\\boldsymbol{\\beta}} \\end{align*}\\] Again, we see that the posterior mean is a weighted average between the prior mean, and the maximum likelihood estimator. The equality of variances of both approaches is as follows: \\[\\begin{align*} Var[\\boldsymbol{\\beta}\\mid \\boldsymbol{y}]&amp; = \\sigma^2(\\boldsymbol{B}_{0}-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{X}\\boldsymbol{B}_{0}\\boldsymbol{X}^\\top+\\boldsymbol{I}_N)^{-1} \\boldsymbol{X}\\boldsymbol{B}_{0})\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}(\\boldsymbol{I}_N- \\boldsymbol{I}_N\\boldsymbol{X}(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{I}_N)\\boldsymbol{X}\\boldsymbol{B}_{0})\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}\\boldsymbol{X}\\boldsymbol{B}_{0}+ \\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}\\boldsymbol{X}(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{X}^{\\top}\\boldsymbol{X}\\boldsymbol{B}_{0})\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}\\boldsymbol{X}\\boldsymbol{B}_{0}+ \\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}\\boldsymbol{X}[\\boldsymbol{I}_K-(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}\\boldsymbol{B}_{0}^{-1}]\\boldsymbol{B}_{0})\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}-\\boldsymbol{B}_{0}\\boldsymbol{X}^{\\top}\\boldsymbol{X}(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1})\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}[\\boldsymbol{I}_K-\\boldsymbol{X}^{\\top}\\boldsymbol{X}(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}])\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}[\\boldsymbol{I}_K-(\\boldsymbol{I}_K-\\boldsymbol{B}_{0}^{-1}(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1})])\\\\ &amp;=\\sigma^2(\\boldsymbol{B}_{0}^{-1}+\\boldsymbol{X}^{\\top}\\boldsymbol{X})^{-1}, \\end{align*}\\] where the second equality uses the Woodbury matrix identity, the fourth equality uses \\((\\boldsymbol{D}+\\boldsymbol{E})^{-1}\\boldsymbol{D}=\\boldsymbol{I}-(\\boldsymbol{D}+\\boldsymbol{E})^{-1}\\boldsymbol{E}\\), and the seventh equality uses \\(\\boldsymbol{D}(\\boldsymbol{D}+\\boldsymbol{E})^{-1}=\\boldsymbol{I}-\\boldsymbol{E}(\\boldsymbol{D}+\\boldsymbol{E})^{-1}\\). Now, we calculate the posterior marginal distribution of \\(\\boldsymbol{\\beta}\\) following the standard approach, \\[\\begin{align*} \\pi(\\boldsymbol{\\beta}\\mid {\\boldsymbol{y}},{\\boldsymbol{X}}) &amp; = \\int_0^{\\infty} \\pi(\\boldsymbol{\\beta}, \\sigma^2\\mid {\\boldsymbol{y}},{\\boldsymbol{X}}) d\\sigma^2 \\\\ &amp; = \\int_0^{\\infty} \\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_n+K}{2} + 1} \\exp \\left\\{-\\frac{s}{2\\sigma^2}\\right\\} d\\sigma^2, \\end{align*}\\] where \\(s = \\delta_n + (\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)^{\\top}{{\\boldsymbol{B}}}_n^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)\\). Then we can write \\[\\begin{align*} \\pi(\\boldsymbol{\\beta}\\mid {\\boldsymbol{y}},{\\boldsymbol{X}}) &amp; = \\int_0^{\\infty} \\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_n+K}{2} + 1} \\exp \\left\\{-\\frac{s}{2\\sigma^2}\\right\\} d\\sigma^2 \\\\ &amp; = \\frac{\\Gamma((\\alpha_n+K)/2)}{(s/2)^{(\\alpha_n+K)/2}} \\int_0^{\\infty} \\frac{(s/2)^{(\\alpha_n+K)/2}}{\\Gamma((\\alpha_n+K)/2)} (\\sigma^2)^{-(\\alpha_n+K)/2 - 1} \\exp \\left\\{-\\frac{s}{2\\sigma^2}\\right\\} d\\sigma^2. \\end{align*}\\] The right term is the integral of the probability density function of an inverse gamma distribution with parameters \\(\\nu = (\\alpha_n+K)/2\\) and \\(\\tau = s/2\\). Since we are integrating over the whole support of \\(\\sigma^2\\), the integral is equal to 1, and therefore \\[\\begin{align*} \\pi(\\boldsymbol{\\beta}\\mid {\\boldsymbol{y}},{\\boldsymbol{X}}) &amp; = \\frac{\\Gamma((\\alpha_n+K)/2)}{(s/2)^{(\\alpha_n+K)/2}} \\\\ &amp; \\propto s^{-(\\alpha_n+K)/2} \\\\ &amp; = [\\delta_n + (\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)^{\\top}{{\\boldsymbol{B}}}_n^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)]^{-(\\alpha_n+K)/2} \\\\ &amp; = \\left[1 + \\frac{(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)^{\\top}\\left(\\frac{\\delta_n}{\\alpha_n}{{\\boldsymbol{B}}}_n\\right)^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)}{\\alpha_n}\\right]^{-(\\alpha_n+K)/2}(\\delta_n)^{-(\\alpha_N+K)/2} \\\\ &amp; \\propto \\left[1 + \\frac{(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{H}}_n^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)}{\\alpha_n}\\right]^{-(\\alpha_n+K)/2}, \\end{align*}\\] where \\({\\boldsymbol{H}}_n = \\frac{\\delta_n}{\\alpha_n}{\\boldsymbol{B}}_n\\). This last expression is a multivariate t distribution, that is, \\(\\boldsymbol{\\beta}\\mid {\\boldsymbol{y}},{\\boldsymbol{X}} \\sim t_K(\\alpha_n, \\boldsymbol{\\beta}_n, {\\boldsymbol{H}}_n)\\). Observe that as we have incorporated the uncertainty of the variance, the posterior for \\(\\boldsymbol{\\beta}\\) changes from a normal to a t distribution, which has heavier tails, indicating more uncertainty. The marginal likelihood of this model is \\[\\begin{align*} p({\\boldsymbol{y}})=\\int_0^{\\infty}\\int_{R^K}\\pi (\\boldsymbol{\\beta} \\mid \\sigma^2,{\\boldsymbol{B}}_0,\\boldsymbol{\\beta}_0 )\\pi(\\sigma^2\\mid \\alpha_0/2, \\delta_0/2)p({\\boldsymbol{y}}\\mid \\boldsymbol{\\beta}, \\sigma^2, {\\boldsymbol{X}})d\\sigma^2 d\\boldsymbol{\\beta}. \\end{align*}\\] Taking into account that \\(({\\boldsymbol{y}}-{\\boldsymbol{X}}\\boldsymbol{\\beta})^{\\top}({\\boldsymbol{y}}-{\\boldsymbol{X}}\\boldsymbol{\\beta})+(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_0)^{\\top}{\\boldsymbol{B}}_0^{-1}(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_0)=(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{B}}_n^{-1}(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_n)+m\\), where \\(m={\\boldsymbol{y}}^{\\top}{\\boldsymbol{y}}+\\boldsymbol{\\beta}_0^{\\top}{\\boldsymbol{B}}_0^{-1}\\boldsymbol{\\beta}_0-\\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n\\), we have that \\[\\begin{align*} p({\\boldsymbol{y}})&amp;=\\int_0^{\\infty}\\int_{R^K}\\pi (\\boldsymbol{\\beta} \\mid \\sigma^2)\\pi(\\sigma^2)p({\\boldsymbol{y}}\\mid \\boldsymbol{\\beta}, \\sigma^2, {\\boldsymbol{X}})d\\sigma^2 d\\boldsymbol{\\beta}\\\\ &amp;=\\int_0^{\\infty}\\pi(\\sigma^2) \\frac{1}{(2\\pi\\sigma^2)^{N/2}}\\exp\\left\\{-\\frac{1}{2\\sigma^2}m \\right\\} \\frac{1}{(2\\pi\\sigma^2)^{K/2}|{\\boldsymbol{B}}_0|^{1/2}}\\\\ &amp;\\times\\int_{R^K}\\exp\\left\\{-\\frac{1}{2\\sigma^2}(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{B}}_n^{-1}(\\boldsymbol{\\beta}-\\boldsymbol{\\beta}_n)\\right\\}d\\sigma^2 d\\boldsymbol{\\beta}\\\\ &amp;=\\int_0^{\\infty}\\pi(\\sigma^2) \\frac{1}{(2\\pi\\sigma^2)^{N/2}}\\exp\\left\\{-\\frac{1}{2\\sigma^2}m \\right\\} \\frac{|{\\boldsymbol{B}}_n|^{1/2}}{|{\\boldsymbol{B}}_0|^{1/2}}d\\sigma^2\\\\ &amp;=\\int_{0}^{\\infty} \\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}\\left(\\frac{1}{\\sigma^2}\\right)^{\\alpha_0/2+1}\\exp\\left\\{\\left(-\\frac{\\delta_0}{2\\sigma^2}\\right)\\right\\} \\frac{1}{(2\\pi\\sigma^2)^{N/2}}\\exp\\left\\{-\\frac{1}{2\\sigma^2}m \\right\\} \\frac{|{\\boldsymbol{B}}_n|^{1/2}}{|{\\boldsymbol{B}}_0|^{1/2}} d\\sigma^2\\\\ &amp;= \\frac{1}{(2\\pi)^{N/2}}\\frac{(\\delta_0/2)^{\\alpha_0/2}}{\\Gamma(\\alpha_0/2)}\\frac{|{\\boldsymbol{B}}_n|^{1/2}}{|{\\boldsymbol{B}}_0|^{1/2}}\\int_{0}^{\\infty}\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{\\alpha_0+N}{2}+1}\\exp\\left\\{\\left(-\\frac{\\delta_0+m}{2\\sigma^2}\\right)\\right\\}d\\sigma^2\\\\ &amp;= \\frac{1}{\\pi^{N/2}}\\frac{\\delta_0^{\\alpha_0/2}}{\\delta_n^{\\alpha_n/2}}\\frac{|{\\boldsymbol{B}}_n|^{1/2}}{|{\\boldsymbol{B}}_0|^{1/2}}\\frac{\\Gamma(\\alpha_n/2)}{\\Gamma(\\alpha_0/2)}. \\end{align*}\\] We can show that \\[\\begin{align*} \\delta_n&amp;=\\delta_0 + {\\boldsymbol{y}}^{\\top}{\\boldsymbol{y}} + \\boldsymbol{\\beta}_0^{\\top}{\\boldsymbol{B}}_0^{-1}\\boldsymbol{\\beta}_0 - \\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n\\\\ &amp;=\\delta_0+({\\boldsymbol{y}}-{\\boldsymbol{X}}\\hat{\\boldsymbol{\\beta}})^{\\top}({\\boldsymbol{y}}-{\\boldsymbol{X}}\\hat{\\boldsymbol{\\beta}})+(\\hat{\\boldsymbol{\\beta}}-\\boldsymbol{\\beta}_0)^{\\top}(({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}+{\\boldsymbol{B}}_0)^{-1}(\\hat{\\boldsymbol{\\beta}}-\\boldsymbol{\\beta}_0). \\end{align*}\\] See Exercise 7. Therefore, if we want to compare two models under this setting, the Bayes factor is \\[\\begin{align*} BF_{12}&amp;=\\frac{p(\\boldsymbol{y}\\mid \\mathcal{M}_1)}{p(\\boldsymbol{y}\\mid \\mathcal{M}_2)}\\\\ &amp;=\\frac{\\frac{\\delta_{10}^{\\alpha_{10}/2}}{\\delta_{1n}^{\\alpha_{1n}/2}}\\frac{|{\\boldsymbol{B}}_{1n}|^{1/2}}{|{\\boldsymbol{B}}_{10}|^{1/2}}\\frac{\\Gamma(\\alpha_{1n}/2)}{\\Gamma(\\alpha_{10}/2)}}{\\frac{\\delta_{20}^{\\alpha_{20}/2}}{\\delta_{2n}^{\\alpha_{2n}/2}}\\frac{|{\\boldsymbol{B}}_{2n}|^{1/2}}{|{\\boldsymbol{B}}_{20}|^{1/2}}\\frac{\\Gamma(\\alpha_{2n}/2)}{\\Gamma(\\alpha_{20}/2)}}, \\end{align*}\\] where subscripts 1 and 2 refer to each model. Observe that, ceteris paribus, the model with better fit, coherence between sample and prior information regarding location parameters, higher prior to posterior precision, and fewer parameters is favored by the Bayes factor. The Bayes factor rewards model fit, as the sum of squared errors appears in \\(\\delta_n\\); the better the fit (i.e., the lower the sum of squared errors), the better the Bayes factor. In addition, a weighted distance between sample and prior location parameters also appears in \\(\\delta_n\\). The greater this distance, the worse the model support. The ratio of determinants between posterior and prior covariance matrices is also present; the higher this ratio, the better the Bayes factor supports a model due to information gains. To see the effect of a model’s parsimony, let’s consider the common situation in applications where \\(\\boldsymbol{B}_{j0} = c \\boldsymbol{I}_{K_j}\\), then \\(| \\boldsymbol{B}_{j0} | = c^{K_j}\\). Hence, \\[ \\left( \\frac{| \\boldsymbol{B}_{20} |}{| \\boldsymbol{B}_{10} |} \\right)^{1/2} = \\left( \\frac{c^{K_2/2}}{c^{K_1/2}} \\right), \\] if \\(\\frac{K_2}{K_1} &gt; 1\\) and \\(c \\to \\infty\\) (the latter implying a non-informative prior), then \\(BF_{12} \\to \\infty\\). This means infinite evidence supporting the parsimonious model, no matter what the sample information says. Comparing models having the same number of regressors (\\(K_1 = K_2\\)) is not a safe ground, as \\(| \\boldsymbol{B}_0 |\\) depends on the measurement units of the regressors. Conclusions regarding model selection depend on this, which is not a nice property. This prevents using non-informative priors when performing model selection in the Bayesian framework. However, this is not the case when \\(\\alpha_0 \\to 0\\) and \\(\\delta_0 \\to 0\\), which implies a non-informative prior for the variance parameter.6 We observe that \\(\\Gamma(\\alpha_{j0})\\) cancels out, as \\(\\alpha_0 \\to 0\\) implies \\(\\alpha_{jn} \\to N\\), and \\[ \\delta_{jn} \\to ({\\boldsymbol{y}} - {\\boldsymbol{X}}_j \\hat{\\boldsymbol{\\beta}}_j)^{\\top} ({\\boldsymbol{y}} - {\\boldsymbol{X}}_j \\hat{\\boldsymbol{\\beta}}_j) + (\\hat{\\boldsymbol{\\beta}}_j - \\boldsymbol{\\beta}_{j0})^{\\top} \\left( ({\\boldsymbol{X}}_j^{\\top} {\\boldsymbol{X}}_j)^{-1} + \\boldsymbol{B}_{j0} \\right)^{-1} (\\hat{\\boldsymbol{\\beta}}_j - \\boldsymbol{\\beta}_{j0}), \\] when \\(\\delta_0 \\to 0,\\) therefore, there is no effect. This is due to \\(\\sigma^2\\) being a common parameter in both models. In general, we can use non-informative priors for common parameters across all models, but we cannot use non-informative priors for non-common parameters when performing model selection using the Bayes factor. This issue raises the question of how to set informative priors. On one hand, we have those who advocate for subjective priors (Ramsey 1926; De Finetti 1937; Savage 1954; Lindley 2000); on the other hand, those who prefer objective priors (T. Bayes 1763; Laplace 1812; H. Jeffreys 1961; J. Berger 2006). Regarding the former, eliciting subjective priors, i.e., “formulating a person’s knowledge and beliefs about one or more uncertain quantities into a (joint) probability distribution for those quantities” (Garthwaite, Kadane, and O’Hagan 2005), is a very difficult task due to human beings’ heuristics and biases associated with representativeness, information availability, conservatism, overconfidence, and anchoring-and-adjustment issues (Tversky and Kahneman 1974). However, there have been good efforts using predictive and structural elicitation procedures (J. B. Kadane 1980; J. Kadane and Wolfson 1998). Regarding the latter, there are reference priors that are designed to have minimal impact on the posterior distribution and to be invariant to different parametrizations of the model (Bernardo and Smith 2009). A remarkable example of reference priors is the Jeffreys’ prior (Harold Jeffreys 1946), which originated from the critique of non-informative priors that were not invariant to transformations of the parameter space. In particular, the Jeffreys’ prior is given by: \\[ \\pi(\\boldsymbol{\\theta}) \\propto |I(\\boldsymbol{\\theta})|^{1/2}, \\] where \\(I(\\boldsymbol{\\theta}) = \\mathbb{E}\\left(-\\frac{\\partial^2 \\log p(\\boldsymbol{y} \\mid \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\theta} \\partial \\boldsymbol{\\theta}^{\\top}}\\right)\\), i.e., \\(I(\\boldsymbol{\\theta})\\) is the Fisher information matrix. However, the Jeffreys’ prior is often improper, meaning it does not work well for model selection. Thus, a standard objective approach is to use intrinsic priors (J. O. Berger and Pericchi 1996), where a minimal training dataset is used with a reference prior to obtain a proper posterior distribution. This proper distribution is then used as a prior, and the standard Bayesian procedures are followed using the remaining dataset. In this way, we end up with meaningful Bayes factors for model selection. Regardless of using a subjective or objective approach to define a prior distribution, it is always a good idea to assess the sensitivity of the posterior results to the prior assumptions. This is commonly done using local or pointwise assessments, such as partial derivatives (Giordano et al. 2022; Jacobi, Zhu, and Joshi 2022; Gustafson 2000) or, more often, in terms of multiple evaluations (scenario analysis) (Richardson and Green 1997; Kim and Nelson 1999; An and Schorfheide 2007). Recently, Jacobi et al. (2024) extend these approaches to perform sensitivity analysis in high-dimensional hyperparameter settings. Returning to the linear model, the posterior predictive is equal to \\[\\begin{align*} \\pi({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}})&amp;=\\int_{0}^{\\infty}\\int_{R^K}p({\\boldsymbol{Y}}_0\\mid \\boldsymbol{\\beta},\\sigma^2,{\\boldsymbol{y}})\\pi(\\boldsymbol{\\beta}\\mid \\sigma^2,{\\boldsymbol{y}})\\pi(\\sigma^2\\mid {\\boldsymbol{y}})d\\boldsymbol{\\beta} d\\sigma^2\\\\ &amp;=\\int_{0}^{\\infty}\\int_{R^K}p({\\boldsymbol{Y}}_0\\mid \\boldsymbol{\\beta},\\sigma^2)\\pi(\\boldsymbol{\\beta}\\mid \\sigma^2,{\\boldsymbol{y}})\\pi(\\sigma^2\\mid {\\boldsymbol{y}})d\\boldsymbol{\\beta} d\\sigma^2, \\end{align*}\\] where we take into account independence between \\({\\boldsymbol{y}}_0\\) and \\({\\boldsymbol{y}}\\). Given \\({\\boldsymbol{X}}_0\\), which is the \\(N_0\\times K\\) matrix of regressors associated with \\({\\boldsymbol{y}}_0\\), Then, \\[\\begin{align*} \\pi({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}})&amp;=\\int_{0}^{\\infty}\\int_{R^K}\\left\\{ (2\\pi\\sigma^2)^{-\\frac{N_0}{2}} \\exp \\left\\{-\\frac{1}{2\\sigma^2} ({\\boldsymbol{y}}_0 - {\\boldsymbol{X}}_0\\boldsymbol{\\beta})^{\\top}({\\boldsymbol{y}}_0 - {\\boldsymbol{X}}_0\\boldsymbol{\\beta})^{\\top} \\right\\}\\right. \\\\ &amp; \\times (2\\pi\\sigma^2)^{-\\frac{K}{2}} |{\\boldsymbol{B}}_n|^{-1/2} \\exp \\left\\{-\\frac{1}{2\\sigma^2} (\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{B}}_n^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)\\right\\} \\\\ &amp; \\left. \\times \\frac{(\\delta_n/2)^{\\alpha_n/2}}{\\Gamma(\\alpha_n/2)}\\left(\\frac{1}{\\sigma^2}\\right)^{\\alpha_n/2+1}\\exp \\left\\{-\\frac{\\delta_n}{2\\sigma^2} \\right\\}\\right\\}d\\boldsymbol{\\beta} d\\sigma^2. \\\\ \\end{align*}\\] Setting \\({\\boldsymbol{M}}=({\\boldsymbol{X}}_0^{\\top}{\\boldsymbol{X}}_0+{\\boldsymbol{B}}_n^{-1})\\) and \\(\\boldsymbol{\\beta}_*={\\boldsymbol{M}}^{-1}({\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{X}}_0^{\\top}{\\boldsymbol{y}}_0)\\), we have \\(({\\boldsymbol{y}}_0 - {\\boldsymbol{X}}_0\\boldsymbol{\\beta})^{\\top}({\\boldsymbol{y}}_0 - {\\boldsymbol{X}}_0\\boldsymbol{\\beta})^{\\top}+(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{B}}_n^{-1}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_n)=(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_*)^{\\top}{\\boldsymbol{M}}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_*)+\\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{y}}_0-\\boldsymbol{\\beta}_*^{\\top}{\\boldsymbol{M}}\\boldsymbol{\\beta}_*\\). Thus, \\[\\begin{align*} \\pi({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}})&amp;\\propto\\int_{0}^{\\infty}\\left\\{\\left(\\frac{1}{\\sigma^2}\\right)^{-\\frac{K+N_0+\\alpha_n}{2}+1}\\exp\\left\\{-\\frac{1}{2\\sigma^2}(\\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{y}}_0-\\boldsymbol{\\beta}_*^{\\top}{\\boldsymbol{M}}\\boldsymbol{\\beta}_*+\\delta_n)\\right\\}\\right.\\\\ &amp;\\times\\left.\\int_{R^K}\\exp\\left\\{-\\frac{1}{2\\sigma^2}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_*)^{\\top}{\\boldsymbol{M}}(\\boldsymbol{\\beta} - \\boldsymbol{\\beta}_*)\\right\\}d\\boldsymbol{\\beta}\\right\\} d\\sigma^2,\\\\ \\end{align*}\\] where the term in the second integral is the kernel of a multivariate normal density with mean \\(\\boldsymbol{\\beta}_*\\) and covariance matrix \\(\\sigma^2{\\boldsymbol{M}}^{-1}\\). Then, \\[\\begin{align*} \\pi({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}})&amp;\\propto\\int_{0}^{\\infty}\\left(\\frac{1}{\\sigma^2}\\right)^{\\frac{N_0+\\alpha_n}{2}+1}\\exp\\left\\{-\\frac{1}{2\\sigma^2}(\\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{y}}_0-\\boldsymbol{\\beta}_*^{\\top}{\\boldsymbol{M}}\\boldsymbol{\\beta}_*+\\delta_n)\\right\\}d\\sigma^2,\\\\ \\end{align*}\\] which is the kernel of an inverse gamma density. Thus, \\[\\begin{align*} \\pi({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}})&amp;\\propto \\left[\\frac{\\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{y}}_0-\\boldsymbol{\\beta}_*^{\\top}{\\boldsymbol{M}}\\boldsymbol{\\beta}_*+\\delta_n}{2}\\right]^{-\\frac{\\alpha_n+N_0}{2}}. \\end{align*}\\] Setting \\({\\boldsymbol{C}}^{-1}={\\boldsymbol{I}}_{N_0}+{\\boldsymbol{X}}_0{\\boldsymbol{B}}_n{\\boldsymbol{X}}_0^{\\top}\\) such that \\({\\boldsymbol{C}}={\\boldsymbol{I}}_{N_0}-{\\boldsymbol{X}}_0({\\boldsymbol{B}}_n^{-1}+{\\boldsymbol{X}}_0^{\\top}{\\boldsymbol{X}}_0)^{-1}{\\boldsymbol{X}}_0^{\\top}={\\boldsymbol{I}}_{N_0}-{\\boldsymbol{X}}_0{\\boldsymbol{M}}^{-1}{\\boldsymbol{X}}_0^{\\top}\\), and \\({\\boldsymbol{\\boldsymbol{\\beta}}}_{**}={\\boldsymbol{C}}^{-1}{\\boldsymbol{X}}_0{\\boldsymbol{M}}^{-1}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n\\), then \\[\\begin{align*} \\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{y}}_0-\\boldsymbol{\\beta}_*^{\\top}{\\boldsymbol{M}}\\boldsymbol{\\beta}_*&amp;= \\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{y}}_0-(\\boldsymbol{\\beta}_n^{\\top}{\\boldsymbol{B}}_n^{-1}+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{X}}_0){\\boldsymbol{M}}^{-1}({\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{X}}_0^{\\top}{\\boldsymbol{y}}_0)\\\\ &amp;=\\boldsymbol{\\beta}_n^{\\top}({\\boldsymbol{B}}_n^{-1}-{\\boldsymbol{B}}_n^{-1}{\\boldsymbol{M}}^{-1}{\\boldsymbol{B}}_n^{-1})\\boldsymbol{\\beta}_n+{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{C}}{\\boldsymbol{y}}_0\\\\ &amp;-2{\\boldsymbol{y}}_0^{\\top}{\\boldsymbol{C}}{\\boldsymbol{C}}^{-1}{\\boldsymbol{X}}_0{\\boldsymbol{M}}^{-1}{\\boldsymbol{B}}_n^{-1}\\boldsymbol{\\beta}_n+{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}^{\\top}{\\boldsymbol{C}}{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}-{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}^{\\top}{\\boldsymbol{C}}{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}\\\\ &amp;=\\boldsymbol{\\beta}_n^{\\top}({\\boldsymbol{B}}_n^{-1}-{\\boldsymbol{B}}_n^{-1}{\\boldsymbol{M}}^{-1}{\\boldsymbol{B}}_n^{-1})\\boldsymbol{\\beta}_n+({\\boldsymbol{y}}_0-{\\boldsymbol{\\boldsymbol{\\beta}}}_{**})^{\\top}{\\boldsymbol{C}}({\\boldsymbol{y}}_0-{\\boldsymbol{\\boldsymbol{\\beta}}}_{**})\\\\ &amp;-{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}^{\\top}{\\boldsymbol{C}}{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}, \\end{align*}\\] where \\(\\boldsymbol{\\beta}_n^{\\top}({\\boldsymbol{B}}_n^{-1}-{\\boldsymbol{B}}_n^{-1}{\\boldsymbol{M}}^{-1}{\\boldsymbol{B}}_n^{-1})\\boldsymbol{\\beta}_n={\\boldsymbol{\\boldsymbol{\\beta}}}_{**}^{\\top}{\\boldsymbol{C}}{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}\\) and \\(\\boldsymbol{\\beta}_{**}={\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n\\) (see Exercise 8). Then, \\[\\begin{align*} \\pi({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}})&amp;\\propto\\left[\\frac{({\\boldsymbol{y}}_0-{\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n)^{\\top}{\\boldsymbol{C}}({\\boldsymbol{y}}_0-{\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n)+\\delta_n}{2}\\right]^{-\\frac{\\alpha_n+N_0}{2}}\\\\ &amp;\\propto\\left[\\frac{({\\boldsymbol{y}}_0-{\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n)^{\\top}\\left(\\frac{{\\boldsymbol{C}}\\alpha_n}{\\delta_n}\\right)({\\boldsymbol{y}}_0-{\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n)}{\\alpha_n}+1\\right]^{-\\frac{\\alpha_n+N_0}{2}}. \\end{align*}\\] The posterior predictive is a multivariate t distribution, \\({\\boldsymbol{y}}_0\\mid {\\boldsymbol{y}}\\sim t\\left({\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n,\\frac{\\delta_n({\\boldsymbol{I}}_{N_0}+{\\boldsymbol{X}}_0{\\boldsymbol{B}}_n{\\boldsymbol{X}}_0^{\\top})}{\\alpha_n},\\alpha_n\\right)\\). Example: Demand of electricity We study in this example the determinants of the monthly demand for electricity by Colombian households. The data consists of information from 2103 households, including the following variables: the average price (USD/kWh), indicators of the socioeconomic conditions of the neighborhood where the household is located (with IndSocio1 being the lowest and IndSocio3 being the highest), an indicator for whether the household is located in a municipality that is above 1000 meters above sea level, the number of rooms in the house, the number of members in the household, the presence of children in the household (where 1 indicates yes), and the monthly income (USD). The specification is as follows: \\[\\begin{align*} \\log(\\text{Electricity}_i) &amp; = \\beta_1\\log(\\text{price}_i) + \\beta_2\\text{IndSocio1}_i + \\beta_3\\text{IndSocio2}_i + \\beta_4\\text{Altitude}_i \\\\ &amp; + \\beta_5\\text{Nrooms}_i + \\beta_6\\text{HouseholdMem}_i + \\beta_7\\text{Children}_i\\\\ &amp; + \\beta_8\\log(\\text{Income}_i) + \\beta_9 + \\mu_i. \\end{align*}\\] We use a non-informative vague prior setting such that \\(\\alpha_0=\\delta_0=0.001\\), \\(\\boldsymbol{\\beta}_0=\\boldsymbol{0}\\) and \\(\\boldsymbol{B}_0=c_0\\boldsymbol{I}_K\\), where \\(c_0=1000\\) and \\(K\\) is the number of regressors. The results from the R code (see below) indicate that the posterior mean of the own-price elasticity of electricity demand is -1.09, and the 95% symmetric credible interval is (-1.47, -0.71). Households in neighborhoods with low socioeconomic conditions and those located in municipalities situated more than 1000 meters above sea level consume less electricity, with reductions of 32.7% and 19.7% on average, respectively. An additional room leads to an 8.7% increase in electricity consumption, and each additional household member increases consumption by 5.9% on average. The mean estimate for income elasticity is 0.074, meaning that a 10% increase in income results in a 0.74% increase in electricity demand. We want to check the results of the Bayes factor comparing the previous specification (model 1) with other specification without considering the price of electricity (model 2), that is, \\[\\begin{align*} \\log(\\text{Electricity}_i) &amp; = \\beta_1\\text{IndSocio1}_i + \\beta_2\\text{IndSocio2}_i + \\beta_3\\text{Altitude}_i + \\beta_4\\text{Nrooms}_i\\\\ &amp; + \\beta_5\\text{HouseholdMem}_i + \\beta_6\\text{Children}_i + \\beta_7\\log(\\text{Income}_i)\\\\ &amp; + \\beta_8 + \\mu_i \\end{align*}\\] In particular, we examine what happens as \\(c_0\\) increases from \\(10^{0}\\) to \\(10^{20}\\). We observe that when \\(c_0 = 1\\), \\(BF_{12} = 8.68 \\times 10^{+16}\\), which indicates very strong evidence in favor of the model including the price of electricity. However, as \\(c_0\\) increases, the Bayes factor decreases, which suggests evidence supporting model 2. For instance, when \\(c_0 = 10^{20}\\), \\(BF_{12} = 3.11 \\times 10^{-4}\\). This is an example of the issue with using non-informative priors to calculate the Bayes factor: there is very strong evidence supporting the parsimonious model as \\(c_0 \\rightarrow \\infty\\). We can obtain the posterior predictive distribution of the monthly electricity demand for a household located in the lowest socioeconomic condition in a municipality situated below 1000 meters above sea level, with 2 rooms, 3 members (with children), a monthly income of USD 500, and an electricity price of USD 0.15/kWh. The next Figure shows the histogram of the predictive posterior distribution. The highest posterior density credible interval at 95% is between 44.4 kWh and 373.9 kWh, and the posterior mean is 169.4 kWh. # Load required libraries library(dplyr) library(Matrix) library(MCMCpack) library(LaplacesDemon) ## ## Attaching package: &#39;LaplacesDemon&#39; ## The following object is masked from &#39;package:purrr&#39;: ## ## partial ## The following objects are masked from &#39;package:MCMCpack&#39;: ## ## BayesFactor, ddirichlet, dinvgamma, rdirichlet, rinvgamma ## The following object is masked from &#39;package:sirt&#39;: ## ## rmvn library(coda) library(HDInterval) # Load electricity demand data data_util &lt;- read.csv( &quot;https://raw.githubusercontent.com/besmarter/BSTApp/refs/heads/master/DataApp/Utilities.csv&quot;, sep = &quot;,&quot;, header = TRUE, quote = &quot;&quot; ) # Filter out households with zero electricity consumption data_est &lt;- data_util %&gt;% filter(Electricity != 0) # Define dependent variable: log of monthly electricity consumption y &lt;- log(data_est$Electricity) # Define regressors including intercept X &lt;- with(data_est, cbind( LnPriceElect, IndSocio1, IndSocio2, Altitude, Nrooms, HouseholdMem, Children, Lnincome, 1 )) # Dimensions k &lt;- ncol(X) n &lt;- nrow(X) # Hyperparameters d_0 &lt;- 0.001 a_0 &lt;- 0.001 b_0 &lt;- rep(0, k) B_0 &lt;- 1000 * diag(k) # Posterior parameters b_hat &lt;- solve(t(X) %*% X) %*% t(X) %*% y B_n &lt;- as.matrix(forceSymmetric(solve(solve(B_0) + t(X) %*% X))) b_n &lt;- B_n %*% (solve(B_0) %*% b_0 + t(X) %*% X %*% b_hat) d_n &lt;- as.numeric(d_0 + t(y) %*% y + t(b_0) %*% solve(B_0) %*% b_0 - t(b_n) %*% solve(B_n) %*% b_n) a_n &lt;- a_0 + n H_n &lt;- B_n * d_n / a_n # Posterior draws S &lt;- 10000 sigma2_samples &lt;- rinvgamma(S, shape = a_n / 2, scale = d_n / 2) summary(mcmc(sigma2_samples)) ## ## Iterations = 1:10000 ## Thinning interval = 1 ## Number of chains = 1 ## Sample size per chain = 10000 ## ## 1. Empirical mean and standard deviation for each variable, ## plus standard error of the mean: ## ## Mean SD Naive SE Time-series SE ## 2.360e-01 7.549e-03 7.549e-05 7.678e-05 ## ## 2. Quantiles for each variable: ## ## 2.5% 25% 50% 75% 97.5% ## 0.2215 0.2309 0.2359 0.2410 0.2511 beta_samples &lt;- rmvt(S, b_n, H_n, df = a_n) summary(mcmc(beta_samples)) ## ## Iterations = 1:10000 ## Thinning interval = 1 ## Number of chains = 1 ## Sample size per chain = 10000 ## ## 1. Empirical mean and standard deviation for each variable, ## plus standard error of the mean: ## ## Mean SD Naive SE Time-series SE ## LnPriceElect -1.08780 0.19319 0.0019319 0.0019214 ## IndSocio1 -0.32671 0.05292 0.0005292 0.0005292 ## IndSocio2 -0.05676 0.04650 0.0004650 0.0004650 ## Altitude -0.19788 0.02418 0.0002418 0.0002418 ## Nrooms 0.08735 0.01084 0.0001084 0.0001084 ## HouseholdMem 0.06005 0.01346 0.0001346 0.0001322 ## Children 0.05696 0.03124 0.0003124 0.0002998 ## Lnincome 0.07458 0.01201 0.0001201 0.0001228 ## 2.52536 0.34724 0.0034724 0.0033371 ## ## 2. Quantiles for each variable: ## ## 2.5% 25% 50% 75% 97.5% ## LnPriceElect -1.474112 -1.21720 -1.08770 -0.95779 -0.70616 ## IndSocio1 -0.428745 -0.36297 -0.32727 -0.29093 -0.22237 ## IndSocio2 -0.147010 -0.08786 -0.05703 -0.02574 0.03495 ## Altitude -0.245399 -0.21420 -0.19769 -0.18157 -0.15049 ## Nrooms 0.065940 0.08004 0.08749 0.09455 0.10883 ## HouseholdMem 0.033534 0.05100 0.05995 0.06899 0.08688 ## Children -0.003131 0.03567 0.05660 0.07805 0.11904 ## Lnincome 0.050923 0.06645 0.07459 0.08278 0.09806 ## 1.845727 2.29194 2.52744 2.75847 3.20891 # Function to compute log marginal likelihood (negative for optimization) log_marginal_likelihood &lt;- function(X, c_0) { k &lt;- ncol(X) n &lt;- nrow(X) B_0 &lt;- c_0 * diag(k) b_0 &lt;- rep(0, k) b_hat &lt;- solve(t(X) %*% X) %*% t(X) %*% y B_n &lt;- as.matrix(forceSymmetric(solve(solve(B_0) + t(X) %*% X))) b_n &lt;- B_n %*% (solve(B_0) %*% b_0 + t(X) %*% X %*% b_hat) d_n &lt;- as.numeric(d_0 + t(y) %*% y + t(b_0) %*% solve(B_0) %*% b_0 - t(b_n) %*% solve(B_n) %*% b_n) a_n &lt;- a_0 + n log_py &lt;- (n / 2) * log(1 / pi) + (a_0 / 2) * log(d_0) - (a_n / 2) * log(d_n) + 0.5 * log(det(B_n) / det(B_0)) + lgamma(a_n / 2) - lgamma(a_0 / 2) return(-log_py) } # Prior variances c_values &lt;- c(1, 1e3, 1e6, 1e10, 1e12, 1e15, 1e20) # Compute log marginal likelihoods log_ml &lt;- sapply(c_values, function(c) -log_marginal_likelihood(X = X, c_0 = c)) # Regressors without price X_new &lt;- with(data_est, cbind( IndSocio1, IndSocio2, Altitude, Nrooms, HouseholdMem, Children, Lnincome, 1 )) log_ml_new &lt;- sapply(c_values, function(c) -log_marginal_likelihood(X = X_new, c_0 = c)) # Bayes Factor bf &lt;- exp(log_ml - log_ml_new) bf ## [1] 8.687289e+16 1.006665e+05 3.108374e+03 3.108299e+01 3.108303e+00 ## [6] 9.829315e-02 3.108302e-04 # Predictive distribution x_pred &lt;- c(log(0.15), 1, 0, 0, 2, 3, 1, log(500), 1) mean_pred &lt;- x_pred %*% b_n H_pred &lt;- d_n * (1 + t(x_pred) %*% B_n %*% x_pred) / a_n expected_kwh &lt;- exp(rmvt(S, mean_pred, H_pred, df = a_n)) summary(expected_kwh) ## V1 ## Min. : 24.4 ## 1st Qu.: 122.5 ## Median : 170.3 ## Mean : 192.3 ## 3rd Qu.: 238.2 ## Max. :1321.3 hdi_interval &lt;- hdi(expected_kwh, credMass = 0.95) hdi_interval ## [,1] ## lower 43.33852 ## upper 388.00752 ## attr(,&quot;credMass&quot;) ## [1] 0.95 hist(expected_kwh, main = &quot;Histogram: Monthly demand of electricity&quot;, xlab = &quot;Monthly kWh&quot;, col = &quot;blue&quot;, breaks = 50) References An, Sungbae, and Frank Schorfheide. 2007. “Bayesian Analysis of DSGE Models.” Econometric Reviews 26 (2-4): 113–72. Bayes, T. 1763. “An Essay Towards Solving a Problem in the Doctrine of Chances.” Philosophical Transactions of the Royal Society of London 53: 370–416. Berger, J. 2006. “The Case for Objective Bayesian Analysis.” Bayesian Analysis 1 (3): 385–402. Berger, James O, and Luis R Pericchi. 1996. “The Intrinsic Bayes Factor for Model Selection and Prediction.” Journal of the American Statistical Association 91 (433): 109–22. Bernardo, José M, and Adrian FM Smith. 2009. Bayesian Theory. Vol. 405. John Wiley &amp; Sons. De Finetti, Bruno. 1937. “Foresight: Its Logical Laws, Its Subjective Sources.” In Studies in Subjective Probability, edited by H. E. Kyburg and H. E. Smokler. New York: Krieger. Garthwaite, P., J. Kadane, and A. O’Hagan. 2005. “Statistical Methods for Eliciting Probability Distributions.” Journal of American Statistical Association 100 (470): 680–701. Gelman, Andrew et al. 2006. “Prior Distributions for Variance Parameters in Hierarchical Models (Comment on Article by Browne and Draper).” Bayesian Analysis 1 (3): 515–34. Giordano, Ryan, Runjing Liu, Michael I Jordan, and Tamara Broderick. 2022. “Evaluating Sensitivity to the Stick-Breaking Prior in Bayesian Nonparametrics.” Bayesian Analysis 1 (1): 1–34. Gustafson, Paul. 2000. “Local Robustness in Bayesian Analysis.” In Robust Bayesian Analysis, 71–88. Springer. Jacobi, Liana, Chun Fung Kwok, Andrés Ramı́rez-Hassan, and Nhung Nghiem. 2024. “Posterior Manifolds over Prior Parameter Regions: Beyond Pointwise Sensitivity Assessments for Posterior Statistics from MCMC Inference.” Studies in Nonlinear Dynamics &amp; Econometrics 28 (2): 403–34. Jacobi, Liana, Dan Zhu, and Mark Joshi. 2022. “Estimating Posterior Sensitivities with Application to Structural Analysis of Bayesian Vector Autoregressions.” Available at SSRN 3347399. https://ssrn.com/abstract=3347399 or http://dx.doi.org/10.2139/ssrn.3347399. Jeffreys, H. 1961. Theory of Probability. London: Oxford University Press. Jeffreys, Harold. 1946. “An Invariant Form for the Prior Probability in Estimation Problems.” Proceedings of the Royal Society of London. Series A. Mathematical and Physical Sciences 186 (1007): 453–61. Kadane, J. B. 1980. “Predictive and Structural Methods for Eliciting Prior Distributions.” In Bayesian Analysis in Econometrics and Statistics: Essays in Honor of Harold Jeffreys, edited by A Zellner, 89–93. Amsterdam: North–Holland Publishing Company,. Kadane, Joseph, and Lara Wolfson. 1998. “Experiences in Elitation.” The Statiscian 47 (1): 3–19. Kim, Chang-Jin, and Charles R Nelson. 1999. “Has the US Economy Become More Stable? A Bayesian Approach Based on a Markov-Switching Model of the Business Cycle.” Review of Economics and Statistics 81 (4): 608–16. Laplace, P. 1812. Théorie Analytique Des Probabilités. Courcier. Lindley, D. V. 2000. “The Philosophy of Statistics.” The Statistician 49 (3): 293–337. Ramsey, F. 1926. “Truth and Probability.” In The Foundations of Mathematics and Other Logical Essays, edited by Routledge and Kegan Paul. London: New York: Harcourt, Brace; Company. Richardson, Sylvia, and Peter J Green. 1997. “On Bayesian Analysis of Mixtures with an Unknown Number of Components (with Discussion).” Journal of the Royal Statistical Society: Series B (Statistical Methodology) 59 (4): 731–92. Savage, L. J. 1954. The Foundations of Statistics. New York: John Wiley &amp; Sons, Inc. Smith, A. F. M. 1973. “A General Bayesian Linear Model.” Journal of the Royal Statistical Society. Series B (Methodological). 35 (1): 67–75. Tversky, A., and D. Kahneman. 1974. “Judgement Under Uncertainty: Heuristics and Biases.” Science 185: 1124–31. A particular case of the Woodbury matrix identity, \\((\\boldsymbol{A}+\\boldsymbol{U}\\boldsymbol{C}\\boldsymbol{V})^{-1}=\\boldsymbol{A}^{-1}-\\boldsymbol{A}^{-1}\\boldsymbol{U}(\\boldsymbol{C}^{-1}+\\boldsymbol{V}\\boldsymbol{A}^{-1}\\boldsymbol{U})^{-1}\\boldsymbol{V}\\boldsymbol{A}^{-1}\\).↩︎ See Gelman et al. (2006) for advice against this common practice.↩︎ "],["sec44.html", "3.4 Multivariate linear regression: The conjugate normal-normal/inverse Wishart model", " 3.4 Multivariate linear regression: The conjugate normal-normal/inverse Wishart model Let’s study the multivariate regression setting where there are \\(N\\)-dimensional vectors \\({\\boldsymbol{y}}_m\\), for \\(m = 1, 2, \\dots, M\\), such that \\({\\boldsymbol{y}}_m = {\\boldsymbol{X}} \\boldsymbol{\\beta}_m + \\boldsymbol{\\mu}_m\\). Here, \\({\\boldsymbol{X}}\\) represents the set of common regressors, and \\(\\boldsymbol{\\mu}_m\\) is the \\(N\\)-dimensional vector of stochastic errors for each equation. We assume that \\({\\boldsymbol{U}} = [\\boldsymbol{\\mu}_1 \\ \\boldsymbol{\\mu}_2 \\ \\dots \\ \\boldsymbol{\\mu}_M] \\sim MN_{N,M}({\\boldsymbol{0}}, {\\boldsymbol{I}}_N, {\\boldsymbol{\\Sigma}})\\), which is a matrix variate normal distribution where \\(\\boldsymbol{\\Sigma}\\) is the covariance matrix of each \\(i\\)-th row of \\({\\boldsymbol{U}}\\), for \\(i = 1, 2, \\dots, N\\), and we assume independence between the rows. Consequently, we have that \\(vec({\\boldsymbol{U}}) \\sim N_{N \\times M}({\\boldsymbol{0}}, \\boldsymbol{\\Sigma} \\otimes {\\boldsymbol{I}}_N)\\).7 This framework can be written in matrix form \\[\\begin{align*} \\underbrace{ \\begin{bmatrix} y_{11} &amp; y_{12} &amp; \\dots &amp; y_{1M}\\\\ y_{21} &amp; y_{22} &amp; \\dots &amp; y_{2M}\\\\ \\vdots &amp; \\vdots &amp; \\dots &amp; \\vdots\\\\ y_{N1} &amp; y_{N2} &amp; \\dots &amp; y_{NM}\\\\ \\end{bmatrix}}_{\\boldsymbol{Y}} &amp;= \\underbrace{\\begin{bmatrix} x_{11} &amp; x_{12} &amp; \\dots &amp; x_{1K}\\\\ x_{21} &amp; x_{22} &amp; \\dots &amp; x_{2K}\\\\ \\vdots &amp; \\vdots &amp; \\dots &amp; \\vdots\\\\ x_{N1} &amp; x_{N2} &amp; \\dots &amp; x_{NK}\\\\ \\end{bmatrix}}_{\\boldsymbol{X}} \\underbrace{ \\begin{bmatrix} \\beta_{11} &amp; \\beta_{12} &amp; \\dots &amp; \\beta_{1M}\\\\ \\beta_{21} &amp; \\beta_{22} &amp; \\dots &amp; \\beta_{2M}\\\\ \\vdots &amp; \\vdots &amp; \\dots &amp; \\vdots\\\\ \\beta_{K1} &amp; \\beta_{K2} &amp; \\dots &amp; \\beta_{KM}\\\\ \\end{bmatrix}}_{\\boldsymbol{B}}\\\\ &amp;+ \\underbrace{\\begin{bmatrix} \\mu_{11} &amp; \\mu_{12} &amp; \\dots &amp; \\mu_{1M}\\\\ \\mu_{21} &amp; \\mu_{22} &amp; \\dots &amp; \\mu_{2M}\\\\ \\vdots &amp; \\vdots &amp; \\dots &amp; \\vdots\\\\ \\mu_{N1} &amp; \\mu_{N2} &amp; \\dots &amp; \\mu_{NM}\\\\ \\end{bmatrix}}_{\\boldsymbol{U}}. \\end{align*}\\] Therefore, \\({\\boldsymbol{Y}}\\sim N_{N\\times M}({\\boldsymbol{X}}{\\boldsymbol{B}},\\boldsymbol{\\Sigma}\\otimes {\\boldsymbol{I}}_N)\\),8 \\[\\begin{align*} p({\\boldsymbol{Y}}\\mid {\\boldsymbol{B}},{\\boldsymbol{\\Sigma}}, {\\boldsymbol{X}})&amp;\\propto |{{\\boldsymbol \\Sigma}}|^{-N/2}\\exp\\left\\lbrace -\\frac{1}{2}tr\\left[({\\boldsymbol{Y}}-{\\boldsymbol{X}}{\\boldsymbol{B}})^{\\top}({\\boldsymbol{Y}}-{\\boldsymbol{X}}{\\boldsymbol{B}}){{\\boldsymbol \\Sigma}}^{-1}\\right]\\right\\rbrace \\\\ &amp;=|{{\\boldsymbol \\Sigma}}|^{-N/2}\\exp\\left\\lbrace -\\frac{1}{2}tr\\left[\\left({\\boldsymbol{S}}+({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})\\right){{\\boldsymbol \\Sigma}}^{-1}\\right]\\right\\rbrace, \\end{align*}\\] where \\({\\boldsymbol{S}}= ({\\boldsymbol{Y}}-{\\boldsymbol{X}}\\widehat{\\boldsymbol{B}})^{\\top}({\\boldsymbol{Y}}-{\\boldsymbol{X}}\\widehat{\\boldsymbol{B}})\\), \\(\\widehat{\\boldsymbol{B}}= ({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{Y}}\\) (see Exercise 9). The conjugate prior for this model is \\(\\pi({\\boldsymbol{B}},{\\boldsymbol{\\Sigma}})=\\pi({\\boldsymbol{B}}\\mid {\\boldsymbol{\\Sigma}})\\pi({\\boldsymbol{\\Sigma}})\\) where \\({\\boldsymbol{B}}\\mid {\\boldsymbol \\Sigma}\\sim N_{K\\times M}({\\boldsymbol{B}}_{0},{\\boldsymbol{V}}_{0},{\\boldsymbol{\\Sigma}})\\) and \\({\\boldsymbol{\\Sigma}}\\sim IW({\\boldsymbol{\\Psi}}_{0},\\alpha_{0})\\), that is, \\[\\begin{align*} \\pi ({\\boldsymbol{B}},{\\boldsymbol{\\Sigma}})\\propto &amp;\\left|{\\boldsymbol{\\Sigma}} \\right|^{-K/2}\\exp\\left\\lbrace -\\frac{1}{2}tr\\left[({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{0}^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0}){\\boldsymbol \\Sigma}^{-1}\\right]\\right\\rbrace \\\\ &amp; \\times \\left|{\\boldsymbol \\Sigma} \\right|^{-(\\alpha_{0}+M+1)/2}\\exp\\left\\lbrace -\\frac{1}{2}tr \\left[ {\\boldsymbol{\\Psi}}_{0} {\\boldsymbol \\Sigma}^{-1}\\right] \\right\\rbrace. \\end{align*}\\] The posterior distribution is given by \\[\\begin{align*} \\pi({\\boldsymbol{B}},{\\boldsymbol{\\Sigma}}\\mid {\\boldsymbol{Y}},{\\boldsymbol{X}})&amp;\\propto p({\\boldsymbol{Y}}\\mid {\\boldsymbol{B}},{\\boldsymbol{\\Sigma}},{\\boldsymbol{X}}) \\pi({\\boldsymbol{B}}\\mid {\\boldsymbol \\Sigma})\\pi({\\boldsymbol{\\Sigma}})\\\\ &amp;\\propto \\left|{\\boldsymbol{\\Sigma}} \\right|^{-\\frac{N+K+\\alpha_{0}+M+1}{2}}\\\\ &amp;\\times\\exp\\left\\lbrace -\\frac{1}{2}tr\\left[(\\boldsymbol{\\Psi}_{0}+{\\boldsymbol{S}} +({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{0}^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})\\right.\\right.\\\\ &amp;\\left.\\left. +({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}))\\boldsymbol{\\Sigma}^{-1}\\right]\\right\\rbrace . \\end{align*}\\] Completing the squares on \\({\\boldsymbol{B}}\\) and collecting the remaining terms in the bracket yields \\[\\begin{align*} {\\boldsymbol{\\Psi}}_{0}+{\\boldsymbol{S}} +({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{0}^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})+({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}) &amp; = ({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)^{\\top}{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)+{\\boldsymbol{\\Psi}}_n, \\end{align*}\\] where \\[\\begin{align*} {\\boldsymbol{B}}_n = &amp;({\\boldsymbol{V}}_{0}^{-1}+{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}({\\boldsymbol{V}}_{0}^{-1}{\\boldsymbol{B}}_{0}+{\\boldsymbol{X}}^{\\top}{\\boldsymbol{Y}})=({\\boldsymbol{V}}_{0}^{-1}+{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}({\\boldsymbol{V}}_{0}^{-1}{\\boldsymbol{B}}_{0}+{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}\\widehat{\\boldsymbol{B}}),\\\\ {\\boldsymbol{V}}_n = &amp;({\\boldsymbol{V}}_{0}^{-1}+{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1},\\\\ {\\boldsymbol{\\Psi}}_n= &amp;{\\boldsymbol{\\Psi}}_{0}+{\\boldsymbol{S}}+{\\boldsymbol{B}}_{0}^{\\top}{\\boldsymbol{V}}_{0}^{-1}{\\boldsymbol{B}}_{0}+\\widehat{\\boldsymbol{B}}^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}\\widehat{\\boldsymbol{B}}-{\\boldsymbol{B}}_n^{\\top}{\\boldsymbol{V}}_n^{-1}{\\boldsymbol{B}}_n. \\end{align*}\\] Thus, the posterior distribution can be written as \\[\\begin{align*} \\pi({\\boldsymbol{B}},{\\boldsymbol \\Sigma}\\mid {\\boldsymbol{Y}}, {\\boldsymbol{X}})\\propto &amp;\\left|{\\boldsymbol \\Sigma} \\right|^{-K/2}\\exp\\left\\lbrace -\\frac{1}{2} tr\\left[({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)^{\\top}{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n) {\\boldsymbol \\Sigma}^{-1}\\right]\\right\\rbrace \\\\ \\times &amp; \\left|{\\boldsymbol \\Sigma} \\right|^{-\\frac{N+\\alpha_{0}+M+1}{2}}\\exp\\left\\lbrace -\\frac{1}{2} tr \\left[ {\\boldsymbol{\\Psi}}_n{\\boldsymbol \\Sigma}^{-1}\\right] \\right\\rbrace . \\end{align*}\\] That is \\(\\pi({\\boldsymbol{B}},{\\boldsymbol \\Sigma}\\mid {\\boldsymbol{Y}}, {\\boldsymbol{X}})=\\pi ({\\boldsymbol{B}}\\mid {\\boldsymbol \\Sigma},{\\boldsymbol{Y}},{\\boldsymbol{X}})\\pi({\\boldsymbol \\Sigma}\\mid {\\boldsymbol{Y}},{\\boldsymbol{X}})\\) where \\({\\boldsymbol{B}}\\mid {\\boldsymbol \\Sigma},{\\boldsymbol{Y}}, {\\boldsymbol{X}} \\sim N_{K\\times M}({\\boldsymbol{B}}_n,{\\boldsymbol{V}}_n,{\\boldsymbol \\Sigma})\\) and \\({\\boldsymbol \\Sigma}\\mid {\\boldsymbol{Y}},{\\boldsymbol{X}} \\sim IW({\\boldsymbol{\\Psi}}_n,{\\alpha}_n)\\), \\(\\alpha_n= N+\\alpha_{0}\\). Observe again that we can write down the posterior mean as a weighted average between prior and sample information such that \\({\\boldsymbol{V}}_0\\rightarrow\\infty\\) implies \\({\\boldsymbol{B}}_n\\rightarrow\\hat{{\\boldsymbol{B}}}\\), as we show in the univariate linear model. The marginal posterior for \\({\\boldsymbol{B}}\\) is given by \\[\\begin{align*} \\pi({\\boldsymbol{B}}\\mid {\\boldsymbol{Y}},{\\boldsymbol{X}})&amp;\\propto \\int_{\\boldsymbol{\\mathcal{S}}} \\left|{\\boldsymbol \\Sigma} \\right|^{-(\\alpha_n+K+M+1)/2}\\\\ &amp;\\times\\exp\\left\\lbrace -\\frac{1}{2} tr\\left\\{\\left[({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)^{\\top}{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)+{\\boldsymbol{\\Psi}}_n \\right] {\\boldsymbol \\Sigma}^{-1}\\right\\}\\right\\rbrace d{\\boldsymbol{\\Sigma}} \\\\ &amp;\\propto|({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)^{\\top}{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)+{\\boldsymbol{\\Psi}}_n|^{-(K+\\alpha_n)/2}\\\\ &amp;=\\left[|{\\boldsymbol{\\Psi}}_n|\\times|{\\boldsymbol{I}}_K+{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n){\\boldsymbol{\\Psi}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)^{\\top}|\\right]^{-(\\alpha_n+1-M+K+M-1)/2}\\\\ &amp;\\propto|{\\boldsymbol{I}}_K+{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n){\\boldsymbol{\\Psi}}_n^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_n)^{\\top}|^{-(\\alpha_n+1-M+K+M-1)/2}. \\end{align*}\\] The second line uses the inverse Wishart distribution, the third line the Sylverter’s theorem, and the last line is the kernel of a matrix \\(t\\)-distribution, that is, \\({\\boldsymbol{B}}\\mid {\\boldsymbol{Y}},{\\boldsymbol{X}}\\sim T_{K\\times M}({\\boldsymbol{B}}_n,{\\boldsymbol{V}}_n,{\\boldsymbol{\\Psi}}_n)\\) with \\(\\alpha_n+1-M\\) degrees of freedom. Observe that \\(vec({\\boldsymbol{B}})\\) has mean \\(vec({\\boldsymbol{B}}_n)\\) and variance \\(({\\boldsymbol{V}}_n\\otimes{\\boldsymbol{\\Psi}}_n)/(\\alpha_n-M-1)\\) based on its marginal distribution. On the other hand, the variance based on the conditional distribution is \\({\\boldsymbol{V}}_n\\otimes{\\boldsymbol{\\Sigma}}\\), where the mean of \\({\\boldsymbol{\\Sigma}}\\) is \\({\\boldsymbol{\\Psi}}_n/(\\alpha_n-M-1)\\). The marginal likelihood is the following, \\[\\begin{align*} p({\\boldsymbol{Y}})&amp;=\\int_{\\mathcal{B}}\\int_{\\mathcal{S}}\\left\\{ (2\\pi)^{-NM/2} |{{\\boldsymbol \\Sigma}}|^{-N/2}\\exp\\left\\lbrace -\\frac{1}{2}tr\\left[{\\boldsymbol{S}}+({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})\\right]{{\\boldsymbol \\Sigma}}^{-1}\\right\\rbrace\\right.\\\\ &amp;\\times (2\\pi)^{-KM/2}\\left|{\\boldsymbol V}_0 \\right|^{-M/2} \\left|{\\boldsymbol{\\Sigma}} \\right|^{-K/2}\\exp\\left\\lbrace -\\frac{1}{2}tr\\left[({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{0}^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0}){\\boldsymbol \\Sigma}^{-1}\\right]\\right\\rbrace \\\\ &amp;\\left. \\times \\frac{|\\Psi_0|^{\\alpha_0/2}}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)} \\left|{\\boldsymbol \\Sigma} \\right|^{-(\\alpha_{0}+M+1)/2}\\exp\\left\\lbrace -\\frac{1}{2}tr \\left[ {\\boldsymbol{\\Psi}}_{0} {\\boldsymbol \\Sigma}^{-1}\\right] \\right\\rbrace \\right\\} d{\\boldsymbol{\\Sigma}} d{\\boldsymbol B}\\\\ &amp;=(2\\pi)^{-M(N+K)/2}\\left|{\\boldsymbol V}_0\\right|^{-M/2}\\frac{|\\Psi_0|^{\\alpha_0/2}}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)}\\\\ &amp;\\times\\int_{\\mathcal{B}}\\int_{\\mathcal{S}} \\left\\{ \\left|{\\boldsymbol \\Sigma} \\right|^{-(\\alpha_{0}+N+K+M+1)/2}\\right.\\\\ &amp;\\left. \\exp\\left\\lbrace -\\frac{1}{2}tr\\left[{\\boldsymbol{S}}+({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})+({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{0}^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})+{\\boldsymbol{\\Psi}}_0\\right]{{\\boldsymbol \\Sigma}}^{-1}\\right\\rbrace\\right\\}d{\\boldsymbol{\\Sigma}} d{\\boldsymbol B}\\\\ &amp;=(2\\pi)^{-M(N+K)/2}\\left|{\\boldsymbol V}_0\\right|^{-M/2}\\frac{|\\Psi_0|^{\\alpha_0/2}}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)}2^{M(\\alpha_n+K)/2}\\Gamma_M((\\alpha_n+K)/2)\\\\ &amp;\\times \\int_{\\mathcal{B}}\\left|{\\boldsymbol{S}}+({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})+({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{0}^{-1}({\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})+{\\boldsymbol{\\Psi}}_0\\right|^{-(\\alpha_n+K)/2}d{\\boldsymbol{B}}\\\\ &amp;=(2\\pi)^{-M(N+K)/2}\\left|{\\boldsymbol V}_0\\right|^{-M/2}\\frac{|\\Psi_0|^{\\alpha_0/2}}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)}2^{M(\\alpha_n+K)/2}\\Gamma_M((\\alpha_n+K)/2)\\\\ &amp;\\times \\int_{\\mathcal{B}}\\left|({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}_n)^{\\top}{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}_n)+{\\boldsymbol{\\Psi}}_n\\right|^{-(\\alpha_n+K)/2}d{\\boldsymbol{B}}\\\\ &amp;=(2\\pi)^{-M(N+K)/2}\\left|{\\boldsymbol V}_0\\right|^{-M/2}\\frac{|\\Psi_0|^{\\alpha_0/2}}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)}2^{M(\\alpha_n+K)/2}\\Gamma_M((\\alpha_n+K)/2)\\\\ &amp;\\times \\int_{\\mathcal{B}}\\left[|{\\boldsymbol{\\Psi}}_n|\\times |{\\boldsymbol{I}}_{K}+{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}_n){\\boldsymbol{\\Psi}}_n^{-1}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}_n)^{\\top}|\\right]^{-(\\alpha_n+K)/2}d{\\boldsymbol{B}}\\\\ &amp;=|{\\boldsymbol{\\Psi}}_n|^{-(\\alpha_n+K)/2}(2\\pi)^{-M(N+K)/2}\\left|{\\boldsymbol V}_0\\right|^{-M/2}\\frac{|\\Psi_0|^{\\alpha_0/2}2^{M(\\alpha_n+K)/2}\\Gamma_M((\\alpha_n+K)/2)}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)}\\\\ &amp;\\times \\int_{\\mathcal{{\\boldsymbol{B}}}}\\left| {\\boldsymbol{I}}_{K}+{\\boldsymbol{V}}_n^{-1}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}_n){\\boldsymbol{\\Psi}}_n^{-1}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}}_n)^{\\top}\\right|^{-(\\alpha_n+1-M+K+M-1)/2}d{\\boldsymbol{B}}\\\\ &amp;=|{\\boldsymbol{\\Psi}}_n|^{-(\\alpha_n+K)/2}(2\\pi)^{-M(N+K)/2}\\left|{\\boldsymbol V}_0\\right|^{-M/2}\\frac{|\\Psi_0|^{\\alpha_0/2}2^{M(\\alpha_n+K)/2}\\Gamma_M((\\alpha_n+K)/2)}{2^{\\alpha_0M/2}\\Gamma_M(\\alpha_0/2)}\\\\ &amp;\\times \\pi^{MK/2}\\frac{\\Gamma_M((\\alpha_n+1-M+M-1)/2)}{\\Gamma_M((\\alpha_n+1-M+K+M-1)/2)}|{\\boldsymbol{\\Psi}}_n|^{K/2}|{\\boldsymbol{V}}_n|^{M/2}\\\\ &amp;=\\frac{|{\\boldsymbol{V}}_n|^{M/2}}{|{\\boldsymbol{V}}_0|^{M/2}}\\frac{|{\\boldsymbol{\\Psi}}_0|^{\\alpha_0/2}}{|{\\boldsymbol{\\Psi}}_n|^{\\alpha_n/2}}\\frac{\\Gamma_M(\\alpha_n/2)}{\\Gamma_M(\\alpha_0/2)}\\pi^{-MN/2}. \\end{align*}\\] The third equality follows from the kernel of an inverse Wishart distribution, the fifth from Sylvester’s theorem, and the seventh from the kernel of a matrix \\(t\\)-distribution. Observe that this last expression is the multivariate case of the marginal likelihood of the univariate regression model. Taking into account that \\[\\begin{align*} ({\\boldsymbol{A}}+{\\boldsymbol{B}})^{-1}&amp;={\\boldsymbol{A}}^{-1}-({\\boldsymbol{A}}^{-1}+{\\boldsymbol{B}}^{-1})^{-1}{\\boldsymbol{A}}^{-1}\\\\ &amp;={\\boldsymbol{B}}^{-1}-({\\boldsymbol{A}}^{-1}+{\\boldsymbol{B}}^{-1})^{-1}{\\boldsymbol{B}}^{-1}\\\\ &amp;={\\boldsymbol{A}}^{-1}({\\boldsymbol{A}}^{-1}+{\\boldsymbol{B}}^{-1}){\\boldsymbol{B}}^{-1}, \\end{align*}\\] we can show that \\({\\boldsymbol{\\Psi}}_{n}={\\boldsymbol{\\Psi}}_{0}+{\\boldsymbol{S}}+(\\hat{\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{n}(\\hat{\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})\\) (see Exercise 7). Therefore, the marginal likelihood rewards fit (smaller sum of squares, \\({\\boldsymbol{S}}\\)), similarity between prior and sample information regarding location parameters, and information gains in variability from \\({\\boldsymbol{V}}_0\\) to \\({\\boldsymbol{V}}_n\\). Given a matrix of regressors \\({\\boldsymbol{X}}_0\\) for \\(N_0\\) unobserved units, the predictive density of \\({\\boldsymbol{Y}}_0\\) given \\({\\boldsymbol{Y}}\\), \\(\\pi({\\boldsymbol{Y}}_0\\mid {\\boldsymbol{Y}})\\) is a matrix t distribution \\(T_{N_0,M}(\\alpha_n-M+1,{\\boldsymbol{X}}_0{\\boldsymbol{B}}_n,{\\boldsymbol{I}}_{N_0}+{\\boldsymbol{X}}_0{\\boldsymbol{V}}_n{\\boldsymbol{X}}_0^{\\top},{\\boldsymbol{\\Psi}}_n)\\) (see Exercise 6). Observe that the prediction is centered at \\({\\boldsymbol{X}}_0{\\boldsymbol{B}}_n\\), and the covariance matrix of \\(vec({\\boldsymbol{Y}}_0)\\) is \\(\\frac{({\\boldsymbol{I}}_{N_0}+{\\boldsymbol{X}}_0{\\boldsymbol{V}}_n{\\boldsymbol{X}}_0^{\\top})\\otimes{\\boldsymbol{\\Psi}}_n}{\\alpha_n-M-1}\\). \\(vec\\) denotes the vectorization operation, and \\(\\otimes\\) denotes the Kronecker product.↩︎ We can write down the former expression in a more familiar way using vectorization properties, \\(\\underbrace{vec(Y)}_{\\boldsymbol{y}}=\\underbrace{({\\boldsymbol{I}}_M\\otimes {\\boldsymbol{X}})}_{{\\boldsymbol{Z}}}\\underbrace{vec({\\boldsymbol{B}})}_{\\boldsymbol{\\beta}}+\\underbrace{vec({\\boldsymbol{U}})}_{\\mu}\\), where \\({\\boldsymbol{y}}\\sim N_{N\\times M}({\\boldsymbol{Z}}\\boldsymbol{\\beta},\\boldsymbol{\\Sigma}\\otimes {\\boldsymbol{I}}_N)\\).↩︎ "],["sec45.html", "3.5 Summary", " 3.5 Summary We introduce conjugate family models for both discrete and continuous data. These models form the foundation of the Bayesian framework due to their mathematical tractability, as they provide closed-form expressions for the posterior distributions, marginal likelihood, and predictive distribution. Additionally, we present the Bayesian linear regression frameworks for both univariate and multivariate cases under conjugate families. These frameworks are fundamental for performing regression analysis in the Bayesian setting. "],["sec46.html", "3.6 Exercises", " 3.6 Exercises Write the distribution of the Bernoulli example in canonical form, and find the mean and variance of the sufficient statistic. Given a random sample \\(\\boldsymbol{Y} = [Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from \\(N\\) binomial experiments, each with known size \\(n_i\\) and the same unknown probability \\(\\theta\\), show that \\(p(\\boldsymbol{y} \\mid \\theta)\\) is in the exponential family. Then, find the posterior distribution, the marginal likelihood, and the predictive distribution of the binomial-Beta model assuming the number of trials is known. Given a random sample \\(\\boldsymbol{Y} = [Y_1 \\ Y_2 \\ \\dots \\ Y_N]^{\\top}\\) from an exponential distribution, show that \\(p(\\boldsymbol{y} \\mid \\lambda)\\) is in the exponential family. Additionally, find the posterior distribution, the marginal likelihood, and the predictive distribution of the exponential-Gamma model. Given that \\(\\boldsymbol{Y} \\sim N_N(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma})\\), that is, a multivariate normal distribution, show that \\(p(\\boldsymbol{y} \\mid \\boldsymbol{\\mu}, \\boldsymbol{\\Sigma})\\) is in the exponential family. Find the marginal likelihood in the normal/inverse-Wishart model. Find the posterior predictive distribution in the normal/inverse-Wishart model, and show that \\({\\boldsymbol{Y}}_0\\mid {\\boldsymbol{Y}}\\sim T_{N_0,M}(\\alpha_n-M+1,{\\boldsymbol{X}}_0{\\boldsymbol{B}}_n,{\\boldsymbol{I}}_{N_0}+{\\boldsymbol{X}}_0{\\boldsymbol{V}}_n{\\boldsymbol{X}}_0^{\\top},{\\boldsymbol{\\Psi}}_n)\\). Show that \\(\\delta_n=\\delta_0+({\\boldsymbol{y}}-{\\boldsymbol{X}}\\hat{\\boldsymbol{\\beta}})^{\\top}({\\boldsymbol{y}}-{\\boldsymbol{X}}\\hat{\\boldsymbol{\\beta}})+(\\hat{\\boldsymbol{\\beta}}-\\boldsymbol{\\beta}_0)^{\\top}(({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}+{\\boldsymbol{B}}_0)^{-1}(\\hat{\\boldsymbol{\\beta}}-\\boldsymbol{\\beta}_0)\\) in the linear regression model, and that \\({\\boldsymbol{\\Psi}}_{n}={\\boldsymbol{\\Psi}}_{0}+{\\boldsymbol{S}}+(\\hat{\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})^{\\top}{\\boldsymbol{V}}_{n}(\\hat{\\boldsymbol{B}}-{\\boldsymbol{B}}_{0})\\) in the linear multivariate regression model. Show that in the linear regression model \\(\\boldsymbol{\\beta}_n^{\\top}({\\boldsymbol{B}}_n^{-1}-{\\boldsymbol{B}}_n^{-1}{\\boldsymbol{M}}^{-1}{\\boldsymbol{B}}_n^{-1})\\boldsymbol{\\beta}_n={\\boldsymbol{\\boldsymbol{\\beta}}}_{**}^{\\top}{\\boldsymbol{C}}{\\boldsymbol{\\boldsymbol{\\beta}}}_{**}\\) and \\(\\boldsymbol{\\beta}_{**}={\\boldsymbol{X}}_0\\boldsymbol{\\beta}_n\\). Show that \\(({\\boldsymbol{Y}}-{\\boldsymbol{X}}{\\boldsymbol{B}})^{\\top}({\\boldsymbol{Y}}-{\\boldsymbol{X}}{\\boldsymbol{B}})={\\boldsymbol{S}}+({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})^{\\top}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}}({\\boldsymbol{B}}-\\widehat{\\boldsymbol{B}})\\) where \\({\\boldsymbol{S}}= ({\\boldsymbol{Y}}-{\\boldsymbol{X}}\\widehat{\\boldsymbol{B}})^{\\top}({\\boldsymbol{Y}}-{\\boldsymbol{X}}\\widehat{\\boldsymbol{B}})\\), \\(\\widehat{\\boldsymbol{B}}= ({\\boldsymbol{X}}^{\\top}{\\boldsymbol{X}})^{-1}{\\boldsymbol{X}}^{\\top}{\\boldsymbol{Y}}\\) in the multivariate regression model. What is the probability that the Sun will rise tomorrow? This is the most famous example by Richard Price, developed in the Appendix of Bayes’ theorem paper (Thomas Bayes 1763). Here, we implicitly use Laplace’s Rule of Succession to solve this problem. In particular, if we were a priori uncertain about the probability that the Sun will rise on a specified day, we can assume a uniform prior distribution over \\((0,1)\\), that is, a Beta(1,1) distribution. Then, what is the probability that the Sun will rise? Using information from Public Policy Polling in September 27th-28th for the 2016 presidential five-way race in USA, there are 411, 373 and 149 sampled people supporting Hillary Clinton, Donald Trump and other, respectively. Find the posterior probability of the percentage difference of people supporting Hillary versus Trump according to this data using a non-informative prior, that is, \\(\\alpha_0=[1 \\ 1 \\ 1]\\) in the multinomial-Dirichlet model. What is the probability of having more supports of Hillary vs Trump? What is the probability that sampling one hundred independent individuals 44, 40 and 16 support Hillary, Trump and other, respectively? Math test example continues You have a random sample of math scores of size \\(N=50\\) from a normal distribution, \\(Y_i\\sim {N}(\\mu, \\sigma^2)\\). The sample mean and variance are equal to \\(102\\) and \\(10\\), respectively. Using the normal-normal/inverse-gamma model where \\(\\mu_0=100\\), \\(\\beta_0=1\\), \\(\\alpha_0=\\delta_0=0.001\\) Get a 95% confidence and credible interval for \\(\\mu\\). What is the posterior probability that \\(\\mu &gt; 103\\)? Demand of electricity example continues Set \\(c_0\\) such that maximizes the marginal likelihood in the specifications with and without electricity price in the example of demand of electricity (empirical Bayes). Then, calculate the Bayes factor, and conclude if there is evidence supporting the inclusion of the price of electricity in the demand equation. Utility demand Use the file Utilities.csv to estimate a multivariate linear regression model where \\(\\boldsymbol{Y}_i=\\left[\\log(\\text{electricity}_i) \\ \\log(\\text{water}_i) \\ \\log(\\text{gas}_i)\\right]\\) as function of \\(\\log(\\text{electricity price}_i)\\), \\(\\log(\\text{water price}_i)\\), \\(\\log(\\text{gas price}_i)\\), \\(\\text{IndSocio1}_i\\), \\(\\text{IndSocio2}_i\\), \\(\\text{Altitude}_i\\), \\(\\text{Nrooms}_i\\), \\(\\text{HouseholdMem}_i\\), \\(\\text{Children}_i\\), and \\(\\log(\\text{Income}_i)\\), where electricity, water and gas are monthly consumption of electricity (kWh), water (m\\(^3\\)) and gas (m\\(^3\\)), and other definitions are given in the Example of Section 3.3. Omit households that do not consume any of the utilities in this exercise. Set a non-informative prior framework, \\(\\boldsymbol{B}_0=\\left[0\\right]_{11\\times 3}\\), \\(\\boldsymbol{V}_0=1000 \\boldsymbol{I}_{11}\\), \\(\\boldsymbol{\\Psi}_0=1000 \\boldsymbol{I}_{3}\\) and \\(\\alpha_0=3\\), where we have \\(K=11\\) (regressors plus intercept) and \\(M=3\\) (equations) in this exercise. Find the posterior mean estimates and the highest posterior density intervals at 95% of \\(\\boldsymbol{B}\\) and \\(\\boldsymbol{\\Sigma}\\). Use the marginal distribution and the conditional distribution to obtain the posterior estimates of \\(\\boldsymbol{B}\\), and compare the results. Find the Bayes factor comparing the baseline model in this exercise with the same specification but using the income in dollars. Now, calculate the Bayes factor using the income in thousand dollars. Is there any difference? Find the predictive distribution for the monthly demand of electricity, water and gas in the baseline specification of a household located in the lowest socioeconomic condition in a municipality located below 1000 meters above the sea level, 2 rooms, 3 members with children, a monthly income equal to USD 500, an electricity price equal to USD/kWh 0.15, a water price equal to USD/M\\(^3\\) 0.70, and a gas price equal to USD/M\\(^3\\) 0.75. 15 Ph.D. students sleeping hours (Albert 2009) We are interested in learning about the proportion of Ph.D. students who sleep at least 6 hours per day. We have a sample of 52 students, where 15 report sleeping at least 6 hours, and the remaining 37 report not sleeping at least 6 hours. The prior distribution is a Beta distribution, with hyperparameters calibrated so that the prior probabilities of the proportion of students who sleep least than 6 hours being less than 0.4 and 0.75 are 0.6 and 0.95, respectively. Estimate the 95% posterior credible interval for the proportion of Ph.D. students who sleep at least 6 hours per day. Then, assume there is a group of experts whose beliefs about the proportion of Ph.D. students sleeping at least 6 hours are represented in the following table: Table 3.1: Probability distribution: Ph.D students that sleep at least 6 hours per day. \\(h\\) 0.05 0.10 0.15 0.20 0.25 0.30 0.35 0.40 0.45 0.50 0.55 \\(P(p=h)\\) 0.05 0.07 0.10 0.12 0.15 0.17 0.15 0.11 0.06 0.01 0.01 Use this Table as prior information, and find the posterior distribution of the proportion of students that sleep at least 6 hours. References Albert, Jim. 2009. Bayesian Computation with r. 2nd ed. Use r! New York, NY: Springer. https://doi.org/10.1007/978-0-387-92297-3. Bayes, Thomas. 1763. “LII. An Essay Towards Solving a Problem in the Doctrine of Chances. By the Late Rev. Mr. Bayes, FRS Communicated by Mr. Price, in a Letter to John Canton, AMFR S.” Philosophical Transactions of the Royal Society of London, no. 53: 370–418. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
