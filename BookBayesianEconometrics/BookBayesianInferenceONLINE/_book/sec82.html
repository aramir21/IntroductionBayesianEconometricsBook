<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.2 ARMA processes | Introduction to Bayesian Data Modeling</title>
  <meta name="description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="8.2 ARMA processes | Introduction to Bayesian Data Modeling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="github-repo" content="https://github.com/aramir21/IntroductionBayesianEconometricsBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.2 ARMA processes | Introduction to Bayesian Data Modeling" />
  
  <meta name="twitter:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  

<meta name="author" content="Andrés Ramírez-Hassan" />


<meta name="date" content="2025-02-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec81.html"/>
<link rel="next" href="sec83.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Bayesian Econometrics: A GUIded tour using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="to-instructors-and-students.html"><a href="to-instructors-and-students.html"><i class="fa fa-check"></i>To instructors and students</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Chap1.html"><a href="Chap1.html"><i class="fa fa-check"></i><b>1</b> Basic formal concepts</a>
<ul>
<li class="chapter" data-level="1.1" data-path="sec11.html"><a href="sec11.html"><i class="fa fa-check"></i><b>1.1</b> The Bayes’ rule</a></li>
<li class="chapter" data-level="1.2" data-path="sec12.html"><a href="sec12.html"><i class="fa fa-check"></i><b>1.2</b> Bayesian framework: A brief summary of theory</a></li>
<li class="chapter" data-level="1.3" data-path="sec14.html"><a href="sec14.html"><i class="fa fa-check"></i><b>1.3</b> Bayesian reports: Decision theory under uncertainty</a></li>
<li class="chapter" data-level="1.4" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
<li class="chapter" data-level="1.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chap2.html"><a href="Chap2.html"><i class="fa fa-check"></i><b>2</b> Conceptual differences between the Bayesian and Frequentist approaches</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec21.html"><a href="sec21.html"><i class="fa fa-check"></i><b>2.1</b> The concept of probability</a></li>
<li class="chapter" data-level="2.2" data-path="sec22.html"><a href="sec22.html"><i class="fa fa-check"></i><b>2.2</b> Subjectivity is not the key</a></li>
<li class="chapter" data-level="2.3" data-path="sec23.html"><a href="sec23.html"><i class="fa fa-check"></i><b>2.3</b> Estimation, hypothesis testing and prediction</a></li>
<li class="chapter" data-level="2.4" data-path="sec24.html"><a href="sec24.html"><i class="fa fa-check"></i><b>2.4</b> The likelihood principle</a></li>
<li class="chapter" data-level="2.5" data-path="sec25.html"><a href="sec25.html"><i class="fa fa-check"></i><b>2.5</b> Why is not the Bayesian approach that popular?</a></li>
<li class="chapter" data-level="2.6" data-path="sec26.html"><a href="sec26.html"><i class="fa fa-check"></i><b>2.6</b> A simple working example</a></li>
<li class="chapter" data-level="2.7" data-path="sec27.html"><a href="sec27.html"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
<li class="chapter" data-level="2.8" data-path="sec28.html"><a href="sec28.html"><i class="fa fa-check"></i><b>2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chap3.html"><a href="Chap3.html"><i class="fa fa-check"></i><b>3</b> Cornerstone models: Conjugate families</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec41.html"><a href="sec41.html"><i class="fa fa-check"></i><b>3.1</b> Motivation of conjugate families</a></li>
<li class="chapter" data-level="3.2" data-path="sec42.html"><a href="sec42.html"><i class="fa fa-check"></i><b>3.2</b> Conjugate prior to exponential family</a></li>
<li class="chapter" data-level="3.3" data-path="sec43.html"><a href="sec43.html"><i class="fa fa-check"></i><b>3.3</b> Linear regression: The conjugate normal-normal/inverse gamma model</a></li>
<li class="chapter" data-level="3.4" data-path="sec44.html"><a href="sec44.html"><i class="fa fa-check"></i><b>3.4</b> Multivariate linear regression: The conjugate normal-normal/inverse Wishart model</a></li>
<li class="chapter" data-level="3.5" data-path="computational-examples.html"><a href="computational-examples.html"><i class="fa fa-check"></i><b>3.5</b> Computational examples</a></li>
<li class="chapter" data-level="3.6" data-path="summary-chapter-4.html"><a href="summary-chapter-4.html"><i class="fa fa-check"></i><b>3.6</b> Summary: Chapter 4</a></li>
<li class="chapter" data-level="3.7" data-path="exercises-chapter-4.html"><a href="exercises-chapter-4.html"><i class="fa fa-check"></i><b>3.7</b> Exercises: Chapter 4</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chap4.html"><a href="Chap4.html"><i class="fa fa-check"></i><b>4</b> Simulation methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec51.html"><a href="sec51.html"><i class="fa fa-check"></i><b>4.1</b> Markov Chain Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="sec51.html"><a href="sec51.html#sec511"><i class="fa fa-check"></i><b>4.1.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="4.1.2" data-path="sec51.html"><a href="sec51.html#sec512"><i class="fa fa-check"></i><b>4.1.2</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="4.1.3" data-path="sec51.html"><a href="sec51.html#sec513"><i class="fa fa-check"></i><b>4.1.3</b> Hamiltonian Monte Carlo</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sec52.html"><a href="sec52.html"><i class="fa fa-check"></i><b>4.2</b> Importance sampling</a></li>
<li class="chapter" data-level="4.3" data-path="sec53.html"><a href="sec53.html"><i class="fa fa-check"></i><b>4.3</b> Particle filtering</a></li>
<li class="chapter" data-level="4.4" data-path="sec54.html"><a href="sec54.html"><i class="fa fa-check"></i><b>4.4</b> Convergence diagnostics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="sec54.html"><a href="sec54.html#numerical-standard-error"><i class="fa fa-check"></i><b>4.4.1</b> Numerical standard error</a></li>
<li class="chapter" data-level="4.4.2" data-path="sec54.html"><a href="sec54.html#effective-number-of-simulation-draws"><i class="fa fa-check"></i><b>4.4.2</b> Effective number of simulation draws</a></li>
<li class="chapter" data-level="4.4.3" data-path="sec54.html"><a href="sec54.html#tests-of-convergence"><i class="fa fa-check"></i><b>4.4.3</b> Tests of convergence</a></li>
<li class="chapter" data-level="4.4.4" data-path="sec54.html"><a href="sec54.html#checking-for-errors-in-the-posterior-simulator"><i class="fa fa-check"></i><b>4.4.4</b> Checking for errors in the posterior simulator</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="sec55.html"><a href="sec55.html"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
<li class="chapter" data-level="4.6" data-path="sec56.html"><a href="sec56.html"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chap5.html"><a href="Chap5.html"><i class="fa fa-check"></i><b>5</b> Graphical user interface</a></li>
<li class="chapter" data-level="6" data-path="Chap6.html"><a href="Chap6.html"><i class="fa fa-check"></i><b>6</b> Univariate regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec61.html"><a href="sec61.html"><i class="fa fa-check"></i><b>6.1</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="6.2" data-path="sec62.html"><a href="sec62.html"><i class="fa fa-check"></i><b>6.2</b> The logit model</a></li>
<li class="chapter" data-level="6.3" data-path="sec63.html"><a href="sec63.html"><i class="fa fa-check"></i><b>6.3</b> The probit model</a></li>
<li class="chapter" data-level="6.4" data-path="sec64.html"><a href="sec64.html"><i class="fa fa-check"></i><b>6.4</b> The multinomial probit model</a></li>
<li class="chapter" data-level="6.5" data-path="sec65.html"><a href="sec65.html"><i class="fa fa-check"></i><b>6.5</b> The multinomial logit model</a></li>
<li class="chapter" data-level="6.6" data-path="sec66.html"><a href="sec66.html"><i class="fa fa-check"></i><b>6.6</b> Ordered probit model</a></li>
<li class="chapter" data-level="6.7" data-path="negative-binomial-model.html"><a href="negative-binomial-model.html"><i class="fa fa-check"></i><b>6.7</b> Negative binomial model</a></li>
<li class="chapter" data-level="6.8" data-path="sec68.html"><a href="sec68.html"><i class="fa fa-check"></i><b>6.8</b> Tobit model</a></li>
<li class="chapter" data-level="6.9" data-path="sec69.html"><a href="sec69.html"><i class="fa fa-check"></i><b>6.9</b> Quantile regression</a></li>
<li class="chapter" data-level="6.10" data-path="sec610.html"><a href="sec610.html"><i class="fa fa-check"></i><b>6.10</b> Bayesian bootstrap regression</a></li>
<li class="chapter" data-level="6.11" data-path="sec611.html"><a href="sec611.html"><i class="fa fa-check"></i><b>6.11</b> Summary</a></li>
<li class="chapter" data-level="6.12" data-path="sec612.html"><a href="sec612.html"><i class="fa fa-check"></i><b>6.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chap7.html"><a href="Chap7.html"><i class="fa fa-check"></i><b>7</b> Multivariate regression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec71.html"><a href="sec71.html"><i class="fa fa-check"></i><b>7.1</b> Multivariate regression</a></li>
<li class="chapter" data-level="7.2" data-path="sec72.html"><a href="sec72.html"><i class="fa fa-check"></i><b>7.2</b> Seemingly Unrelated Regression</a></li>
<li class="chapter" data-level="7.3" data-path="sec73.html"><a href="sec73.html"><i class="fa fa-check"></i><b>7.3</b> Instrumental variable</a></li>
<li class="chapter" data-level="7.4" data-path="sec74.html"><a href="sec74.html"><i class="fa fa-check"></i><b>7.4</b> Multivariate probit model</a></li>
<li class="chapter" data-level="7.5" data-path="sec75.html"><a href="sec75.html"><i class="fa fa-check"></i><b>7.5</b> Summary</a></li>
<li class="chapter" data-level="7.6" data-path="sec76.html"><a href="sec76.html"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chap8.html"><a href="Chap8.html"><i class="fa fa-check"></i><b>8</b> Time series</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec81.html"><a href="sec81.html"><i class="fa fa-check"></i><b>8.1</b> State-space representation</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="sec81.html"><a href="sec81.html#gaussian-linear-state-space-models"><i class="fa fa-check"></i><b>8.1.1</b> Gaussian linear state-space models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="sec82.html"><a href="sec82.html"><i class="fa fa-check"></i><b>8.2</b> ARMA processes</a></li>
<li class="chapter" data-level="8.3" data-path="sec83.html"><a href="sec83.html"><i class="fa fa-check"></i><b>8.3</b> Stochastic volatility models</a></li>
<li class="chapter" data-level="8.4" data-path="sec84.html"><a href="sec84.html"><i class="fa fa-check"></i><b>8.4</b> Vector Autoregressive models</a></li>
<li class="chapter" data-level="8.5" data-path="sec85.html"><a href="sec85.html"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
<li class="chapter" data-level="8.6" data-path="sec86.html"><a href="sec86.html"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bayesian Data Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec82" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> ARMA processes<a href="sec82.html#sec82" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Since the seminal work of <span class="citation">Box and Jenkins (<a href="#ref-box_jenkins_1976">1976</a>)</span>, autoregressive moving average (ARMA) models have become ubiquitous in time series analysis. Thus, we present a brief introduction to these models in this section.</p>
<p>Let’s start with the linear Gaussian model with autoregressive errors:</p>
<p><span class="math display" id="eq:eq2" id="eq:eq1">\[\begin{align}
    y_t &amp;= \boldsymbol{x}_t^{\top} \boldsymbol{\beta} + \mu_t \tag{8.5} \\
    \phi(L) \mu_t &amp;= \epsilon_t \tag{8.6}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{x}_t\)</span> is a <span class="math inline">\(K\)</span>-dimensional vector of regressors, <span class="math inline">\(\epsilon_t \sim \text{iid} \, N(0, \sigma^2)\)</span>, and <span class="math inline">\(\phi(L) = 1 - \phi_1 L - \phi_2 L^2 - \dots - \phi_p L^p\)</span> is a polynomial in the lag operator <span class="math inline">\(L\)</span>, where <span class="math inline">\(L z_t = z_{t-1}\)</span>, and in general, <span class="math inline">\(L^r z_t = z_{t-r}\)</span>.</p>
<p>Thus, we see that the stochastic error <span class="math inline">\(\mu_t\)</span> follows an <em>autoregressive process of order <span class="math inline">\(p\)</span></em>, i.e., <span class="math inline">\(\mu_t \sim AR(p)\)</span>. It is standard practice to assume that <span class="math inline">\(\mu_t\)</span> is second-order stationary, meaning the mean, variance, and autocovariance of <span class="math inline">\(\mu_t\)</span> are finite and independent of <span class="math inline">\(t\)</span> and <span class="math inline">\(s\)</span>, although <span class="math inline">\(\mathbb{E}[\mu_t \mu_s]\)</span> may depend on <span class="math inline">\(|t - s|\)</span>. Then, all roots of <span class="math inline">\(\phi(L)\)</span> lie outside the unit circle. For instance, for an <span class="math inline">\(AR(1)\)</span>, <span class="math inline">\(1 - \phi_1 L = 0\)</span>, implying <span class="math inline">\(L = 1/\phi_1\)</span>, such that <span class="math inline">\(|\phi_1| &lt; 1\)</span> for the process to be second-order stationary.</p>
<p>The likelihood function conditional on the first <span class="math inline">\(p\)</span> observations is:</p>
<p><span class="math display">\[\begin{align*}
    p(y_{p+1}, \dots, y_T \mid y_{p}, \dots, y_1, \boldsymbol{\theta})
    &amp;= \prod_{t=p+1}^{T} p(y_t \mid \mathcal{I}_{t-1}, \boldsymbol{\theta}) \\
    &amp;\propto \sigma^{-(T-p)} \exp\left\{-\frac{1}{2\sigma^2} \sum_{t=p+1}^T \left(y_t - \hat{y}_{t \mid t-1, \boldsymbol{\theta}}\right)^2 \right\}
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\mathcal{I}_{t-1}\)</span> is the past information, <span class="math inline">\(\boldsymbol{\theta}\)</span> collects all parameters <span class="math inline">\((\boldsymbol{\beta}, \phi_1, \dots, \phi_p, \sigma^2)\)</span>, and <span class="math inline">\(\hat{y}_{t \mid t-1, \boldsymbol{\theta}} = (1 - \phi(L)) y_t + \phi(L) \boldsymbol{x}^{\top} \boldsymbol{\beta}\)</span>.</p>
<p>We can see that multiplying the first expression in Equation <a href="sec82.html#eq:eq1">(8.5)</a> by <span class="math inline">\(\phi(L)\)</span>, we can express the model as
<span class="math display" id="eq:eq3">\[\begin{align}
    y_t^*=\boldsymbol{x}_t^{*\top}\boldsymbol{\beta}+\epsilon_t
    \tag{8.7}
\end{align}\]</span>
where <span class="math inline">\(y_t^*=\phi(L)Y_t\)</span> and <span class="math inline">\(\boldsymbol{x}_t^{*}=\phi(L)\boldsymbol{x}_t\)</span>.</p>
<p>Thus, collecting all observations <span class="math inline">\(t=p+1,p+2,\dots,T\)</span>, we have <span class="math inline">\(\boldsymbol{y}^*=\boldsymbol{X}^*\boldsymbol{\beta}+\boldsymbol{\epsilon}\)</span>, where <span class="math inline">\(\boldsymbol{\epsilon}\sim N(\boldsymbol{0},\sigma^2\boldsymbol{I}_{T-p})\)</span>, <span class="math inline">\(\boldsymbol{y}^*\)</span> is a <span class="math inline">\(T-p\)</span> dimensional vector, and <span class="math inline">\(\boldsymbol{X}^*\)</span> is a <span class="math inline">\((T-p)\times K\)</span> dimensional matrix.</p>
<p>Assuming that <span class="math inline">\(\boldsymbol{\beta}\mid \sigma\sim N(\boldsymbol{\beta}_0,\sigma^2\boldsymbol{B}_0)\)</span>, <span class="math inline">\(\sigma^2\sim IG(\alpha_0/2,\delta_0/2)\)</span> and <span class="math inline">\(\boldsymbol{\phi}\sim N(\boldsymbol{\phi}_0,\boldsymbol{\Phi}_0)\mathbb{1}(\boldsymbol{\phi}\in S_{\boldsymbol{\phi}})\)</span>, where <span class="math inline">\(S_{\boldsymbol{\phi}}\)</span> is the stationary region of <span class="math inline">\(\boldsymbol{\phi}=[\phi_1 \ \dots \ \phi_p]^{\top}\)</span>. Then, Equation <a href="sec82.html#eq:eq3">(8.7)</a> implies that <span class="math inline">\(\boldsymbol{\beta}\mid \sigma^2,\boldsymbol{\phi},\boldsymbol{y},\boldsymbol{X}\sim N(\boldsymbol{\beta}_n, \sigma^2{\boldsymbol{B}}_n)\)</span>, where <span class="math inline">\(\boldsymbol{B}_n = (\boldsymbol{B}_0^{-1} + \boldsymbol{X}^{*\top}\boldsymbol{X}^{*})^{-1}\)</span> and <span class="math inline">\(\boldsymbol{\beta}_n = \boldsymbol{B}_n(\boldsymbol{B}_0^{-1}\boldsymbol{\beta}_0 + \boldsymbol{X}^{*\top}\boldsymbol{y}^{*})\)</span>. In addition, <span class="math inline">\(\sigma^2\mid \boldsymbol{\beta},\boldsymbol{\phi},\boldsymbol{y},\boldsymbol{X}\sim IG(\alpha_n/2,\delta_n/2)\)</span> where <span class="math inline">\(\alpha_n=\alpha_0+T-p\)</span> and <span class="math inline">\(\delta_n=\delta_0+(\boldsymbol{y}^*-\boldsymbol{X}^{*}\boldsymbol{\beta})^{\top}(\boldsymbol{y}^*-\boldsymbol{X}^{*}\boldsymbol{\beta})+(\boldsymbol{\beta}-\boldsymbol{\beta}_0)\boldsymbol{B}_0^{-1}(\boldsymbol{\beta}-\boldsymbol{\beta}_0)\)</span>. Thus, the previous conditional posterior distributions imply that we can use a Gibbs sampling algorithm to perform inference of these parameters <span class="citation">(<a href="#ref-chib1993bayes">Chib 1993</a>)</span>.</p>
<p>We know from Equation q(eq:eq1) that <span class="math inline">\(\mu_t=y_t-\boldsymbol{x}_t^{\top}\boldsymbol{\beta}\)</span>, from Equation <a href="sec82.html#eq:eq2">(8.6)</a> that <span class="math inline">\(\mu_t=\phi_1\mu_{t-1}+\dots+\phi_p\mu_{t-p}+\epsilon_t\)</span>, <span class="math inline">\(t=p+1,\dots,T\)</span>. In matrix notation <span class="math inline">\(\boldsymbol{\mu}=\boldsymbol{U}\boldsymbol{\phi}+\boldsymbol{\epsilon}\)</span>, where <span class="math inline">\(\boldsymbol{\mu}\)</span> is a <span class="math inline">\(T-p\)</span> dimensional vector, <span class="math inline">\(\boldsymbol{U}\)</span> is a <span class="math inline">\((T-p)\times p\)</span> matrix whose <span class="math inline">\(t\)</span>-th row is <span class="math inline">\([\mu_{t-1} \ \dots \ \mu_{t-p}]\)</span>. Thus, the posterior distribution of <span class="math inline">\(\boldsymbol{\phi}\mid \boldsymbol{\beta},\sigma^2,\boldsymbol{y},\boldsymbol{X}\)</span> is <span class="math inline">\(N(\boldsymbol{\phi}_n, \boldsymbol{\Phi}_n)\mathbb{1}(\boldsymbol{\phi}\in S_{\boldsymbol{\phi}})\)</span>, where <span class="math inline">\(\boldsymbol{\Phi}_n=(\boldsymbol{\Phi}_0^{-1}+\sigma^{-2}\boldsymbol{U}^{\top}\boldsymbol{U})\)</span> and <span class="math inline">\(\boldsymbol{\phi}_n=\boldsymbol{\Phi}_n(\boldsymbol{\Phi}_0^{-1}\boldsymbol{\phi}_0+\sigma^{-2}\boldsymbol{U}^{\top}\boldsymbol{\mu})\)</span> (see Exercise 4).</p>
<p>Drawing from the model under the stationarity restriction is straightforward: we simply sample from the multivariate normal distribution and discard draws that do not satisfy the stationarity condition. The proportion of draws that meet this restriction represents the conditional probability that the process is stationary.</p>
<p><strong>Example: Effects of inflation on interest rate II</strong></p>
<p>We specify a <em>dynamic linear model</em> in the example of the effects of inflation on interest rates to account for a potential dynamic relationship. However, we can introduce dynamics in this model by assuming
<span class="math display">\[
\Delta i_t = \beta_{1} + \beta_{2} \Delta inf_t + \beta_{3} \Delta def_t + \mu_t,
\]</span>
where <span class="math inline">\(\mu_t = \phi \mu_{t-1} + \epsilon_t\)</span>. This leads to the model:
<span class="math display">\[
\Delta i_t = \beta_{1}(1-\phi_1) + \phi_1 \Delta i_{t-1} + \beta_{2}(\Delta inf_t - \phi_1 \Delta inf_{t-1}) + \beta_{3}(\Delta def_t - \phi_1 \Delta def_{t-1}) + \epsilon_t.
\]</span>
Thus, we again use the dataset <em>16INTDEF.csv</em> provided by <span class="citation">Wooldridge (<a href="#ref-wooldridge2016introductory">2016</a>)</span> to illustrate linear regressions with <span class="math inline">\(AR(1)\)</span> errors.</p>
<p>The following code demonstrates how to implement this application using vague priors, assuming <span class="math inline">\(\alpha_0 = \delta_0 = 0.01\)</span>, <span class="math inline">\(\boldsymbol{\beta}_0 = \boldsymbol{0}\)</span>, <span class="math inline">\(\boldsymbol{B}_0 = \boldsymbol{I}\)</span>, <span class="math inline">\(\boldsymbol{\phi}_0 = \boldsymbol{0}\)</span>, and <span class="math inline">\(\boldsymbol{\Phi}_0 = \boldsymbol{I}\)</span>. We use 15,000 MCMC iterations, with a burn-in of 5,000 and a thinning parameter of 5.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="sec82.html#cb3-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb3-2"><a href="sec82.html#cb3-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">010101</span>)</span>
<span id="cb3-3"><a href="sec82.html#cb3-3" tabindex="-1"></a>DataIntRate <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/besmarter/BSTApp/refs/heads/master/DataApp/16INTDEF.csv&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">quote =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb3-4"><a href="sec82.html#cb3-4" tabindex="-1"></a><span class="fu">attach</span>(DataIntRate)</span>
<span id="cb3-5"><a href="sec82.html#cb3-5" tabindex="-1"></a>yt <span class="ot">&lt;-</span> <span class="fu">diff</span>(i3); ytlag <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(yt, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb3-6"><a href="sec82.html#cb3-6" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(yt)</span>
<span id="cb3-7"><a href="sec82.html#cb3-7" tabindex="-1"></a>Xt <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">diff</span>(inf), <span class="fu">diff</span>(def)); Xtlag <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(Xt, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb3-8"><a href="sec82.html#cb3-8" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">dim</span>(Xt)[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb3-9"><a href="sec82.html#cb3-9" tabindex="-1"></a>Reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(yt <span class="sc">~</span> ytlag <span class="sc">+</span> <span class="fu">I</span>(Xt[,<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> Xtlag))</span>
<span id="cb3-10"><a href="sec82.html#cb3-10" tabindex="-1"></a>SumReg <span class="ot">&lt;-</span> <span class="fu">summary</span>(Reg); SumReg</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = yt ~ ytlag + I(Xt[, -1] - Xtlag))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.85560 -0.86022  0.04917  0.95966  2.85684 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)           0.07375    0.19570   0.377   0.7081  
## ytlag                 0.13495    0.15530   0.869   0.3897  
## I(Xt[, -1] - Xtlag)1 -0.13756    0.07594  -1.811   0.0771 .
## I(Xt[, -1] - Xtlag)2 -0.14807    0.09212  -1.607   0.1153  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.331 on 43 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.1506, Adjusted R-squared:  0.09137 
## F-statistic: 2.542 on 3 and 43 DF,  p-value: 0.06878</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="sec82.html#cb5-1" tabindex="-1"></a>PostSig2 <span class="ot">&lt;-</span> <span class="cf">function</span>(Beta, Phi){</span>
<span id="cb5-2"><a href="sec82.html#cb5-2" tabindex="-1"></a>    Xstar<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T<span class="dv">-1</span>, K <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="sec82.html#cb5-3" tabindex="-1"></a>    ystar <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T<span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb5-4"><a href="sec82.html#cb5-4" tabindex="-1"></a>    <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>T){</span>
<span id="cb5-5"><a href="sec82.html#cb5-5" tabindex="-1"></a>        Xstar[t<span class="dv">-1</span>,] <span class="ot">&lt;-</span> Xt[t,] <span class="sc">-</span> Phi<span class="sc">*</span>Xt[t<span class="dv">-1</span>,]</span>
<span id="cb5-6"><a href="sec82.html#cb5-6" tabindex="-1"></a>        ystar[t<span class="dv">-1</span>,] <span class="ot">&lt;-</span> yt[t] <span class="sc">-</span> Phi<span class="sc">*</span>yt[t<span class="dv">-1</span>]</span>
<span id="cb5-7"><a href="sec82.html#cb5-7" tabindex="-1"></a>    }</span>
<span id="cb5-8"><a href="sec82.html#cb5-8" tabindex="-1"></a>    Xstar <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, Xstar)</span>
<span id="cb5-9"><a href="sec82.html#cb5-9" tabindex="-1"></a>    an <span class="ot">&lt;-</span> T <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> a0</span>
<span id="cb5-10"><a href="sec82.html#cb5-10" tabindex="-1"></a>    dn <span class="ot">&lt;-</span> d0 <span class="sc">+</span> <span class="fu">t</span>(ystar <span class="sc">-</span> Xstar<span class="sc">%*%</span>Beta)<span class="sc">%*%</span>(ystar <span class="sc">-</span> Xstar<span class="sc">%*%</span>Beta) <span class="sc">+</span> <span class="fu">t</span>(Beta <span class="sc">-</span> b0)<span class="sc">%*%</span>B0i<span class="sc">%*%</span>(Beta <span class="sc">-</span> b0)</span>
<span id="cb5-11"><a href="sec82.html#cb5-11" tabindex="-1"></a>    sig2 <span class="ot">&lt;-</span> invgamma<span class="sc">::</span><span class="fu">rinvgamma</span>(<span class="dv">1</span>, <span class="at">shape =</span> an<span class="sc">/</span><span class="dv">2</span>, <span class="at">rate =</span> dn<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb5-12"><a href="sec82.html#cb5-12" tabindex="-1"></a>    <span class="fu">return</span>(sig2)</span>
<span id="cb5-13"><a href="sec82.html#cb5-13" tabindex="-1"></a>}</span>
<span id="cb5-14"><a href="sec82.html#cb5-14" tabindex="-1"></a>PostBeta <span class="ot">&lt;-</span> <span class="cf">function</span>(sig2, Phi){</span>
<span id="cb5-15"><a href="sec82.html#cb5-15" tabindex="-1"></a>    Xstar<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T<span class="dv">-1</span>, K <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb5-16"><a href="sec82.html#cb5-16" tabindex="-1"></a>    ystar <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T<span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb5-17"><a href="sec82.html#cb5-17" tabindex="-1"></a>    <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>T){</span>
<span id="cb5-18"><a href="sec82.html#cb5-18" tabindex="-1"></a>        Xstar[t<span class="dv">-1</span>,] <span class="ot">&lt;-</span> Xt[t,] <span class="sc">-</span> Phi<span class="sc">*</span>Xt[t<span class="dv">-1</span>,]</span>
<span id="cb5-19"><a href="sec82.html#cb5-19" tabindex="-1"></a>        ystar[t<span class="dv">-1</span>,] <span class="ot">&lt;-</span> yt[t] <span class="sc">-</span> Phi<span class="sc">*</span>yt[t<span class="dv">-1</span>]</span>
<span id="cb5-20"><a href="sec82.html#cb5-20" tabindex="-1"></a>    }</span>
<span id="cb5-21"><a href="sec82.html#cb5-21" tabindex="-1"></a>    Xstar <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, Xstar)</span>
<span id="cb5-22"><a href="sec82.html#cb5-22" tabindex="-1"></a>    XtXstar <span class="ot">&lt;-</span> <span class="fu">t</span>(Xstar)<span class="sc">%*%</span>Xstar</span>
<span id="cb5-23"><a href="sec82.html#cb5-23" tabindex="-1"></a>    Xtystar <span class="ot">&lt;-</span> <span class="fu">t</span>(Xstar)<span class="sc">%*%</span>ystar</span>
<span id="cb5-24"><a href="sec82.html#cb5-24" tabindex="-1"></a>    Bn <span class="ot">&lt;-</span> <span class="fu">solve</span>(B0i <span class="sc">+</span> XtXstar)</span>
<span id="cb5-25"><a href="sec82.html#cb5-25" tabindex="-1"></a>    bn <span class="ot">&lt;-</span> Bn<span class="sc">%*%</span>(B0i<span class="sc">%*%</span>b0 <span class="sc">+</span> Xtystar)</span>
<span id="cb5-26"><a href="sec82.html#cb5-26" tabindex="-1"></a>    Beta <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">1</span>, bn, sig2<span class="sc">*</span>Bn)</span>
<span id="cb5-27"><a href="sec82.html#cb5-27" tabindex="-1"></a>    <span class="fu">return</span>(Beta)</span>
<span id="cb5-28"><a href="sec82.html#cb5-28" tabindex="-1"></a>}</span>
<span id="cb5-29"><a href="sec82.html#cb5-29" tabindex="-1"></a>PostPhi <span class="ot">&lt;-</span> <span class="cf">function</span>(sig2, Beta){</span>
<span id="cb5-30"><a href="sec82.html#cb5-30" tabindex="-1"></a>    u <span class="ot">&lt;-</span> yt <span class="sc">-</span> <span class="fu">cbind</span>(<span class="dv">1</span>,Xt)<span class="sc">%*%</span>Beta</span>
<span id="cb5-31"><a href="sec82.html#cb5-31" tabindex="-1"></a>    U <span class="ot">&lt;-</span> u[<span class="sc">-</span>T]</span>
<span id="cb5-32"><a href="sec82.html#cb5-32" tabindex="-1"></a>    ustar <span class="ot">&lt;-</span> u[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb5-33"><a href="sec82.html#cb5-33" tabindex="-1"></a>    UtU <span class="ot">&lt;-</span> <span class="fu">t</span>(U)<span class="sc">%*%</span>U</span>
<span id="cb5-34"><a href="sec82.html#cb5-34" tabindex="-1"></a>    Utu <span class="ot">&lt;-</span> <span class="fu">t</span>(U)<span class="sc">%*%</span>ustar</span>
<span id="cb5-35"><a href="sec82.html#cb5-35" tabindex="-1"></a>    Phin <span class="ot">&lt;-</span> <span class="fu">solve</span>(Phi0i <span class="sc">+</span> sig2<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span>UtU)</span>
<span id="cb5-36"><a href="sec82.html#cb5-36" tabindex="-1"></a>    phin <span class="ot">&lt;-</span> Phin<span class="sc">%*%</span>(Phi0i<span class="sc">%*%</span>phi0 <span class="sc">+</span> sig2<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span>Utu)</span>
<span id="cb5-37"><a href="sec82.html#cb5-37" tabindex="-1"></a>    Phi <span class="ot">&lt;-</span> truncnorm<span class="sc">::</span><span class="fu">rtruncnorm</span>(<span class="dv">1</span>, <span class="at">a =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">mean =</span> phin, <span class="at">sd =</span> Phin<span class="sc">^</span><span class="fl">0.5</span>)</span>
<span id="cb5-38"><a href="sec82.html#cb5-38" tabindex="-1"></a>    <span class="fu">return</span>(Phi)</span>
<span id="cb5-39"><a href="sec82.html#cb5-39" tabindex="-1"></a>}</span>
<span id="cb5-40"><a href="sec82.html#cb5-40" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb5-41"><a href="sec82.html#cb5-41" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> <span class="fl">0.01</span>; a0 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb5-42"><a href="sec82.html#cb5-42" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, K); c0 <span class="ot">&lt;-</span> <span class="dv">1</span>; </span>
<span id="cb5-43"><a href="sec82.html#cb5-43" tabindex="-1"></a>B0 <span class="ot">&lt;-</span> c0<span class="sc">*</span><span class="fu">diag</span>(K); B0i <span class="ot">&lt;-</span> <span class="fu">solve</span>(B0)</span>
<span id="cb5-44"><a href="sec82.html#cb5-44" tabindex="-1"></a>phi0 <span class="ot">&lt;-</span> <span class="dv">0</span>; Phi0 <span class="ot">&lt;-</span> <span class="dv">1</span>; Phi0i <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>Phi0</span>
<span id="cb5-45"><a href="sec82.html#cb5-45" tabindex="-1"></a><span class="co"># MCMC parameters</span></span>
<span id="cb5-46"><a href="sec82.html#cb5-46" tabindex="-1"></a>mcmc <span class="ot">&lt;-</span> <span class="dv">15000</span></span>
<span id="cb5-47"><a href="sec82.html#cb5-47" tabindex="-1"></a>burnin <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb5-48"><a href="sec82.html#cb5-48" tabindex="-1"></a>tot <span class="ot">&lt;-</span> mcmc <span class="sc">+</span> burnin</span>
<span id="cb5-49"><a href="sec82.html#cb5-49" tabindex="-1"></a>thin <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb5-50"><a href="sec82.html#cb5-50" tabindex="-1"></a>PostBetas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, mcmc<span class="sc">+</span>burnin, K)</span>
<span id="cb5-51"><a href="sec82.html#cb5-51" tabindex="-1"></a>PostSigma2s <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, mcmc<span class="sc">+</span>burnin)</span>
<span id="cb5-52"><a href="sec82.html#cb5-52" tabindex="-1"></a>PostPhis <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, mcmc<span class="sc">+</span>burnin)</span>
<span id="cb5-53"><a href="sec82.html#cb5-53" tabindex="-1"></a>Beta <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, K); Phi <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-54"><a href="sec82.html#cb5-54" tabindex="-1"></a>sig2 <span class="ot">&lt;-</span> SumReg<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>; Phi <span class="ot">&lt;-</span> SumReg<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb5-55"><a href="sec82.html#cb5-55" tabindex="-1"></a>Beta <span class="ot">&lt;-</span> SumReg<span class="sc">$</span>coefficients[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="dv">1</span>]</span>
<span id="cb5-56"><a href="sec82.html#cb5-56" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> tot, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb5-57"><a href="sec82.html#cb5-57" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tot){</span>
<span id="cb5-58"><a href="sec82.html#cb5-58" tabindex="-1"></a>    sig2 <span class="ot">&lt;-</span> <span class="fu">PostSig2</span>(<span class="at">Beta =</span> Beta, <span class="at">Phi =</span> Phi)</span>
<span id="cb5-59"><a href="sec82.html#cb5-59" tabindex="-1"></a>    PostSigma2s[s] <span class="ot">&lt;-</span> sig2</span>
<span id="cb5-60"><a href="sec82.html#cb5-60" tabindex="-1"></a>    Beta <span class="ot">&lt;-</span> <span class="fu">PostBeta</span>(<span class="at">sig2 =</span> sig2, <span class="at">Phi =</span> Phi)</span>
<span id="cb5-61"><a href="sec82.html#cb5-61" tabindex="-1"></a>    PostBetas[s,] <span class="ot">&lt;-</span> Beta</span>
<span id="cb5-62"><a href="sec82.html#cb5-62" tabindex="-1"></a>    Phi <span class="ot">&lt;-</span> <span class="fu">PostPhi</span>(<span class="at">sig2 =</span> sig2, <span class="at">Beta =</span> Beta)</span>
<span id="cb5-63"><a href="sec82.html#cb5-63" tabindex="-1"></a>    PostPhis[s] <span class="ot">&lt;-</span> Phi</span>
<span id="cb5-64"><a href="sec82.html#cb5-64" tabindex="-1"></a>    <span class="fu">setWinProgressBar</span>(pb, s, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(s<span class="sc">/</span>tot<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="st">&quot;% done&quot;</span>))</span>
<span id="cb5-65"><a href="sec82.html#cb5-65" tabindex="-1"></a>}</span>
<span id="cb5-66"><a href="sec82.html#cb5-66" tabindex="-1"></a><span class="fu">close</span>(pb)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="sec82.html#cb7-1" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">seq</span>((burnin<span class="sc">+</span><span class="dv">1</span>), tot, thin)</span>
<span id="cb7-2"><a href="sec82.html#cb7-2" tabindex="-1"></a>PosteriorBetas <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(PostBetas[keep,])</span>
<span id="cb7-3"><a href="sec82.html#cb7-3" tabindex="-1"></a><span class="fu">summary</span>(PosteriorBetas)</span></code></pre></div>
<pre><code>## 
## Iterations = 1:15000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 15000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##         Mean     SD  Naive SE Time-series SE
## [1,]  0.0663 0.1904 0.0015545       0.001554
## [2,]  0.2293 0.1171 0.0009563       0.001163
## [3,] -0.1451 0.1704 0.0013913       0.001391
## 
## 2. Quantiles for each variable:
## 
##           2.5%      25%      50%      75%  97.5%
## var1 -0.307875 -0.05914  0.06597  0.19276 0.4392
## var2 -0.004462  0.15191  0.22912  0.30839 0.4564
## var3 -0.475203 -0.25696 -0.14711 -0.03156 0.1918</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="sec82.html#cb9-1" tabindex="-1"></a>PosteriorSigma2 <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(PostSigma2s[keep])</span>
<span id="cb9-2"><a href="sec82.html#cb9-2" tabindex="-1"></a><span class="fu">summary</span>(PosteriorSigma2)</span></code></pre></div>
<pre><code>## 
## Iterations = 1:15000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 15000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##           Mean             SD       Naive SE Time-series SE 
##       1.698250       0.385326       0.003146       0.003462 
## 
## 2. Quantiles for each variable:
## 
##  2.5%   25%   50%   75% 97.5% 
## 1.110 1.423 1.643 1.909 2.611</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="sec82.html#cb11-1" tabindex="-1"></a>PosteriorPhi <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(PostPhis[keep])</span>
<span id="cb11-2"><a href="sec82.html#cb11-2" tabindex="-1"></a><span class="fu">summary</span>(PosteriorPhi)</span></code></pre></div>
<pre><code>## 
## Iterations = 1:15000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 15000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##           Mean             SD       Naive SE Time-series SE 
##       0.020208       0.163454       0.001335       0.001705 
## 
## 2. Quantiles for each variable:
## 
##     2.5%      25%      50%      75%    97.5% 
## -0.28977 -0.09105  0.01602  0.12843  0.34971</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="sec82.html#cb13-1" tabindex="-1"></a>dfBinf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(PosteriorBetas[,<span class="dv">2</span>])</span>
<span id="cb13-2"><a href="sec82.html#cb13-2" tabindex="-1"></a><span class="co"># Basic density</span></span>
<span id="cb13-3"><a href="sec82.html#cb13-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 4.3.3</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="sec82.html#cb15-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfBinf, <span class="fu">aes</span>(<span class="at">x=</span>var1)) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="sec82.html#cb15-2" tabindex="-1"></a><span class="fu">geom_density</span>(<span class="at">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="at">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="sec82.html#cb15-3" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="fu">mean</span>(var1)), <span class="at">color=</span><span class="st">&quot;blue&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="sec82.html#cb15-4" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="fu">quantile</span>(var1, <span class="fl">0.025</span>)), <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="sec82.html#cb15-5" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="fu">quantile</span>(var1, <span class="fl">0.975</span>)), <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="sec82.html#cb15-6" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Density effect of inflation on interest rate&quot;</span>, <span class="at">x=</span><span class="st">&quot;Effect of inflation&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>)</span>
<span id="cb15-7"><a href="sec82.html#cb15-7" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-3-1.svg" width="672" /></p>
<p>This figure shows the posterior density plot of the effects of inflation rate on interest rate. The posterior mean of this coefficient is approximately 0.25, and the credible interval at 95% is (0, 0.46), which indicates again that the annual changes in interest rate are weakly positive related to annual changes in inflation.</p>
<p>Observe that the previous setting encompasses the particular relevant case <span class="math inline">\(y_t\sim AR(p)\)</span>, it is just omitting the covariates such that <span class="math inline">\(y_t=\mu_t\)</span>. <span class="citation">Chib and Greenberg (<a href="#ref-chib1994bayes">1994</a>)</span> extend the Bayesian inference of linear regression with <span class="math inline">\(AR(p)\)</span> errors to <span class="math inline">\(ARMA(p,q)\)</span> errors using a <em>state-space</em> representation.</p>
<p>Setting <span class="math inline">\(y_t=\mu_t\)</span> such that <span class="math inline">\(y_t=\sum_{s=1}^{p}\phi_jy_{t-s}+\sum_{s=1}^{q}\theta_s \epsilon_{t-s}+\epsilon_t\)</span>, letting <span class="math inline">\(r=\max \left\{p,q+1\right\}\)</span>, <span class="math inline">\(\phi_s=0\)</span> for <span class="math inline">\(s&gt;p\)</span> and <span class="math inline">\(\theta_s=0\)</span> for <span class="math inline">\(s&gt;q\)</span>, and defining <span class="math inline">\(\boldsymbol{x}^{\top}=[1 \ 0 \ \dots \ 0]\)</span>, and <span class="math inline">\(\boldsymbol{H}=[1 \ \psi_1 \ \dots \ \psi_{r-1}]^{\top}\)</span> <span class="math inline">\(r\)</span>-dimensional vectors, and
<span class="math display">\[\begin{align*}
    \boldsymbol{G}=\begin{bmatrix}
        \phi_1 &amp; 1 &amp; 0 &amp; \dots &amp; 0\\
        \phi_2 &amp; 0 &amp; 1 &amp; \dots &amp; 0\\
        \vdots &amp; \vdots &amp; \ddots &amp;  &amp;\\
        \phi_{r-1} &amp; 0 &amp; 0 &amp; \dots &amp; 1\\
        \phi_r &amp; 0 &amp; 0 &amp; \dots &amp; 0\\
    \end{bmatrix} = \begin{bmatrix}
        \phi_1 &amp; \vdots &amp;  &amp;  &amp; \\
        \phi_2 &amp; \vdots &amp;  &amp; \boldsymbol{I}_{r-1}  &amp; \\
        \vdots &amp; \vdots &amp;  &amp;  &amp;\\
        \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots\\
        \phi_r &amp; 0 &amp; 0 &amp; \dots &amp; 0\\
    \end{bmatrix},
\end{align*}\]</span>
which is a <span class="math inline">\(r\times r\)</span> dimensional matrix, and give the <em>state</em> vector <span class="math inline">\(\boldsymbol{\beta}_t=[\beta_{1,t} \ \beta_{2,t} \ \dots \ \beta_{r,t}]^{\top}\)</span>, the <span class="math inline">\(ARMA\)</span> model has the following representation:
<span class="math display">\[\begin{align*}
    y_t&amp;=\boldsymbol{x}^{\top}\boldsymbol{\beta}_t\\
    \boldsymbol{\beta}_t &amp;= \boldsymbol{G}\boldsymbol{\beta}_{t-1}+\boldsymbol{H}\epsilon_{t}.
\end{align*}\]</span></p>
<p>This is a <em>dynamic linear model</em> where <span class="math inline">\(\boldsymbol{\Sigma}_t=0\)</span>, and <span class="math inline">\(\boldsymbol{\Omega}_t=\sigma^2\boldsymbol{H}\boldsymbol{H}^{\top}\)</span> (see <span class="citation">Petris, Petrone, and Campagnoli (<a href="#ref-petris2009dynamic">2009</a>)</span> and <span class="citation">Chib and Greenberg (<a href="#ref-chib1994bayes">1994</a>)</span>).</p>
<p>A notable advantage of the <em>state-space</em> representation of the <span class="math inline">\(ARMA\)</span> model is that the evaluation of the likelihood can be performed efficiently using the recursive laws. Extensions to autoregressive integrated moving average <span class="math inline">\(ARIMA(p,d,q)\)</span> models are discussed in <span class="citation">Petris, Petrone, and Campagnoli (<a href="#ref-petris2009dynamic">2009</a>)</span>. In <span class="math inline">\(ARIMA(p,d,q)\)</span> models, <span class="math inline">\(d\)</span> refers to the level of integration (or differencing) required to eliminate the stochastic trend in a time series (see <span class="citation">Enders (<a href="#ref-enders_2014">2014</a>)</span> for details).</p>
<p><strong>Example: <span class="math inline">\(AR(2)\)</span> process</strong></p>
<p>Let’s see the <em>state-space</em> representation of a stationary <span class="math inline">\(AR(2)\)</span> process with intercept, that is, <span class="math inline">\(y_t=\mu+\phi_1y_{t-1}+\phi_2y_{t-2}+\epsilon_t\)</span>, where <span class="math inline">\(\epsilon_t\sim N(0,\sigma^2)\)</span>. Thus, <span class="math inline">\(\mathbb{E}[y_t]=\frac{\mu}{1-\phi_1-\phi_2}\)</span>, and variance <span class="math inline">\(Var[y_t]=\frac{\sigma^2(1-\phi_2)}{1-\phi_2-\phi_1^2-\phi_1^2\phi_2-\phi_2^2+\phi_2^3}\)</span>.</p>
<p>In addition, we can proof that setting <span class="math inline">\(z_t=Y_t-\bar{\mu}\)</span>, we have <span class="math inline">\(z_t=\phi_1z_{t-1}+\phi_2z_{t-2}+\epsilon_t\)</span> where <span class="math inline">\(\mathbb{E}[z_t]=0\)</span>, and these are equivalent representations (see Exercise 5). Then, setting <span class="math inline">\(\boldsymbol{x}^{\top}=[1 \ 0]\)</span>, <span class="math inline">\(\boldsymbol{H}=[1 \ 0]^{\top}\)</span>, <span class="math inline">\(\boldsymbol{G}=\begin{bmatrix}  \phi_1 &amp; 1\\  \phi_2 &amp; 0 \\ \end{bmatrix}\)</span>, <span class="math inline">\(\boldsymbol{\beta}_t=[\beta_{t1} \ \beta_{t2}]^{\top}\)</span>, <span class="math inline">\(\boldsymbol{\Sigma}_t=0\)</span> and <span class="math inline">\(\boldsymbol{\Omega}_t=\sigma^2\)</span> we have
<span class="math display">\[\begin{align*}
    z_t&amp;=\boldsymbol{x}^{\top}\boldsymbol{\beta}_t&amp; \text{(Observation equation)}\\
    \boldsymbol{\beta}_t&amp;=\boldsymbol{G}\boldsymbol{\beta}_{t-1}+\boldsymbol{H}{\epsilon}_t &amp; \text{(States equations)}.
\end{align*}\]</span></p>
<p>We use the function <em>stan_sarima</em> from the package <em>bayesforecast</em> to perform Bayesian inference in <span class="math inline">\(ARMA\)</span> models in our GUI. The following code shows how to simulate an <span class="math inline">\(AR(2)\)</span> process, and perform Bayesian inference using this function.</p>
<p>We perform 10000 MCMC iterations plus a burn-in equal 5000 assuming <span class="math inline">\(\sigma^2\sim IG(0.01/2, 0.01/2)\)</span>, <span class="math inline">\(\mu\sim N(0, 1)\)</span> and <span class="math inline">\(\phi_k\sim N(0, 1)\)</span>, <span class="math inline">\(k=1,2\)</span>. The trace plots look well, and all 95% credible intervals encompass the population values.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="sec82.html#cb16-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()); <span class="fu">set.seed</span>(<span class="dv">010101</span>)</span>
<span id="cb16-2"><a href="sec82.html#cb16-2" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">200</span>; mu <span class="ot">&lt;-</span> <span class="fl">0.5</span> </span>
<span id="cb16-3"><a href="sec82.html#cb16-3" tabindex="-1"></a>phi1 <span class="ot">&lt;-</span> <span class="fl">0.5</span>; phi2 <span class="ot">&lt;-</span> <span class="fl">0.3</span>; sig <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb16-4"><a href="sec82.html#cb16-4" tabindex="-1"></a>Ey <span class="ot">&lt;-</span> mu<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>phi1<span class="sc">-</span>phi2); Sigy <span class="ot">&lt;-</span> sig<span class="sc">*</span>((<span class="dv">1</span><span class="sc">-</span>phi2)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>phi2<span class="sc">-</span>phi1<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>phi2<span class="sc">*</span>phi1<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>phi2<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>phi2<span class="sc">^</span><span class="dv">3</span>))<span class="sc">^</span><span class="fl">0.5</span> </span>
<span id="cb16-5"><a href="sec82.html#cb16-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T, <span class="at">mean =</span> Ey, <span class="at">sd =</span> Sigy)</span>
<span id="cb16-6"><a href="sec82.html#cb16-6" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sig)</span>
<span id="cb16-7"><a href="sec82.html#cb16-7" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>T){</span>
<span id="cb16-8"><a href="sec82.html#cb16-8" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> mu <span class="sc">+</span> phi1<span class="sc">*</span>y[t<span class="dv">-1</span>] <span class="sc">+</span> phi2<span class="sc">*</span>y[t<span class="dv">-2</span>] <span class="sc">+</span> e[t]</span>
<span id="cb16-9"><a href="sec82.html#cb16-9" tabindex="-1"></a>}</span>
<span id="cb16-10"><a href="sec82.html#cb16-10" tabindex="-1"></a><span class="fu">mean</span>(y); <span class="fu">sd</span>(y)</span>
<span id="cb16-11"><a href="sec82.html#cb16-11" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">ts</span>(y, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1820</span>, <span class="dv">1</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb16-12"><a href="sec82.html#cb16-12" tabindex="-1"></a><span class="fu">plot</span>(y)</span>
<span id="cb16-13"><a href="sec82.html#cb16-13" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">10000</span>; burnin <span class="ot">&lt;-</span> <span class="dv">5000</span>; thin <span class="ot">&lt;-</span> <span class="dv">1</span>; tot <span class="ot">&lt;-</span> iter <span class="sc">+</span> burnin</span>
<span id="cb16-14"><a href="sec82.html#cb16-14" tabindex="-1"></a><span class="fu">library</span>(bayesforecast)</span>
<span id="cb16-15"><a href="sec82.html#cb16-15" tabindex="-1"></a>sf1 <span class="ot">&lt;-</span> bayesforecast<span class="sc">::</span><span class="fu">stan_sarima</span>(y, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">prior_mu0 =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb16-16"><a href="sec82.html#cb16-16" tabindex="-1"></a><span class="at">prior_ar =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">prior_sigma0 =</span> <span class="fu">inverse.gamma</span>(<span class="fl">0.01</span><span class="sc">/</span><span class="dv">2</span>, <span class="fl">0.01</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb16-17"><a href="sec82.html#cb16-17" tabindex="-1"></a><span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">iter =</span> tot, <span class="at">warmup =</span> burnin, <span class="at">chains =</span> <span class="dv">1</span>)</span>
<span id="cb16-18"><a href="sec82.html#cb16-18" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">seq</span>(burnin<span class="sc">+</span><span class="dv">1</span>, tot, thin)</span>
<span id="cb16-19"><a href="sec82.html#cb16-19" tabindex="-1"></a>Postmu <span class="ot">&lt;-</span> sf1[[<span class="st">&quot;stanfit&quot;</span>]]<span class="sc">@</span>sim[[<span class="st">&quot;samples&quot;</span>]][[<span class="dv">1</span>]][[<span class="st">&quot;mu0&quot;</span>]][keep]</span>
<span id="cb16-20"><a href="sec82.html#cb16-20" tabindex="-1"></a>Postsig <span class="ot">&lt;-</span> sf1[[<span class="st">&quot;stanfit&quot;</span>]]<span class="sc">@</span>sim[[<span class="st">&quot;samples&quot;</span>]][[<span class="dv">1</span>]][[<span class="st">&quot;sigma0&quot;</span>]][keep]</span>
<span id="cb16-21"><a href="sec82.html#cb16-21" tabindex="-1"></a>Postphi1 <span class="ot">&lt;-</span> sf1[[<span class="st">&quot;stanfit&quot;</span>]]<span class="sc">@</span>sim[[<span class="st">&quot;samples&quot;</span>]][[<span class="dv">1</span>]][[<span class="st">&quot;ar0[1]&quot;</span>]][keep]</span>
<span id="cb16-22"><a href="sec82.html#cb16-22" tabindex="-1"></a>Postphi2 <span class="ot">&lt;-</span> sf1[[<span class="st">&quot;stanfit&quot;</span>]]<span class="sc">@</span>sim[[<span class="st">&quot;samples&quot;</span>]][[<span class="dv">1</span>]][[<span class="st">&quot;ar0[2]&quot;</span>]][keep]</span>
<span id="cb16-23"><a href="sec82.html#cb16-23" tabindex="-1"></a>Postdraws <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(<span class="fu">cbind</span>(Postmu, Postsig, Postphi1, Postphi2))</span>
<span id="cb16-24"><a href="sec82.html#cb16-24" tabindex="-1"></a><span class="fu">summary</span>(Postdraws)</span></code></pre></div>
<p>The following Algorithm shows how to perform inference in <span class="math inline">\(ARMA(p,q)\)</span> models using our GUI. See also Chapter <a href="Chap5.html#Chap5">5</a> for details regarding the dataset structure.</p>
<div class="algorithm">
<div style="background-color: #f8f9fa; padding: 15px; border-left: 5px solid #343a40; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.1); border-radius: 5px;">
<p><strong>Algorithm: Autoregressive Moving Average (ARMA) Models</strong></p>
<ol style="list-style-type: decimal">
<li>Select <em>Time series Model</em> on the top panel<br />
</li>
<li>Select <em>ARMA</em> using the left radio button<br />
</li>
<li>Upload the dataset selecting first if there is a header in the file, and the kind of separator in the <em>csv</em> file of the dataset (comma, semicolon, or tab). Then, use the <em>Browse</em> button under the <strong>Choose File</strong> legend<br />
</li>
<li>Select MCMC iterations, burn-in, and thinning parameters using the <em>Range sliders</em><br />
</li>
<li>Set the order of the ARMA model, <em>p</em> and <em>q</em> parameters<br />
</li>
<li>Set the frequency: annual (1), quarterly (4), monthly (12), etc.<br />
</li>
<li>Set the location and scale hyperparameters of the <em>intercept</em>, autoregressive (<em>AR</em>), moving average (<em>MA</em>) and standard deviation. Take into account that there is just one set of hyperparameters for <em>AR</em> and <em>MA</em> coefficients. This step is not necessary as by default our GUI uses non-informative priors<br />
</li>
<li>Click the <em>Go!</em> button<br />
</li>
<li>Analyze results<br />
</li>
<li>Download posterior chains using the <em>Download Posterior Chains</em> button</li>
</ol>
</div>
</div>
<p>The function <em>stan_sarima</em> uses the <em>Stan</em> software <span class="citation">(<a href="#ref-Stan2024">Stan Development Team 2024</a>)</span>, which in turn employs <em>Hamiltonian Monte Carlo</em> (HMC). The following code illustrates how to perform Bayesian inference in the <span class="math inline">\(AR(2)\)</span> model by programming the HMC from scratch. It is important to note that this is only an illustration, as HMC is less efficient than the Gibbs sampler in this example. However, HMC can outperform traditional MCMC algorithms in more complex models, particularly when dealing with high-dimensional probability distributions or when MCMC struggles with poor mixing due to posterior correlation.</p>
<p>In the first block, we perform the simulation by setting <span class="math inline">\(\mu=0.5\)</span>, <span class="math inline">\(\phi_1=0.5\)</span>, <span class="math inline">\(\phi_2=0.3\)</span>, <span class="math inline">\(\sigma=0.25\)</span>, and a sample size of 200. We then set the hyperparameters and define the function to calculate the logarithm of the posterior distribution. The model is parametrized using <span class="math inline">\(\tau = \log(\sigma^2)\)</span>, such that <span class="math inline">\(\sigma^2=\exp(\tau)\)</span>, which avoids issues related to the non-negativity restriction of <span class="math inline">\(\sigma^2\)</span>. As a result, we need to account for the Jacobian due to this transformation, specifically <span class="math inline">\(d\sigma^2/d\tau = \exp(\tau)\)</span>.</p>
<p>Next, we define the function to compute the gradient vector of the log posterior distribution. It is preferable to calculate the gradient vector analytically, as using finite differences can be computationally expensive. However, it is a good practice to check the analytical calculations by evaluating the function at the maximum posterior estimate, where the function should return values close to 0, or by comparing the results with finite differences at a few evaluation points.</p>
<p>The posterior distribution is given by<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
<span class="math display">\[\begin{align*}
    \pi(\mu,\phi_1,\phi_2,\tau\mid \boldsymbol{y})&amp;\propto \prod_{t=3}^T(\exp(\tau))^{-1/2}\exp\left\{-\frac{1}{2\exp(\tau)}(y_t-\mu-\phi_1y_{t-1}-\phi_2y_{t-2})^2\right\}\\
    &amp;\times\exp\left\{-\frac{1}{2\sigma^2_{\mu}}(\mu-\mu_0)^2\right\}\times\exp\left\{-\frac{1}{2\sigma^2_{\phi_1}}(\phi_1-\phi_{10})^2\right\}\\
    &amp;\times\exp\left\{-\frac{1}{2\sigma^2_{\phi_2}}(\phi_2-\phi_{20})^2\right\}\times\exp\left\{-(\alpha_0/2+1)\tau\right\}\exp\left\{-\delta_0/(2\exp(\tau))\right\}\exp(\tau).
\end{align*}\]</span></p>
<p>The components of the gradient vector of the log posterior distribution are given by
<span class="math display">\[\begin{align*}
    \frac{\partial \log(\pi(\mu,\phi_1,\phi_2,\tau\mid \boldsymbol{y}))}{\partial\mu}&amp;=\frac{\sum_{t=3}^T(y_t-\mu-\phi_1y_{t-1}-\phi_2y_{t-2})}{\exp(\tau)}-\frac{1}{\sigma_{\mu}^2}(\mu-\mu_0)\\
    \frac{\partial\log(\pi(\mu,\phi_1,\phi_2,\tau\mid \boldsymbol{y}))}{\partial\phi_1}&amp;=\frac{\sum_{t=3}^T(y_t-\mu-\phi_1y_{t-1}-\phi_2y_{t-2})y_{t-1}}{\exp(\tau)}-\frac{1}{\sigma_{\phi_1}^2}(\phi_1-\phi_{10})\\
    \frac{\partial\log(\pi(\mu,\phi_1,\phi_2,\tau\mid \boldsymbol{y}))}{\partial\phi_2}&amp;=\frac{\sum_{t=3}^T(y_t-\mu-\phi_1y_{t-1}-\phi_2y_{t-2})y_{t-2}}{\exp(\tau)}-\frac{1}{\sigma_{\phi_2}^2}(\phi_2-\phi_{20})\\    \frac{\partial\log(\pi(\mu,\phi_1,\phi_2,\tau\mid \boldsymbol{y}))}{\partial\tau}&amp;=-\frac{(T-2)}{2}+\frac{\sum_{t=3}^T(y_t-\mu-\phi_1y_{t-1}-\phi_2y_{t-2})^2}{2\exp(\tau)}\\
    &amp;-(\alpha_0/2+1)+\delta_0/(2\exp(\tau))+1.\\
\end{align*}\]</span></p>
<p>Next, we provide the code for the Hamiltonian Monte Carlo, as outlined in Chapter <a href="Chap4.html#Chap4">4</a>. The initial values are set as follows: <span class="math inline">\(\mu=\bar{y}=\frac{1}{T-2}\sum_{t=3}^T y_t\)</span>, <span class="math inline">\(\phi_1=\phi_2=0\)</span>, and <span class="math inline">\(\tau=\exp\left(\frac{1}{T-2}\sum_{t=3}^T(y_t-\bar{y})^2\right)\)</span>, with <span class="math inline">\(M\)</span> being the inverse covariance matrix of the posterior distribution evaluated at its maximum. Additionally, <span class="math inline">\(\epsilon\)</span> is randomly drawn from a uniform distribution between 0 and <span class="math inline">\(2\epsilon_0\)</span>, and <span class="math inline">\(L\)</span> is set to the highest integer near <span class="math inline">\(1/\epsilon\)</span>, in order to approximately satisfy <span class="math inline">\(L\epsilon=1\)</span>, where <span class="math inline">\(\epsilon_0=0.1\)</span>.</p>
<p>We can verify that all 95% credible intervals encompass the population values, and the posterior means are close to the population values. The acceptance rate averages above 65%, so we should consider increasing the base step (<span class="math inline">\(\epsilon_0\)</span>). Furthermore, we do not impose the stationarity conditions on <span class="math inline">\(\phi_1\)</span> and <span class="math inline">\(\phi_2\)</span>. Exercise 6 asks to program an HMC that takes these requirements into account.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="sec82.html#cb17-1" tabindex="-1"></a><span class="co"># Simulation AR(2)</span></span>
<span id="cb17-2"><a href="sec82.html#cb17-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()); <span class="fu">set.seed</span>(<span class="dv">010101</span>); T <span class="ot">&lt;-</span> <span class="dv">1000</span>; K <span class="ot">&lt;-</span> <span class="dv">4</span> </span>
<span id="cb17-3"><a href="sec82.html#cb17-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.5</span>; phi1 <span class="ot">&lt;-</span> <span class="fl">0.5</span>; phi2 <span class="ot">&lt;-</span> <span class="fl">0.3</span>; sig <span class="ot">&lt;-</span> <span class="fl">0.5</span> </span>
<span id="cb17-4"><a href="sec82.html#cb17-4" tabindex="-1"></a>Ey <span class="ot">&lt;-</span> mu<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>phi1<span class="sc">-</span>phi2); Sigy <span class="ot">&lt;-</span> sig<span class="sc">*</span>((<span class="dv">1</span><span class="sc">-</span>phi2)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>phi2<span class="sc">-</span>phi1<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>phi2<span class="sc">*</span>phi1<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>phi2<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>phi2<span class="sc">^</span><span class="dv">3</span>))<span class="sc">^</span><span class="fl">0.5</span> </span>
<span id="cb17-5"><a href="sec82.html#cb17-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T, <span class="at">mean =</span> Ey, <span class="at">sd =</span> Sigy); e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sig)</span>
<span id="cb17-6"><a href="sec82.html#cb17-6" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>T){</span>
<span id="cb17-7"><a href="sec82.html#cb17-7" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> mu <span class="sc">+</span> phi1<span class="sc">*</span>y[t<span class="dv">-1</span>] <span class="sc">+</span> phi2<span class="sc">*</span>y[t<span class="dv">-2</span>] <span class="sc">+</span> e[t]</span>
<span id="cb17-8"><a href="sec82.html#cb17-8" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="sec82.html#cb17-9" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb17-10"><a href="sec82.html#cb17-10" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> <span class="fl">0.01</span>; a0 <span class="ot">&lt;-</span> <span class="fl">0.01</span>; mu0 <span class="ot">&lt;-</span> <span class="dv">0</span>; MU0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-11"><a href="sec82.html#cb17-11" tabindex="-1"></a>phi0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>); Phi0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span>)</span>
<span id="cb17-12"><a href="sec82.html#cb17-12" tabindex="-1"></a><span class="co"># Log posterior multiply by -1 to use optim</span></span>
<span id="cb17-13"><a href="sec82.html#cb17-13" tabindex="-1"></a>LogPost <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, y){</span>
<span id="cb17-14"><a href="sec82.html#cb17-14" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> theta[<span class="dv">1</span>]; phi1 <span class="ot">&lt;-</span> theta[<span class="dv">2</span>]; phi2 <span class="ot">&lt;-</span> theta[<span class="dv">3</span>]</span>
<span id="cb17-15"><a href="sec82.html#cb17-15" tabindex="-1"></a>    tau <span class="ot">&lt;-</span> theta[<span class="dv">4</span>]; sig2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(tau); logLik <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-16"><a href="sec82.html#cb17-16" tabindex="-1"></a>    <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>T){</span>
<span id="cb17-17"><a href="sec82.html#cb17-17" tabindex="-1"></a>        logLikt <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(y[t], <span class="at">mean =</span> mu <span class="sc">+</span> phi1<span class="sc">*</span>y[t<span class="dv">-1</span>] <span class="sc">+</span> phi2<span class="sc">*</span>y[t<span class="dv">-2</span>], <span class="at">sd =</span> sig2<span class="sc">^</span><span class="fl">0.5</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-18"><a href="sec82.html#cb17-18" tabindex="-1"></a>        logLik <span class="ot">&lt;-</span> <span class="fu">c</span>(logLik, logLikt)</span>
<span id="cb17-19"><a href="sec82.html#cb17-19" tabindex="-1"></a>    }</span>
<span id="cb17-20"><a href="sec82.html#cb17-20" tabindex="-1"></a>    logLik <span class="ot">&lt;-</span> <span class="fu">sum</span>(logLik)</span>
<span id="cb17-21"><a href="sec82.html#cb17-21" tabindex="-1"></a>    logPrior <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(mu, <span class="at">mean =</span> mu0, <span class="at">sd =</span> MU0<span class="sc">^</span><span class="fl">0.5</span>, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">dnorm</span>(phi1, <span class="at">mean =</span> phi0[<span class="dv">1</span>], <span class="at">sd =</span> Phi0[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">^</span><span class="fl">0.5</span>, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">dnorm</span>(phi2, <span class="at">mean =</span> phi0[<span class="dv">2</span>], <span class="at">sd =</span> Phi0[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">^</span><span class="fl">0.5</span>, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> invgamma<span class="sc">::</span><span class="fu">dinvgamma</span>(sig2, <span class="at">shape =</span> a0<span class="sc">/</span><span class="dv">2</span>, <span class="at">rate =</span> d0<span class="sc">/</span><span class="dv">2</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-22"><a href="sec82.html#cb17-22" tabindex="-1"></a>    logPosterior <span class="ot">&lt;-</span> logLik <span class="sc">+</span> logPrior <span class="sc">+</span> tau</span>
<span id="cb17-23"><a href="sec82.html#cb17-23" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span>logPosterior) <span class="co"># Multiply by -1 to minimize using optim</span></span>
<span id="cb17-24"><a href="sec82.html#cb17-24" tabindex="-1"></a>}</span>
<span id="cb17-25"><a href="sec82.html#cb17-25" tabindex="-1"></a>theta0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(y), <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">var</span>(y))</span>
<span id="cb17-26"><a href="sec82.html#cb17-26" tabindex="-1"></a>Opt <span class="ot">&lt;-</span> <span class="fu">optim</span>(theta0, LogPost, <span class="at">y =</span> y, <span class="at">hessian =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-27"><a href="sec82.html#cb17-27" tabindex="-1"></a>theta0 <span class="ot">&lt;-</span> Opt<span class="sc">$</span>par; VarPost <span class="ot">&lt;-</span> <span class="fu">solve</span>(Opt<span class="sc">$</span>hessian)</span>
<span id="cb17-28"><a href="sec82.html#cb17-28" tabindex="-1"></a><span class="co"># Gradient log posterior</span></span>
<span id="cb17-29"><a href="sec82.html#cb17-29" tabindex="-1"></a>GradientTheta <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, y){</span>
<span id="cb17-30"><a href="sec82.html#cb17-30" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> theta[<span class="dv">1</span>]; phi1 <span class="ot">&lt;-</span> theta[<span class="dv">2</span>]; phi2 <span class="ot">&lt;-</span> theta[<span class="dv">3</span>]</span>
<span id="cb17-31"><a href="sec82.html#cb17-31" tabindex="-1"></a>    tau <span class="ot">&lt;-</span> theta[<span class="dv">4</span>]; sig2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(tau); SumLik <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb17-32"><a href="sec82.html#cb17-32" tabindex="-1"></a>    SumLik2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-33"><a href="sec82.html#cb17-33" tabindex="-1"></a>    <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>T){</span>
<span id="cb17-34"><a href="sec82.html#cb17-34" tabindex="-1"></a>        xt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, y[t<span class="dv">-1</span>], y[t<span class="dv">-2</span>]), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb17-35"><a href="sec82.html#cb17-35" tabindex="-1"></a>        SumLikt <span class="ot">&lt;-</span> (y[t] <span class="sc">-</span> (mu <span class="sc">+</span> phi1<span class="sc">*</span>y[t<span class="dv">-1</span>] <span class="sc">+</span> phi2<span class="sc">*</span>y[t<span class="dv">-2</span>]))<span class="sc">*</span>xt</span>
<span id="cb17-36"><a href="sec82.html#cb17-36" tabindex="-1"></a>        SumLik2t <span class="ot">&lt;-</span> (y[t] <span class="sc">-</span> (mu <span class="sc">+</span> phi1<span class="sc">*</span>y[t<span class="dv">-1</span>] <span class="sc">+</span> phi2<span class="sc">*</span>y[t<span class="dv">-2</span>]))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-37"><a href="sec82.html#cb17-37" tabindex="-1"></a>        SumLik <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">cbind</span>(SumLik, SumLikt))</span>
<span id="cb17-38"><a href="sec82.html#cb17-38" tabindex="-1"></a>        SumLik2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(SumLik2, SumLik2t)</span>
<span id="cb17-39"><a href="sec82.html#cb17-39" tabindex="-1"></a>    }</span>
<span id="cb17-40"><a href="sec82.html#cb17-40" tabindex="-1"></a>    Grad_mu <span class="ot">&lt;-</span> SumLik[<span class="dv">1</span>]<span class="sc">/</span>sig2 <span class="sc">-</span> (<span class="dv">1</span><span class="sc">/</span>MU0)<span class="sc">*</span>(mu <span class="sc">-</span> mu0)</span>
<span id="cb17-41"><a href="sec82.html#cb17-41" tabindex="-1"></a>    Grad_phi1 <span class="ot">&lt;-</span> SumLik[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">exp</span>(tau) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>Phi0[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">*</span>(phi1 <span class="sc">-</span> phi0[<span class="dv">1</span>])</span>
<span id="cb17-42"><a href="sec82.html#cb17-42" tabindex="-1"></a>    Grad_phi2 <span class="ot">&lt;-</span> SumLik[<span class="dv">3</span>]<span class="sc">/</span><span class="fu">exp</span>(tau) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>Phi0[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">*</span>(phi2 <span class="sc">-</span> phi0[<span class="dv">2</span>])</span>
<span id="cb17-43"><a href="sec82.html#cb17-43" tabindex="-1"></a>    Grad_tau <span class="ot">&lt;-</span> <span class="sc">-</span>(T<span class="dv">-2</span>)<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> SumLik2<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(tau)) <span class="sc">-</span> (a0<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> d0<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(tau)) <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb17-44"><a href="sec82.html#cb17-44" tabindex="-1"></a>    Grad <span class="ot">&lt;-</span> <span class="fu">c</span>(Grad_mu, Grad_phi1, Grad_phi2, Grad_tau)</span>
<span id="cb17-45"><a href="sec82.html#cb17-45" tabindex="-1"></a>    <span class="fu">return</span>(Grad)</span>
<span id="cb17-46"><a href="sec82.html#cb17-46" tabindex="-1"></a>}</span>
<span id="cb17-47"><a href="sec82.html#cb17-47" tabindex="-1"></a><span class="co"># Hamiltonian Monte Carlo function</span></span>
<span id="cb17-48"><a href="sec82.html#cb17-48" tabindex="-1"></a>HMC <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, y, epsilon, M){</span>
<span id="cb17-49"><a href="sec82.html#cb17-49" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="dv">1</span><span class="sc">/</span>epsilon)</span>
<span id="cb17-50"><a href="sec82.html#cb17-50" tabindex="-1"></a>    Minv <span class="ot">&lt;-</span> <span class="fu">solve</span>(M); thetat <span class="ot">&lt;-</span> theta</span>
<span id="cb17-51"><a href="sec82.html#cb17-51" tabindex="-1"></a>    K <span class="ot">&lt;-</span> <span class="fu">length</span>(thetat)</span>
<span id="cb17-52"><a href="sec82.html#cb17-52" tabindex="-1"></a>    mom <span class="ot">&lt;-</span> <span class="fu">t</span>(mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, K), M))</span>
<span id="cb17-53"><a href="sec82.html#cb17-53" tabindex="-1"></a>    logPost_Mom_t <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">LogPost</span>(thetat, y) <span class="sc">+</span>  mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">t</span>(mom), <span class="fu">rep</span>(<span class="dv">0</span>, K), M, <span class="at">log =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb17-54"><a href="sec82.html#cb17-54" tabindex="-1"></a>    <span class="cf">for</span>(l <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>L){</span>
<span id="cb17-55"><a href="sec82.html#cb17-55" tabindex="-1"></a>        <span class="cf">if</span>(l <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> l <span class="sc">==</span> L){</span>
<span id="cb17-56"><a href="sec82.html#cb17-56" tabindex="-1"></a>            mom <span class="ot">&lt;-</span> mom <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>epsilon<span class="sc">*</span><span class="fu">GradientTheta</span>(theta, y)</span>
<span id="cb17-57"><a href="sec82.html#cb17-57" tabindex="-1"></a>            theta <span class="ot">&lt;-</span> theta <span class="sc">+</span> epsilon<span class="sc">*</span>Minv<span class="sc">%*%</span>mom</span>
<span id="cb17-58"><a href="sec82.html#cb17-58" tabindex="-1"></a>        }<span class="cf">else</span>{</span>
<span id="cb17-59"><a href="sec82.html#cb17-59" tabindex="-1"></a>            mom <span class="ot">&lt;-</span> mom <span class="sc">+</span> epsilon<span class="sc">*</span><span class="fu">GradientTheta</span>(theta, y)</span>
<span id="cb17-60"><a href="sec82.html#cb17-60" tabindex="-1"></a>            theta <span class="ot">&lt;-</span> theta <span class="sc">+</span> epsilon<span class="sc">*</span>Minv<span class="sc">%*%</span>mom</span>
<span id="cb17-61"><a href="sec82.html#cb17-61" tabindex="-1"></a>        }</span>
<span id="cb17-62"><a href="sec82.html#cb17-62" tabindex="-1"></a>    }</span>
<span id="cb17-63"><a href="sec82.html#cb17-63" tabindex="-1"></a>    logPost_Mom_star <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">LogPost</span>(theta, y) <span class="sc">+</span>  mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">t</span>(mom), <span class="fu">rep</span>(<span class="dv">0</span>, K), M, <span class="at">log =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb17-64"><a href="sec82.html#cb17-64" tabindex="-1"></a>    alpha <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, <span class="fu">exp</span>(logPost_Mom_star<span class="sc">-</span>logPost_Mom_t))</span>
<span id="cb17-65"><a href="sec82.html#cb17-65" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb17-66"><a href="sec82.html#cb17-66" tabindex="-1"></a>    <span class="cf">if</span>(u <span class="sc">&lt;=</span> alpha){</span>
<span id="cb17-67"><a href="sec82.html#cb17-67" tabindex="-1"></a>        thetaNew <span class="ot">&lt;-</span> <span class="fu">c</span>(theta)</span>
<span id="cb17-68"><a href="sec82.html#cb17-68" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb17-69"><a href="sec82.html#cb17-69" tabindex="-1"></a>        thetaNew <span class="ot">&lt;-</span> thetat</span>
<span id="cb17-70"><a href="sec82.html#cb17-70" tabindex="-1"></a>    }</span>
<span id="cb17-71"><a href="sec82.html#cb17-71" tabindex="-1"></a>    rest <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">theta =</span> thetaNew, <span class="at">Prob =</span> alpha)</span>
<span id="cb17-72"><a href="sec82.html#cb17-72" tabindex="-1"></a>    <span class="fu">return</span>(rest)</span>
<span id="cb17-73"><a href="sec82.html#cb17-73" tabindex="-1"></a>}</span>
<span id="cb17-74"><a href="sec82.html#cb17-74" tabindex="-1"></a><span class="co"># Posterior draws</span></span>
<span id="cb17-75"><a href="sec82.html#cb17-75" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">1000</span>; burnin <span class="ot">&lt;-</span> <span class="dv">1000</span>; thin <span class="ot">&lt;-</span> <span class="dv">2</span>; tot <span class="ot">&lt;-</span> S <span class="sc">+</span> burnin</span>
<span id="cb17-76"><a href="sec82.html#cb17-76" tabindex="-1"></a>thetaPost <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, K)</span>
<span id="cb17-77"><a href="sec82.html#cb17-77" tabindex="-1"></a>ProbAccept <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, tot)</span>
<span id="cb17-78"><a href="sec82.html#cb17-78" tabindex="-1"></a>theta0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(y), <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">exp</span>(<span class="fu">var</span>(y))) </span>
<span id="cb17-79"><a href="sec82.html#cb17-79" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">solve</span>(VarPost); epsilon0 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb17-80"><a href="sec82.html#cb17-80" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> tot, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb17-81"><a href="sec82.html#cb17-81" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tot){</span>
<span id="cb17-82"><a href="sec82.html#cb17-82" tabindex="-1"></a>    epsilon <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span><span class="sc">*</span>epsilon0)</span>
<span id="cb17-83"><a href="sec82.html#cb17-83" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="dv">1</span><span class="sc">/</span>epsilon)</span>
<span id="cb17-84"><a href="sec82.html#cb17-84" tabindex="-1"></a>    HMCs <span class="ot">&lt;-</span> <span class="fu">HMC</span>(<span class="at">theta =</span> theta0, y, epsilon, M) </span>
<span id="cb17-85"><a href="sec82.html#cb17-85" tabindex="-1"></a>    theta0 <span class="ot">&lt;-</span> HMCs<span class="sc">$</span>theta </span>
<span id="cb17-86"><a href="sec82.html#cb17-86" tabindex="-1"></a>    thetaPost[s,] <span class="ot">&lt;-</span> HMCs<span class="sc">$</span>theta</span>
<span id="cb17-87"><a href="sec82.html#cb17-87" tabindex="-1"></a>    ProbAccept[s] <span class="ot">&lt;-</span> HMCs<span class="sc">$</span>Prob</span>
<span id="cb17-88"><a href="sec82.html#cb17-88" tabindex="-1"></a>    <span class="fu">setWinProgressBar</span>(pb, s, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(s<span class="sc">/</span>tot<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="st">&quot;% done&quot;</span>))</span>
<span id="cb17-89"><a href="sec82.html#cb17-89" tabindex="-1"></a>}</span>
<span id="cb17-90"><a href="sec82.html#cb17-90" tabindex="-1"></a><span class="fu">close</span>(pb)</span>
<span id="cb17-91"><a href="sec82.html#cb17-91" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">seq</span>((burnin<span class="sc">+</span><span class="dv">1</span>), tot, thin)</span>
<span id="cb17-92"><a href="sec82.html#cb17-92" tabindex="-1"></a>thetaF <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(thetaPost[keep,])</span>
<span id="cb17-93"><a href="sec82.html#cb17-93" tabindex="-1"></a><span class="fu">summary</span>(thetaF)</span>
<span id="cb17-94"><a href="sec82.html#cb17-94" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">exp</span>(thetaF[,K]))</span>
<span id="cb17-95"><a href="sec82.html#cb17-95" tabindex="-1"></a>ProbAcceptF <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(ProbAccept[keep])</span>
<span id="cb17-96"><a href="sec82.html#cb17-96" tabindex="-1"></a><span class="fu">summary</span>(ProbAcceptF)</span></code></pre></div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-box_jenkins_1976" class="csl-entry">
Box, George E. P., and Gwilym M. Jenkins. 1976. <em>Time Series Analysis: Forecasting and Control</em>. 1st ed. San Francisco: Holden-Day.
</div>
<div id="ref-chib1993bayes" class="csl-entry">
Chib, Siddhartha. 1993. <span>“Bayes Regression with Autoregressive Errors: A Gibbs Sampling Approach.”</span> <em>Journal of Econometrics</em> 58 (3): 275–94.
</div>
<div id="ref-chib1994bayes" class="csl-entry">
Chib, Siddhartha, and Edward Greenberg. 1994. <span>“Bayes Inference in Regression Models with ARMA (p, q) Errors.”</span> <em>Journal of Econometrics</em> 64 (1-2): 183–206.
</div>
<div id="ref-enders_2014" class="csl-entry">
Enders, Walter. 2014. <em>Applied Econometric Time Series</em>. 4th ed. Hoboken, NJ: Wiley.
</div>
<div id="ref-petris2009dynamic" class="csl-entry">
Petris, Giovanni, Sonia Petrone, and Patrizia Campagnoli. 2009. <span>“Dynamic Linear Models.”</span> In <em>Dynamic Linear Models with r</em>, 31–84. Springer.
</div>
<div id="ref-Stan2024" class="csl-entry">
Stan Development Team. 2024. <span>“Stan Modeling Language Users Guide and Reference Manual, 2024.”</span> <a href="http://mc-stan.org/">http://mc-stan.org/</a>.
</div>
<div id="ref-wooldridge2016introductory" class="csl-entry">
Wooldridge, Jeffrey M. 2016. <em>Introductory Econometrics: A Modern Approach</em>. 6th ed. Boston, MA: Cengage Learning.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Take into account that we do not consider the first two observations when present the likelihood, this is no an issue when there is a large sample size.<a href="sec82.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec81.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec83.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aramir21/IntroductionBayesianEconometricsBook/08-Timeseries.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
