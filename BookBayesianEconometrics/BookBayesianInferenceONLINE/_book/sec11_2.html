<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11.2 Splines | Introduction to Bayesian Econometrics</title>
  <meta name="description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="11.2 Splines | Introduction to Bayesian Econometrics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="github-repo" content="https://github.com/aramir21/IntroductionBayesianEconometricsBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11.2 Splines | Introduction to Bayesian Econometrics" />
  
  <meta name="twitter:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  

<meta name="author" content="Andrés Ramírez-Hassan" />


<meta name="date" content="2025-11-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec11_1.html"/>
<link rel="next" href="sec11_3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Bayesian Econometrics: A GUIded toolkit using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="to-instructors-and-students.html"><a href="to-instructors-and-students.html"><i class="fa fa-check"></i>To instructors and students</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Chap1.html"><a href="Chap1.html"><i class="fa fa-check"></i><b>1</b> Basic formal concepts</a>
<ul>
<li class="chapter" data-level="1.1" data-path="sec11.html"><a href="sec11.html"><i class="fa fa-check"></i><b>1.1</b> The Bayes’ rule</a></li>
<li class="chapter" data-level="1.2" data-path="sec12.html"><a href="sec12.html"><i class="fa fa-check"></i><b>1.2</b> Bayesian framework: A brief summary of theory</a></li>
<li class="chapter" data-level="1.3" data-path="sec14.html"><a href="sec14.html"><i class="fa fa-check"></i><b>1.3</b> Bayesian reports: Decision theory under uncertainty</a></li>
<li class="chapter" data-level="1.4" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
<li class="chapter" data-level="1.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chap2.html"><a href="Chap2.html"><i class="fa fa-check"></i><b>2</b> Conceptual differences between the Bayesian and Frequentist approaches</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec21.html"><a href="sec21.html"><i class="fa fa-check"></i><b>2.1</b> The concept of probability</a></li>
<li class="chapter" data-level="2.2" data-path="sec22.html"><a href="sec22.html"><i class="fa fa-check"></i><b>2.2</b> Subjectivity is not the key</a></li>
<li class="chapter" data-level="2.3" data-path="sec23.html"><a href="sec23.html"><i class="fa fa-check"></i><b>2.3</b> Estimation, hypothesis testing and prediction</a></li>
<li class="chapter" data-level="2.4" data-path="sec24.html"><a href="sec24.html"><i class="fa fa-check"></i><b>2.4</b> The likelihood principle</a></li>
<li class="chapter" data-level="2.5" data-path="sec25.html"><a href="sec25.html"><i class="fa fa-check"></i><b>2.5</b> Why is not the Bayesian approach that popular?</a></li>
<li class="chapter" data-level="2.6" data-path="sec26.html"><a href="sec26.html"><i class="fa fa-check"></i><b>2.6</b> A simple working example</a></li>
<li class="chapter" data-level="2.7" data-path="sec27.html"><a href="sec27.html"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
<li class="chapter" data-level="2.8" data-path="sec28.html"><a href="sec28.html"><i class="fa fa-check"></i><b>2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chap3.html"><a href="Chap3.html"><i class="fa fa-check"></i><b>3</b> Cornerstone models: Conjugate families</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec41.html"><a href="sec41.html"><i class="fa fa-check"></i><b>3.1</b> Motivation of conjugate families</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="sec41.html"><a href="sec41.html#examples-of-exponential-family-distributions"><i class="fa fa-check"></i><b>3.1.1</b> Examples of exponential family distributions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="sec42.html"><a href="sec42.html"><i class="fa fa-check"></i><b>3.2</b> Conjugate prior to exponential family</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sec42.html"><a href="sec42.html#sec421"><i class="fa fa-check"></i><b>3.2.1</b> Examples: Theorem 4.2.1</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sec43.html"><a href="sec43.html"><i class="fa fa-check"></i><b>3.3</b> Linear regression: The conjugate normal-normal/inverse gamma model</a></li>
<li class="chapter" data-level="3.4" data-path="sec44.html"><a href="sec44.html"><i class="fa fa-check"></i><b>3.4</b> Multivariate linear regression: The conjugate normal-normal/inverse Wishart model</a></li>
<li class="chapter" data-level="3.5" data-path="sec45.html"><a href="sec45.html"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
<li class="chapter" data-level="3.6" data-path="sec46.html"><a href="sec46.html"><i class="fa fa-check"></i><b>3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chap4.html"><a href="Chap4.html"><i class="fa fa-check"></i><b>4</b> Simulation methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec51.html"><a href="sec51.html"><i class="fa fa-check"></i><b>4.1</b> Markov Chain Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="sec51.html"><a href="sec51.html#sec511"><i class="fa fa-check"></i><b>4.1.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="4.1.2" data-path="sec51.html"><a href="sec51.html#sec512"><i class="fa fa-check"></i><b>4.1.2</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="4.1.3" data-path="sec51.html"><a href="sec51.html#sec513"><i class="fa fa-check"></i><b>4.1.3</b> Hamiltonian Monte Carlo</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sec52.html"><a href="sec52.html"><i class="fa fa-check"></i><b>4.2</b> Importance sampling</a></li>
<li class="chapter" data-level="4.3" data-path="sec53.html"><a href="sec53.html"><i class="fa fa-check"></i><b>4.3</b> Particle filtering</a></li>
<li class="chapter" data-level="4.4" data-path="sec54.html"><a href="sec54.html"><i class="fa fa-check"></i><b>4.4</b> Convergence diagnostics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="sec54.html"><a href="sec54.html#numerical-standard-error"><i class="fa fa-check"></i><b>4.4.1</b> Numerical standard error</a></li>
<li class="chapter" data-level="4.4.2" data-path="sec54.html"><a href="sec54.html#effective-number-of-simulation-draws"><i class="fa fa-check"></i><b>4.4.2</b> Effective number of simulation draws</a></li>
<li class="chapter" data-level="4.4.3" data-path="sec54.html"><a href="sec54.html#tests-of-convergence"><i class="fa fa-check"></i><b>4.4.3</b> Tests of convergence</a></li>
<li class="chapter" data-level="4.4.4" data-path="sec54.html"><a href="sec54.html#checking-for-errors-in-the-posterior-simulator"><i class="fa fa-check"></i><b>4.4.4</b> Checking for errors in the posterior simulator</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="sec55.html"><a href="sec55.html"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
<li class="chapter" data-level="4.6" data-path="sec56.html"><a href="sec56.html"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chap5.html"><a href="Chap5.html"><i class="fa fa-check"></i><b>5</b> Graphical user interface</a>
<ul>
<li class="chapter" data-level="5.1" data-path="secGUI1.html"><a href="secGUI1.html"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="secGUI2.html"><a href="secGUI2.html"><i class="fa fa-check"></i><b>5.2</b> Univariate models</a></li>
<li class="chapter" data-level="5.3" data-path="secGUI3.html"><a href="secGUI3.html"><i class="fa fa-check"></i><b>5.3</b> Multivariate models</a></li>
<li class="chapter" data-level="5.4" data-path="secGUI4.html"><a href="secGUI4.html"><i class="fa fa-check"></i><b>5.4</b> Time series models</a></li>
<li class="chapter" data-level="5.5" data-path="secGUI5.html"><a href="secGUI5.html"><i class="fa fa-check"></i><b>5.5</b> Longitudinal/panel models</a></li>
<li class="chapter" data-level="5.6" data-path="secGUI6.html"><a href="secGUI6.html"><i class="fa fa-check"></i><b>5.6</b> Bayesian model averaging</a></li>
<li class="chapter" data-level="5.7" data-path="secGUI7.html"><a href="secGUI7.html"><i class="fa fa-check"></i><b>5.7</b> Help</a></li>
<li class="chapter" data-level="5.8" data-path="secGUI8.html"><a href="secGUI8.html"><i class="fa fa-check"></i><b>5.8</b> Warning</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chap6.html"><a href="Chap6.html"><i class="fa fa-check"></i><b>6</b> Univariate models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec61.html"><a href="sec61.html"><i class="fa fa-check"></i><b>6.1</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="6.2" data-path="sec62.html"><a href="sec62.html"><i class="fa fa-check"></i><b>6.2</b> The logit model</a></li>
<li class="chapter" data-level="6.3" data-path="sec63.html"><a href="sec63.html"><i class="fa fa-check"></i><b>6.3</b> The probit model</a></li>
<li class="chapter" data-level="6.4" data-path="sec64.html"><a href="sec64.html"><i class="fa fa-check"></i><b>6.4</b> The multinomial probit model</a></li>
<li class="chapter" data-level="6.5" data-path="sec65.html"><a href="sec65.html"><i class="fa fa-check"></i><b>6.5</b> The multinomial logit model</a></li>
<li class="chapter" data-level="6.6" data-path="sec66.html"><a href="sec66.html"><i class="fa fa-check"></i><b>6.6</b> Ordered probit model</a></li>
<li class="chapter" data-level="6.7" data-path="negative-binomial-model.html"><a href="negative-binomial-model.html"><i class="fa fa-check"></i><b>6.7</b> Negative binomial model</a></li>
<li class="chapter" data-level="6.8" data-path="sec68.html"><a href="sec68.html"><i class="fa fa-check"></i><b>6.8</b> Tobit model</a></li>
<li class="chapter" data-level="6.9" data-path="sec69.html"><a href="sec69.html"><i class="fa fa-check"></i><b>6.9</b> Quantile regression</a></li>
<li class="chapter" data-level="6.10" data-path="sec610.html"><a href="sec610.html"><i class="fa fa-check"></i><b>6.10</b> Bayesian bootstrap regression</a></li>
<li class="chapter" data-level="6.11" data-path="sec611.html"><a href="sec611.html"><i class="fa fa-check"></i><b>6.11</b> Summary</a></li>
<li class="chapter" data-level="6.12" data-path="sec612.html"><a href="sec612.html"><i class="fa fa-check"></i><b>6.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chap7.html"><a href="Chap7.html"><i class="fa fa-check"></i><b>7</b> Multivariate models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec71.html"><a href="sec71.html"><i class="fa fa-check"></i><b>7.1</b> Multivariate regression</a></li>
<li class="chapter" data-level="7.2" data-path="sec72.html"><a href="sec72.html"><i class="fa fa-check"></i><b>7.2</b> Seemingly Unrelated Regression</a></li>
<li class="chapter" data-level="7.3" data-path="sec73.html"><a href="sec73.html"><i class="fa fa-check"></i><b>7.3</b> Instrumental variable</a></li>
<li class="chapter" data-level="7.4" data-path="sec74.html"><a href="sec74.html"><i class="fa fa-check"></i><b>7.4</b> Multivariate probit model</a></li>
<li class="chapter" data-level="7.5" data-path="sec75.html"><a href="sec75.html"><i class="fa fa-check"></i><b>7.5</b> Summary</a></li>
<li class="chapter" data-level="7.6" data-path="sec76.html"><a href="sec76.html"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chap8.html"><a href="Chap8.html"><i class="fa fa-check"></i><b>8</b> Time series models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec81.html"><a href="sec81.html"><i class="fa fa-check"></i><b>8.1</b> State-space representation</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="sec81.html"><a href="sec81.html#gaussian-linear-state-space-models"><i class="fa fa-check"></i><b>8.1.1</b> Gaussian linear state-space models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="sec82.html"><a href="sec82.html"><i class="fa fa-check"></i><b>8.2</b> ARMA processes</a></li>
<li class="chapter" data-level="8.3" data-path="sec83.html"><a href="sec83.html"><i class="fa fa-check"></i><b>8.3</b> Stochastic volatility models</a></li>
<li class="chapter" data-level="8.4" data-path="sec84.html"><a href="sec84.html"><i class="fa fa-check"></i><b>8.4</b> Vector Autoregressive models</a></li>
<li class="chapter" data-level="8.5" data-path="sec85.html"><a href="sec85.html"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
<li class="chapter" data-level="8.6" data-path="sec86.html"><a href="sec86.html"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chap9.html"><a href="Chap9.html"><i class="fa fa-check"></i><b>9</b> Longitudinal/Panel data models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec91.html"><a href="sec91.html"><i class="fa fa-check"></i><b>9.1</b> Normal model</a></li>
<li class="chapter" data-level="9.2" data-path="sec92.html"><a href="sec92.html"><i class="fa fa-check"></i><b>9.2</b> Logit model</a></li>
<li class="chapter" data-level="9.3" data-path="sec93.html"><a href="sec93.html"><i class="fa fa-check"></i><b>9.3</b> Poisson model</a></li>
<li class="chapter" data-level="9.4" data-path="sec94.html"><a href="sec94.html"><i class="fa fa-check"></i><b>9.4</b> Summary</a></li>
<li class="chapter" data-level="9.5" data-path="sec95.html"><a href="sec95.html"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Chap10.html"><a href="Chap10.html"><i class="fa fa-check"></i><b>10</b> Bayesian model averaging</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec10_1.html"><a href="sec10_1.html"><i class="fa fa-check"></i><b>10.1</b> Foundation</a></li>
<li class="chapter" data-level="10.2" data-path="sec102.html"><a href="sec102.html"><i class="fa fa-check"></i><b>10.2</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="10.3" data-path="sec103.html"><a href="sec103.html"><i class="fa fa-check"></i><b>10.3</b> Generalized linear models</a></li>
<li class="chapter" data-level="10.4" data-path="sec10_4.html"><a href="sec10_4.html"><i class="fa fa-check"></i><b>10.4</b> Calculating the marginal likelihood</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_1"><i class="fa fa-check"></i><b>10.4.1</b> Savage-Dickey density ratio</a></li>
<li class="chapter" data-level="10.4.2" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_2"><i class="fa fa-check"></i><b>10.4.2</b> Chib’s methods</a></li>
<li class="chapter" data-level="10.4.3" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_3"><i class="fa fa-check"></i><b>10.4.3</b> Gelfand-Dey method</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="sec10_5.html"><a href="sec10_5.html"><i class="fa fa-check"></i><b>10.5</b> Summary</a></li>
<li class="chapter" data-level="10.6" data-path="sec10_6.html"><a href="sec10_6.html"><i class="fa fa-check"></i><b>10.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Chap11.html"><a href="Chap11.html"><i class="fa fa-check"></i><b>11</b> Semi-parametric and non-parametric models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec11_1.html"><a href="sec11_1.html"><i class="fa fa-check"></i><b>11.1</b> Mixture models</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="sec11_1.html"><a href="sec11_1.html#sec11_11"><i class="fa fa-check"></i><b>11.1.1</b> Finite Gaussian mixtures</a></li>
<li class="chapter" data-level="11.1.2" data-path="sec11_1.html"><a href="sec11_1.html#sec11_12"><i class="fa fa-check"></i><b>11.1.2</b> Direchlet processes</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="sec11_2.html"><a href="sec11_2.html"><i class="fa fa-check"></i><b>11.2</b> Splines</a></li>
<li class="chapter" data-level="11.3" data-path="sec11_3.html"><a href="sec11_3.html"><i class="fa fa-check"></i><b>11.3</b> Summary</a></li>
<li class="chapter" data-level="11.4" data-path="sec11_4.html"><a href="sec11_4.html"><i class="fa fa-check"></i><b>11.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Chap12.html"><a href="Chap12.html"><i class="fa fa-check"></i><b>12</b> Bayesian machine learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sec12_1.html"><a href="sec12_1.html"><i class="fa fa-check"></i><b>12.1</b> Cross-validation and Bayes factors</a></li>
<li class="chapter" data-level="12.2" data-path="sec12_2.html"><a href="sec12_2.html"><i class="fa fa-check"></i><b>12.2</b> Regularization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="sec12_2.html"><a href="sec12_2.html#sec12_21"><i class="fa fa-check"></i><b>12.2.1</b> Bayesian LASSO</a></li>
<li class="chapter" data-level="12.2.2" data-path="sec12_2.html"><a href="sec12_2.html#sec12_22"><i class="fa fa-check"></i><b>12.2.2</b> Stochastic search variable selection</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="sec12_3.html"><a href="sec12_3.html"><i class="fa fa-check"></i><b>12.3</b> Bayesian additive regression trees</a></li>
<li class="chapter" data-level="12.4" data-path="sec12_4.html"><a href="sec12_4.html"><i class="fa fa-check"></i><b>12.4</b> Gaussian processes</a></li>
<li class="chapter" data-level="12.5" data-path="sec12_5.html"><a href="sec12_5.html"><i class="fa fa-check"></i><b>12.5</b> Tall data problems</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="sec12_5.html"><a href="sec12_5.html#sec12_51"><i class="fa fa-check"></i><b>12.5.1</b> Divide-and-conquer methods</a></li>
<li class="chapter" data-level="12.5.2" data-path="sec12_5.html"><a href="sec12_5.html#sec12_52"><i class="fa fa-check"></i><b>12.5.2</b> Subsampling-based algorithms</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="id_13_6.html"><a href="id_13_6.html"><i class="fa fa-check"></i><b>12.6</b> Summary</a></li>
<li class="chapter" data-level="12.7" data-path="id_13_7.html"><a href="id_13_7.html"><i class="fa fa-check"></i><b>12.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Chap13.html"><a href="Chap13.html"><i class="fa fa-check"></i><b>13</b> Causal inference</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec13_1.html"><a href="sec13_1.html"><i class="fa fa-check"></i><b>13.1</b> Identification setting</a></li>
<li class="chapter" data-level="13.2" data-path="sec13_2.html"><a href="sec13_2.html"><i class="fa fa-check"></i><b>13.2</b> Randomized controlled trial (RCT)</a></li>
<li class="chapter" data-level="13.3" data-path="sec13_3.html"><a href="sec13_3.html"><i class="fa fa-check"></i><b>13.3</b> Conditional independence assumption (CIA)</a></li>
<li class="chapter" data-level="13.4" data-path="sec13_4.html"><a href="sec13_4.html"><i class="fa fa-check"></i><b>13.4</b> Instrumental variables (IV)</a></li>
<li class="chapter" data-level="13.5" data-path="sec13_5.html"><a href="sec13_5.html"><i class="fa fa-check"></i><b>13.5</b> Difference-in-differences design (DiD)</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="sec13_5.html"><a href="sec13_5.html#sec13_51"><i class="fa fa-check"></i><b>13.5.1</b> Classic DiD: two-group and two-period (<span class="math inline">\(2\times2\)</span>) setup</a></li>
<li class="chapter" data-level="13.5.2" data-path="sec13_5.html"><a href="sec13_5.html#sec13_52"><i class="fa fa-check"></i><b>13.5.2</b> Staggered (SDiD): G-group and T-period (<span class="math inline">\(G\times T\)</span>) setup</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="sec13_6.html"><a href="sec13_6.html"><i class="fa fa-check"></i><b>13.6</b> Regression discontinuity design (RD)</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="sec13_6.html"><a href="sec13_6.html#sec13_61"><i class="fa fa-check"></i><b>13.6.1</b> Sharp regression discontinuity design (SRD)</a></li>
<li class="chapter" data-level="13.6.2" data-path="sec13_6.html"><a href="sec13_6.html#sec13_62"><i class="fa fa-check"></i><b>13.6.2</b> Fuzzy regression discontinuity design (FRD)</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="sec13_7.html"><a href="sec13_7.html"><i class="fa fa-check"></i><b>13.7</b> Sample selection</a></li>
<li class="chapter" data-level="13.8" data-path="sec13_8.html"><a href="sec13_8.html"><i class="fa fa-check"></i><b>13.8</b> Bayesian exponentially tilted empirical likelihood</a></li>
<li class="chapter" data-level="13.9" data-path="sec13_9.html"><a href="sec13_9.html"><i class="fa fa-check"></i><b>13.9</b> General Bayes posteriors</a></li>
<li class="chapter" data-level="13.10" data-path="sec13_10.html"><a href="sec13_10.html"><i class="fa fa-check"></i><b>13.10</b> Doubly robust Bayesian inferential framework (DRB)</a></li>
<li class="chapter" data-level="13.11" data-path="sec13_11.html"><a href="sec13_11.html"><i class="fa fa-check"></i><b>13.11</b> Summary</a></li>
<li class="chapter" data-level="13.12" data-path="sec13_12.html"><a href="sec13_12.html"><i class="fa fa-check"></i><b>13.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Chap14.html"><a href="Chap14.html"><i class="fa fa-check"></i><b>14</b> Approximate Bayesian methods</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sec14_1.html"><a href="sec14_1.html"><i class="fa fa-check"></i><b>14.1</b> Simulation-based approaches</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="sec14_1.html"><a href="sec14_1.html#sec14_11"><i class="fa fa-check"></i><b>14.1.1</b> Approximate Bayesian computation</a></li>
<li class="chapter" data-level="14.1.2" data-path="sec14_1.html"><a href="sec14_1.html#sec14_12"><i class="fa fa-check"></i><b>14.1.2</b> Bayesian synthetic likelihood</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="sec14_2.html"><a href="sec14_2.html"><i class="fa fa-check"></i><b>14.2</b> Optimization approaches</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="sec14_2.html"><a href="sec14_2.html#sec14_21"><i class="fa fa-check"></i><b>14.2.1</b> Integrated nested Laplace approximations</a></li>
<li class="chapter" data-level="14.2.2" data-path="sec14_2.html"><a href="sec14_2.html#sec14_22"><i class="fa fa-check"></i><b>14.2.2</b> Variational Bayes</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>14.3</b> Summary</a></li>
<li class="chapter" data-level="14.4" data-path="sec14_4.html"><a href="sec14_4.html"><i class="fa fa-check"></i><b>14.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a>
<ul>
<li class="chapter" data-level="" data-path="packages-and-commands-in-besmarter-gui.html"><a href="packages-and-commands-in-besmarter-gui.html"><i class="fa fa-check"></i>Packages and commands in BEsmarter GUI</a></li>
<li class="chapter" data-level="" data-path="datasets-templates-in-folder-datasim.html"><a href="datasets-templates-in-folder-datasim.html"><i class="fa fa-check"></i>Datasets templates in folder DataSim</a></li>
<li class="chapter" data-level="" data-path="real-datasets-in-folder-dataapp.html"><a href="real-datasets-in-folder-dataapp.html"><i class="fa fa-check"></i>Real datasets in folder DataApp</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bayesian Econometrics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec11_2" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Splines<a href="sec11_2.html#sec11_2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another common approach to performing non-parametric or semi-parametric inference is using splines. These are piecewise polynomial functions that allow for approximating complex relationships in data.</p>
<p>To clarify ideas, let’s begin with a simple univariate case. The starting point is to assume that<br />
<span class="math display">\[
y_i = f(x_{i}) + \mu_i,
\]</span><br />
where <span class="math inline">\(\mu_i \sim N(0, \sigma^2)\)</span> is independent of the regressor <span class="math inline">\(x_{i}\)</span>, and <span class="math inline">\(f(x_{i})\)</span> is a smooth function such that nearby points in the support of <span class="math inline">\(x_{i}\)</span> should have similar values. Observe that this means we must always sort the data in increasing order according to <span class="math inline">\(x_i\)</span>. This has no effect, as we assume a random sample. The index <span class="math inline">\(i = 1,2,\dots, N\)</span> represents the observations.</p>
<p>The spline approach defines<br />
<span class="math display" id="eq:1ch11">\[\begin{align}
    f(x_{i}) = \beta_{1}b_1(x_{i}) + \beta_{2}b_2(x_{i}) + \dots + \beta_{H}b_H(x_{i}) = \boldsymbol{b}(x_{i})^{\top}\boldsymbol{\beta},
    \tag{11.1}
\end{align}\]</span><br />
where <span class="math inline">\(\boldsymbol{\beta} = [\beta_{1} \ \beta_{2} \ \dots \ \beta_{H}]^{\top}\)</span> and <span class="math inline">\(\boldsymbol{b}(x_{i}) = [b_1(x_{i}) \ b_2(x_{i}) \ \dots \ b_H(x_{i})]^{\top}\)</span> are the vector of parameters and the vector of spline basis (B-splines) function values at <span class="math inline">\(x_{i}\)</span>, respectively.</p>
<p>Note that in this setting, there is only one regressor; however, there are <span class="math inline">\(H\)</span> location parameters. Given <span class="math inline">\(N\)</span> observations, the design matrix is:
<span class="math display">\[\begin{align*}
    \boldsymbol{W}=\begin{bmatrix}
        b_1(x_{1}) &amp; b_2(x_{1}) &amp; \dots &amp; b_H(x_{1})\\
        b_1(x_{2}) &amp; b_2(x_{2}) &amp; \dots &amp; b_H(x_{2})\\
        \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
        b_1(x_{N}) &amp; b_2(x_{N}) &amp; \dots &amp; b_H(x_{N})\\
    \end{bmatrix}.
\end{align*}\]</span>
Thus, we have a standard linear model where we can proceed as in Chapter <a href="Chap3.html#Chap3">3</a>.</p>
<p>Actually, Equation <a href="sec11_2.html#eq:1ch11">(11.1)</a> represents the basis function approach, where <span class="math inline">\(\boldsymbol{b}(x_{i})\)</span> is a specified set of basis functions, such as B-splines. However, other functions derived from the Fourier transform, Gaussian radial basis functions, wavelets, etc., can also be used. Here, we focus on the most popular case: cubic B-splines. However, the same ideas apply to other basis functions. In particular, cubic B-splines provide the lowest degree necessary to generate sufficiently smooth curves; the first and second derivatives are nonzero, which is not the case with constant and linear splines <span class="citation">(<a href="#ref-BMCP2021">O. A. Martin, Kumar, and Lao 2021</a>)</span>.</p>
<p>Thus, from Equation <a href="sec11_2.html#eq:1ch11">(11.1)</a>, we see that a spline is a linear combination of <span class="math inline">\(H\)</span> B-splines. The latter are polynomials of a certain degree, meaning that splines are piecewise polynomial functions. Any spline function of order <span class="math inline">\(n\)</span> can be expressed as a linear combination of B-splines of order <span class="math inline">\(n\)</span>, and B-splines serve as the basis functions for the spline function space.</p>
<p>The cubic B-spline is
<span class="math display">\[\begin{align*}
    b_{h,3}(x_i)=\begin{Bmatrix}
        \frac{u^3}{6} &amp; x_h \leq x_i &lt; x_{h+1}, &amp; u=(x_i-x_h)/\delta\\
        \frac{1+3u+3u^2-3u^3}{6} &amp; x_{h+1} \leq x_i &lt; x_{h+2}, &amp; u=(x_i-x_{h+1})/\delta\\
        \frac{4-6u^2+3u^3}{6} &amp; x_{h+2} \leq x_i &lt; x_{h+3}, &amp; u=(x_i-x_{h+2})/\delta\\
        \frac{1-3u+3u^2-3u^3}{6} &amp; x_{h+3} \leq x_i &lt; x_{h+4}, &amp; u=(x_i-x_{h+3})/\delta\\
        0 &amp; \text{otherwise}
    \end{Bmatrix},
\end{align*}\]</span>
where <span class="math inline">\(x_{h+k}\)</span> are called the knots, for <span class="math inline">\(k=0,1,\dots,4\)</span>. These are the points in the domain of the function where the pieces of the spline join, satisfying <span class="math inline">\(x_{h+k} \leq x_{h+k+1}\)</span>. The knots control the shape and flexibility of the spline curve; more knots imply greater flexibility but less smoothness. Note that <span class="math inline">\(\delta\)</span> determines the distance between the knots, and that this expression clearly shows that the cubic B-spline is a piecewise polynomial function.</p>
<p>The following code implements this function in <strong>R</strong> using a delta of 1.5 and 5 knots <span class="math inline">\(\left\{2, 3.5, 5, 6.5, 8\right\}\)</span>. The knots <span class="math inline">\(\left\{2, 8\right\}\)</span> are called boundary knots, which can be given by the range of <span class="math inline">\(x\)</span>, and the knots <span class="math inline">\(\left\{3.5, 5, 6.5\right\}\)</span> are called internal knots. B-splines with evenly distributed knots are called uniform B-splines. However, this is not always the case.</p>
<p>The figure compares the results of our own function (black circles) with those obtained using the <em>bs</em> function from the <em>splines</em> package (red line).</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="sec11_2.html#cb679-1" tabindex="-1"></a>SplineOwn <span class="ot">&lt;-</span> <span class="cf">function</span>(x, knots, delta){</span>
<span id="cb679-2"><a href="sec11_2.html#cb679-2" tabindex="-1"></a>    <span class="cf">if</span>(knots[<span class="dv">1</span>] <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;</span> knots[<span class="dv">2</span>]){</span>
<span id="cb679-3"><a href="sec11_2.html#cb679-3" tabindex="-1"></a>        u <span class="ot">&lt;-</span> (x <span class="sc">-</span> knots[<span class="dv">1</span>])<span class="sc">/</span>delta</span>
<span id="cb679-4"><a href="sec11_2.html#cb679-4" tabindex="-1"></a>        b <span class="ot">&lt;-</span> u<span class="sc">^</span><span class="dv">3</span><span class="sc">/</span><span class="dv">6</span></span>
<span id="cb679-5"><a href="sec11_2.html#cb679-5" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb679-6"><a href="sec11_2.html#cb679-6" tabindex="-1"></a>        <span class="cf">if</span>(knots[<span class="dv">2</span>] <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;</span> knots[<span class="dv">3</span>]){</span>
<span id="cb679-7"><a href="sec11_2.html#cb679-7" tabindex="-1"></a>            u <span class="ot">&lt;-</span> (x <span class="sc">-</span> knots[<span class="dv">2</span>])<span class="sc">/</span>delta</span>
<span id="cb679-8"><a href="sec11_2.html#cb679-8" tabindex="-1"></a>            b <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>u <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>u<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span><span class="sc">*</span>u<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb679-9"><a href="sec11_2.html#cb679-9" tabindex="-1"></a>        }<span class="cf">else</span>{</span>
<span id="cb679-10"><a href="sec11_2.html#cb679-10" tabindex="-1"></a>            <span class="cf">if</span>(knots[<span class="dv">3</span>] <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;</span> knots[<span class="dv">4</span>]){</span>
<span id="cb679-11"><a href="sec11_2.html#cb679-11" tabindex="-1"></a>                u <span class="ot">&lt;-</span> (x <span class="sc">-</span> knots[<span class="dv">3</span>])<span class="sc">/</span>delta</span>
<span id="cb679-12"><a href="sec11_2.html#cb679-12" tabindex="-1"></a>                b <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)<span class="sc">*</span>(<span class="dv">4</span> <span class="sc">-</span> <span class="dv">6</span><span class="sc">*</span>u<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>u<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb679-13"><a href="sec11_2.html#cb679-13" tabindex="-1"></a>            }<span class="cf">else</span>{</span>
<span id="cb679-14"><a href="sec11_2.html#cb679-14" tabindex="-1"></a>                <span class="cf">if</span>(knots[<span class="dv">4</span>] <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;</span> knots[<span class="dv">5</span>]){</span>
<span id="cb679-15"><a href="sec11_2.html#cb679-15" tabindex="-1"></a>                    u <span class="ot">&lt;-</span> (x <span class="sc">-</span> knots[<span class="dv">4</span>])<span class="sc">/</span>delta</span>
<span id="cb679-16"><a href="sec11_2.html#cb679-16" tabindex="-1"></a>                    b <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="dv">3</span><span class="sc">*</span>u <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>u<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> u<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb679-17"><a href="sec11_2.html#cb679-17" tabindex="-1"></a>                }<span class="cf">else</span>{</span>
<span id="cb679-18"><a href="sec11_2.html#cb679-18" tabindex="-1"></a>                    b <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb679-19"><a href="sec11_2.html#cb679-19" tabindex="-1"></a>                }</span>
<span id="cb679-20"><a href="sec11_2.html#cb679-20" tabindex="-1"></a>            }</span>
<span id="cb679-21"><a href="sec11_2.html#cb679-21" tabindex="-1"></a>        }</span>
<span id="cb679-22"><a href="sec11_2.html#cb679-22" tabindex="-1"></a>    }</span>
<span id="cb679-23"><a href="sec11_2.html#cb679-23" tabindex="-1"></a>    <span class="fu">return</span>(b)</span>
<span id="cb679-24"><a href="sec11_2.html#cb679-24" tabindex="-1"></a>}</span>
<span id="cb679-25"><a href="sec11_2.html#cb679-25" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb679-26"><a href="sec11_2.html#cb679-26" tabindex="-1"></a>knotsA <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">8</span>, delta)</span>
<span id="cb679-27"><a href="sec11_2.html#cb679-27" tabindex="-1"></a>xA <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">8</span>, <span class="fl">0.1</span>)</span>
<span id="cb679-28"><a href="sec11_2.html#cb679-28" tabindex="-1"></a>Ens <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xA, <span class="cf">function</span>(xi) {<span class="fu">SplineOwn</span>(xi, <span class="at">knots =</span> knotsA, <span class="at">delta =</span> delta)})</span>
<span id="cb679-29"><a href="sec11_2.html#cb679-29" tabindex="-1"></a><span class="fu">plot</span>(xA, Ens, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;B-spline&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Cubic B-spline comparison: own function vs bs&quot;</span>)</span>
<span id="cb679-30"><a href="sec11_2.html#cb679-30" tabindex="-1"></a><span class="fu">require</span>(splines)</span></code></pre></div>
<pre><code>## Loading required package: splines</code></pre>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="sec11_2.html#cb681-1" tabindex="-1"></a>BSfunc <span class="ot">&lt;-</span> <span class="fu">bs</span>(xA, <span class="at">knots =</span> knotsA, <span class="at">degree =</span> <span class="dv">3</span>)</span>
<span id="cb681-2"><a href="sec11_2.html#cb681-2" tabindex="-1"></a><span class="fu">lines</span>(xA, BSfunc[,<span class="dv">4</span>], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-65-1.svg" width="672" /></p>
<p>The figure shows a particular cubic B-spline, but <span class="math inline">\(f(x_i)\)</span> in Equation <a href="sec11_2.html#eq:1ch11">(11.1)</a> involves <span class="math inline">\(H\)</span> splines over the range of potential values of <span class="math inline">\(x\)</span>, as we need to evaluate the splines centered at different knots. Here, we should clarify that to avoid issues with the use of splines at boundary regions, it is essential to artificially increase the number of boundary knots by repeating these knots as many times as the degree of the polynomial. For instance, in our example, the final set of knots is <span class="math inline">\(\left\{2, 2, 2, 2, 3.5, 5, 6.5, 8, 8, 8, 8\right\}\)</span>.
The set of B-splines can be constructed using the Cox–de Boor recursion formula. The starting point is the B-spline of degree 0,
<span class="math display">\[\begin{align*}
        b_{h,0}(x_i)=\begin{Bmatrix}
        1 &amp; x_h \leq x_i &lt; x_{h+1}\\
        0 &amp; \text{otherwise}
    \end{Bmatrix},
\end{align*}\]</span>
and then, the other B-splines are defined by the recursion
<span class="math display">\[\begin{align}
    b_{h,p}(x_i)=\frac{x_i-x_{h}}{x_{h+p}-x_h}b_{h,p-1}(x_i)+\frac{x_{h+p+1}-x_i}{x_{h+p+1}-x_{h+1}}b_{h+1,p-1}(x_i).
\end{align}\]</span>
Note that B-splines are defined by their degree and their knots.</p>
<p>The following code demonstrates how to perform this recursion using the same settings as in the previous code and compares the results with the <em>bs</em> function from the <em>splines</em> package. As shown in the figure, we obtain the same results. We will continue using the <em>bs</em> function from the <em>splines</em> package for convenience in the process, but it seems that we have gained some understanding of the underlying process.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="sec11_2.html#cb682-1" tabindex="-1"></a>cubic_bspline <span class="ot">&lt;-</span> <span class="cf">function</span>(x, knots, <span class="at">degree =</span> <span class="dv">3</span>) {</span>
<span id="cb682-2"><a href="sec11_2.html#cb682-2" tabindex="-1"></a>    extended_knots <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(knots[<span class="dv">1</span>], degree), knots, <span class="fu">rep</span>(knots[<span class="fu">length</span>(knots)], degree))</span>
<span id="cb682-3"><a href="sec11_2.html#cb682-3" tabindex="-1"></a>    num_basis <span class="ot">&lt;-</span> <span class="fu">length</span>(knots) <span class="sc">+</span> degree <span class="sc">-</span> <span class="dv">1</span>  </span>
<span id="cb682-4"><a href="sec11_2.html#cb682-4" tabindex="-1"></a>    basis_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(x), <span class="at">ncol =</span> num_basis)</span>
<span id="cb682-5"><a href="sec11_2.html#cb682-5" tabindex="-1"></a>    <span class="co"># Function to compute B-spline basis recursively</span></span>
<span id="cb682-6"><a href="sec11_2.html#cb682-6" tabindex="-1"></a>    b_spline_basis <span class="ot">&lt;-</span> <span class="cf">function</span>(x, degree, i, knots) {</span>
<span id="cb682-7"><a href="sec11_2.html#cb682-7" tabindex="-1"></a>        <span class="cf">if</span> (degree <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb682-8"><a href="sec11_2.html#cb682-8" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> knots[i] <span class="sc">&amp;</span> x <span class="sc">&lt;</span> knots[i <span class="sc">+</span> <span class="dv">1</span>], <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb682-9"><a href="sec11_2.html#cb682-9" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb682-10"><a href="sec11_2.html#cb682-10" tabindex="-1"></a>            left_num <span class="ot">&lt;-</span> (x <span class="sc">-</span> knots[i])</span>
<span id="cb682-11"><a href="sec11_2.html#cb682-11" tabindex="-1"></a>            left_den <span class="ot">&lt;-</span> (knots[i <span class="sc">+</span> degree] <span class="sc">-</span> knots[i])</span>
<span id="cb682-12"><a href="sec11_2.html#cb682-12" tabindex="-1"></a>            left <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(left_den <span class="sc">!=</span> <span class="dv">0</span>, (left_num <span class="sc">/</span> left_den) <span class="sc">*</span> <span class="fu">b_spline_basis</span>(x, degree <span class="sc">-</span> <span class="dv">1</span>, i, knots), <span class="dv">0</span>)</span>
<span id="cb682-13"><a href="sec11_2.html#cb682-13" tabindex="-1"></a>            </span>
<span id="cb682-14"><a href="sec11_2.html#cb682-14" tabindex="-1"></a>            right_num <span class="ot">&lt;-</span> (knots[i <span class="sc">+</span> degree <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> x)</span>
<span id="cb682-15"><a href="sec11_2.html#cb682-15" tabindex="-1"></a>            right_den <span class="ot">&lt;-</span> (knots[i <span class="sc">+</span> degree <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> knots[i <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb682-16"><a href="sec11_2.html#cb682-16" tabindex="-1"></a>            right <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(right_den <span class="sc">!=</span> <span class="dv">0</span>, (right_num <span class="sc">/</span> right_den) <span class="sc">*</span> <span class="fu">b_spline_basis</span>(x, degree <span class="sc">-</span> <span class="dv">1</span>, i <span class="sc">+</span> <span class="dv">1</span>, knots), <span class="dv">0</span>)</span>
<span id="cb682-17"><a href="sec11_2.html#cb682-17" tabindex="-1"></a>            </span>
<span id="cb682-18"><a href="sec11_2.html#cb682-18" tabindex="-1"></a>            <span class="fu">return</span>(left <span class="sc">+</span> right)</span>
<span id="cb682-19"><a href="sec11_2.html#cb682-19" tabindex="-1"></a>        }</span>
<span id="cb682-20"><a href="sec11_2.html#cb682-20" tabindex="-1"></a>    }</span>
<span id="cb682-21"><a href="sec11_2.html#cb682-21" tabindex="-1"></a>    </span>
<span id="cb682-22"><a href="sec11_2.html#cb682-22" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_basis) {</span>
<span id="cb682-23"><a href="sec11_2.html#cb682-23" tabindex="-1"></a>        basis_matrix[, i] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(xi) <span class="fu">b_spline_basis</span>(xi, degree, i, extended_knots))</span>
<span id="cb682-24"><a href="sec11_2.html#cb682-24" tabindex="-1"></a>    }</span>
<span id="cb682-25"><a href="sec11_2.html#cb682-25" tabindex="-1"></a>    <span class="cf">if</span>(x[<span class="fu">length</span>(x)] <span class="sc">==</span> knots[<span class="fu">length</span>(knots)]){</span>
<span id="cb682-26"><a href="sec11_2.html#cb682-26" tabindex="-1"></a>        basis_matrix[<span class="fu">length</span>(x), num_basis] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb682-27"><a href="sec11_2.html#cb682-27" tabindex="-1"></a>    }</span>
<span id="cb682-28"><a href="sec11_2.html#cb682-28" tabindex="-1"></a>    <span class="fu">return</span>(basis_matrix)</span>
<span id="cb682-29"><a href="sec11_2.html#cb682-29" tabindex="-1"></a>}</span>
<span id="cb682-30"><a href="sec11_2.html#cb682-30" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb682-31"><a href="sec11_2.html#cb682-31" tabindex="-1"></a>knotsA <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">8</span>, delta)</span>
<span id="cb682-32"><a href="sec11_2.html#cb682-32" tabindex="-1"></a>xA <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">8</span>, <span class="fl">0.1</span>)</span>
<span id="cb682-33"><a href="sec11_2.html#cb682-33" tabindex="-1"></a>basis_matrix <span class="ot">&lt;-</span> <span class="fu">cubic_bspline</span>(xA, <span class="at">knots =</span> knotsA, <span class="at">degree =</span> <span class="dv">3</span>)</span>
<span id="cb682-34"><a href="sec11_2.html#cb682-34" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb682-35"><a href="sec11_2.html#cb682-35" tabindex="-1"></a>bs_matrix <span class="ot">&lt;-</span> <span class="fu">bs</span>(xA, <span class="at">knots =</span> knotsA[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">length</span>(knotsA))], <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">intercept =</span> <span class="cn">TRUE</span>, <span class="at">Boundary.knots =</span> <span class="fu">range</span>(knotsA))</span>
<span id="cb682-36"><a href="sec11_2.html#cb682-36" tabindex="-1"></a>bs_matrix_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(bs_matrix)</span>
<span id="cb682-37"><a href="sec11_2.html#cb682-37" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb682-38"><a href="sec11_2.html#cb682-38" tabindex="-1"></a><span class="fu">matplot</span>(xA, basis_matrix, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="fu">ncol</span>(basis_matrix)), <span class="at">ylab =</span> <span class="st">&quot;B-spline Basis&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Own function&quot;</span>)</span>
<span id="cb682-39"><a href="sec11_2.html#cb682-39" tabindex="-1"></a><span class="fu">matplot</span>(xA, bs_matrix_matrix, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="fu">ncol</span>(basis_matrix)), <span class="at">ylab =</span> <span class="st">&quot;B-spline Basis&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">main =</span> <span class="st">&quot;bs function&quot;</span>)</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-66-1.svg" width="672" /></p>
<p>The idea in splines is to calculate the linear combination of the <span class="math inline">\(H\)</span> B-splines, as those shown in the figure, that bets fit the dependent variable.</p>
<p>Splines can also be extended to non-linear models based on data augmentation, such as the probit and tobit models. Again, the basic idea is to incorporate splines into the implicit latent variables. <span class="citation">G. M. Koop (<a href="#ref-koop2003bayesian">2003</a>)</span> presents these extensions.</p>
<p>Let’s perform a simulation exercise to fix ideas.</p>
<p><strong>Simulation exercise: Splines</strong></p>
<p>Let’s assume that the data generating process is
<span class="math display">\[\begin{align*}
    y_i &amp; = 0.4 + 0.25\sin(8x_i - 5) + 0.4\exp(-16(4x_i - 2.5)^2) + \mu_i,
\end{align*}\]</span>
where <span class="math inline">\(\mu_i \sim N(0,0.15^2)\)</span>, and <span class="math inline">\(x_i\)</span> is a sequence in <span class="math inline">\((0,1)\)</span>, with 100 random draws of the pairs <span class="math inline">\((x_i, y_i)\)</span>. In addition, we choose the knots <span class="math inline">\(\left\{0, 0.25, 0.5, 0.75, 1\right\}\)</span>. We then calculate the cubic B-splines; however, we should take into account that the last two B-spline columns generate multicollinearity issues. Therefore, we exclude them when generating random realizations of the splines by drawing the coefficients from <span class="math inline">\(N(0, 0.35^2)\)</span>. The intercept is fixed to maintain the scale in the figure, where we observe the data points, <span class="math inline">\(f(x)\)</span>, and the different splines associated with various random realizations of the coefficients. The following code demonstrates how to perform this simulation.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="sec11_2.html#cb683-1" tabindex="-1"></a><span class="do">########### Simulation: B-splines ###########</span></span>
<span id="cb683-2"><a href="sec11_2.html#cb683-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb683-3"><a href="sec11_2.html#cb683-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2); <span class="fu">library</span>(splines)</span>
<span id="cb683-4"><a href="sec11_2.html#cb683-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">010101</span>)</span>
<span id="cb683-5"><a href="sec11_2.html#cb683-5" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb683-6"><a href="sec11_2.html#cb683-6" tabindex="-1"></a>ysignal <span class="ot">&lt;-</span> <span class="fl">0.4</span> <span class="sc">+</span> <span class="fl">0.25</span><span class="sc">*</span><span class="fu">sin</span>(<span class="dv">8</span><span class="sc">*</span>x <span class="sc">-</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fl">0.4</span><span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>(<span class="dv">4</span><span class="sc">*</span>x <span class="sc">-</span> <span class="fl">2.5</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb683-7"><a href="sec11_2.html#cb683-7" tabindex="-1"></a>sig <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb683-8"><a href="sec11_2.html#cb683-8" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(ysignal), <span class="dv">0</span>, <span class="at">sd =</span> sig)</span>
<span id="cb683-9"><a href="sec11_2.html#cb683-9" tabindex="-1"></a>y <span class="ot">&lt;-</span> ysignal <span class="sc">+</span> e</span>
<span id="cb683-10"><a href="sec11_2.html#cb683-10" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb683-11"><a href="sec11_2.html#cb683-11" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ysignal), N))</span>
<span id="cb683-12"><a href="sec11_2.html#cb683-12" tabindex="-1"></a>xobs <span class="ot">&lt;-</span> x[ids]</span>
<span id="cb683-13"><a href="sec11_2.html#cb683-13" tabindex="-1"></a>yobs <span class="ot">&lt;-</span> y[ids]</span>
<span id="cb683-14"><a href="sec11_2.html#cb683-14" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)</span>
<span id="cb683-15"><a href="sec11_2.html#cb683-15" tabindex="-1"></a>BS <span class="ot">&lt;-</span> <span class="fu">bs</span>(xobs, <span class="at">knots =</span> knots, <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">Boundary.knots =</span> <span class="fu">range</span>(x), <span class="at">intercept =</span> <span class="cn">FALSE</span>)</span>
<span id="cb683-16"><a href="sec11_2.html#cb683-16" tabindex="-1"></a><span class="co"># Splines</span></span>
<span id="cb683-17"><a href="sec11_2.html#cb683-17" tabindex="-1"></a>Spline1 <span class="ot">&lt;-</span> <span class="fl">0.56</span> <span class="sc">+</span> BS[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">%*%</span> <span class="fu">rnorm</span>(<span class="dv">6</span>, <span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb683-18"><a href="sec11_2.html#cb683-18" tabindex="-1"></a>Spline2 <span class="ot">&lt;-</span> <span class="fl">0.56</span> <span class="sc">+</span> BS[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">%*%</span> <span class="fu">rnorm</span>(<span class="dv">6</span>, <span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb683-19"><a href="sec11_2.html#cb683-19" tabindex="-1"></a>Spline3 <span class="ot">&lt;-</span> <span class="fl">0.56</span> <span class="sc">+</span> BS[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">%*%</span> <span class="fu">rnorm</span>(<span class="dv">6</span>, <span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb683-20"><a href="sec11_2.html#cb683-20" tabindex="-1"></a>Spline4 <span class="ot">&lt;-</span> <span class="fl">0.56</span> <span class="sc">+</span> BS[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">%*%</span> <span class="fu">rnorm</span>(<span class="dv">6</span>, <span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb683-21"><a href="sec11_2.html#cb683-21" tabindex="-1"></a><span class="co"># Create data frames for the true signal, observed data, and Splines</span></span>
<span id="cb683-22"><a href="sec11_2.html#cb683-22" tabindex="-1"></a>data_true_signal <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> ysignal, <span class="at">Type =</span> <span class="st">&quot;True Signal&quot;</span>)</span>
<span id="cb683-23"><a href="sec11_2.html#cb683-23" tabindex="-1"></a>data_obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xobs, <span class="at">y =</span> yobs, <span class="at">Type =</span> <span class="st">&quot;Observed Data&quot;</span>)</span>
<span id="cb683-24"><a href="sec11_2.html#cb683-24" tabindex="-1"></a><span class="co"># Create separate data frames for each Spline</span></span>
<span id="cb683-25"><a href="sec11_2.html#cb683-25" tabindex="-1"></a>data_Spline1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xobs, <span class="at">y =</span> Spline1, <span class="at">Type =</span> <span class="st">&quot;Spline 1&quot;</span>)</span>
<span id="cb683-26"><a href="sec11_2.html#cb683-26" tabindex="-1"></a>data_Spline2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xobs, <span class="at">y =</span> Spline2, <span class="at">Type =</span> <span class="st">&quot;Spline 2&quot;</span>)</span>
<span id="cb683-27"><a href="sec11_2.html#cb683-27" tabindex="-1"></a>data_Spline3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xobs, <span class="at">y =</span> Spline3, <span class="at">Type =</span> <span class="st">&quot;Spline 3&quot;</span>)</span>
<span id="cb683-28"><a href="sec11_2.html#cb683-28" tabindex="-1"></a>data_Spline4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xobs, <span class="at">y =</span> Spline4, <span class="at">Type =</span> <span class="st">&quot;Spline 4&quot;</span>)</span>
<span id="cb683-29"><a href="sec11_2.html#cb683-29" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_true_signal, data_obs, data_Spline1, data_Spline2, data_Spline3, data_Spline4)</span>
<span id="cb683-30"><a href="sec11_2.html#cb683-30" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;True Signal&quot;</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;True Signal&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;Observed Data&quot;</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Observed Data&quot;</span>), <span class="at">shape =</span> <span class="dv">16</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;Spline 1&quot;</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Splines&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;Spline 2&quot;</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Splines&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;Spline 3&quot;</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Splines&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;Spline 4&quot;</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Splines&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;True Signal&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>, <span class="st">&quot;Observed Data&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Splines&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;y&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Legend&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb683-31"><a href="sec11_2.html#cb683-31" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-67-1.svg" width="672" /></p>
<p>We can also use this simulation to examine the effect of changing the knots. The following code performs the fit using least squares, which is equivalent to using a non-informative prior in a Bayesian linear regression framework.</p>
<p>The figure illustrates the fit of different splines based on varying numbers of knots. We observe that increasing the number of knots enhances the flexibility of the spline, providing better local control. However, too many knots can result in a wiggly, overly complex fit that captures noise rather than the true underlying trend and may also increase multicollinearity. Therefore, selecting an appropriate number of knots is a crucial aspect of spline modeling. To address this issue, we can apply the strategies discussed in Chapter <a href="Chap10.html#Chap10">10</a>, and the strategies that will be discussed in the section of regularization in Chapter <a href="Chap12.html#Chap12">12</a>.</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="sec11_2.html#cb684-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb684-2"><a href="sec11_2.html#cb684-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2); <span class="fu">library</span>(splines)</span>
<span id="cb684-3"><a href="sec11_2.html#cb684-3" tabindex="-1"></a><span class="co"># Data generation</span></span>
<span id="cb684-4"><a href="sec11_2.html#cb684-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10101</span>)</span>
<span id="cb684-5"><a href="sec11_2.html#cb684-5" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb684-6"><a href="sec11_2.html#cb684-6" tabindex="-1"></a>ysignal <span class="ot">&lt;-</span> <span class="fl">0.4</span> <span class="sc">+</span> <span class="fl">0.25</span><span class="sc">*</span><span class="fu">sin</span>(<span class="dv">8</span><span class="sc">*</span>x <span class="sc">-</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fl">0.4</span><span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>(<span class="dv">4</span><span class="sc">*</span>x <span class="sc">-</span> <span class="fl">2.5</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb684-7"><a href="sec11_2.html#cb684-7" tabindex="-1"></a>sig <span class="ot">&lt;-</span> <span class="fl">0.15</span>; e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(ysignal), <span class="dv">0</span>, <span class="at">sd =</span> sig)</span>
<span id="cb684-8"><a href="sec11_2.html#cb684-8" tabindex="-1"></a>y <span class="ot">&lt;-</span> ysignal <span class="sc">+</span> e; N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb684-9"><a href="sec11_2.html#cb684-9" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ysignal), N))</span>
<span id="cb684-10"><a href="sec11_2.html#cb684-10" tabindex="-1"></a>xobs <span class="ot">&lt;-</span> x[ids]</span>
<span id="cb684-11"><a href="sec11_2.html#cb684-11" tabindex="-1"></a>yobs <span class="ot">&lt;-</span> y[ids]</span>
<span id="cb684-12"><a href="sec11_2.html#cb684-12" tabindex="-1"></a><span class="co"># Generate Fits with different knot placements</span></span>
<span id="cb684-13"><a href="sec11_2.html#cb684-13" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.33</span>), <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>), <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>))</span>
<span id="cb684-14"><a href="sec11_2.html#cb684-14" tabindex="-1"></a>Fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb684-15"><a href="sec11_2.html#cb684-15" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb684-16"><a href="sec11_2.html#cb684-16" tabindex="-1"></a>    BS <span class="ot">&lt;-</span> <span class="fu">bs</span>(xobs, <span class="at">knots =</span> knots_list[[i]], <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">Boundary.knots =</span> <span class="fu">range</span>(x), <span class="at">intercept =</span> <span class="cn">FALSE</span>)</span>
<span id="cb684-17"><a href="sec11_2.html#cb684-17" tabindex="-1"></a>    fm <span class="ot">&lt;-</span> <span class="fu">lm</span>(yobs <span class="sc">~</span> BS)</span>
<span id="cb684-18"><a href="sec11_2.html#cb684-18" tabindex="-1"></a>    Fits[[i]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm)</span>
<span id="cb684-19"><a href="sec11_2.html#cb684-19" tabindex="-1"></a>}</span>
<span id="cb684-20"><a href="sec11_2.html#cb684-20" tabindex="-1"></a><span class="co"># Create data frames</span></span>
<span id="cb684-21"><a href="sec11_2.html#cb684-21" tabindex="-1"></a>data_true_signal <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> ysignal, <span class="at">Type =</span> <span class="st">&quot;True Signal&quot;</span>)</span>
<span id="cb684-22"><a href="sec11_2.html#cb684-22" tabindex="-1"></a>data_obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xobs, <span class="at">y =</span> yobs, <span class="at">Type =</span> <span class="st">&quot;Observed Data&quot;</span>)</span>
<span id="cb684-23"><a href="sec11_2.html#cb684-23" tabindex="-1"></a>data_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb684-24"><a href="sec11_2.html#cb684-24" tabindex="-1"></a><span class="at">x =</span> <span class="fu">rep</span>(xobs, <span class="dv">4</span>),</span>
<span id="cb684-25"><a href="sec11_2.html#cb684-25" tabindex="-1"></a><span class="at">y =</span> <span class="fu">c</span>(Fits[[<span class="dv">1</span>]], Fits[[<span class="dv">2</span>]], Fits[[<span class="dv">3</span>]], Fits[[<span class="dv">4</span>]]),</span>
<span id="cb684-26"><a href="sec11_2.html#cb684-26" tabindex="-1"></a><span class="at">Type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Fit 1&quot;</span>, <span class="st">&quot;Fit 2&quot;</span>, <span class="st">&quot;Fit 3&quot;</span>, <span class="st">&quot;Fit 4&quot;</span>), <span class="at">each =</span> <span class="fu">length</span>(xobs))</span>
<span id="cb684-27"><a href="sec11_2.html#cb684-27" tabindex="-1"></a>)</span>
<span id="cb684-28"><a href="sec11_2.html#cb684-28" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_true_signal, data_obs, data_preds)</span>
<span id="cb684-29"><a href="sec11_2.html#cb684-29" tabindex="-1"></a></span>
<span id="cb684-30"><a href="sec11_2.html#cb684-30" tabindex="-1"></a><span class="co"># Create ggplot</span></span>
<span id="cb684-31"><a href="sec11_2.html#cb684-31" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> Type)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;True Signal&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, Type <span class="sc">==</span> <span class="st">&quot;Observed Data&quot;</span>), <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">subset</span>(data, <span class="fu">grepl</span>(<span class="st">&quot;Fit&quot;</span>, Type)), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;True Signal&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>, <span class="st">&quot;Observed Data&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Fit 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Fit 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;green&quot;</span>, <span class="st">&quot;Fit 3&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;Fit 4&quot;</span> <span class="ot">=</span> <span class="st">&quot;purple&quot;</span>)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;y&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb684-32"><a href="sec11_2.html#cb684-32" tabindex="-1"></a><span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-68-1.svg" width="672" /></p>
<p>Note that splines use local information to perform the fit. This implies the <em>curse of dimensionality</em> issue, where increasing the number of variables leads to more dispersed regions in the regressor space. In other words, the observations become increasingly further apart as we have more regressors. As a result, splines become less reliable in high-dimensional spaces.</p>
<p>A strategy to overcome the curse of dimensionality is to specify the <em>partial linear model</em>:
<span class="math display" id="eq:3ch11">\[\begin{align}
    y_i &amp; = \boldsymbol{z}_i^{\top}\boldsymbol{\gamma} + f(x_i) + \mu_i.
    \tag{11.2}
\end{align}\]</span>
In this specification, some regressors enter in a linear way, while potentially the most relevant regressor — the one under primary investigation — enters in a non-parametric way. Note that we only need to increase the dimension of the matrix <span class="math inline">\(\boldsymbol{W}\)</span> by adding the columns from <span class="math inline">\(\boldsymbol{z}\)</span>, and proceed as we did previously.</p>
<p><strong>Example: Consumption of marijuana in Colombia continues</strong></p>
<p>Let’s continue using the dataset <em>MarijuanaColombia.csv</em> to perform a partial linear model as in Equation <a href="sec11_2.html#eq:3ch11">(11.2)</a>, where <span class="math inline">\(y_i\)</span> is the (log) marijuana monthly consumption, <span class="math inline">\(\boldsymbol{z}_i\)</span> represents the presence of a drug dealer in the neighborhood (<em>Dealer</em>), gender (<em>Female</em>), indicators of good physical and mental health (<em>PhysicalHealthGood</em> and <em>MentalHealthGood</em>), years of education (<em>YearsEducation</em>), and the (log) prices of marijuana, cocaine, and crack by individual.</p>
<p>We set the knots as the percentiles <span class="math inline">\(\left\{0,0.05,\dots,0.95,1\right\}\)</span> of age, use cubic B-splines, non-informative conjugate priors in the linear regression model, 5,000 MCMC iterations, and 5,000 burn-in iterations.</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="sec11_2.html#cb685-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()); <span class="fu">set.seed</span>(<span class="dv">010101</span>)</span>
<span id="cb685-2"><a href="sec11_2.html#cb685-2" tabindex="-1"></a><span class="fu">library</span>(splines); <span class="fu">library</span>(ggplot2)</span>
<span id="cb685-3"><a href="sec11_2.html#cb685-3" tabindex="-1"></a>Data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/BEsmarter-consultancy/BSTApp/refs/heads/master/DataApp/MarijuanaColombia.csv&quot;</span>)</span>
<span id="cb685-4"><a href="sec11_2.html#cb685-4" tabindex="-1"></a><span class="fu">attach</span>(Data)</span></code></pre></div>
<pre><code>## The following objects are masked from Data (pos = 4):
## 
##     Age, Age2, Dealer, Female, LogMarijuana, LogPriceCocaine,
##     LogPriceCrack, LogPriceMarijuana, MentalHealthGood,
##     PhysicalHealthGood, YearsEducation</code></pre>
<pre><code>## The following object is masked from Data (pos = 7):
## 
##     Age</code></pre>
<pre><code>## The following objects are masked from Data (pos = 15):
## 
##     Age, Female</code></pre>
<pre><code>## The following objects are masked from Data (pos = 19):
## 
##     Age, Age2</code></pre>
<pre><code>## The following objects are masked from Data (pos = 20):
## 
##     Age, Age2</code></pre>
<pre><code>## The following objects are masked from Data (pos = 21):
## 
##     Age, Age2, Female</code></pre>
<pre><code>## The following objects are masked from mydata:
## 
##     Age, Age2, Female</code></pre>
<pre><code>## The following objects are masked from Data (pos = 23):
## 
##     Age, Age2</code></pre>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="sec11_2.html#cb694-1" tabindex="-1"></a>IdOrd <span class="ot">&lt;-</span> <span class="fu">order</span>(Age) </span>
<span id="cb694-2"><a href="sec11_2.html#cb694-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> LogMarijuana[IdOrd]</span>
<span id="cb694-3"><a href="sec11_2.html#cb694-3" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(Data[IdOrd,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>)]))</span>
<span id="cb694-4"><a href="sec11_2.html#cb694-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> Age[IdOrd] </span>
<span id="cb694-5"><a href="sec11_2.html#cb694-5" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb694-6"><a href="sec11_2.html#cb694-6" tabindex="-1"></a>BS <span class="ot">&lt;-</span> <span class="fu">bs</span>(x, <span class="at">knots =</span> knots, <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">Boundary.knots =</span> <span class="fu">range</span>(x), <span class="at">intercept =</span> <span class="cn">FALSE</span>)</span>
<span id="cb694-7"><a href="sec11_2.html#cb694-7" tabindex="-1"></a><span class="fu">matplot</span>(x, BS, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="fu">ncol</span>(BS)))</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-69-1.svg" width="672" /></p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="sec11_2.html#cb695-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, BS[,<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>], Z) <span class="co"># Get B-splines without multicollinearity issues</span></span>
<span id="cb695-2"><a href="sec11_2.html#cb695-2" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>]; N <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">1</span>]</span>
<span id="cb695-3"><a href="sec11_2.html#cb695-3" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb695-4"><a href="sec11_2.html#cb695-4" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> <span class="fl">0.001</span>; a0 <span class="ot">&lt;-</span> <span class="fl">0.001</span></span>
<span id="cb695-5"><a href="sec11_2.html#cb695-5" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, k); c0 <span class="ot">&lt;-</span> <span class="dv">1000</span>; B0 <span class="ot">&lt;-</span> c0<span class="sc">*</span><span class="fu">diag</span>(k); B0i <span class="ot">&lt;-</span> <span class="fu">solve</span>(B0)</span>
<span id="cb695-6"><a href="sec11_2.html#cb695-6" tabindex="-1"></a><span class="co"># MCMC parameters</span></span>
<span id="cb695-7"><a href="sec11_2.html#cb695-7" tabindex="-1"></a>mcmc <span class="ot">&lt;-</span> <span class="dv">5000</span>; burnin <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb695-8"><a href="sec11_2.html#cb695-8" tabindex="-1"></a>tot <span class="ot">&lt;-</span> mcmc <span class="sc">+</span> burnin; thin <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb695-9"><a href="sec11_2.html#cb695-9" tabindex="-1"></a>posterior  <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">MCMCregress</span>(y<span class="sc">~</span>X<span class="dv">-1</span>, <span class="at">b0=</span>b0, <span class="at">B0 =</span> B0i, <span class="at">c0 =</span> a0, <span class="at">d0 =</span> d0, <span class="at">burnin =</span> burnin, <span class="at">mcmc =</span> mcmc, <span class="at">thin =</span> thin)</span>
<span id="cb695-10"><a href="sec11_2.html#cb695-10" tabindex="-1"></a><span class="fu">summary</span>(coda<span class="sc">::</span><span class="fu">mcmc</span>(posterior))</span></code></pre></div>
<pre><code>## 
## Iterations = 1:5000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 5000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##                          Mean      SD  Naive SE Time-series SE
## X                    4.762070 1.59464 0.0225517      0.0225517
## X1                   0.414460 1.14161 0.0161448      0.0161448
## X2                  -0.434707 1.32159 0.0186902      0.0182422
## X3                   1.200738 1.07888 0.0152577      0.0152577
## X4                   1.373621 0.85336 0.0120684      0.0120684
## X5                   1.676279 0.88480 0.0125129      0.0125129
## X6                   1.220783 0.85900 0.0121481      0.0121481
## X7                   1.241079 0.87359 0.0123544      0.0120724
## X8                   1.816973 0.86389 0.0122173      0.0122173
## X9                   1.773895 0.84875 0.0120031      0.0120031
## X10                  1.262535 0.85882 0.0121456      0.0118736
## X11                  1.458600 0.86801 0.0122755      0.0122755
## X12                  1.694007 0.89295 0.0126283      0.0122990
## X13                  0.969907 0.87151 0.0123250      0.0123250
## X14                  2.020513 0.88300 0.0124875      0.0124875
## X15                  2.096505 0.85861 0.0121426      0.0121426
## X16                  1.075789 0.88201 0.0124735      0.0121409
## X17                  2.271827 0.87125 0.0123214      0.0120323
## X18                  1.613481 0.90826 0.0128448      0.0128448
## X19                  1.649940 0.86303 0.0122050      0.0119253
## X20                  1.795846 0.99558 0.0140796      0.0140796
## X21                  0.551177 0.95249 0.0134702      0.0134702
## X22                  1.578060 1.52457 0.0215607      0.0215607
## XLogPriceMarijuana  -0.548236 0.07428 0.0010505      0.0010505
## XLogPriceCocaine     0.004347 0.09533 0.0013481      0.0013481
## XLogPriceCrack       0.230243 0.09680 0.0013689      0.0013689
## XYearsEducation     -0.108868 0.01382 0.0001955      0.0001955
## XDealer              0.283355 0.09489 0.0013419      0.0012233
## XFemale             -0.524882 0.10884 0.0015392      0.0015392
## XPhysicalHealthGood -0.104649 0.12127 0.0017151      0.0017444
## XMentalHealthGood    0.068732 0.10384 0.0014685      0.0014685
## sigma2               2.428064 0.10092 0.0014272      0.0014272
## 
## 2. Quantiles for each variable:
## 
##                         2.5%        25%       50%      75%    97.5%
## X                    1.55699  3.7175175  4.739009  5.80172  7.92279
## X1                  -1.79003 -0.3583041  0.398603  1.19511  2.64498
## X2                  -2.99804 -1.3469332 -0.448332  0.46987  2.14830
## X3                  -0.92834  0.4836180  1.196875  1.92378  3.34203
## X4                  -0.28717  0.7970619  1.376339  1.93079  3.08974
## X5                  -0.05263  1.0887515  1.686176  2.25558  3.41183
## X6                  -0.42825  0.6494850  1.217303  1.79922  2.95536
## X7                  -0.46407  0.6662542  1.239668  1.82647  2.96068
## X8                   0.13876  1.2494689  1.812351  2.40049  3.53973
## X9                   0.14501  1.1917504  1.776206  2.33589  3.43701
## X10                 -0.40892  0.6947791  1.272198  1.82679  2.96285
## X11                 -0.23940  0.8657272  1.456057  2.05675  3.20787
## X12                 -0.06415  1.1114082  1.714477  2.27762  3.45773
## X13                 -0.72303  0.3695078  0.978630  1.55659  2.69103
## X14                  0.27912  1.4376210  2.018344  2.60509  3.77226
## X15                  0.41493  1.5289959  2.098777  2.66159  3.80006
## X16                 -0.59638  0.4805844  1.064190  1.67853  2.82543
## X17                  0.58853  1.6874131  2.267223  2.85066  3.98668
## X18                 -0.17849  0.9960272  1.618077  2.20946  3.45835
## X19                 -0.01256  1.0733493  1.640711  2.21205  3.34662
## X20                 -0.15662  1.1339269  1.789473  2.45008  3.75248
## X21                 -1.28909 -0.1001288  0.544697  1.20134  2.43123
## X22                 -1.51384  0.5779855  1.564216  2.59474  4.62015
## XLogPriceMarijuana  -0.69875 -0.5969960 -0.547761 -0.49908 -0.40337
## XLogPriceCocaine    -0.18313 -0.0562270  0.002893  0.06634  0.19409
## XLogPriceCrack       0.03801  0.1655022  0.230836  0.29429  0.42126
## XYearsEducation     -0.13605 -0.1180723 -0.108845 -0.09958 -0.08225
## XDealer              0.09831  0.2186432  0.284203  0.34647  0.47046
## XFemale             -0.73478 -0.5975294 -0.523892 -0.45189 -0.30925
## XPhysicalHealthGood -0.33999 -0.1863400 -0.105786 -0.02289  0.13607
## XMentalHealthGood   -0.13261 -0.0005379  0.066461  0.13917  0.27269
## sigma2               2.23758  2.3591542  2.424957  2.49384  2.63860</code></pre>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="sec11_2.html#cb697-1" tabindex="-1"></a><span class="co"># Predict values with 95% credible intervals</span></span>
<span id="cb697-2"><a href="sec11_2.html#cb697-2" tabindex="-1"></a>xfit <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="fl">0.2</span>)</span>
<span id="cb697-3"><a href="sec11_2.html#cb697-3" tabindex="-1"></a>H <span class="ot">&lt;-</span> <span class="fu">length</span>(xfit)</span>
<span id="cb697-4"><a href="sec11_2.html#cb697-4" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">1</span>)</span>
<span id="cb697-5"><a href="sec11_2.html#cb697-5" tabindex="-1"></a>idfit <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N, H)</span>
<span id="cb697-6"><a href="sec11_2.html#cb697-6" tabindex="-1"></a>BSfit <span class="ot">&lt;-</span> <span class="fu">bs</span>(xfit, <span class="at">knots =</span> knots, <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">Boundary.knots =</span> <span class="fu">range</span>(x), <span class="at">intercept =</span> <span class="cn">FALSE</span>)</span>
<span id="cb697-7"><a href="sec11_2.html#cb697-7" tabindex="-1"></a>Xfit <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, BSfit[,<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>], Z[<span class="fu">rep</span>(i, H),]) <span class="co"># Relevant regressors, PIP &gt; 0.5</span></span>
<span id="cb697-8"><a href="sec11_2.html#cb697-8" tabindex="-1"></a>Fit <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, mcmc, H)</span>
<span id="cb697-9"><a href="sec11_2.html#cb697-9" tabindex="-1"></a><span class="co"># posterior[posterior &gt; 0] &lt;- 0</span></span>
<span id="cb697-10"><a href="sec11_2.html#cb697-10" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>mcmc){</span>
<span id="cb697-11"><a href="sec11_2.html#cb697-11" tabindex="-1"></a>    Fit[s,] <span class="ot">&lt;-</span> Xfit<span class="sc">%*%</span>posterior[s,<span class="dv">1</span><span class="sc">:</span><span class="dv">31</span>]</span>
<span id="cb697-12"><a href="sec11_2.html#cb697-12" tabindex="-1"></a>}</span>
<span id="cb697-13"><a href="sec11_2.html#cb697-13" tabindex="-1"></a><span class="co"># Create a data frame for ggplot</span></span>
<span id="cb697-14"><a href="sec11_2.html#cb697-14" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xfit, <span class="at">fit =</span> <span class="fu">colMeans</span>(Fit), <span class="at">liminf =</span> <span class="fu">apply</span>(Fit, <span class="dv">2</span>, quantile, <span class="fl">0.025</span>), <span class="at">limsup =</span> <span class="fu">apply</span>(Fit, <span class="dv">2</span>, quantile, <span class="fl">0.975</span>))</span>
<span id="cb697-15"><a href="sec11_2.html#cb697-15" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> plot_data, <span class="fu">aes</span>(x, fit), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">data =</span> plot_data, <span class="fu">aes</span>(x, <span class="at">ymin =</span> liminf, <span class="at">ymax =</span> limsup), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;B-Spline Regression with 95% Confidence Interval&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Log Marijuana&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="BayesianEconometrics_files/figure-html/unnamed-chunk-69-2.svg" width="672" /></p>
<p>The previous code illustrates the procedure. The posterior 95% credible intervals indicate that marijuana is an inelastic good, there is substitution between marijuana and crack, more educated female individuals consume less, and the presence of a drug dealer in the neighborhood increases consumption.</p>
<p>The figure shows the fitted spline, specifically the mean (blue line) and the 95% credible intervals (shaded blue). Notice that there is a lot of wiggliness due to the use of many knots, suggesting that this relationship could be expressed in a more parsimonious way. In Exercise 7, we ask to use variable selection methods, such as the BIC approximation presented in Chapter <a href="Chap10.html#Chap10">10</a>, to perform regressor selection, particularly for the splines.</p>
<p>In general, the selection of <span class="math inline">\(H\)</span> is a problem of variable selection (regressor uncertainty) and can be handled using other approaches, such as those discussed in the regularization section of the following chapter.</p>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-koop2003bayesian" class="csl-entry">
Koop, Gary M. 2003. <em>Bayesian Econometrics</em>. John Wiley &amp; Sons Inc.
</div>
<div id="ref-BMCP2021" class="csl-entry">
Martin, Osvaldo A., Ravin Kumar, and Junpeng Lao. 2021. <em><span class="nocase">Bayesian Modeling and Computation in Python</span></em>. <span>Boca Raton</span>: publisher=<span>Chapman and Hall/CRC</span>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec11_1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec11_3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/aramir21/IntroductionBayesianEconometricsBook/12-Nonparametric.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
