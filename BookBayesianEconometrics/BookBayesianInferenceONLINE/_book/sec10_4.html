<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10.4 Calculating the marginal likelihood | Introduction to Bayesian Data Modeling</title>
  <meta name="description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="10.4 Calculating the marginal likelihood | Introduction to Bayesian Data Modeling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="github-repo" content="https://github.com/aramir21/IntroductionBayesianEconometricsBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10.4 Calculating the marginal likelihood | Introduction to Bayesian Data Modeling" />
  
  <meta name="twitter:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  

<meta name="author" content="Andrés Ramírez-Hassan" />


<meta name="date" content="2025-02-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec103.html"/>
<link rel="next" href="sec10_5.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Bayesian Econometrics: A GUIded tour using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="to-instructors-and-students.html"><a href="to-instructors-and-students.html"><i class="fa fa-check"></i>To instructors and students</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Chap1.html"><a href="Chap1.html"><i class="fa fa-check"></i><b>1</b> Basic formal concepts</a>
<ul>
<li class="chapter" data-level="1.1" data-path="sec11.html"><a href="sec11.html"><i class="fa fa-check"></i><b>1.1</b> The Bayes’ rule</a></li>
<li class="chapter" data-level="1.2" data-path="sec12.html"><a href="sec12.html"><i class="fa fa-check"></i><b>1.2</b> Bayesian framework: A brief summary of theory</a></li>
<li class="chapter" data-level="1.3" data-path="sec14.html"><a href="sec14.html"><i class="fa fa-check"></i><b>1.3</b> Bayesian reports: Decision theory under uncertainty</a></li>
<li class="chapter" data-level="1.4" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
<li class="chapter" data-level="1.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chap2.html"><a href="Chap2.html"><i class="fa fa-check"></i><b>2</b> Conceptual differences between the Bayesian and Frequentist approaches</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec21.html"><a href="sec21.html"><i class="fa fa-check"></i><b>2.1</b> The concept of probability</a></li>
<li class="chapter" data-level="2.2" data-path="sec22.html"><a href="sec22.html"><i class="fa fa-check"></i><b>2.2</b> Subjectivity is not the key</a></li>
<li class="chapter" data-level="2.3" data-path="sec23.html"><a href="sec23.html"><i class="fa fa-check"></i><b>2.3</b> Estimation, hypothesis testing and prediction</a></li>
<li class="chapter" data-level="2.4" data-path="sec24.html"><a href="sec24.html"><i class="fa fa-check"></i><b>2.4</b> The likelihood principle</a></li>
<li class="chapter" data-level="2.5" data-path="sec25.html"><a href="sec25.html"><i class="fa fa-check"></i><b>2.5</b> Why is not the Bayesian approach that popular?</a></li>
<li class="chapter" data-level="2.6" data-path="sec26.html"><a href="sec26.html"><i class="fa fa-check"></i><b>2.6</b> A simple working example</a></li>
<li class="chapter" data-level="2.7" data-path="sec27.html"><a href="sec27.html"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
<li class="chapter" data-level="2.8" data-path="sec28.html"><a href="sec28.html"><i class="fa fa-check"></i><b>2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chap3.html"><a href="Chap3.html"><i class="fa fa-check"></i><b>3</b> Cornerstone models: Conjugate families</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec41.html"><a href="sec41.html"><i class="fa fa-check"></i><b>3.1</b> Motivation of conjugate families</a></li>
<li class="chapter" data-level="3.2" data-path="sec42.html"><a href="sec42.html"><i class="fa fa-check"></i><b>3.2</b> Conjugate prior to exponential family</a></li>
<li class="chapter" data-level="3.3" data-path="sec43.html"><a href="sec43.html"><i class="fa fa-check"></i><b>3.3</b> Linear regression: The conjugate normal-normal/inverse gamma model</a></li>
<li class="chapter" data-level="3.4" data-path="sec44.html"><a href="sec44.html"><i class="fa fa-check"></i><b>3.4</b> Multivariate linear regression: The conjugate normal-normal/inverse Wishart model</a></li>
<li class="chapter" data-level="3.5" data-path="computational-examples.html"><a href="computational-examples.html"><i class="fa fa-check"></i><b>3.5</b> Computational examples</a></li>
<li class="chapter" data-level="3.6" data-path="summary-chapter-4.html"><a href="summary-chapter-4.html"><i class="fa fa-check"></i><b>3.6</b> Summary: Chapter 4</a></li>
<li class="chapter" data-level="3.7" data-path="exercises-chapter-4.html"><a href="exercises-chapter-4.html"><i class="fa fa-check"></i><b>3.7</b> Exercises: Chapter 4</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chap4.html"><a href="Chap4.html"><i class="fa fa-check"></i><b>4</b> Simulation methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec51.html"><a href="sec51.html"><i class="fa fa-check"></i><b>4.1</b> Markov Chain Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="sec51.html"><a href="sec51.html#sec511"><i class="fa fa-check"></i><b>4.1.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="4.1.2" data-path="sec51.html"><a href="sec51.html#sec512"><i class="fa fa-check"></i><b>4.1.2</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="4.1.3" data-path="sec51.html"><a href="sec51.html#sec513"><i class="fa fa-check"></i><b>4.1.3</b> Hamiltonian Monte Carlo</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sec52.html"><a href="sec52.html"><i class="fa fa-check"></i><b>4.2</b> Importance sampling</a></li>
<li class="chapter" data-level="4.3" data-path="sec53.html"><a href="sec53.html"><i class="fa fa-check"></i><b>4.3</b> Particle filtering</a></li>
<li class="chapter" data-level="4.4" data-path="sec54.html"><a href="sec54.html"><i class="fa fa-check"></i><b>4.4</b> Convergence diagnostics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="sec54.html"><a href="sec54.html#numerical-standard-error"><i class="fa fa-check"></i><b>4.4.1</b> Numerical standard error</a></li>
<li class="chapter" data-level="4.4.2" data-path="sec54.html"><a href="sec54.html#effective-number-of-simulation-draws"><i class="fa fa-check"></i><b>4.4.2</b> Effective number of simulation draws</a></li>
<li class="chapter" data-level="4.4.3" data-path="sec54.html"><a href="sec54.html#tests-of-convergence"><i class="fa fa-check"></i><b>4.4.3</b> Tests of convergence</a></li>
<li class="chapter" data-level="4.4.4" data-path="sec54.html"><a href="sec54.html#checking-for-errors-in-the-posterior-simulator"><i class="fa fa-check"></i><b>4.4.4</b> Checking for errors in the posterior simulator</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="sec55.html"><a href="sec55.html"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
<li class="chapter" data-level="4.6" data-path="sec56.html"><a href="sec56.html"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chap5.html"><a href="Chap5.html"><i class="fa fa-check"></i><b>5</b> Graphical user interface</a></li>
<li class="chapter" data-level="6" data-path="Chap6.html"><a href="Chap6.html"><i class="fa fa-check"></i><b>6</b> Univariate regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec61.html"><a href="sec61.html"><i class="fa fa-check"></i><b>6.1</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="6.2" data-path="sec62.html"><a href="sec62.html"><i class="fa fa-check"></i><b>6.2</b> The logit model</a></li>
<li class="chapter" data-level="6.3" data-path="sec63.html"><a href="sec63.html"><i class="fa fa-check"></i><b>6.3</b> The probit model</a></li>
<li class="chapter" data-level="6.4" data-path="sec64.html"><a href="sec64.html"><i class="fa fa-check"></i><b>6.4</b> The multinomial probit model</a></li>
<li class="chapter" data-level="6.5" data-path="sec65.html"><a href="sec65.html"><i class="fa fa-check"></i><b>6.5</b> The multinomial logit model</a></li>
<li class="chapter" data-level="6.6" data-path="sec66.html"><a href="sec66.html"><i class="fa fa-check"></i><b>6.6</b> Ordered probit model</a></li>
<li class="chapter" data-level="6.7" data-path="negative-binomial-model.html"><a href="negative-binomial-model.html"><i class="fa fa-check"></i><b>6.7</b> Negative binomial model</a></li>
<li class="chapter" data-level="6.8" data-path="sec68.html"><a href="sec68.html"><i class="fa fa-check"></i><b>6.8</b> Tobit model</a></li>
<li class="chapter" data-level="6.9" data-path="sec69.html"><a href="sec69.html"><i class="fa fa-check"></i><b>6.9</b> Quantile regression</a></li>
<li class="chapter" data-level="6.10" data-path="sec610.html"><a href="sec610.html"><i class="fa fa-check"></i><b>6.10</b> Bayesian bootstrap regression</a></li>
<li class="chapter" data-level="6.11" data-path="sec611.html"><a href="sec611.html"><i class="fa fa-check"></i><b>6.11</b> Summary</a></li>
<li class="chapter" data-level="6.12" data-path="sec612.html"><a href="sec612.html"><i class="fa fa-check"></i><b>6.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chap7.html"><a href="Chap7.html"><i class="fa fa-check"></i><b>7</b> Multivariate regression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec71.html"><a href="sec71.html"><i class="fa fa-check"></i><b>7.1</b> Multivariate regression</a></li>
<li class="chapter" data-level="7.2" data-path="sec72.html"><a href="sec72.html"><i class="fa fa-check"></i><b>7.2</b> Seemingly Unrelated Regression</a></li>
<li class="chapter" data-level="7.3" data-path="sec73.html"><a href="sec73.html"><i class="fa fa-check"></i><b>7.3</b> Instrumental variable</a></li>
<li class="chapter" data-level="7.4" data-path="sec74.html"><a href="sec74.html"><i class="fa fa-check"></i><b>7.4</b> Multivariate probit model</a></li>
<li class="chapter" data-level="7.5" data-path="sec75.html"><a href="sec75.html"><i class="fa fa-check"></i><b>7.5</b> Summary</a></li>
<li class="chapter" data-level="7.6" data-path="sec76.html"><a href="sec76.html"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chap8.html"><a href="Chap8.html"><i class="fa fa-check"></i><b>8</b> Time series</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec81.html"><a href="sec81.html"><i class="fa fa-check"></i><b>8.1</b> State-space representation</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="sec81.html"><a href="sec81.html#gaussian-linear-state-space-models"><i class="fa fa-check"></i><b>8.1.1</b> Gaussian linear state-space models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="sec82.html"><a href="sec82.html"><i class="fa fa-check"></i><b>8.2</b> ARMA processes</a></li>
<li class="chapter" data-level="8.3" data-path="sec83.html"><a href="sec83.html"><i class="fa fa-check"></i><b>8.3</b> Stochastic volatility models</a></li>
<li class="chapter" data-level="8.4" data-path="sec84.html"><a href="sec84.html"><i class="fa fa-check"></i><b>8.4</b> Vector Autoregressive models</a></li>
<li class="chapter" data-level="8.5" data-path="sec85.html"><a href="sec85.html"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
<li class="chapter" data-level="8.6" data-path="sec86.html"><a href="sec86.html"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chap9.html"><a href="Chap9.html"><i class="fa fa-check"></i><b>9</b> Longitudinal regression</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec91.html"><a href="sec91.html"><i class="fa fa-check"></i><b>9.1</b> Normal model</a></li>
<li class="chapter" data-level="9.2" data-path="sec92.html"><a href="sec92.html"><i class="fa fa-check"></i><b>9.2</b> Logit model</a></li>
<li class="chapter" data-level="9.3" data-path="sec93.html"><a href="sec93.html"><i class="fa fa-check"></i><b>9.3</b> Poisson model</a></li>
<li class="chapter" data-level="9.4" data-path="sec94.html"><a href="sec94.html"><i class="fa fa-check"></i><b>9.4</b> Summary</a></li>
<li class="chapter" data-level="9.5" data-path="sec95.html"><a href="sec95.html"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Chap10.html"><a href="Chap10.html"><i class="fa fa-check"></i><b>10</b> Bayesian model averaging in variable selection</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec10_1.html"><a href="sec10_1.html"><i class="fa fa-check"></i><b>10.1</b> Foundation</a></li>
<li class="chapter" data-level="10.2" data-path="sec102.html"><a href="sec102.html"><i class="fa fa-check"></i><b>10.2</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="10.3" data-path="sec103.html"><a href="sec103.html"><i class="fa fa-check"></i><b>10.3</b> Generalized linear models</a></li>
<li class="chapter" data-level="10.4" data-path="sec10_4.html"><a href="sec10_4.html"><i class="fa fa-check"></i><b>10.4</b> Calculating the marginal likelihood</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_1"><i class="fa fa-check"></i><b>10.4.1</b> Savage-Dickey density ratio</a></li>
<li class="chapter" data-level="10.4.2" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_2"><i class="fa fa-check"></i><b>10.4.2</b> Chib’s methods</a></li>
<li class="chapter" data-level="10.4.3" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_3"><i class="fa fa-check"></i><b>10.4.3</b> Gelfand-Dey method</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="sec10_5.html"><a href="sec10_5.html"><i class="fa fa-check"></i><b>10.5</b> Summary</a></li>
<li class="chapter" data-level="10.6" data-path="sec10_6.html"><a href="sec10_6.html"><i class="fa fa-check"></i><b>10.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Chap11.html"><a href="Chap11.html"><i class="fa fa-check"></i><b>11</b> Semi-parametric and non-parametric models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec11_1.html"><a href="sec11_1.html"><i class="fa fa-check"></i><b>11.1</b> Mixture models</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="sec11_1.html"><a href="sec11_1.html#sec11_11"><i class="fa fa-check"></i><b>11.1.1</b> Finite Gaussian mixtures</a></li>
<li class="chapter" data-level="11.1.2" data-path="sec11_1.html"><a href="sec11_1.html#sec11_12"><i class="fa fa-check"></i><b>11.1.2</b> Dirichlet processes</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="sec11_2.html"><a href="sec11_2.html"><i class="fa fa-check"></i><b>11.2</b> Non-parametric generalized additive models</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Chap12.html"><a href="Chap12.html"><i class="fa fa-check"></i><b>12</b> Machine learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sec12_1.html"><a href="sec12_1.html"><i class="fa fa-check"></i><b>12.1</b> Cross validation and Bayes factors</a></li>
<li class="chapter" data-level="12.2" data-path="sec12_2.html"><a href="sec12_2.html"><i class="fa fa-check"></i><b>12.2</b> Regularization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="sec12_2.html"><a href="sec12_2.html#sec12_21"><i class="fa fa-check"></i><b>12.2.1</b> Bayesian LASSO</a></li>
<li class="chapter" data-level="12.2.2" data-path="sec12_2.html"><a href="sec12_2.html#sec12_22"><i class="fa fa-check"></i><b>12.2.2</b> Stochastic search variable selection</a></li>
<li class="chapter" data-level="12.2.3" data-path="sec12_2.html"><a href="sec12_2.html#sec12_23"><i class="fa fa-check"></i><b>12.2.3</b> Non-local priors</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="sec12_3.html"><a href="sec12_3.html"><i class="fa fa-check"></i><b>12.3</b> Bayesian additive regression trees</a></li>
<li class="chapter" data-level="12.4" data-path="sec12_4.html"><a href="sec12_4.html"><i class="fa fa-check"></i><b>12.4</b> Gaussian processes</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Chap13.html"><a href="Chap13.html"><i class="fa fa-check"></i><b>13</b> Causal inference</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec13_1.html"><a href="sec13_1.html"><i class="fa fa-check"></i><b>13.1</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="sec13_1.html"><a href="sec13_1.html#sec13_11"><i class="fa fa-check"></i><b>13.1.1</b> Semi-parametric IV model</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="sec13_2.html"><a href="sec13_2.html"><i class="fa fa-check"></i><b>13.2</b> Regression discontinuity design</a></li>
<li class="chapter" data-level="13.3" data-path="sec13_3.html"><a href="sec13_3.html"><i class="fa fa-check"></i><b>13.3</b> Regression kink design</a></li>
<li class="chapter" data-level="13.4" data-path="sec13_4.html"><a href="sec13_4.html"><i class="fa fa-check"></i><b>13.4</b> Synthetic control</a></li>
<li class="chapter" data-level="13.5" data-path="sec13_5.html"><a href="sec13_5.html"><i class="fa fa-check"></i><b>13.5</b> Difference in difference estimation</a></li>
<li class="chapter" data-level="13.6" data-path="sec13_6.html"><a href="sec13_6.html"><i class="fa fa-check"></i><b>13.6</b> Event Analysis</a></li>
<li class="chapter" data-level="13.7" data-path="sec13_7.html"><a href="sec13_7.html"><i class="fa fa-check"></i><b>13.7</b> Bayesian exponential tilted empirical likelihood</a></li>
<li class="chapter" data-level="13.8" data-path="sec13_8.html"><a href="sec13_8.html"><i class="fa fa-check"></i><b>13.8</b> Double-Debiased machine learning causal effects</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Chap14.html"><a href="Chap14.html"><i class="fa fa-check"></i><b>14</b> Approximation methods</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sec14_1.html"><a href="sec14_1.html"><i class="fa fa-check"></i><b>14.1</b> Approximate Bayesian computation</a></li>
<li class="chapter" data-level="14.2" data-path="sec14_2.html"><a href="sec14_2.html"><i class="fa fa-check"></i><b>14.2</b> Bayesian synthetic likelihood</a></li>
<li class="chapter" data-level="14.3" data-path="sec14_3.html"><a href="sec14_3.html"><i class="fa fa-check"></i><b>14.3</b> Expectation propagation</a></li>
<li class="chapter" data-level="14.4" data-path="sec14_4.html"><a href="sec14_4.html"><i class="fa fa-check"></i><b>14.4</b> Integrated nested Laplace approximations</a></li>
<li class="chapter" data-level="14.5" data-path="sec14_5.html"><a href="sec14_5.html"><i class="fa fa-check"></i><b>14.5</b> Variational Bayes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bayesian Data Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec10_4" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Calculating the marginal likelihood<a href="sec10_4.html#sec10_4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The BIC is an asymptotic approximation of the marginal likelihood, and consequently, it is used to obtain the Bayes factors. However, this method has limitations in applications with moderate and small sample sizes <span class="citation">(<a href="#ref-gelfand1994bayesian">Gelfand and Dey 1994</a>)</span>. Therefore, other methods are available to calculate the Bayes factors when there is no analytical solution for the marginal likelihood.</p>
<p>Observe that calculating the Bayes factor with respect to a reference model (<span class="math inline">\(\mathcal{M}_0\)</span>) helps to obtain the posterior model probabilities,</p>
<p><span class="math display">\[\begin{align*}
    \pi(\mathcal{M}_j |\boldsymbol{y})&amp;=\frac{p(\boldsymbol{y} | \mathcal{M}_j)\pi(\mathcal{M}_j)}{\sum_{m=1}^{M}p(\boldsymbol{y} | \mathcal{M}_m)\pi(\mathcal{M}_m)}\\
    &amp;=\frac{p(\boldsymbol{y} | \mathcal{M}_j)\pi(\mathcal{M}_j)/p(\boldsymbol{y} | \mathcal{M}_0)}{\sum_{m=1}^{M}p(\boldsymbol{y} | \mathcal{M}_m)\pi(\mathcal{M}_m)/p(\boldsymbol{y} | \mathcal{M}_0)}\\
    &amp;=\frac{BF_{j0}\times\pi(\mathcal{M}_j)}{\sum_{m=1}^{M}BF_{l0}\times\pi(\mathcal{M}_l)}.
\end{align*}\]</span></p>
<p>Thus, <span class="math inline">\(\pi(\mathcal{M}_j |\boldsymbol{y})=\frac{BF_{j0}}{\sum_{m=1}^{M}BF_{l0}}\)</span> assuming equal prior model probabilities.</p>
<p>In addition, it has been established in many settings that the Bayes factor is consistent. That is, the probability of identifying the true data generating process converges to 1 as the sample size increases to infinity. Alternatively, it asymptotically identifies the model that minimizes the Kullback-Leibler divergence with respect to the data generating process when this process is not part of the models under consideration <span class="citation">(<a href="#ref-chib2016bayes">Chib and Kuffner 2016</a>; <a href="#ref-walker2004new">Stephen G. Walker 2004b</a>; <a href="#ref-walker2004modern">Stephen G. Walker 2004a</a>)</span>.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<div id="sec10_4_1" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Savage-Dickey density ratio<a href="sec10_4.html#sec10_4_1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Savage-Dickey density ratio is a way to calculate the Bayes factors when we compare nested models with particular priors <span class="citation">(<a href="#ref-dickey1971weighted">James M. Dickey 1971</a>; <a href="#ref-verdinelli1995computing">Verdinelli and Wasserman 1995</a>)</span>. In particular, given the parameter space <span class="math inline">\(\boldsymbol{\theta}=(\boldsymbol{\omega}^{\top}, \boldsymbol{\psi}^{\top})^{\top}\in \boldsymbol{\Theta}=\boldsymbol{\Omega}\times \boldsymbol{\Psi}\)</span>, where we wish to test the null hypothesis <span class="math inline">\(H_0:\boldsymbol{\omega}=\boldsymbol{\omega}_0\)</span> (model <span class="math inline">\(\mathcal{M}_1\)</span>) versus <span class="math inline">\(H_1:\boldsymbol{\omega}\neq \boldsymbol{\omega}_0\)</span> (model <span class="math inline">\(\mathcal{M}_2\)</span>), if <span class="math inline">\(\pi(\boldsymbol{\psi}|\boldsymbol{\omega}_0,\mathcal{M}_2)=\pi(\boldsymbol{\psi}|\mathcal{M}_1)\)</span>,<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> then the Bayes factor comparing <span class="math inline">\(\mathcal{M}_1\)</span> versus <span class="math inline">\(\mathcal{M}_2\)</span> is</p>
<p><span class="math display" id="eq:SD">\[\begin{equation}
    BF_{12}=\frac{\pi(\boldsymbol{\omega}=\boldsymbol{\omega}_0|\boldsymbol{y},\mathcal{M}_2)}{\pi(\boldsymbol{\omega}=\boldsymbol{\omega}_0|\mathcal{M}_2)},
    \tag{10.1}
\end{equation}\]</span>
where <span class="math inline">\(\pi(\boldsymbol{\omega}=\boldsymbol{\omega}_0|\boldsymbol{y},\mathcal{M}_2)\)</span> and <span class="math inline">\(\pi(\boldsymbol{\omega}=\boldsymbol{\omega}_0|\mathcal{M}_2)\)</span> are the posterior and prior densities of <span class="math inline">\(\boldsymbol{\omega}\)</span> under <span class="math inline">\(\mathcal{M}_2\)</span> evaluated at <span class="math inline">\(\boldsymbol{\omega}_0\)</span> (see <span class="citation">Verdinelli and Wasserman (<a href="#ref-verdinelli1995computing">1995</a>)</span>).</p>
<p>Equation <a href="sec10_4.html#eq:SD">(10.1)</a> is called the Savage-Dickey density ratio. A nice feature is that just requires estimation of model <span class="math inline">\(\mathcal{M}_2\)</span>, and evaluation of the prior and posterior densities. This means no evaluation of the marginal likelihood <span class="citation">(<a href="#ref-koop2003bayesian">G. M. Koop 2003</a>)</span>.</p>
</div>
<div id="sec10_4_2" class="section level3 hasAnchor" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Chib’s methods<a href="sec10_4.html#sec10_4_2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another popular method to calculate the marginal likelihood is given by <span class="citation">Chib (<a href="#ref-chib1995marginal">1995</a>)</span> and <span class="citation">Chib and Jeliazkov (<a href="#ref-chib2001marginal">2001</a>)</span>. The former is an algorithm to calculate the marginal likelihood from the posterior draws of the Gibbs sampling algorithm, and the latter calculates the marginal likelihood from the posterior draws of the Metropolis-Hastings algorithm.</p>
<p>The point of departure in <span class="citation">Chib (<a href="#ref-chib1995marginal">1995</a>)</span> is the identity
<span class="math display">\[\begin{align*}
    \pi(\boldsymbol{\theta}^*|\boldsymbol{y},\mathcal{M}_m)=\frac{p(\boldsymbol{y}|\boldsymbol{\theta}^*,\mathcal{M}_m)\times\pi(\boldsymbol{\theta}^*|\mathcal{M}_m)}{p(\boldsymbol{y}|\mathcal{M}_m)},
\end{align*}\]</span>
where <span class="math inline">\(\boldsymbol{\theta}^*\)</span> is a particular value of <span class="math inline">\(\boldsymbol{\theta}\)</span> of high probability, for instance, the mode. This implies that
<span class="math display">\[\begin{align*}
    p(\boldsymbol{y}|\mathcal{M}_m)=\frac{p(\boldsymbol{y}|\boldsymbol{\theta}^*,\mathcal{M}_m)\times\pi(\boldsymbol{\theta}^*|\mathcal{M}_m)}{\pi(\boldsymbol{\theta}^*|\boldsymbol{y},\mathcal{M}_m)}.
\end{align*}\]</span>
We can easily calculate the numerator of this expression. However, the critical point in this expression is to calculate the denominator as we know <span class="math inline">\(\pi(\boldsymbol{\theta}^*|\boldsymbol{y},\mathcal{M}_m)\)</span> up to a normalizing constant. We can calculate this from the posterior draws. Assume that <span class="math inline">\(\boldsymbol{\theta}=[\boldsymbol{\theta}^{\top}_1 \ \boldsymbol{\theta}^{\top}_2]^{\top}\)</span>, then <span class="math inline">\(\pi(\boldsymbol{\theta}^*|\boldsymbol{y},\mathcal{M}_m)=\pi(\boldsymbol{\theta}^*_1|\boldsymbol{\theta}^*_2,\boldsymbol{y},\mathcal{M}_m)\times \pi(\boldsymbol{\theta}^*_2|\boldsymbol{y},\mathcal{M}_m)\)</span>. We have the first term because in the Gibbs sampling algorithm the posterior conditional distributions are available. The second is</p>
<p><span class="math display">\[\begin{align*}
    \pi(\boldsymbol{\theta}^*_2|\boldsymbol{y},\mathcal{M}_m)&amp;=\int_{\boldsymbol{\Theta}_1}\pi(\boldsymbol{\theta}_1,\boldsymbol{\theta}^*_2|\boldsymbol{y},\mathcal{M}_m)d\boldsymbol{\theta}_1\\
    &amp;=\int_{\boldsymbol{\Theta}_1}\pi(\boldsymbol{\theta}^*_2|\boldsymbol{\theta}_1,\boldsymbol{y},\mathcal{M}_m)\pi(\boldsymbol{\theta}_1|\boldsymbol{y},\mathcal{M}_m)d\boldsymbol{\theta}_1\\
    &amp;\approx \frac{1}{S}\sum_{s=1}^S \pi(\boldsymbol{\theta}^*_2|\boldsymbol{\theta}^{(s)}_1,\boldsymbol{y},\mathcal{M}_m),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\theta}^{(s)}_1\)</span> are the posterior draws of <span class="math inline">\(\boldsymbol{\theta}_1\)</span> from the Gibbs sampling algorithm.</p>
<p>The generalization to more blocks can be seen in <span class="citation">Chib (<a href="#ref-chib1995marginal">1995</a>)</span> and <span class="citation">Greenberg (<a href="#ref-greenberg2012introduction">2012</a>)</span>. In addition, the extension to the Metropolis-Hastings algorithm can be seen in <span class="citation">Chib and Jeliazkov (<a href="#ref-chib2001marginal">2001</a>)</span>, and <span class="citation">Greenberg (<a href="#ref-greenberg2012introduction">2012</a>)</span>.</p>
</div>
<div id="sec10_4_3" class="section level3 hasAnchor" number="10.4.3">
<h3><span class="header-section-number">10.4.3</span> Gelfand-Dey method<a href="sec10_4.html#sec10_4_3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use the Gelfand-Dey method <span class="citation">(<a href="#ref-gelfand1994bayesian">Gelfand and Dey 1994</a>)</span> when we want to calculate the Bayes factor to compare non-nested models, models where the Savage-Dickey density ratio is hard to calculate, or the Chib’s methods are difficult to implement. The Gelfand-Dey method is very general, and can be used in virtually any model <span class="citation">(<a href="#ref-koop2003bayesian">G. M. Koop 2003</a>)</span>.</p>
<p>Given a probability density function <span class="math inline">\(q(\boldsymbol{\theta})\)</span>, whose support is in <span class="math inline">\(\boldsymbol{\Theta}\)</span>, then
<span class="math display">\[\begin{align*}
    \mathbb{E}\left[\frac{q(\boldsymbol{\theta})}{\pi(\boldsymbol{\theta}|\mathcal{M}_m)p(\boldsymbol{y}|\boldsymbol{\theta}_m,\mathcal{M}_m)}\biggr\rvert \boldsymbol{y},\mathcal{M}_m\right]&amp;=\frac{1}{p(\boldsymbol{y}|\mathcal{M}_m)},
\end{align*}\]</span></p>
<p>where the expected value is with respect to the posterior distribution given the model <span class="math inline">\(\mathcal{M}_m\)</span> (see Exercise 12).</p>
<p>The critical point is to select a good <span class="math inline">\(q(\boldsymbol{\theta})\)</span>. <span class="citation">Geweke (<a href="#ref-geweke1999using">1999</a>)</span> recommends to use <span class="math inline">\(q(\boldsymbol{\theta})\)</span> equal to a truncated multivariate normal density function with mean and variance equal to the posterior mean (<span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span>) and variance (<span class="math inline">\(\hat{\boldsymbol{\Sigma}}\)</span>) of <span class="math inline">\(\boldsymbol{\theta}\)</span>. The truncation region is <span class="math inline">\(\hat{\boldsymbol{\Theta}}=\left\{\boldsymbol{\theta}:(\boldsymbol{\theta}-\hat{\boldsymbol{\theta}})^{\top}\hat{\boldsymbol{\Sigma}}^{-1}(\boldsymbol{\theta}-\hat{\boldsymbol{\theta}})\leq \chi_{1-\alpha}^2(K)\right\}\)</span>, where <span class="math inline">\(\chi_{1-\alpha}^2(K)\)</span> is the <span class="math inline">\((1-\alpha)\)</span> percentile of the Chi-squared distribution with <span class="math inline">\(K\)</span> degrees of freedom, <span class="math inline">\(K\)</span> is the dimension of <span class="math inline">\(\boldsymbol{\theta}\)</span>. We can pick small values of <span class="math inline">\(\alpha\)</span>, for instance, <span class="math inline">\(\alpha=0.01\)</span>.</p>
<p>Observe that
<span class="math display">\[\begin{align*}
    \mathbb{E}\left[\frac{q(\boldsymbol{\theta})}{\pi(\boldsymbol{\theta}|\mathcal{M}_m)p(\boldsymbol{y}|\boldsymbol{\theta}_m,\mathcal{M}_m)}\biggr\rvert \boldsymbol{y},\mathcal{M}_m\right]&amp;\approx \frac{1}{S}\sum_{s=1}^S \left[\frac{q(\boldsymbol{\theta}^{(s)})}{\pi(\boldsymbol{\theta}^{(s)}|\mathcal{M}_m)p(\boldsymbol{y}|\boldsymbol{\theta}^{(s)}_m,\mathcal{M}_m)}\right],
\end{align*}\]</span>
where <span class="math inline">\(\boldsymbol{\theta}^{(s)}_m\)</span> are draws from the posterior distribution.</p>
<p>Observe that we can calculate the marginal likelihoods of the models in Chapters <a href="Chap6.html#Chap6">6</a>, <a href="Chap7.html#Chap7">7</a>, <a href="Chap8.html#Chap8">8</a> and <a href="Chap9.html#Chap9">9</a> using the Chib’s methods and the Gelfand-Dickey method.</p>
<p><strong>Example: Simulation exercise</strong></p>
<p>Let’s check the performance of the Savage-Dickey density ratio, Chib’s method and the Gelfand-Dey method to calculate the Bayes factor in a setting where we can obtain the analytical solution for the marginal likelihood. In particular, we will consider the Gaussian linear model with a conjugate prior (see Section <a href="sec43.html#sec43">3.3</a>).</p>
<p>Assume that the data generating process is given by<br />
<span class="math display">\[
y_{i} = 0.7 + 0.3x_{i1} + 0.7x_{i2} - 0.2x_{i3} + 0.2x_{i4} + \mu_i,
\]</span>
where <span class="math inline">\(x_{i1} \sim B(0.3)\)</span>, <span class="math inline">\(x_{ik} \sim N(0,1)\)</span>, for <span class="math inline">\(k = 2, \dots, 4\)</span>, and <span class="math inline">\(\mu_i \sim N(0, 1)\)</span>, for <span class="math inline">\(i = 1, 2, \dots, 500\)</span>. Let us set <span class="math inline">\(H_0: \beta_5 = 0\)</span> (model <span class="math inline">\(\mathcal{M}_1\)</span>) versus <span class="math inline">\(H_1: \beta_5 \neq 0\)</span> (model <span class="math inline">\(\mathcal{M}_2\)</span>).</p>
<p>We assume that <span class="math inline">\(\boldsymbol{\beta}_{m0} = \boldsymbol{0}_{m0}\)</span>, <span class="math inline">\(\boldsymbol{B}_{m0} = 0.5 \boldsymbol{I}_{m}\)</span>, <span class="math inline">\(\alpha_0 = \delta_0 = 4\)</span>. The dimensions of <span class="math inline">\(\boldsymbol{0}_{m0}\)</span> and <span class="math inline">\(\boldsymbol{I}_m\)</span> are 4 for model <span class="math inline">\(\mathcal{M}_1\)</span> and 5 for model <span class="math inline">\(\mathcal{M}_2\)</span>. In addition, we assume equal prior probabilities for both models.</p>
<p>We know from Section <a href="sec43.html#sec43">3.3</a> that the marginal likelihood is
<span class="math display">\[\begin{align*}
    p(\bf{y}|\mathcal{M}_m)&amp;=\frac{\delta_{m0}^{\alpha_{m0}/2}}{\delta_{mn}^{\alpha_{mn}/2}}\frac{|{\bf{B}}_{mn}|^{1/2}}{|{\bf{B}}_{m0}|^{1/2}}\frac{\Gamma(\alpha_{mn}/2)}{\Gamma(\alpha_{m0}/2)},
\end{align*}\]</span>
where <span class="math inline">\({{\boldsymbol{B}}}_{mn} = ({\boldsymbol{B}}_{m0}^{-1} + {\boldsymbol{X}}_m^{\top}{\boldsymbol{X}}_m)^{-1}\)</span>, <span class="math inline">\(\boldsymbol{\beta}_{mn} = {{\bf{B}}}_{mn}({\boldsymbol{B}}_{m0}^{-1}\boldsymbol{\beta}_{m0} + {\boldsymbol{X}}_m^{\top}{\boldsymbol{X}}_m\hat{\boldsymbol{\beta}}_m)\)</span>, <span class="math inline">\(\alpha_{mn}=\alpha_{m0}+N\)</span>, and <span class="math inline">\(\delta_{mn}=\delta_{m0}+({\boldsymbol{y}}-{\boldsymbol{X}}_m\hat{\boldsymbol{\beta}}_m)^{\top}({\boldsymbol{y}}-{\boldsymbol{X}}_m\hat{\boldsymbol{\beta}}_m)+(\hat{\boldsymbol{\beta}}_m-\boldsymbol{\beta}_{m0})^{\top}(({\boldsymbol{X}_m}^{\top}{\boldsymbol{X}_m})^{-1}+{\boldsymbol{B}}_{m0})^{-1}(\hat{\boldsymbol{\beta}}_m-\boldsymbol{\beta}_{m0})\)</span>, <span class="math inline">\(m=1,2\)</span> are the indices of the models.</p>
<p>The log marginal likelihoods for models <span class="math inline">\(\mathcal{M}_1\)</span> and <span class="math inline">\(\mathcal{M}_2\)</span> are -751.72 and -740.79, respectively. This implies a <span class="math inline">\(2\times\log(BF_{21})=21.85\)</span> which means positive evidence against model <span class="math inline">\(\mathcal{M}_1\)</span>.</p>
<p>We have different ways to calculate the Bayes factor using the Savage-Dickey density ratio in this example because we know that the marginal prior and marginal posterior distributions of <span class="math inline">\(\beta_5\)</span> have analytical solutions. In addition, we can use the posterior draws of <span class="math inline">\(\sigma^2\)</span> to evaluate the conditional prior and conditional posterior distributions at <span class="math inline">\(\beta_5=0\)</span>. We show in the following code the latter approach, as it is more general than using analytical solutions, which are not always available.</p>
<p>We know that the conditional posterior distribution of <span class="math inline">\(\beta_5\)</span> is <span class="math inline">\(N(\beta_{5n}, \sigma \boldsymbol{B}_{55n})\)</span>, where <span class="math inline">\(\beta_{5n}\)</span> is the 5th element of <span class="math inline">\(\boldsymbol{\beta}_n\)</span>, and <span class="math inline">\(\boldsymbol{B}_{55n}\)</span> is the element 5,5 of <span class="math inline">\(\boldsymbol{B}_n\)</span>. Then,
<span class="math display">\[\begin{align*}
    \pi(\beta_5=0|\boldsymbol{y}, \mathcal{M}_2) &amp;= \int_{\mathcal{R}^+} \pi(\beta_5=0|\boldsymbol{y}, \sigma^2) \pi(\sigma^2|\boldsymbol{y}) \, d\sigma^2 \\
    &amp;\approx \frac{1}{S} \sum_{s=1}^S \pi(\beta_5=0|\boldsymbol{y}, \sigma^{2(s)}),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\sigma^{2(s)}\)</span> are draws from the posterior distribution of <span class="math inline">\(\sigma^2\)</span>.</p>
<p>We can follow the same logic to obtain an approximation to <span class="math inline">\(\pi(\beta_5=0|\mathcal{M}_2)\)</span> by sampling draws from the prior distribution of <span class="math inline">\(\sigma^2\)</span>.</p>
<p>We obtain <span class="math inline">\(2 \times \log(BF_{21}) = 21.85\)</span> using the Savage-Dickey density ratio, which is the same value as the analytic solution using the marginal likelihoods.</p>
<p>We calculate the log marginal likelihood using the Chib’s method taking into account that
<span class="math display">\[\begin{align*}
    \log(p(\boldsymbol{y}|\mathcal{M}_m))&amp;=\log(p(\boldsymbol{y}|\boldsymbol{\theta}^*,\mathcal{M}_m))+\log(\pi(\boldsymbol{\theta}^*|\mathcal{M}_m))-\log(\pi(\boldsymbol{\theta}^*|\boldsymbol{y},\mathcal{M}_m)),\\
\end{align*}\]</span>
where <span class="math inline">\(p(\boldsymbol{y}|\boldsymbol{\theta}^*,\mathcal{M}_m)\)</span> is the value of a normal density with mean <span class="math inline">\(\boldsymbol{X}_m\boldsymbol{\beta}_{m}^*\)</span> and variance <span class="math inline">\(\sigma^{2*}_m\boldsymbol{I}_N\)</span> evaluated at <span class="math inline">\(\boldsymbol{y}\)</span>. In addition, <span class="math inline">\(\log(\pi(\boldsymbol{\theta}^*|\mathcal{M}_m))=\log(\pi(\boldsymbol{\beta}_m^*|\sigma^{2*}_m))+\log(\pi(\sigma^{2*}_m))\)</span>, where the first term is the density of a normal with mean <span class="math inline">\(\boldsymbol{\beta}_{m0}\)</span> and variance matrix <span class="math inline">\(\sigma^{2*}\boldsymbol{B}_{m0}\)</span> evaluated at <span class="math inline">\(\boldsymbol{\beta}_m^*\)</span>, and the second term is the density of an inverse-gamma with parameters <span class="math inline">\(\alpha_{m0}/2\)</span> and <span class="math inline">\(\delta_{m0}/2\)</span> evaluated at <span class="math inline">\(\sigma^{2*}_m\)</span>. Finally, the third term in the right hand of the previous expression is <span class="math inline">\(\log(\pi(\boldsymbol{\theta}^*|\boldsymbol{y},\mathcal{M}_m))=\log(\pi(\boldsymbol{\beta}_m^*|\sigma^{2*}_m,\boldsymbol{y}))+\log(\pi(\sigma^{2*}_m|\boldsymbol{y}))\)</span>, where the first term is the density of a normal with mean <span class="math inline">\(\boldsymbol{\beta}_{mn}\)</span> and variance matrix <span class="math inline">\(\sigma^{2*}_m\boldsymbol{B}_{mn}\)</span> evaluated at <span class="math inline">\(\boldsymbol{\beta}_m^*\)</span>, and the second term is the density of an inverse-gamma with parameters <span class="math inline">\(\alpha_{mn}/2\)</span> and <span class="math inline">\(\delta_{mn}/2\)</span> evaluated at <span class="math inline">\(\sigma^{2*}_m\)</span>. We use the modes of the posterior draws of <span class="math inline">\(\boldsymbol{\beta}_m\)</span> and <span class="math inline">\(\sigma^2_m\)</span> as reference values.</p>
<p>We get the same value, up to two decimals, for the log marginal likelihood of the restricted and unrestricted models using the Chib’s method and the analytical expression. Thus, <span class="math inline">\(2\times\log(BF_{21})=21.85\)</span>, that is, positive evidence against model <span class="math inline">\(\mathcal{M}_1\)</span>.</p>
<p>We calculate the log marginal likelihood using the Gelfand-Dey method taking into account that
<span class="math display">\[\begin{align*}
    \log\left[\frac{q(\boldsymbol{\theta}^{(s)})}{\pi(\boldsymbol{\theta}^{(s)}|\mathcal{M}_m)p(\boldsymbol{y}|\boldsymbol{\theta}^{(s)}_m,\mathcal{M}_m)}\right]&amp;=\log(q(\boldsymbol{\theta}^{(s)}))-\log(\pi(\boldsymbol{\theta}^{(s)}|\mathcal{M}_m))-\log(p(\boldsymbol{y}|\boldsymbol{\theta}^{(s)}_m,\mathcal{M}_m)),
\end{align*}\]</span>
where <span class="math inline">\(q(\boldsymbol{\theta}^{(s)})\)</span> is the truncated multivariate normal density of Subsection @ref(sec10_4_3) evaluated at <span class="math inline">\(\boldsymbol{\theta}^{(s)}=[\boldsymbol{\beta}^{(s)\top} \ \sigma^{2(s)}]^{\top}\)</span>, which is the <span class="math inline">\(s\)</span>-th posterior draw of the Gibbs sampling algorithm, such that <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span> satisfies the truncation restriction. <span class="math inline">\(\log(\pi(\boldsymbol{\theta}^{(s)}|\mathcal{M}_m))=\log(\pi(\boldsymbol{\beta}_m^{(s)}|\sigma^{2(s)}_m))+\log(\pi(\sigma^{2(s)}_m))\)</span>, where the first term is the density of a normal with mean <span class="math inline">\(\boldsymbol{\beta}_{m0}\)</span> and variance matrix <span class="math inline">\(\sigma^{2(s)}\boldsymbol{B}_{m0}\)</span> evaluated at <span class="math inline">\(\boldsymbol{\beta}_m^{(s)}\)</span>, and the second term is the density of an inverse-gamma with parameters <span class="math inline">\(\alpha_{m0}/2\)</span> and <span class="math inline">\(\delta_{m0}/2\)</span> evaluated at <span class="math inline">\(\sigma^{2(s)}_m\)</span>. The third term <span class="math inline">\(p(\boldsymbol{y}|\boldsymbol{\theta}^{(s)},\mathcal{M}_m)\)</span> is the value of a normal density with mean <span class="math inline">\(\boldsymbol{X}_m\boldsymbol{\beta}_{m}^{(s)}\)</span> and variance <span class="math inline">\(\sigma^{2(s)}_m\boldsymbol{I}_N\)</span> evaluated at <span class="math inline">\(\boldsymbol{y}\)</span>.</p>
<p>The log marginal likelihoods of the restricted and unrestricted models using the Gelfand-Dey method are -751.79 and -740.89, respectively. This implies <span class="math inline">\(2\times \log(BF_{21})=21.81\)</span>, which is positive evidence in favor of the unrestricted model.</p>
<p>We see in this example that these methods give very good approximations to the true marginal likelihoods. However, the Savage-Dickey density ratio and Chib’s method performed slightly better than the Gelfand-Dey method. In addition, the computational demand of the Gelfand-Dey method is by far the largest. This is because the Gelfand-Dey method requires many evaluations based on the posterior draws. However, we should keep in mind that the Gelfand-Dey method is more general.</p>
<p>The following code shows how to do all these calculations.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="sec10_4.html#cb12-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()); <span class="fu">set.seed</span>(<span class="dv">010101</span>)</span>
<span id="cb12-2"><a href="sec10_4.html#cb12-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span>; K <span class="ot">&lt;-</span> <span class="dv">5</span>; K2 <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb12-3"><a href="sec10_4.html#cb12-3" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>) </span>
<span id="cb12-4"><a href="sec10_4.html#cb12-4" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.3</span>)</span>
<span id="cb12-5"><a href="sec10_4.html#cb12-5" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(K2<span class="sc">*</span>N), N, K2)</span>
<span id="cb12-6"><a href="sec10_4.html#cb12-6" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, X1, X2)</span>
<span id="cb12-7"><a href="sec10_4.html#cb12-7" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X<span class="sc">%*%</span>B <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb12-8"><a href="sec10_4.html#cb12-8" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb12-9"><a href="sec10_4.html#cb12-9" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> <span class="dv">4</span>; a0 <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb12-10"><a href="sec10_4.html#cb12-10" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, K); cOpt <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb12-11"><a href="sec10_4.html#cb12-11" tabindex="-1"></a>an <span class="ot">&lt;-</span> N <span class="sc">+</span> a0; B0 <span class="ot">&lt;-</span> cOpt<span class="sc">*</span><span class="fu">diag</span>(K)</span>
<span id="cb12-12"><a href="sec10_4.html#cb12-12" tabindex="-1"></a>Bn <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">solve</span>(B0)<span class="sc">+</span><span class="fu">t</span>(X)<span class="sc">%*%</span>X); bhat <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb12-13"><a href="sec10_4.html#cb12-13" tabindex="-1"></a>bn <span class="ot">&lt;-</span> Bn<span class="sc">%*%</span>(<span class="fu">solve</span>(B0)<span class="sc">%*%</span>b0<span class="sc">+</span><span class="fu">t</span>(X)<span class="sc">%*%</span>X<span class="sc">%*%</span>bhat)</span>
<span id="cb12-14"><a href="sec10_4.html#cb12-14" tabindex="-1"></a>dn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(d0 <span class="sc">+</span> <span class="fu">t</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>bhat)<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>bhat)<span class="sc">+</span><span class="fu">t</span>(bhat <span class="sc">-</span> b0)<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">+</span>B0)<span class="sc">%*%</span>(bhat <span class="sc">-</span> b0))</span>
<span id="cb12-15"><a href="sec10_4.html#cb12-15" tabindex="-1"></a>Hn <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">forceSymmetric</span>(dn<span class="sc">*</span>Bn<span class="sc">/</span>an))</span>
<span id="cb12-16"><a href="sec10_4.html#cb12-16" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb12-17"><a href="sec10_4.html#cb12-17" tabindex="-1"></a>LogMarLikLM <span class="ot">&lt;-</span> <span class="cf">function</span>(X, c0){</span>
<span id="cb12-18"><a href="sec10_4.html#cb12-18" tabindex="-1"></a>    K <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>]</span>
<span id="cb12-19"><a href="sec10_4.html#cb12-19" tabindex="-1"></a>    N <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">1</span>]  </span>
<span id="cb12-20"><a href="sec10_4.html#cb12-20" tabindex="-1"></a>    <span class="co"># Hyperparameters</span></span>
<span id="cb12-21"><a href="sec10_4.html#cb12-21" tabindex="-1"></a>    B0 <span class="ot">&lt;-</span> c0<span class="sc">*</span><span class="fu">diag</span>(K)</span>
<span id="cb12-22"><a href="sec10_4.html#cb12-22" tabindex="-1"></a>    b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, K)</span>
<span id="cb12-23"><a href="sec10_4.html#cb12-23" tabindex="-1"></a>    <span class="co"># Posterior parameters</span></span>
<span id="cb12-24"><a href="sec10_4.html#cb12-24" tabindex="-1"></a>    bhat <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb12-25"><a href="sec10_4.html#cb12-25" tabindex="-1"></a>    <span class="co"># Force this matrix to be symmetric</span></span>
<span id="cb12-26"><a href="sec10_4.html#cb12-26" tabindex="-1"></a>    Bn <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">forceSymmetric</span>(<span class="fu">solve</span>(<span class="fu">solve</span>(B0) <span class="sc">+</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>X))) </span>
<span id="cb12-27"><a href="sec10_4.html#cb12-27" tabindex="-1"></a>    bn <span class="ot">&lt;-</span> Bn<span class="sc">%*%</span>(<span class="fu">solve</span>(B0)<span class="sc">%*%</span>b0 <span class="sc">+</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>X<span class="sc">%*%</span>bhat)</span>
<span id="cb12-28"><a href="sec10_4.html#cb12-28" tabindex="-1"></a>    dn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(d0 <span class="sc">+</span> <span class="fu">t</span>(Y)<span class="sc">%*%</span>Y<span class="sc">+</span><span class="fu">t</span>(b0)<span class="sc">%*%</span><span class="fu">solve</span>(B0)<span class="sc">%*%</span>b0<span class="sc">-</span><span class="fu">t</span>(bn)<span class="sc">%*%</span><span class="fu">solve</span>(Bn)<span class="sc">%*%</span>bn)</span>
<span id="cb12-29"><a href="sec10_4.html#cb12-29" tabindex="-1"></a>    an <span class="ot">&lt;-</span> a0 <span class="sc">+</span> N</span>
<span id="cb12-30"><a href="sec10_4.html#cb12-30" tabindex="-1"></a>    <span class="co"># Log marginal likelihood</span></span>
<span id="cb12-31"><a href="sec10_4.html#cb12-31" tabindex="-1"></a>    logpy <span class="ot">&lt;-</span> (N<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span>pi)<span class="sc">+</span>(a0<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">log</span>(d0)<span class="sc">-</span>(an<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">log</span>(dn) <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fu">log</span>(<span class="fu">det</span>(Bn)<span class="sc">/</span><span class="fu">det</span>(B0)) <span class="sc">+</span> <span class="fu">lgamma</span>(an<span class="sc">/</span><span class="dv">2</span>)<span class="sc">-</span><span class="fu">lgamma</span>(a0<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-32"><a href="sec10_4.html#cb12-32" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span>logpy)</span>
<span id="cb12-33"><a href="sec10_4.html#cb12-33" tabindex="-1"></a>}</span>
<span id="cb12-34"><a href="sec10_4.html#cb12-34" tabindex="-1"></a>LogMarM2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">LogMarLikLM</span>(<span class="at">X =</span> X, <span class="at">c0 =</span> cOpt)</span>
<span id="cb12-35"><a href="sec10_4.html#cb12-35" tabindex="-1"></a>LogMarM1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">LogMarLikLM</span>(<span class="at">X =</span> X[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">c0 =</span> cOpt)</span>
<span id="cb12-36"><a href="sec10_4.html#cb12-36" tabindex="-1"></a>BF12 <span class="ot">&lt;-</span> <span class="fu">exp</span>(LogMarM1<span class="sc">-</span>LogMarM2) </span>
<span id="cb12-37"><a href="sec10_4.html#cb12-37" tabindex="-1"></a>BF12; <span class="dv">1</span><span class="sc">/</span>BF12</span>
<span id="cb12-38"><a href="sec10_4.html#cb12-38" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span>BF12)</span>
<span id="cb12-39"><a href="sec10_4.html#cb12-39" tabindex="-1"></a><span class="co"># Savage-Dickey density ratio</span></span>
<span id="cb12-40"><a href="sec10_4.html#cb12-40" tabindex="-1"></a><span class="co"># Posterior evaluation</span></span>
<span id="cb12-41"><a href="sec10_4.html#cb12-41" tabindex="-1"></a>Brest <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-42"><a href="sec10_4.html#cb12-42" tabindex="-1"></a>sig2P <span class="ot">&lt;-</span> invgamma<span class="sc">::</span><span class="fu">rinvgamma</span>(S, <span class="at">shape =</span> an<span class="sc">/</span><span class="dv">2</span>, <span class="at">rate =</span> dn<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-43"><a href="sec10_4.html#cb12-43" tabindex="-1"></a>PostRestCom <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(sig2P, <span class="cf">function</span>(x){<span class="fu">dnorm</span>(Brest, <span class="at">mean =</span> bn[<span class="dv">5</span>], <span class="at">sd =</span> (x<span class="sc">*</span>Bn[<span class="dv">5</span>,<span class="dv">5</span>])<span class="sc">^</span><span class="fl">0.5</span>, <span class="at">log =</span> <span class="cn">FALSE</span>)})) </span>
<span id="cb12-44"><a href="sec10_4.html#cb12-44" tabindex="-1"></a><span class="co"># Prior evaluation</span></span>
<span id="cb12-45"><a href="sec10_4.html#cb12-45" tabindex="-1"></a>sig2 <span class="ot">&lt;-</span> invgamma<span class="sc">::</span><span class="fu">rinvgamma</span>(S, <span class="at">shape =</span> a0<span class="sc">/</span><span class="dv">2</span>, <span class="at">rate =</span> d0<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-46"><a href="sec10_4.html#cb12-46" tabindex="-1"></a>PriorRestCom <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(sig2, <span class="cf">function</span>(x){<span class="fu">dnorm</span>(Brest, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> (x<span class="sc">*</span>cOpt)<span class="sc">^</span><span class="fl">0.5</span>, <span class="at">log =</span> <span class="cn">FALSE</span>)})) </span>
<span id="cb12-47"><a href="sec10_4.html#cb12-47" tabindex="-1"></a><span class="co"># Bayes factor</span></span>
<span id="cb12-48"><a href="sec10_4.html#cb12-48" tabindex="-1"></a>BF12SD <span class="ot">&lt;-</span> PostRestCom<span class="sc">/</span>PriorRestCom</span>
<span id="cb12-49"><a href="sec10_4.html#cb12-49" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span>BF12SD)</span>
<span id="cb12-50"><a href="sec10_4.html#cb12-50" tabindex="-1"></a><span class="co"># Chib&#39;s method</span></span>
<span id="cb12-51"><a href="sec10_4.html#cb12-51" tabindex="-1"></a>sig2Post <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">rinvgamma</span>(S,an<span class="sc">/</span><span class="dv">2</span>,dn<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-52"><a href="sec10_4.html#cb12-52" tabindex="-1"></a>BetasGibbs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>S, <span class="cf">function</span>(s){MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mu =</span> bn, <span class="at">Sigma =</span> sig2Post[s]<span class="sc">*</span>Bn)})</span>
<span id="cb12-53"><a href="sec10_4.html#cb12-53" tabindex="-1"></a><span class="co"># Mode function for continuous data</span></span>
<span id="cb12-54"><a href="sec10_4.html#cb12-54" tabindex="-1"></a>mode_continuous <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb12-55"><a href="sec10_4.html#cb12-55" tabindex="-1"></a>    density_est <span class="ot">&lt;-</span> <span class="fu">density</span>(x)       </span>
<span id="cb12-56"><a href="sec10_4.html#cb12-56" tabindex="-1"></a>    mode_value <span class="ot">&lt;-</span> density_est<span class="sc">$</span>x[<span class="fu">which.max</span>(density_est<span class="sc">$</span>y)]  </span>
<span id="cb12-57"><a href="sec10_4.html#cb12-57" tabindex="-1"></a>    <span class="fu">return</span>(mode_value)</span>
<span id="cb12-58"><a href="sec10_4.html#cb12-58" tabindex="-1"></a>}</span>
<span id="cb12-59"><a href="sec10_4.html#cb12-59" tabindex="-1"></a><span class="co"># Unrestricted model</span></span>
<span id="cb12-60"><a href="sec10_4.html#cb12-60" tabindex="-1"></a>BetasMode <span class="ot">&lt;-</span> <span class="fu">apply</span>(BetasGibbs, <span class="dv">1</span>, mode_continuous)</span>
<span id="cb12-61"><a href="sec10_4.html#cb12-61" tabindex="-1"></a>Sigma2Mode <span class="ot">&lt;-</span> <span class="fu">mode_continuous</span>(sig2Post)</span>
<span id="cb12-62"><a href="sec10_4.html#cb12-62" tabindex="-1"></a>VarModel <span class="ot">&lt;-</span> Sigma2Mode<span class="sc">*</span><span class="fu">diag</span>(N)</span>
<span id="cb12-63"><a href="sec10_4.html#cb12-63" tabindex="-1"></a>MeanModel <span class="ot">&lt;-</span> X<span class="sc">%*%</span>BetasMode</span>
<span id="cb12-64"><a href="sec10_4.html#cb12-64" tabindex="-1"></a>LogLik <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">c</span>(Y), <span class="at">mean =</span> MeanModel, <span class="at">sigma =</span> VarModel, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-65"><a href="sec10_4.html#cb12-65" tabindex="-1"></a>LogPrior <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(BetasMode, <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, K), <span class="at">sigma =</span> Sigma2Mode<span class="sc">*</span>cOpt<span class="sc">*</span><span class="fu">diag</span>(K), <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)<span class="sc">+</span><span class="fu">log</span>(MCMCpack<span class="sc">::</span><span class="fu">dinvgamma</span>(Sigma2Mode, a0<span class="sc">/</span><span class="dv">2</span>, d0<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-66"><a href="sec10_4.html#cb12-66" tabindex="-1"></a>LogPost1 <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(BetasMode, <span class="at">mean =</span> bn, <span class="at">sigma =</span> Sigma2Mode<span class="sc">*</span>Bn, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-67"><a href="sec10_4.html#cb12-67" tabindex="-1"></a>LogPost2 <span class="ot">&lt;-</span> <span class="fu">log</span>(MCMCpack<span class="sc">::</span><span class="fu">dinvgamma</span>(Sigma2Mode, an<span class="sc">/</span><span class="dv">2</span>, dn<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-68"><a href="sec10_4.html#cb12-68" tabindex="-1"></a>LogMarLikChib <span class="ot">&lt;-</span> LogLik <span class="sc">+</span> LogPrior <span class="sc">-</span>(LogPost1 <span class="sc">+</span> LogPost2)</span>
<span id="cb12-69"><a href="sec10_4.html#cb12-69" tabindex="-1"></a><span class="co"># Restricted model</span></span>
<span id="cb12-70"><a href="sec10_4.html#cb12-70" tabindex="-1"></a>anRest <span class="ot">&lt;-</span> N <span class="sc">+</span> a0; XRest <span class="ot">&lt;-</span> X[,<span class="sc">-</span><span class="dv">5</span>]</span>
<span id="cb12-71"><a href="sec10_4.html#cb12-71" tabindex="-1"></a>KRest <span class="ot">&lt;-</span> <span class="fu">dim</span>(XRest)[<span class="dv">2</span>]; B0Rest <span class="ot">&lt;-</span> cOpt<span class="sc">*</span><span class="fu">diag</span>(KRest) </span>
<span id="cb12-72"><a href="sec10_4.html#cb12-72" tabindex="-1"></a>BnRest <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">solve</span>(B0Rest)<span class="sc">+</span><span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest)</span>
<span id="cb12-73"><a href="sec10_4.html#cb12-73" tabindex="-1"></a>bhatRest <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest)<span class="sc">%*%</span><span class="fu">t</span>(XRest)<span class="sc">%*%</span>Y</span>
<span id="cb12-74"><a href="sec10_4.html#cb12-74" tabindex="-1"></a>b0Rest <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, KRest)</span>
<span id="cb12-75"><a href="sec10_4.html#cb12-75" tabindex="-1"></a>bnRest <span class="ot">&lt;-</span> BnRest<span class="sc">%*%</span>(<span class="fu">solve</span>(B0Rest)<span class="sc">%*%</span>b0Rest<span class="sc">+</span><span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest<span class="sc">%*%</span>bhatRest)</span>
<span id="cb12-76"><a href="sec10_4.html#cb12-76" tabindex="-1"></a>dnRest <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(d0 <span class="sc">+</span> <span class="fu">t</span>(Y<span class="sc">-</span>XRest<span class="sc">%*%</span>bhatRest)<span class="sc">%*%</span>(Y<span class="sc">-</span>XRest<span class="sc">%*%</span>bhatRest)<span class="sc">+</span><span class="fu">t</span>(bhatRest <span class="sc">-</span> b0Rest)<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">solve</span>(<span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest)<span class="sc">+</span>B0Rest)<span class="sc">%*%</span>(bhatRest <span class="sc">-</span> b0Rest))</span>
<span id="cb12-77"><a href="sec10_4.html#cb12-77" tabindex="-1"></a>sig2PostRest <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">rinvgamma</span>(S,anRest<span class="sc">/</span><span class="dv">2</span>,dnRest<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-78"><a href="sec10_4.html#cb12-78" tabindex="-1"></a>BetasGibbsRest <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>S, <span class="cf">function</span>(s){MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mu =</span> bnRest, <span class="at">Sigma =</span> sig2PostRest[s]<span class="sc">*</span>BnRest)})</span>
<span id="cb12-79"><a href="sec10_4.html#cb12-79" tabindex="-1"></a>BetasModeRest <span class="ot">&lt;-</span> <span class="fu">apply</span>(BetasGibbsRest, <span class="dv">1</span>, mode_continuous)</span>
<span id="cb12-80"><a href="sec10_4.html#cb12-80" tabindex="-1"></a>Sigma2ModeRest <span class="ot">&lt;-</span> <span class="fu">mode_continuous</span>(sig2PostRest)</span>
<span id="cb12-81"><a href="sec10_4.html#cb12-81" tabindex="-1"></a>VarModelRest <span class="ot">&lt;-</span> Sigma2ModeRest<span class="sc">*</span><span class="fu">diag</span>(N)</span>
<span id="cb12-82"><a href="sec10_4.html#cb12-82" tabindex="-1"></a>MeanModelRest <span class="ot">&lt;-</span> XRest<span class="sc">%*%</span>BetasModeRest</span>
<span id="cb12-83"><a href="sec10_4.html#cb12-83" tabindex="-1"></a>LogLikRest <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">c</span>(Y), <span class="at">mean =</span> MeanModelRest, <span class="at">sigma =</span> VarModelRest, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-84"><a href="sec10_4.html#cb12-84" tabindex="-1"></a>LogPriorRest <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(BetasModeRest, <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, KRest), <span class="at">sigma =</span> Sigma2ModeRest<span class="sc">*</span>cOpt<span class="sc">*</span><span class="fu">diag</span>(KRest), <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)<span class="sc">+</span><span class="fu">log</span>(MCMCpack<span class="sc">::</span><span class="fu">dinvgamma</span>(Sigma2ModeRest, a0<span class="sc">/</span><span class="dv">2</span>, d0<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-85"><a href="sec10_4.html#cb12-85" tabindex="-1"></a>LogPost1Rest <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(BetasModeRest, <span class="at">mean =</span> bnRest, <span class="at">sigma =</span> Sigma2ModeRest<span class="sc">*</span>BnRest, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-86"><a href="sec10_4.html#cb12-86" tabindex="-1"></a>LogPost2Rest <span class="ot">&lt;-</span> <span class="fu">log</span>(MCMCpack<span class="sc">::</span><span class="fu">dinvgamma</span>(Sigma2ModeRest, anRest<span class="sc">/</span><span class="dv">2</span>, dnRest<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-87"><a href="sec10_4.html#cb12-87" tabindex="-1"></a>LogMarLikChibRest <span class="ot">&lt;-</span> LogLikRest <span class="sc">+</span> LogPriorRest <span class="sc">-</span>(LogPost1Rest <span class="sc">+</span> LogPost2Rest)</span>
<span id="cb12-88"><a href="sec10_4.html#cb12-88" tabindex="-1"></a>BFChibs <span class="ot">&lt;-</span> <span class="fu">exp</span>(LogMarLikChibRest<span class="sc">-</span>LogMarLikChib)</span>
<span id="cb12-89"><a href="sec10_4.html#cb12-89" tabindex="-1"></a>BFChibs; <span class="dv">1</span><span class="sc">/</span>BFChibs; <span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span>BFChibs)</span>
<span id="cb12-90"><a href="sec10_4.html#cb12-90" tabindex="-1"></a><span class="co"># Gelfand-Dey method</span></span>
<span id="cb12-91"><a href="sec10_4.html#cb12-91" tabindex="-1"></a>GDmarglik <span class="ot">&lt;-</span> <span class="cf">function</span>(ids, X, Betas, MeanThetas, VarThetas, sig2Post){</span>
<span id="cb12-92"><a href="sec10_4.html#cb12-92" tabindex="-1"></a>    K <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>]; Thetas <span class="ot">&lt;-</span> <span class="fu">c</span>(Betas[ids,], sig2Post[ids])</span>
<span id="cb12-93"><a href="sec10_4.html#cb12-93" tabindex="-1"></a>    Lognom <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">*</span>mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(Thetas, <span class="at">mean =</span> MeanThetas, <span class="at">sigma =</span> VarThetas, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-94"><a href="sec10_4.html#cb12-94" tabindex="-1"></a>    Logden1 <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(Betas[ids,], <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, K), <span class="at">sigma =</span> sig2Post[ids]<span class="sc">*</span>cOpt<span class="sc">*</span><span class="fu">diag</span>(K), <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">log</span>(MCMCpack<span class="sc">::</span><span class="fu">dinvgamma</span>(sig2Post[ids], a0<span class="sc">/</span><span class="dv">2</span>, d0<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-95"><a href="sec10_4.html#cb12-95" tabindex="-1"></a>    VarModel <span class="ot">&lt;-</span> sig2Post[ids]<span class="sc">*</span><span class="fu">diag</span>(N)</span>
<span id="cb12-96"><a href="sec10_4.html#cb12-96" tabindex="-1"></a>    MeanModel <span class="ot">&lt;-</span> X<span class="sc">%*%</span>Betas[ids,]</span>
<span id="cb12-97"><a href="sec10_4.html#cb12-97" tabindex="-1"></a>    Logden2 <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">c</span>(Y), <span class="at">mean =</span> MeanModel, <span class="at">sigma =</span> VarModel, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">checkSymmetry =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-98"><a href="sec10_4.html#cb12-98" tabindex="-1"></a>    LogGDid <span class="ot">&lt;-</span> Lognom <span class="sc">-</span> Logden1 <span class="sc">-</span> Logden2</span>
<span id="cb12-99"><a href="sec10_4.html#cb12-99" tabindex="-1"></a>    <span class="fu">return</span>(LogGDid)</span>
<span id="cb12-100"><a href="sec10_4.html#cb12-100" tabindex="-1"></a>}</span>
<span id="cb12-101"><a href="sec10_4.html#cb12-101" tabindex="-1"></a>sig2Post <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">rinvgamma</span>(S,an<span class="sc">/</span><span class="dv">2</span>,dn<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-102"><a href="sec10_4.html#cb12-102" tabindex="-1"></a>Betas <span class="ot">&lt;-</span> LaplacesDemon<span class="sc">::</span><span class="fu">rmvt</span>(S, bn, Hn, an)</span>
<span id="cb12-103"><a href="sec10_4.html#cb12-103" tabindex="-1"></a>Thetas <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Betas, sig2Post)</span>
<span id="cb12-104"><a href="sec10_4.html#cb12-104" tabindex="-1"></a>MeanThetas <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Thetas); VarThetas <span class="ot">&lt;-</span> <span class="fu">var</span>(Thetas)</span>
<span id="cb12-105"><a href="sec10_4.html#cb12-105" tabindex="-1"></a>iVarThetas <span class="ot">&lt;-</span> <span class="fu">solve</span>(VarThetas)</span>
<span id="cb12-106"><a href="sec10_4.html#cb12-106" tabindex="-1"></a>ChiSQ <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>S, <span class="cf">function</span>(s){(Thetas[s,]<span class="sc">-</span>MeanThetas)<span class="sc">%*%</span>iVarThetas<span class="sc">%*%</span>(Thetas[s,]<span class="sc">-</span>MeanThetas)})</span>
<span id="cb12-107"><a href="sec10_4.html#cb12-107" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.01</span>; criticalval <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="dv">1</span><span class="sc">-</span>alpha, K <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb12-108"><a href="sec10_4.html#cb12-108" tabindex="-1"></a>idGoodThetas <span class="ot">&lt;-</span> <span class="fu">which</span>(ChiSQ <span class="sc">&lt;=</span> criticalval)</span>
<span id="cb12-109"><a href="sec10_4.html#cb12-109" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> S, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb12-110"><a href="sec10_4.html#cb12-110" tabindex="-1"></a>InvMargLik2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-111"><a href="sec10_4.html#cb12-111" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> idGoodThetas){</span>
<span id="cb12-112"><a href="sec10_4.html#cb12-112" tabindex="-1"></a>    LogInvs <span class="ot">&lt;-</span> <span class="fu">GDmarglik</span>(<span class="at">ids =</span> s, <span class="at">X =</span> X, <span class="at">Betas =</span> Betas, <span class="at">MeanThetas =</span> MeanThetas, <span class="at">VarThetas =</span> VarThetas, <span class="at">sig2Post =</span> sig2Post)</span>
<span id="cb12-113"><a href="sec10_4.html#cb12-113" tabindex="-1"></a>    InvMargLik2 <span class="ot">&lt;-</span> <span class="fu">c</span>(InvMargLik2, LogInvs)</span>
<span id="cb12-114"><a href="sec10_4.html#cb12-114" tabindex="-1"></a>    <span class="fu">setWinProgressBar</span>(pb, s, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(s<span class="sc">/</span>S<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>),<span class="st">&quot;% done&quot;</span>))</span>
<span id="cb12-115"><a href="sec10_4.html#cb12-115" tabindex="-1"></a>}</span>
<span id="cb12-116"><a href="sec10_4.html#cb12-116" tabindex="-1"></a><span class="fu">close</span>(pb); <span class="fu">mean</span>(InvMargLik2)</span>
<span id="cb12-117"><a href="sec10_4.html#cb12-117" tabindex="-1"></a><span class="co"># Restricted model</span></span>
<span id="cb12-118"><a href="sec10_4.html#cb12-118" tabindex="-1"></a>anRest <span class="ot">&lt;-</span> N <span class="sc">+</span> a0; XRest <span class="ot">&lt;-</span> X[,<span class="sc">-</span><span class="dv">5</span>]</span>
<span id="cb12-119"><a href="sec10_4.html#cb12-119" tabindex="-1"></a>KRest <span class="ot">&lt;-</span> <span class="fu">dim</span>(XRest)[<span class="dv">2</span>]; B0Rest <span class="ot">&lt;-</span> cOpt<span class="sc">*</span><span class="fu">diag</span>(KRest) </span>
<span id="cb12-120"><a href="sec10_4.html#cb12-120" tabindex="-1"></a>BnRest <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">solve</span>(B0Rest)<span class="sc">+</span><span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest)</span>
<span id="cb12-121"><a href="sec10_4.html#cb12-121" tabindex="-1"></a>bhatRest <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest)<span class="sc">%*%</span><span class="fu">t</span>(XRest)<span class="sc">%*%</span>Y</span>
<span id="cb12-122"><a href="sec10_4.html#cb12-122" tabindex="-1"></a>b0Rest <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, KRest)</span>
<span id="cb12-123"><a href="sec10_4.html#cb12-123" tabindex="-1"></a>bnRest <span class="ot">&lt;-</span> BnRest<span class="sc">%*%</span>(<span class="fu">solve</span>(B0Rest)<span class="sc">%*%</span>b0Rest<span class="sc">+</span><span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest<span class="sc">%*%</span>bhatRest)</span>
<span id="cb12-124"><a href="sec10_4.html#cb12-124" tabindex="-1"></a>dnRest <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(d0 <span class="sc">+</span> <span class="fu">t</span>(Y<span class="sc">-</span>XRest<span class="sc">%*%</span>bhatRest)<span class="sc">%*%</span>(Y<span class="sc">-</span>XRest<span class="sc">%*%</span>bhatRest)<span class="sc">+</span><span class="fu">t</span>(bhatRest <span class="sc">-</span> b0Rest)<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">solve</span>(<span class="fu">t</span>(XRest)<span class="sc">%*%</span>XRest)<span class="sc">+</span>B0Rest)<span class="sc">%*%</span>(bhatRest <span class="sc">-</span> b0Rest))</span>
<span id="cb12-125"><a href="sec10_4.html#cb12-125" tabindex="-1"></a>HnRest <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">forceSymmetric</span>(dnRest<span class="sc">*</span>BnRest<span class="sc">/</span>anRest))</span>
<span id="cb12-126"><a href="sec10_4.html#cb12-126" tabindex="-1"></a>sig2PostRest <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">rinvgamma</span>(S,anRest<span class="sc">/</span><span class="dv">2</span>,dnRest<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-127"><a href="sec10_4.html#cb12-127" tabindex="-1"></a>BetasRest <span class="ot">&lt;-</span> LaplacesDemon<span class="sc">::</span><span class="fu">rmvt</span>(S, bnRest, HnRest, anRest)</span>
<span id="cb12-128"><a href="sec10_4.html#cb12-128" tabindex="-1"></a>ThetasRest <span class="ot">&lt;-</span> <span class="fu">cbind</span>(BetasRest, sig2PostRest)</span>
<span id="cb12-129"><a href="sec10_4.html#cb12-129" tabindex="-1"></a>MeanThetasRest <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(ThetasRest)</span>
<span id="cb12-130"><a href="sec10_4.html#cb12-130" tabindex="-1"></a>VarThetasRest <span class="ot">&lt;-</span> <span class="fu">var</span>(ThetasRest)</span>
<span id="cb12-131"><a href="sec10_4.html#cb12-131" tabindex="-1"></a>iVarThetasRest <span class="ot">&lt;-</span> <span class="fu">solve</span>(VarThetasRest)</span>
<span id="cb12-132"><a href="sec10_4.html#cb12-132" tabindex="-1"></a>ChiSQRest <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>S, <span class="cf">function</span>(s){(ThetasRest[s,]<span class="sc">-</span>MeanThetasRest)<span class="sc">%*%</span>iVarThetasRest<span class="sc">%*%</span>(ThetasRest[s,]<span class="sc">-</span>MeanThetasRest)})</span>
<span id="cb12-133"><a href="sec10_4.html#cb12-133" tabindex="-1"></a>idGoodThetasRest <span class="ot">&lt;-</span> <span class="fu">which</span>(ChiSQRest <span class="sc">&lt;=</span> criticalval)</span>
<span id="cb12-134"><a href="sec10_4.html#cb12-134" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> S, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb12-135"><a href="sec10_4.html#cb12-135" tabindex="-1"></a>InvMargLik1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-136"><a href="sec10_4.html#cb12-136" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> idGoodThetasRest){</span>
<span id="cb12-137"><a href="sec10_4.html#cb12-137" tabindex="-1"></a>    LogInvs <span class="ot">&lt;-</span> <span class="fu">GDmarglik</span>(<span class="at">ids =</span> s, <span class="at">X =</span> XRest, <span class="at">Betas =</span> BetasRest, <span class="at">MeanThetas =</span> MeanThetasRest, <span class="at">VarThetas =</span> VarThetasRest, <span class="at">sig2Post =</span> sig2PostRest)</span>
<span id="cb12-138"><a href="sec10_4.html#cb12-138" tabindex="-1"></a>    InvMargLik1 <span class="ot">&lt;-</span> <span class="fu">c</span>(InvMargLik1, LogInvs)</span>
<span id="cb12-139"><a href="sec10_4.html#cb12-139" tabindex="-1"></a>    <span class="fu">setWinProgressBar</span>(pb, s, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(s<span class="sc">/</span>S<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>),<span class="st">&quot;% done&quot;</span>))</span>
<span id="cb12-140"><a href="sec10_4.html#cb12-140" tabindex="-1"></a>}</span>
<span id="cb12-141"><a href="sec10_4.html#cb12-141" tabindex="-1"></a><span class="fu">close</span>(pb); <span class="fu">summary</span>(coda<span class="sc">::</span><span class="fu">mcmc</span>(InvMargLik1))</span>
<span id="cb12-142"><a href="sec10_4.html#cb12-142" tabindex="-1"></a><span class="fu">mean</span>(InvMargLik1)</span>
<span id="cb12-143"><a href="sec10_4.html#cb12-143" tabindex="-1"></a>BFFD <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">mean</span>(InvMargLik2)<span class="sc">-</span><span class="fu">mean</span>(InvMargLik1))</span>
<span id="cb12-144"><a href="sec10_4.html#cb12-144" tabindex="-1"></a>BFFD; <span class="fu">mean</span>(<span class="dv">1</span><span class="sc">/</span>BFFD); <span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span>BFFD)</span></code></pre></div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chib1995marginal" class="csl-entry">
Chib, Siddhartha. 1995. <span>“Marginal Likelihood from the Gibbs Output.”</span> <em>Journal of the American Statistical Association</em> 90 (432): 1313–21.
</div>
<div id="ref-chib2001marginal" class="csl-entry">
Chib, Siddhartha, and Ivan Jeliazkov. 2001. <span>“Marginal Likelihood from the Metropolis–Hastings Output.”</span> <em>Journal of the American Statistical Association</em> 96 (453): 270–81.
</div>
<div id="ref-chib2016bayes" class="csl-entry">
Chib, Siddhartha, and Todd A Kuffner. 2016. <span>“Bayes Factor Consistency.”</span> <em>arXiv Preprint arXiv:1607.00292</em>.
</div>
<div id="ref-dickey1971weighted" class="csl-entry">
Dickey, James M. 1971. <span>“The Weighted Likelihood Ratio, Linear Hypotheses on Normal Location Parameters.”</span> <em>The Annals of Mathematical Statistics</em>, 204–23.
</div>
<div id="ref-gelfand1994bayesian" class="csl-entry">
Gelfand, Alan E, and Dipak K Dey. 1994. <span>“Bayesian Model Choice: Asymptotics and Exact Calculations.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 56 (3): 501–14.
</div>
<div id="ref-geweke1999using" class="csl-entry">
Geweke, John. 1999. <span>“Using Simulation Methods for Bayesian Econometric Models: Inference, Development, and Communication.”</span> <em>Econometric Reviews</em> 18 (1): 1–73.
</div>
<div id="ref-greenberg2012introduction" class="csl-entry">
Greenberg, Edward. 2012. <em>Introduction to Bayesian Econometrics</em>. Cambridge University Press.
</div>
<div id="ref-Johnson2012" class="csl-entry">
Jhonson, V. E., and D. Rossell. 2012. <span>“Bayesian Model Selection in High-Dimensional Settings.”</span> <em>Journal of the American Statistical Association</em> 107 (498): 649–60.
</div>
<div id="ref-koop2003bayesian" class="csl-entry">
Koop, Gary M. 2003. <em>Bayesian Econometrics</em>. John Wiley &amp; Sons Inc.
</div>
<div id="ref-verdinelli1995computing" class="csl-entry">
Verdinelli, Isabella, and Larry Wasserman. 1995. <span>“Computing Bayes Factors Using a Generalization of the Savage-Dickey Density Ratio.”</span> <em>Journal of the American Statistical Association</em> 90 (430): 614–18.
</div>
<div id="ref-walker2004modern" class="csl-entry">
Walker, Stephen G. 2004a. <span>“Modern Bayesian Asymptotics.”</span> <em>Statistical Science</em>, 111–17.
</div>
<div id="ref-walker2004new" class="csl-entry">
Walker, Stephen G. 2004b. <span>“New Approaches to Bayesian Consistency.”</span> <em>Annals of Statistics</em> 32 (5): 2028–43. <a href="https://doi.org/10.1214/009053604000000409">https://doi.org/10.1214/009053604000000409</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p><span class="citation">Jhonson and Rossell (<a href="#ref-Johnson2012">2012</a>)</span> highlight the important distinction between pairwise consistency and model selection consistency. The latter requires the consistency of a sequence of pairwise nested comparisons.<a href="sec10_4.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Note that a sufficient condition for this assumption is to assume the same prior for the parameters that are the same in each model. <span class="citation">Verdinelli and Wasserman (<a href="#ref-verdinelli1995computing">1995</a>)</span> incorporate a correction factor when this assumption is not satisfied.<a href="sec10_4.html#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec103.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec10_5.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aramir21/IntroductionBayesianEconometricsBook/11-BMA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
