<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13.6 Regression discontinuity design (RD) | Introduction to Bayesian Econometrics</title>
  <meta name="description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="13.6 Regression discontinuity design (RD) | Introduction to Bayesian Econometrics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  <meta name="github-repo" content="https://github.com/aramir21/IntroductionBayesianEconometricsBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13.6 Regression discontinuity design (RD) | Introduction to Bayesian Econometrics" />
  
  <meta name="twitter:description" content="The subject of this textbook is Bayesian data modeling, with the primary aim of providing an introduction to its theoretical foundations and facilitating the application of Bayesian inference using a GUI." />
  

<meta name="author" content="Andrés Ramírez-Hassan" />


<meta name="date" content="2025-11-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec13_5.html"/>
<link rel="next" href="sec13_7.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Bayesian Econometrics: A GUIded toolkit using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="to-instructors-and-students.html"><a href="to-instructors-and-students.html"><i class="fa fa-check"></i>To instructors and students</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Chap1.html"><a href="Chap1.html"><i class="fa fa-check"></i><b>1</b> Basic formal concepts</a>
<ul>
<li class="chapter" data-level="1.1" data-path="sec11.html"><a href="sec11.html"><i class="fa fa-check"></i><b>1.1</b> The Bayes’ rule</a></li>
<li class="chapter" data-level="1.2" data-path="sec12.html"><a href="sec12.html"><i class="fa fa-check"></i><b>1.2</b> Bayesian framework: A brief summary of theory</a></li>
<li class="chapter" data-level="1.3" data-path="sec14.html"><a href="sec14.html"><i class="fa fa-check"></i><b>1.3</b> Bayesian reports: Decision theory under uncertainty</a></li>
<li class="chapter" data-level="1.4" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
<li class="chapter" data-level="1.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chap2.html"><a href="Chap2.html"><i class="fa fa-check"></i><b>2</b> Conceptual differences between the Bayesian and Frequentist approaches</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec21.html"><a href="sec21.html"><i class="fa fa-check"></i><b>2.1</b> The concept of probability</a></li>
<li class="chapter" data-level="2.2" data-path="sec22.html"><a href="sec22.html"><i class="fa fa-check"></i><b>2.2</b> Subjectivity is not the key</a></li>
<li class="chapter" data-level="2.3" data-path="sec23.html"><a href="sec23.html"><i class="fa fa-check"></i><b>2.3</b> Estimation, hypothesis testing and prediction</a></li>
<li class="chapter" data-level="2.4" data-path="sec24.html"><a href="sec24.html"><i class="fa fa-check"></i><b>2.4</b> The likelihood principle</a></li>
<li class="chapter" data-level="2.5" data-path="sec25.html"><a href="sec25.html"><i class="fa fa-check"></i><b>2.5</b> Why is not the Bayesian approach that popular?</a></li>
<li class="chapter" data-level="2.6" data-path="sec26.html"><a href="sec26.html"><i class="fa fa-check"></i><b>2.6</b> A simple working example</a></li>
<li class="chapter" data-level="2.7" data-path="sec27.html"><a href="sec27.html"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
<li class="chapter" data-level="2.8" data-path="sec28.html"><a href="sec28.html"><i class="fa fa-check"></i><b>2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chap3.html"><a href="Chap3.html"><i class="fa fa-check"></i><b>3</b> Cornerstone models: Conjugate families</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec41.html"><a href="sec41.html"><i class="fa fa-check"></i><b>3.1</b> Motivation of conjugate families</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="sec41.html"><a href="sec41.html#examples-of-exponential-family-distributions"><i class="fa fa-check"></i><b>3.1.1</b> Examples of exponential family distributions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="sec42.html"><a href="sec42.html"><i class="fa fa-check"></i><b>3.2</b> Conjugate prior to exponential family</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sec42.html"><a href="sec42.html#sec421"><i class="fa fa-check"></i><b>3.2.1</b> Examples: Theorem 4.2.1</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sec43.html"><a href="sec43.html"><i class="fa fa-check"></i><b>3.3</b> Linear regression: The conjugate normal-normal/inverse gamma model</a></li>
<li class="chapter" data-level="3.4" data-path="sec44.html"><a href="sec44.html"><i class="fa fa-check"></i><b>3.4</b> Multivariate linear regression: The conjugate normal-normal/inverse Wishart model</a></li>
<li class="chapter" data-level="3.5" data-path="sec45.html"><a href="sec45.html"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
<li class="chapter" data-level="3.6" data-path="sec46.html"><a href="sec46.html"><i class="fa fa-check"></i><b>3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chap4.html"><a href="Chap4.html"><i class="fa fa-check"></i><b>4</b> Simulation methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec51.html"><a href="sec51.html"><i class="fa fa-check"></i><b>4.1</b> Markov Chain Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="sec51.html"><a href="sec51.html#sec511"><i class="fa fa-check"></i><b>4.1.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="4.1.2" data-path="sec51.html"><a href="sec51.html#sec512"><i class="fa fa-check"></i><b>4.1.2</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="4.1.3" data-path="sec51.html"><a href="sec51.html#sec513"><i class="fa fa-check"></i><b>4.1.3</b> Hamiltonian Monte Carlo</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sec52.html"><a href="sec52.html"><i class="fa fa-check"></i><b>4.2</b> Importance sampling</a></li>
<li class="chapter" data-level="4.3" data-path="sec53.html"><a href="sec53.html"><i class="fa fa-check"></i><b>4.3</b> Particle filtering</a></li>
<li class="chapter" data-level="4.4" data-path="sec54.html"><a href="sec54.html"><i class="fa fa-check"></i><b>4.4</b> Convergence diagnostics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="sec54.html"><a href="sec54.html#numerical-standard-error"><i class="fa fa-check"></i><b>4.4.1</b> Numerical standard error</a></li>
<li class="chapter" data-level="4.4.2" data-path="sec54.html"><a href="sec54.html#effective-number-of-simulation-draws"><i class="fa fa-check"></i><b>4.4.2</b> Effective number of simulation draws</a></li>
<li class="chapter" data-level="4.4.3" data-path="sec54.html"><a href="sec54.html#tests-of-convergence"><i class="fa fa-check"></i><b>4.4.3</b> Tests of convergence</a></li>
<li class="chapter" data-level="4.4.4" data-path="sec54.html"><a href="sec54.html#checking-for-errors-in-the-posterior-simulator"><i class="fa fa-check"></i><b>4.4.4</b> Checking for errors in the posterior simulator</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="sec55.html"><a href="sec55.html"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
<li class="chapter" data-level="4.6" data-path="sec56.html"><a href="sec56.html"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chap5.html"><a href="Chap5.html"><i class="fa fa-check"></i><b>5</b> Graphical user interface</a>
<ul>
<li class="chapter" data-level="5.1" data-path="secGUI1.html"><a href="secGUI1.html"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="secGUI2.html"><a href="secGUI2.html"><i class="fa fa-check"></i><b>5.2</b> Univariate models</a></li>
<li class="chapter" data-level="5.3" data-path="secGUI3.html"><a href="secGUI3.html"><i class="fa fa-check"></i><b>5.3</b> Multivariate models</a></li>
<li class="chapter" data-level="5.4" data-path="secGUI4.html"><a href="secGUI4.html"><i class="fa fa-check"></i><b>5.4</b> Time series models</a></li>
<li class="chapter" data-level="5.5" data-path="secGUI5.html"><a href="secGUI5.html"><i class="fa fa-check"></i><b>5.5</b> Longitudinal/panel models</a></li>
<li class="chapter" data-level="5.6" data-path="secGUI6.html"><a href="secGUI6.html"><i class="fa fa-check"></i><b>5.6</b> Bayesian model averaging</a></li>
<li class="chapter" data-level="5.7" data-path="secGUI7.html"><a href="secGUI7.html"><i class="fa fa-check"></i><b>5.7</b> Help</a></li>
<li class="chapter" data-level="5.8" data-path="secGUI8.html"><a href="secGUI8.html"><i class="fa fa-check"></i><b>5.8</b> Warning</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chap6.html"><a href="Chap6.html"><i class="fa fa-check"></i><b>6</b> Univariate models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec61.html"><a href="sec61.html"><i class="fa fa-check"></i><b>6.1</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="6.2" data-path="sec62.html"><a href="sec62.html"><i class="fa fa-check"></i><b>6.2</b> The logit model</a></li>
<li class="chapter" data-level="6.3" data-path="sec63.html"><a href="sec63.html"><i class="fa fa-check"></i><b>6.3</b> The probit model</a></li>
<li class="chapter" data-level="6.4" data-path="sec64.html"><a href="sec64.html"><i class="fa fa-check"></i><b>6.4</b> The multinomial probit model</a></li>
<li class="chapter" data-level="6.5" data-path="sec65.html"><a href="sec65.html"><i class="fa fa-check"></i><b>6.5</b> The multinomial logit model</a></li>
<li class="chapter" data-level="6.6" data-path="sec66.html"><a href="sec66.html"><i class="fa fa-check"></i><b>6.6</b> Ordered probit model</a></li>
<li class="chapter" data-level="6.7" data-path="negative-binomial-model.html"><a href="negative-binomial-model.html"><i class="fa fa-check"></i><b>6.7</b> Negative binomial model</a></li>
<li class="chapter" data-level="6.8" data-path="sec68.html"><a href="sec68.html"><i class="fa fa-check"></i><b>6.8</b> Tobit model</a></li>
<li class="chapter" data-level="6.9" data-path="sec69.html"><a href="sec69.html"><i class="fa fa-check"></i><b>6.9</b> Quantile regression</a></li>
<li class="chapter" data-level="6.10" data-path="sec610.html"><a href="sec610.html"><i class="fa fa-check"></i><b>6.10</b> Bayesian bootstrap regression</a></li>
<li class="chapter" data-level="6.11" data-path="sec611.html"><a href="sec611.html"><i class="fa fa-check"></i><b>6.11</b> Summary</a></li>
<li class="chapter" data-level="6.12" data-path="sec612.html"><a href="sec612.html"><i class="fa fa-check"></i><b>6.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chap7.html"><a href="Chap7.html"><i class="fa fa-check"></i><b>7</b> Multivariate models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec71.html"><a href="sec71.html"><i class="fa fa-check"></i><b>7.1</b> Multivariate regression</a></li>
<li class="chapter" data-level="7.2" data-path="sec72.html"><a href="sec72.html"><i class="fa fa-check"></i><b>7.2</b> Seemingly Unrelated Regression</a></li>
<li class="chapter" data-level="7.3" data-path="sec73.html"><a href="sec73.html"><i class="fa fa-check"></i><b>7.3</b> Instrumental variable</a></li>
<li class="chapter" data-level="7.4" data-path="sec74.html"><a href="sec74.html"><i class="fa fa-check"></i><b>7.4</b> Multivariate probit model</a></li>
<li class="chapter" data-level="7.5" data-path="sec75.html"><a href="sec75.html"><i class="fa fa-check"></i><b>7.5</b> Summary</a></li>
<li class="chapter" data-level="7.6" data-path="sec76.html"><a href="sec76.html"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chap8.html"><a href="Chap8.html"><i class="fa fa-check"></i><b>8</b> Time series models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec81.html"><a href="sec81.html"><i class="fa fa-check"></i><b>8.1</b> State-space representation</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="sec81.html"><a href="sec81.html#gaussian-linear-state-space-models"><i class="fa fa-check"></i><b>8.1.1</b> Gaussian linear state-space models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="sec82.html"><a href="sec82.html"><i class="fa fa-check"></i><b>8.2</b> ARMA processes</a></li>
<li class="chapter" data-level="8.3" data-path="sec83.html"><a href="sec83.html"><i class="fa fa-check"></i><b>8.3</b> Stochastic volatility models</a></li>
<li class="chapter" data-level="8.4" data-path="sec84.html"><a href="sec84.html"><i class="fa fa-check"></i><b>8.4</b> Vector Autoregressive models</a></li>
<li class="chapter" data-level="8.5" data-path="sec85.html"><a href="sec85.html"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
<li class="chapter" data-level="8.6" data-path="sec86.html"><a href="sec86.html"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chap9.html"><a href="Chap9.html"><i class="fa fa-check"></i><b>9</b> Longitudinal/Panel data models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec91.html"><a href="sec91.html"><i class="fa fa-check"></i><b>9.1</b> Normal model</a></li>
<li class="chapter" data-level="9.2" data-path="sec92.html"><a href="sec92.html"><i class="fa fa-check"></i><b>9.2</b> Logit model</a></li>
<li class="chapter" data-level="9.3" data-path="sec93.html"><a href="sec93.html"><i class="fa fa-check"></i><b>9.3</b> Poisson model</a></li>
<li class="chapter" data-level="9.4" data-path="sec94.html"><a href="sec94.html"><i class="fa fa-check"></i><b>9.4</b> Summary</a></li>
<li class="chapter" data-level="9.5" data-path="sec95.html"><a href="sec95.html"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Chap10.html"><a href="Chap10.html"><i class="fa fa-check"></i><b>10</b> Bayesian model averaging</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec10_1.html"><a href="sec10_1.html"><i class="fa fa-check"></i><b>10.1</b> Foundation</a></li>
<li class="chapter" data-level="10.2" data-path="sec102.html"><a href="sec102.html"><i class="fa fa-check"></i><b>10.2</b> The Gaussian linear model</a></li>
<li class="chapter" data-level="10.3" data-path="sec103.html"><a href="sec103.html"><i class="fa fa-check"></i><b>10.3</b> Generalized linear models</a></li>
<li class="chapter" data-level="10.4" data-path="sec10_4.html"><a href="sec10_4.html"><i class="fa fa-check"></i><b>10.4</b> Calculating the marginal likelihood</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_1"><i class="fa fa-check"></i><b>10.4.1</b> Savage-Dickey density ratio</a></li>
<li class="chapter" data-level="10.4.2" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_2"><i class="fa fa-check"></i><b>10.4.2</b> Chib’s methods</a></li>
<li class="chapter" data-level="10.4.3" data-path="sec10_4.html"><a href="sec10_4.html#sec10_4_3"><i class="fa fa-check"></i><b>10.4.3</b> Gelfand-Dey method</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="sec10_5.html"><a href="sec10_5.html"><i class="fa fa-check"></i><b>10.5</b> Summary</a></li>
<li class="chapter" data-level="10.6" data-path="sec10_6.html"><a href="sec10_6.html"><i class="fa fa-check"></i><b>10.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Chap11.html"><a href="Chap11.html"><i class="fa fa-check"></i><b>11</b> Semi-parametric and non-parametric models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec11_1.html"><a href="sec11_1.html"><i class="fa fa-check"></i><b>11.1</b> Mixture models</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="sec11_1.html"><a href="sec11_1.html#sec11_11"><i class="fa fa-check"></i><b>11.1.1</b> Finite Gaussian mixtures</a></li>
<li class="chapter" data-level="11.1.2" data-path="sec11_1.html"><a href="sec11_1.html#sec11_12"><i class="fa fa-check"></i><b>11.1.2</b> Direchlet processes</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="sec11_2.html"><a href="sec11_2.html"><i class="fa fa-check"></i><b>11.2</b> Splines</a></li>
<li class="chapter" data-level="11.3" data-path="sec11_3.html"><a href="sec11_3.html"><i class="fa fa-check"></i><b>11.3</b> Summary</a></li>
<li class="chapter" data-level="11.4" data-path="sec11_4.html"><a href="sec11_4.html"><i class="fa fa-check"></i><b>11.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Chap12.html"><a href="Chap12.html"><i class="fa fa-check"></i><b>12</b> Bayesian machine learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sec12_1.html"><a href="sec12_1.html"><i class="fa fa-check"></i><b>12.1</b> Cross-validation and Bayes factors</a></li>
<li class="chapter" data-level="12.2" data-path="sec12_2.html"><a href="sec12_2.html"><i class="fa fa-check"></i><b>12.2</b> Regularization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="sec12_2.html"><a href="sec12_2.html#sec12_21"><i class="fa fa-check"></i><b>12.2.1</b> Bayesian LASSO</a></li>
<li class="chapter" data-level="12.2.2" data-path="sec12_2.html"><a href="sec12_2.html#sec12_22"><i class="fa fa-check"></i><b>12.2.2</b> Stochastic search variable selection</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="sec12_3.html"><a href="sec12_3.html"><i class="fa fa-check"></i><b>12.3</b> Bayesian additive regression trees</a></li>
<li class="chapter" data-level="12.4" data-path="sec12_4.html"><a href="sec12_4.html"><i class="fa fa-check"></i><b>12.4</b> Gaussian processes</a></li>
<li class="chapter" data-level="12.5" data-path="sec12_5.html"><a href="sec12_5.html"><i class="fa fa-check"></i><b>12.5</b> Tall data problems</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="sec12_5.html"><a href="sec12_5.html#sec12_51"><i class="fa fa-check"></i><b>12.5.1</b> Divide-and-conquer methods</a></li>
<li class="chapter" data-level="12.5.2" data-path="sec12_5.html"><a href="sec12_5.html#sec12_52"><i class="fa fa-check"></i><b>12.5.2</b> Subsampling-based algorithms</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="id_13_6.html"><a href="id_13_6.html"><i class="fa fa-check"></i><b>12.6</b> Summary</a></li>
<li class="chapter" data-level="12.7" data-path="id_13_7.html"><a href="id_13_7.html"><i class="fa fa-check"></i><b>12.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Chap13.html"><a href="Chap13.html"><i class="fa fa-check"></i><b>13</b> Causal inference</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec13_1.html"><a href="sec13_1.html"><i class="fa fa-check"></i><b>13.1</b> Identification setting</a></li>
<li class="chapter" data-level="13.2" data-path="sec13_2.html"><a href="sec13_2.html"><i class="fa fa-check"></i><b>13.2</b> Randomized controlled trial (RCT)</a></li>
<li class="chapter" data-level="13.3" data-path="sec13_3.html"><a href="sec13_3.html"><i class="fa fa-check"></i><b>13.3</b> Conditional independence assumption (CIA)</a></li>
<li class="chapter" data-level="13.4" data-path="sec13_4.html"><a href="sec13_4.html"><i class="fa fa-check"></i><b>13.4</b> Instrumental variables (IV)</a></li>
<li class="chapter" data-level="13.5" data-path="sec13_5.html"><a href="sec13_5.html"><i class="fa fa-check"></i><b>13.5</b> Difference-in-differences design (DiD)</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="sec13_5.html"><a href="sec13_5.html#sec13_51"><i class="fa fa-check"></i><b>13.5.1</b> Classic DiD: two-group and two-period (<span class="math inline">\(2\times2\)</span>) setup</a></li>
<li class="chapter" data-level="13.5.2" data-path="sec13_5.html"><a href="sec13_5.html#sec13_52"><i class="fa fa-check"></i><b>13.5.2</b> Staggered (SDiD): G-group and T-period (<span class="math inline">\(G\times T\)</span>) setup</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="sec13_6.html"><a href="sec13_6.html"><i class="fa fa-check"></i><b>13.6</b> Regression discontinuity design (RD)</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="sec13_6.html"><a href="sec13_6.html#sec13_61"><i class="fa fa-check"></i><b>13.6.1</b> Sharp regression discontinuity design (SRD)</a></li>
<li class="chapter" data-level="13.6.2" data-path="sec13_6.html"><a href="sec13_6.html#sec13_62"><i class="fa fa-check"></i><b>13.6.2</b> Fuzzy regression discontinuity design (FRD)</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="sec13_7.html"><a href="sec13_7.html"><i class="fa fa-check"></i><b>13.7</b> Sample selection</a></li>
<li class="chapter" data-level="13.8" data-path="sec13_8.html"><a href="sec13_8.html"><i class="fa fa-check"></i><b>13.8</b> Bayesian exponentially tilted empirical likelihood</a></li>
<li class="chapter" data-level="13.9" data-path="sec13_9.html"><a href="sec13_9.html"><i class="fa fa-check"></i><b>13.9</b> General Bayes posteriors</a></li>
<li class="chapter" data-level="13.10" data-path="sec13_10.html"><a href="sec13_10.html"><i class="fa fa-check"></i><b>13.10</b> Doubly robust Bayesian inferential framework (DRB)</a></li>
<li class="chapter" data-level="13.11" data-path="sec13_11.html"><a href="sec13_11.html"><i class="fa fa-check"></i><b>13.11</b> Summary</a></li>
<li class="chapter" data-level="13.12" data-path="sec13_12.html"><a href="sec13_12.html"><i class="fa fa-check"></i><b>13.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Chap14.html"><a href="Chap14.html"><i class="fa fa-check"></i><b>14</b> Approximate Bayesian methods</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sec14_1.html"><a href="sec14_1.html"><i class="fa fa-check"></i><b>14.1</b> Simulation-based approaches</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="sec14_1.html"><a href="sec14_1.html#sec14_11"><i class="fa fa-check"></i><b>14.1.1</b> Approximate Bayesian computation</a></li>
<li class="chapter" data-level="14.1.2" data-path="sec14_1.html"><a href="sec14_1.html#sec14_12"><i class="fa fa-check"></i><b>14.1.2</b> Bayesian synthetic likelihood</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="sec14_2.html"><a href="sec14_2.html"><i class="fa fa-check"></i><b>14.2</b> Optimization approaches</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="sec14_2.html"><a href="sec14_2.html#sec14_21"><i class="fa fa-check"></i><b>14.2.1</b> Integrated nested Laplace approximations</a></li>
<li class="chapter" data-level="14.2.2" data-path="sec14_2.html"><a href="sec14_2.html#sec14_22"><i class="fa fa-check"></i><b>14.2.2</b> Variational Bayes</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>14.3</b> Summary</a></li>
<li class="chapter" data-level="14.4" data-path="sec14_4.html"><a href="sec14_4.html"><i class="fa fa-check"></i><b>14.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a>
<ul>
<li class="chapter" data-level="" data-path="packages-and-commands-in-besmarter-gui.html"><a href="packages-and-commands-in-besmarter-gui.html"><i class="fa fa-check"></i>Packages and commands in BEsmarter GUI</a></li>
<li class="chapter" data-level="" data-path="datasets-templates-in-folder-datasim.html"><a href="datasets-templates-in-folder-datasim.html"><i class="fa fa-check"></i>Datasets templates in folder DataSim</a></li>
<li class="chapter" data-level="" data-path="real-datasets-in-folder-dataapp.html"><a href="real-datasets-in-folder-dataapp.html"><i class="fa fa-check"></i>Real datasets in folder DataApp</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bayesian Econometrics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec13_6" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">13.6</span> Regression discontinuity design (RD)<a href="sec13_6.html#sec13_6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we study the <em>regression discontinuity</em> (RD) design. In particular, we analyze the causal effect of a binary treatment <span class="math inline">\(D_i\)</span> on an outcome <span class="math inline">\(Y_i\)</span> within the potential outcomes (Rubin causal model) framework, namely <span class="math inline">\(Y_i(1)-Y_i(0)\)</span>. As usual, we face the fundamental problem of causal inference. Identification in RD relies on a <em>running variable</em> <span class="math inline">\(Z_i\)</span>, also known as the <em>forcing</em>, <em>index</em>, or <em>score variable</em>, which determines treatment assignment, either completely or partially, depending on whether a unit lies on either side of a known cutoff <span class="math inline">\(c\)</span>. The running variable may be associated with the potential outcomes, but this association is assumed to be smooth at <span class="math inline">\(c\)</span>. Under this smoothness assumption (and in the absence of precise manipulation at <span class="math inline">\(c\)</span>), any discontinuity in the conditional mean of <span class="math inline">\(Y_i\)</span> as a function of <span class="math inline">\(Z_i\)</span> at <span class="math inline">\(c\)</span> identifies the causal effect of the treatment at the cutoff <span class="citation">(<a href="#ref-imbens2008regression">Guido W. Imbens and Lemieux 2008</a>)</span>.</p>
<p>There are two common versions of RD: <em>sharp</em> and <em>fuzzy</em>. In the former, the change (jump) in the conditional probability of treatment at the cutoff equals one; in the latter, it is strictly between zero and one:</p>
<p><span class="math display">\[
\Delta \;=\; \lim_{z \downarrow c}\Pr(D_i=1\mid Z_i=z)-\lim_{z \uparrow c}\Pr(D_i=1\mid Z_i=z)
=
\begin{cases}
    1, &amp; \text{sharp RD},\\[2pt]
    \in(0,1), &amp; \text{fuzzy RD}.
\end{cases}
\]</span></p>
<p>Here <span class="math inline">\(\lim_{z \downarrow c}\)</span> and <span class="math inline">\(\lim_{z \uparrow c}\)</span> denote the right (approach from above) and left (approach from below) limits, respectively.</p>
<div id="sec13_61" class="section level3 hasAnchor" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> Sharp regression discontinuity design (SRD)<a href="sec13_6.html#sec13_61" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the sharp case, treatment assignment is a deterministic function of the running variable:</p>
<p><span class="math display">\[
D_i = \mathbf{1}\{Z_i \ge c\},
\]</span></p>
<p>so the conditional probability of treatment jumps from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span> at <span class="math inline">\(Z_i=c\)</span>. All units with <span class="math inline">\(Z_i \ge c\)</span> are treated, whereas those with <span class="math inline">\(Z_i &lt; c\)</span> serve as the control group. Therefore, assignment is identical to treatment in the sharp RD (perfect compliance). The following figure displays the conditional probability of treatment.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-15"></span>
<img src="figures/FigChap13_9.png" alt="Sharp regression discontinuity design: Conditional probability of treatment." width="500px" />
<p class="caption">
Figure 13.9: Sharp regression discontinuity design: Conditional probability of treatment.
</p>
</div>
<p>The observed outcome is given by</p>
<p><span class="math display">\[
Y_i=(1-D_i)\cdot Y_i(0) + D_i\cdot Y_i(1)=
\begin{cases}
    Y_i(0), &amp; Z_i &lt; c,\\
    Y_i(1), &amp; Z_i \geq c.
\end{cases}
\]</span></p>
<p>Thus, the causal effect that we target in SRD is</p>
<p><span class="math display">\[
\tau_{SRD}=\mathbb{E}[Y_i(1)-Y_i(0)\mid Z_i=c].
\]</span></p>
<p>Note that the treatment effect is evaluated at the cutoff, which is a single point in the support of the running variable. Hence <span class="math inline">\(\tau_{\text{SRD}}\)</span> is inherently local and need not be representative of units whose running variable lies far from <span class="math inline">\(c\)</span>.<br />
The identification of <span class="math inline">\(\tau_{\text{SRD}}\)</span> requires <em>continuity of the potential outcome regression functions</em>, that is,</p>
<p><span class="math display">\[
\mathbb{E}[Y_i(0)\mid Z_i=z]\ \text{and}\ \mathbb{E}[Y_i(1)\mid Z_i=z]
\]</span></p>
<p>are continuous at <span class="math inline">\(z\)</span>. Strictly speaking, it suffices that the left- and right-hand limits of <span class="math inline">\(\mathbb{E}[Y_i(d)\mid Z_i=z]\)</span> coincide at <span class="math inline">\(z=c\)</span> for <span class="math inline">\(d\in\{0,1\}\)</span>.</p>
<p>This implies</p>
<p><span class="math display">\[
\begin{aligned}
    \mathbb{E}[Y_i(0)\mid Z_i=c]
    &amp;= \lim_{z \uparrow c}\mathbb{E}[Y_i(0)\mid Z_i=z] \\
    &amp;= \lim_{z \uparrow c}\mathbb{E}[Y_i(0)\mid Z_i=z, D_i=0] \\
    &amp;= \lim_{z \uparrow c}\mathbb{E}[Y_i\mid Z_i=z],
\end{aligned}
\]</span></p>
<p>since for <span class="math inline">\(z&lt;c\)</span> we have <span class="math inline">\(D_i=0\)</span>. Similarly,</p>
<p><span class="math display">\[
\begin{aligned}
    \mathbb{E}[Y_i(1)\mid Z_i=c]
    &amp;= \lim_{z \downarrow c}\mathbb{E}[Y_i(1)\mid Z_i=z] \\
    &amp;= \lim_{z \downarrow c}\mathbb{E}[Y_i\mid Z_i=z],
\end{aligned}
\]</span></p>
<p>because for <span class="math inline">\(z&gt;c\)</span> we have <span class="math inline">\(D_i=1\)</span>. Therefore,</p>
<p><span class="math display">\[
\tau_{\text{SRD}}
= \lim_{z \downarrow c}\mathbb{E}[Y_i\mid Z_i=z]
- \lim_{z \uparrow c}\mathbb{E}[Y_i\mid Z_i=z],
\]</span></p>
<p>i.e., the target estimand is the jump in the conditional mean at the discontinuity point <span class="math inline">\(c\)</span>. See the following figure.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-16"></span>
<img src="figures/FigChap13_10.png" alt="RD treatment effect in a sharp RD design. Solid segments are observed on each side of $c$; dashed segments are counterfactual." width="500px" />
<p class="caption">
Figure 13.10: RD treatment effect in a sharp RD design. Solid segments are observed on each side of <span class="math inline">\(c\)</span>; dashed segments are counterfactual.
</p>
</div>
</div>
<div id="sec13_62" class="section level3 hasAnchor" number="13.6.2">
<h3><span class="header-section-number">13.6.2</span> Fuzzy regression discontinuity design (FRD)<a href="sec13_6.html#sec13_62" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the fuzzy case, the conditional probability of treatment has a discontinuous jump at the cutoff that is strictly between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>:
<span class="math display">\[\begin{align*}
    \lim_{z \uparrow c} \Pr(D_i=1 \mid Z_i=z) \ne \lim_{z \downarrow c} \Pr(D_i=1 \mid Z_i=z),\\
    0 \;&lt;\; \lim_{z \downarrow c} \Pr(D_i=1 \mid Z_i=z) \;-\; \lim_{z \uparrow c} \Pr(D_i=1 \mid Z_i=z) \;&lt;\; 1.
\end{align*}\]</span>
Thus, the probability of treatment increases discontinuously at <span class="math inline">\(c\)</span>. Note that in a fuzzy RD, compliance is imperfect: some units assigned to treatment do not take it, and some units not assigned may nonetheless receive it. The following figure displays the conditional probability of treatment.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-17"></span>
<img src="figures/FigChap13_11.png" alt="Fuzzy regression discontinuity design: Conditional probability of treatment." width="500px" />
<p class="caption">
Figure 13.11: Fuzzy regression discontinuity design: Conditional probability of treatment.
</p>
</div>
<p>Note that the expected value of the observed outcome given the running variable is given by
<span class="math display">\[\begin{align*}
    \mathbb{E}[Y_i\mid Z_i=z]&amp;=\mathbb{E}[Y_i(0)\mid D_i=0, Z_i=z]P(D_i=0\mid Z_i=z)\\
    &amp;+\mathbb{E}[Y_i(1)\mid D_i=1, Z_i=z]P(D_i=1\mid Z_i=z).
\end{align*}\]</span></p>
<p>Thus, the observed outcome is a weighted average of potential outcomes. The following figure displays the treatment effect that we are targeting.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="figures/FigChap13_12.png" alt="RD treatment effect in a fuzzy RD design. Solid segments are observed on each side of $c$; dashed segments are counterfactual." width="500px" />
<p class="caption">
Figure 13.12: RD treatment effect in a fuzzy RD design. Solid segments are observed on each side of <span class="math inline">\(c\)</span>; dashed segments are counterfactual.
</p>
</div>
<p>The target causal effect in the FRD is (see <span class="citation">Hahn, Todd, and Klaauw (<a href="#ref-hahn2001rdd">2001</a>)</span> for a proof)</p>
<p><span class="math display">\[
\tau_{\text{FRD}}
=
\frac{\lim_{z \downarrow c}\mathbb{E}[Y_i\mid Z_i=z]-\lim_{z \uparrow c}\mathbb{E}[Y_i\mid Z_i=z]}
{\lim_{z \downarrow c}\mathbb{E}[D_i\mid Z_i=z]-\lim_{z \uparrow c}\mathbb{E}[D_i\mid Z_i=z]}
=
\mathbb{E}[Y_i(1)-Y_i(0)\mid Z_i=c], \ \text{units are compliers}.
\]</span></p>
<p>Note that <span class="math inline">\(\tau_{\text{FRD}}\)</span> encompasses <span class="math inline">\(\tau_{\text{SRD}}\)</span> as <span class="math inline">\(\lim_{z \downarrow c}\mathbb{E}[D_i\mid Z_i=z]-\lim_{z \uparrow c}\mathbb{E}[D_i\mid Z_i=z]=1\)</span> in the SRD. In addition, <span class="math inline">\(\tau_{\text{FRD}}\)</span> has the same structure as the local average treatment effect (LATE) in the IV literature, with the instrument given by the eligibility indicator <span class="math inline">\(T_i=\mathbf{1}\{Z_i\ge c\}\)</span>. Because compliance is imperfect (some eligible units do not take treatment and some ineligible units receive it), <span class="math inline">\(D_i \neq T_i\)</span> for some units, and the estimand pertains to <em>compliers at the cutoff</em>.</p>
<p>Let <span class="math inline">\(D_i(z)\)</span> denote the potential treatment status if the cutoff were <span class="math inline">\(z\)</span> (for <span class="math inline">\(z\)</span> in a neighborhood of <span class="math inline">\(c\)</span>) such that <span class="math inline">\(D_i(z)=1\)</span> implies that the unit would be treated if the cutoff is <span class="math inline">\(z\)</span>. The identification assumptions are:</p>
<p><em>1. Continuity of the potential outcome regression functions</em>, particularly at <span class="math inline">\(c\)</span>.</p>
<p><em>2. A nontrivial first stage</em>,<br />
<span class="math inline">\(\lim_{z \downarrow c}\mathbb{E}[D_i\mid Z_i=z]-\lim_{z \uparrow c}\mathbb{E}[D_i\mid Z_i=z]\neq 0\)</span>,</p>
<p><em>3. Monotonicity</em>: <span class="math inline">\(D_i(z)\)</span> is non-increasing in <span class="math inline">\(z\)</span> at <span class="math inline">\(z=c\)</span>.</p>
<p>We can classify unit types (locally around the cutoff <span class="math inline">\(c\)</span>) using the potential treatment under a hypothetical cutoff <span class="math inline">\(z\)</span>, <span class="math inline">\(D_i(z)\)</span> as follows:</p>
<p><em>Complier status</em><br />
<span class="math display">\[
\lim_{z\downarrow Z_i}D_i(z)=0, \ \text{and} \ \lim_{z\uparrow Z_i}D_i(z)=1,
\]</span></p>
<p><em>Never-takers</em><br />
<span class="math display">\[
\lim_{z\downarrow Z_i}D_i(z)=0, \ \text{and} \ \lim_{z\uparrow Z_i}D_i(z)=0,
\]</span></p>
<p><em>Always-takers</em><br />
<span class="math display">\[
\lim_{z\downarrow Z_i}D_i(z)=1, \ \text{and} \ \lim_{z\uparrow Z_i}D_i(z)=1.
\]</span></p>
<p>Thus, compliers are units that would be treated if the cutoff were at or below their score <span class="math inline">\(Z_i\)</span>, and would not be treated if the cutoff were above <span class="math inline">\(Z_i\)</span>. Never-takers and always-takers do not change treatment status regardless of the cutoff: the former are always untreated, whereas the latter are always treated. Monotonicity precludes <em>defiers</em>.</p>
<p>See <span class="citation">Guido W. Imbens and Lemieux (<a href="#ref-imbens2008regression">2008</a>)</span> and <span class="citation">Cattaneo, Idrobo, and Titiunik (<a href="#ref-cattaneo2019practical">2019</a>)</span> for discussions of graphical and formal diagnostics of the assumptions in RD.</p>
<p><strong>Example: Returns to compulsory schooling <span class="citation">(<a href="#ref-chib2016bayesian">Chib and Jacobi 2016</a>)</span></strong></p>
<p><span class="citation">Chib and Jacobi (<a href="#ref-chib2016bayesian">2016</a>)</span> propose a Bayesian inferential framework that explicitly models unit type (complier, always-taker, and never-taker), which enables implementation of a Gibbs sampler. Their empirical application is motivated by the April 1947 reform in the United Kingdom that raised the minimum school-leaving age from 14 to 15.</p>
<p>In the example below, we construct a simulation calibrated to their application to illustrate Bayesian inference in a fuzzy RD. In particular, we specify priors, derive the full conditional distributions, and implement a Gibbs sampler to estimate the treatment effect at the cutoff.</p>
<p>There are three types of individuals: compliers (<span class="math inline">\(c\)</span>), never-takers (<span class="math inline">\(n\)</span>), and always-takers (<span class="math inline">\(a\)</span>). These imply four potential outcomes <span class="math inline">\(Y_{ic}(0)\)</span>, <span class="math inline">\(Y_{ic}(1)\)</span>, <span class="math inline">\(Y_{in}(0)\)</span>, and <span class="math inline">\(Y_{ia}(1)\)</span>. <span class="citation">Chib and Jacobi (<a href="#ref-chib2016bayesian">2016</a>)</span> assume</p>
<p><span class="math display">\[
Y_{ic}(0)=\beta_{0c0}+\beta_{0c1}Z_i+\mathbf{X}_i^{\top}\boldsymbol{\beta}_c+\mu_{0ci}=\mathbf{W}_{ic}^{\top}\beta_{0c}+\mu_{0ci},
\]</span></p>
<p><span class="math display">\[
Y_{ic}(1)=\beta_{1c0}+\beta_{1c1}Z_i+\mathbf{X}_i^{\top}\boldsymbol{\beta}_c+\mu_{1ci}=\mathbf{W}_{ic}^{\top}\beta_{1c}+\mu_{1ci},
\]</span></p>
<p><span class="math display">\[
Y_{in}(0)=\beta_{n0}+\mathbf{X}_i^{\top}\boldsymbol{\beta}_n+\mu_{ni}=\mathbf{W}_{in}^{\top}\beta_{0n}+\mu_{ni},
\]</span></p>
<p>and</p>
<p><span class="math display">\[
Y_{ia}(1)=\beta_{a0}+\mathbf{X}_i^{\top}\boldsymbol{\beta}_a+\mu_{ai}=\mathbf{W}_{ia}^{\top}\beta_{1a}+\mu_{ai},
\]</span></p>
<p>where <span class="math inline">\(\mu_{dci}\sim t_v(0,\sigma^2_{dc})\)</span> for <span class="math inline">\(d\in\{0,1\}\)</span>, <span class="math inline">\(\mu_{ni}\sim t_v(0,\sigma^2_{0n})\)</span>, and <span class="math inline">\(\mu_{ai}\sim t_v(0,\sigma^2_{1a})\)</span>; here <span class="math inline">\(t_v\)</span> denotes the Student-<span class="math inline">\(t\)</span> distribution with <span class="math inline">\(v\)</span> degrees of freedom. The running variable is centered at the cutoff, so <span class="math inline">\(Z_i=0\)</span> at the threshold, and the FRD treatment effect is</p>
<p><span class="math display">\[
\tau_{\text{FRD}}=\beta_{1c0}-\beta_{0c0}.
\]</span></p>
<p>There are four cells in this setting, defined by policy epochs <span class="math inline">\(\mathbf{1}(Z_i &lt; 0)\)</span> and <span class="math inline">\(\mathbf{1}(Z_i \geq 0)\)</span>, and treatment values <span class="math inline">\(D_i = 0\)</span> and <span class="math inline">\(D_i = 1\)</span>. Table <a href="sec13_6.html#tab:appCJ">13.5</a> shows the case where, in the cell without treatment under the old policy (<span class="math inline">\(K_{00}\)</span>), there are compliers and never-takers, while in the cell with treatment under the new policy (<span class="math inline">\(K_{11}\)</span>), there are compliers and always-takers.</p>
<table>
<caption><span id="tab:appCJ">Table 13.5: </span> Distribution of subject type by observed policy regime and treatment</caption>
<thead>
<tr class="header">
<th align="center">Policy indicator</th>
<th align="center"><span class="math inline">\(D_i = 0\)</span></th>
<th align="center"><span class="math inline">\(D_i = 1\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(\mathbf{1}(Z_i &lt; 0)\)</span> (old policy)</td>
<td align="center">c, n</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\mathbf{1}(Z_i \geq 0)\)</span> (new policy)</td>
<td align="center">n</td>
<td align="center">c, a</td>
</tr>
</tbody>
</table>
<p>The four cells by policy and treatment status are:</p>
<p><span class="math display">\[
K_{00} = \{c, n\}, \quad K_{10} = \{n\}, \quad K_{01} = \{a\}, \quad K_{11} = \{c, a\},
\]</span></p>
<p>and the two cells by treatment status are:</p>
<p><span class="math display">\[
K_0 = \{c, n\}, \quad K_1 = \{c, a\}.
\]</span></p>
<p>Under a Bayesian framework, posterior simulation simplifies because we sample each unit’s latent type <span class="math inline">\(C_i \in \{c, n, a\}\)</span>. This contrasts with the Frequentist literature, where types are not modeled explicitly. Thus, the Bayesian approach requires setting assumptions about the types (see <span class="citation">Chib and Jacobi (<a href="#ref-chib2016bayesian">2016</a>)</span> for details); for instance, types may be distributed smoothly around the cutoff with unknown distributions. In addition, given monotonicity, there are models for four potential outcomes. This differs from the Frequentist literature, which considers only two potential outcomes, given the binary treatment, and a model for the treatment.</p>
<p>Note that if we observe <span class="math inline">\(Z_i &lt; 0\)</span> and <span class="math inline">\(D_i = 0\)</span>, only compliers and never-takers are possible. Then,</p>
<p><span class="math display">\[
P(C_i = c \mid Y_i, D_i = 0, \boldsymbol{\theta})
= \frac{\eta_{c} \, t_v\!\big(Y_i \mid \mathbf{W}_{ic}^{\top} \boldsymbol{\beta}_{0c}, \sigma^2_{0c} \big)}
{\eta_{c} \, t_v\!\big(Y_i \mid \mathbf{W}_{ic}^{\top} \boldsymbol{\beta}_{0c}, \sigma^2_{0c} \big) +
    \eta_{n} \, t_v\!\big(Y_i \mid \mathbf{W}_{in}^{\top} \boldsymbol{\beta}_{0n}, \sigma^2_{0n} \big)}, \quad i \in K_{00}
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\theta}\)</span> denotes the set of model parameters, and <span class="math inline">\(\eta_{c}\)</span> and <span class="math inline">\(\eta_{n}\)</span> are the current mixture weights for a complier and a never-taker, respectively.</p>
<p>Conversely, if <span class="math inline">\(Z_i \geq 0\)</span> and <span class="math inline">\(D_i = 1\)</span>, only compliers and always-takers are possible:</p>
<p><span class="math display">\[
P(C_i = c \mid Y_i, D_i = 1, \boldsymbol{\theta})
= \frac{\eta_{c} \, t_v\!\big(Y_i \mid \mathbf{W}_{ic}^{\top} \boldsymbol{\beta}_{1c}, \sigma^2_{1c} \big)}
{\eta_{c} \, t_v\!\big(Y_i \mid \mathbf{W}_{ic}^{\top} \boldsymbol{\beta}_{1c}, \sigma^2_{1c} \big) +
    \eta_{a} \, t_v\!\big(Y_i \mid \mathbf{W}_{ia}^{\top} \boldsymbol{\beta}_{1a}, \sigma^2_{1a} \big)}, \quad i \in K_{11}
\]</span></p>
<p>where <span class="math inline">\(\eta_{a}\)</span> is the mixture weight for an always-taker.</p>
<p>Following <span class="citation">Chib and Jacobi (<a href="#ref-chib2016bayesian">2016</a>)</span>, we assume a Dirichlet prior for the mixing probabilities (<span class="math inline">\(\eta_c, \eta_n,\eta_a\)</span>) with hyperparameters <span class="math inline">\(\alpha_{0k}\)</span>, <span class="math inline">\(k \in \{c, n, a\}\)</span>. The posterior distribution is then Dirichlet with parameters <span class="math inline">\(\alpha_{0k} + \sum_{i=1}^N \mathbf{1}(C_i = k)\)</span>.</p>
<p>In addition, <span class="citation">Chib and Jacobi (<a href="#ref-chib2016bayesian">2016</a>)</span> use the normal–gamma mixture representation of the Student-<span class="math inline">\(t\)</span> distribution, where the mixing parameter satisfies <span class="math inline">\(\lambda_i \sim G(v/2, v/2)\)</span>. Consequently, the posterior distribution of <span class="math inline">\(\lambda_i\)</span> is gamma with parameters <span class="math inline">\((v+1)/2\)</span> and <span class="math inline">\((v + \sigma_{dk}^{-2}(y_i - \mathbf{W}_{ik}^{\top} \boldsymbol{\beta}_{dk})^2) / 2\)</span>.</p>
<p>The prior distribution for the location parameters <span class="math inline">\(\boldsymbol{\beta}_{dk}\)</span> is independent normal with mean <span class="math inline">\(\boldsymbol{\beta}_{dk,0}\)</span> and variance matrix <span class="math inline">\(\mathbf{B}_{dk,0}\)</span>. The posterior distribution of <span class="math inline">\(\boldsymbol{\beta}_{dk}\)</span> is normal with mean</p>
<p><span class="math display">\[
\boldsymbol{\beta}_{dk,n} = \mathbf{B}_{dk,n} \left( \mathbf{B}_{dk,0}^{-1} \boldsymbol{\beta}_{dk,0} + \sigma_{dk}^{-2} \sum_{i \in I_{dk}} \lambda_i \mathbf{W}_{ik} Y_i \right),
\]</span></p>
<p>and covariance matrix</p>
<p><span class="math display">\[
\mathbf{B}_{dk,n} = \left( \mathbf{B}_{dk,0}^{-1} + \sigma_{dk}^{-2} \sum_{i \in I_{dk}} \lambda_i \mathbf{W}_{ik} \mathbf{W}_{ik}^{\top} \right)^{-1},
\]</span></p>
<p>where <span class="math inline">\(I_{dk} = \{i : D_i = d, C_i = k\}\)</span> is the set of indices for observations by treatment status and unit type. Note that there are only four possible combinations determined by policy and treatment status, namely, <span class="math inline">\(I_{0c}\)</span>, <span class="math inline">\(I_{1c}\)</span>, <span class="math inline">\(I_{0n}\)</span> and <span class="math inline">\(I_{1a}\)</span>.</p>
<p>Finally, assuming that the prior distributions of the variances are independent inverse-gamma, <span class="math inline">\(\sigma_{dk}^2 \sim IG(\alpha_{dk,0}/2, \delta_{dk,0}/2)\)</span>, the posterior distributions are also inverse-gamma, <span class="math inline">\(\sigma_{dk}^2 \sim IG(\alpha_{dk,n}/2, \delta_{dk,n}/2)\)</span>, where</p>
<p><span class="math display">\[
\alpha_{dk,n} = \alpha_{dk,0} + N_{dk},
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\delta_{dk,n} = \delta_{dk,0} + \sum_{i \in I_{dk}} \lambda_i \left(Y_i - \mathbf{w}_{ik}^{\top} \boldsymbol{\beta}_{dk} \right)^2.
\]</span></p>
<p>Here, <span class="math inline">\(N_{dk}\)</span> denotes the number of elements (cardinality) of <span class="math inline">\(I_{dk}\)</span>.</p>
<p>The following code performs a simulation assuming that <span class="math inline">\(Z_i\)</span> follows a discrete uniform distribution from <span class="math inline">\(-24\)</span> to <span class="math inline">\(24\)</span>, where the policy indicator equals one if <span class="math inline">\(Z_i \geq 0\)</span>. Next, <span class="math inline">\(X_i\)</span> follows a discrete uniform distribution between <span class="math inline">\(85\)</span> and <span class="math inline">\(95\)</span>. We set <span class="math inline">\(\boldsymbol{\beta}_{0c} = [4.50 \ -0.20 \ 0.03]^{\top}\)</span> and <span class="math inline">\(\boldsymbol{\beta}_{1c} = [5.50 \ 0.40 \ 0.03]^{\top}\)</span>, so that the treatment effect is <span class="math inline">\(1\)</span>. In addition, <span class="math inline">\(\boldsymbol{\beta}_{0n} = [6.80 \ -0.02]^{\top}\)</span> and <span class="math inline">\(\boldsymbol{\beta}_{1a} = [5.50 \ -0.04]^{\top}\)</span>, with <span class="math inline">\(\sigma_{0c}^2 = \sigma_{1c}^2 = 0.10\)</span>, <span class="math inline">\(\sigma_{0n}^2 = 0.15\)</span>, and <span class="math inline">\(\sigma_{1a}^2 = 0.20\)</span>. The type probabilities are <span class="math inline">\(\eta_{c} = 0.70\)</span>, <span class="math inline">\(\eta_{n} = 0.15\)</span>, and <span class="math inline">\(\eta_{a} = 0.15\)</span>. We set the sample size to <span class="math inline">\(3{,}000\)</span> and <span class="math inline">\(v = 5\)</span>. In addition, we set non-informative priors, a burn-in of 1,000, and 5,000 MCMC iterations. The following code illustrates the implementation, and the figure presents the posterior distribution of the LATE. The 95% credible interval encompasses the population value, and the posterior mean lies close to this value.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="sec13_6.html#cb7-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()); <span class="fu">set.seed</span>(<span class="dv">10101</span>); <span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="sec13_6.html#cb7-2" tabindex="-1"></a><span class="co"># Simulation setup</span></span>
<span id="cb7-3"><a href="sec13_6.html#cb7-3" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">3000</span></span>
<span id="cb7-4"><a href="sec13_6.html#cb7-4" tabindex="-1"></a>Zi <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">24</span>, <span class="dv">24</span>, <span class="dv">1</span>), N, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># Running var</span></span>
<span id="cb7-5"><a href="sec13_6.html#cb7-5" tabindex="-1"></a>Z <span class="ot">&lt;-</span> Zi <span class="sc">-</span> <span class="fu">mean</span>(Zi)</span>
<span id="cb7-6"><a href="sec13_6.html#cb7-6" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(Z <span class="sc">&gt;=</span> <span class="dv">0</span>)                          <span class="co"># Policy (0/1)</span></span>
<span id="cb7-7"><a href="sec13_6.html#cb7-7" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">85</span>, <span class="dv">95</span>, <span class="dv">1</span>), N, <span class="at">replace =</span> <span class="cn">TRUE</span>)   <span class="co"># Regressor</span></span>
<span id="cb7-8"><a href="sec13_6.html#cb7-8" tabindex="-1"></a>Wc <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, Z, X)                             <span class="co"># Compliers</span></span>
<span id="cb7-9"><a href="sec13_6.html#cb7-9" tabindex="-1"></a>W  <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, X)                                <span class="co"># No compliers</span></span>
<span id="cb7-10"><a href="sec13_6.html#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="sec13_6.html#cb7-11" tabindex="-1"></a>B0c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.03</span>); B1c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">5.5</span>, <span class="fl">0.4</span>,  <span class="fl">0.03</span>)</span>
<span id="cb7-12"><a href="sec13_6.html#cb7-12" tabindex="-1"></a>B0n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.8</span>,  <span class="sc">-</span><span class="fl">0.02</span>); B1a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">5.5</span>,  <span class="sc">-</span><span class="fl">0.04</span>)</span>
<span id="cb7-13"><a href="sec13_6.html#cb7-13" tabindex="-1"></a>s2c <span class="ot">&lt;-</span> <span class="fl">0.1</span>; s2n <span class="ot">&lt;-</span> <span class="fl">0.15</span>; s2a <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb7-14"><a href="sec13_6.html#cb7-14" tabindex="-1"></a>Etac <span class="ot">&lt;-</span> <span class="fl">0.7</span>; Etan <span class="ot">&lt;-</span> <span class="fl">0.15</span>; Etaa <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb7-15"><a href="sec13_6.html#cb7-15" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb7-16"><a href="sec13_6.html#cb7-16" tabindex="-1"></a><span class="co"># Potential outcomes (Student-t noise scaled to match variances)</span></span>
<span id="cb7-17"><a href="sec13_6.html#cb7-17" tabindex="-1"></a>mu0c <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(s2c) <span class="sc">*</span> <span class="fu">rt</span>(N, v);  Y0c <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Wc <span class="sc">%*%</span> B0c <span class="sc">+</span> mu0c)</span>
<span id="cb7-18"><a href="sec13_6.html#cb7-18" tabindex="-1"></a>mu1c <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(s2c) <span class="sc">*</span> <span class="fu">rt</span>(N, v);  Y1c <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Wc <span class="sc">%*%</span> B1c <span class="sc">+</span> mu1c)</span>
<span id="cb7-19"><a href="sec13_6.html#cb7-19" tabindex="-1"></a>mu0n <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(s2n) <span class="sc">*</span> <span class="fu">rt</span>(N, v);  Y0n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(W  <span class="sc">%*%</span> B0n <span class="sc">+</span> mu0n)</span>
<span id="cb7-20"><a href="sec13_6.html#cb7-20" tabindex="-1"></a>mu1a <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(s2a) <span class="sc">*</span> <span class="fu">rt</span>(N, v);  Y1a <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(W  <span class="sc">%*%</span> B1a <span class="sc">+</span> mu1a)</span>
<span id="cb7-21"><a href="sec13_6.html#cb7-21" tabindex="-1"></a><span class="co"># Latent types: first n, then a, remaining are c</span></span>
<span id="cb7-22"><a href="sec13_6.html#cb7-22" tabindex="-1"></a>id    <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(N)</span>
<span id="cb7-23"><a href="sec13_6.html#cb7-23" tabindex="-1"></a>n_n   <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">round</span>(Etan <span class="sc">*</span> N))</span>
<span id="cb7-24"><a href="sec13_6.html#cb7-24" tabindex="-1"></a>n_a   <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">round</span>(Etaa <span class="sc">*</span> N))</span>
<span id="cb7-25"><a href="sec13_6.html#cb7-25" tabindex="-1"></a>id0n  <span class="ot">&lt;-</span> <span class="fu">sample</span>(id, n_n, <span class="at">replace =</span> <span class="cn">FALSE</span>)     <span class="co"># never-takers</span></span>
<span id="cb7-26"><a href="sec13_6.html#cb7-26" tabindex="-1"></a>id_rem <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(id, id0n)</span>
<span id="cb7-27"><a href="sec13_6.html#cb7-27" tabindex="-1"></a>id1a  <span class="ot">&lt;-</span> <span class="fu">sample</span>(id_rem, n_a, <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co"># always-takers</span></span>
<span id="cb7-28"><a href="sec13_6.html#cb7-28" tabindex="-1"></a>idc   <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(id, <span class="fu">c</span>(id0n, id1a))           <span class="co"># compliers</span></span>
<span id="cb7-29"><a href="sec13_6.html#cb7-29" tabindex="-1"></a>type <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_character_</span>, N)</span>
<span id="cb7-30"><a href="sec13_6.html#cb7-30" tabindex="-1"></a>type[id0n] <span class="ot">&lt;-</span> <span class="st">&quot;n&quot;</span></span>
<span id="cb7-31"><a href="sec13_6.html#cb7-31" tabindex="-1"></a>type[id1a] <span class="ot">&lt;-</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb7-32"><a href="sec13_6.html#cb7-32" tabindex="-1"></a>type[idc]  <span class="ot">&lt;-</span> <span class="st">&quot;c&quot;</span></span>
<span id="cb7-33"><a href="sec13_6.html#cb7-33" tabindex="-1"></a><span class="co"># Realized treatment under monotonicity:</span></span>
<span id="cb7-34"><a href="sec13_6.html#cb7-34" tabindex="-1"></a><span class="co"># n -&gt; D=0, a -&gt; D=1, c -&gt; D=T</span></span>
<span id="cb7-35"><a href="sec13_6.html#cb7-35" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">integer</span>(N)</span>
<span id="cb7-36"><a href="sec13_6.html#cb7-36" tabindex="-1"></a>D[type <span class="sc">==</span> <span class="st">&quot;n&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>; D[type <span class="sc">==</span> <span class="st">&quot;a&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-37"><a href="sec13_6.html#cb7-37" tabindex="-1"></a>D[type <span class="sc">==</span> <span class="st">&quot;c&quot;</span>] <span class="ot">&lt;-</span> T[type <span class="sc">==</span> <span class="st">&quot;c&quot;</span>]</span>
<span id="cb7-38"><a href="sec13_6.html#cb7-38" tabindex="-1"></a></span>
<span id="cb7-39"><a href="sec13_6.html#cb7-39" tabindex="-1"></a><span class="co"># 2x2 table of D vs T</span></span>
<span id="cb7-40"><a href="sec13_6.html#cb7-40" tabindex="-1"></a>tab_DT <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">T =</span> <span class="fu">factor</span>(T, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>), <span class="at">D =</span> <span class="fu">factor</span>(D, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span>
<span id="cb7-41"><a href="sec13_6.html#cb7-41" tabindex="-1"></a><span class="fu">print</span>(tab_DT)</span>
<span id="cb7-42"><a href="sec13_6.html#cb7-42" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(type <span class="sc">==</span> <span class="st">&quot;n&quot;</span>, Y0n, <span class="fu">ifelse</span>(type <span class="sc">==</span> <span class="st">&quot;a&quot;</span>, Y1a, <span class="fu">ifelse</span>(D <span class="sc">==</span> <span class="dv">0</span>, Y0c, Y1c)))</span>
<span id="cb7-43"><a href="sec13_6.html#cb7-43" tabindex="-1"></a><span class="do">## Gibbs sampler ##</span></span>
<span id="cb7-44"><a href="sec13_6.html#cb7-44" tabindex="-1"></a>I00 <span class="ot">&lt;-</span> <span class="fu">which</span>(T <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> D <span class="sc">==</span> <span class="dv">0</span>); I11 <span class="ot">&lt;-</span> <span class="fu">which</span>(T <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> D <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb7-45"><a href="sec13_6.html#cb7-45" tabindex="-1"></a>I01 <span class="ot">&lt;-</span> <span class="fu">which</span>(T <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> D <span class="sc">==</span> <span class="dv">1</span>); I10 <span class="ot">&lt;-</span> <span class="fu">which</span>(T <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> D <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb7-46"><a href="sec13_6.html#cb7-46" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb7-47"><a href="sec13_6.html#cb7-47" tabindex="-1"></a>a0c <span class="ot">&lt;-</span> <span class="dv">1</span>; a0n <span class="ot">&lt;-</span> <span class="dv">1</span>; a0a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Hyperpar Dirichlet</span></span>
<span id="cb7-48"><a href="sec13_6.html#cb7-48" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># Student-t</span></span>
<span id="cb7-49"><a href="sec13_6.html#cb7-49" tabindex="-1"></a>a0 <span class="ot">&lt;-</span> <span class="fl">0.01</span>; d0 <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Inv-Gamma</span></span>
<span id="cb7-50"><a href="sec13_6.html#cb7-50" tabindex="-1"></a><span class="co"># Prob complier | D=0</span></span>
<span id="cb7-51"><a href="sec13_6.html#cb7-51" tabindex="-1"></a>dens_t_locscale <span class="ot">&lt;-</span> <span class="cf">function</span>(y, mu, sig2, v) {</span>
<span id="cb7-52"><a href="sec13_6.html#cb7-52" tabindex="-1"></a>    z <span class="ot">&lt;-</span> (y <span class="sc">-</span> mu) <span class="sc">/</span> <span class="fu">sqrt</span>(sig2); <span class="fu">dt</span>(z, <span class="at">df =</span> v) <span class="sc">/</span> <span class="fu">sqrt</span>(sig2)</span>
<span id="cb7-53"><a href="sec13_6.html#cb7-53" tabindex="-1"></a>}</span>
<span id="cb7-54"><a href="sec13_6.html#cb7-54" tabindex="-1"></a>Pc0 <span class="ot">&lt;-</span> <span class="cf">function</span>(b0c, sigma20c, etac, b0n, sigma20n, etan, i){</span>
<span id="cb7-55"><a href="sec13_6.html#cb7-55" tabindex="-1"></a>    p0c <span class="ot">&lt;-</span> etac <span class="sc">*</span> <span class="fu">dens_t_locscale</span>(Y[i], <span class="at">mu =</span> <span class="fu">sum</span>(Wc[i,]<span class="sc">*</span>b0c), <span class="at">sig2 =</span> sigma20c, <span class="at">v =</span> v)</span>
<span id="cb7-56"><a href="sec13_6.html#cb7-56" tabindex="-1"></a>    p0n <span class="ot">&lt;-</span> etan <span class="sc">*</span> <span class="fu">dens_t_locscale</span>(Y[i], <span class="at">mu =</span> <span class="fu">sum</span>(W[i, ]<span class="sc">*</span>b0n), <span class="at">sig2 =</span> sigma20n, <span class="at">v =</span> v)</span>
<span id="cb7-57"><a href="sec13_6.html#cb7-57" tabindex="-1"></a>    pc0 <span class="ot">&lt;-</span> p0c <span class="sc">/</span> (p0c <span class="sc">+</span> p0n <span class="sc">+</span> <span class="fl">1e-12</span>)</span>
<span id="cb7-58"><a href="sec13_6.html#cb7-58" tabindex="-1"></a>    <span class="fu">return</span>(pc0)</span>
<span id="cb7-59"><a href="sec13_6.html#cb7-59" tabindex="-1"></a>}</span>
<span id="cb7-60"><a href="sec13_6.html#cb7-60" tabindex="-1"></a>Pc1 <span class="ot">&lt;-</span> <span class="cf">function</span>(b1c, sigma21c, etac, b1a, sigma21a, etaa, i){</span>
<span id="cb7-61"><a href="sec13_6.html#cb7-61" tabindex="-1"></a>    p1c <span class="ot">&lt;-</span> etac <span class="sc">*</span> <span class="fu">dens_t_locscale</span>(Y[i], <span class="at">mu =</span> <span class="fu">sum</span>(Wc[i,]<span class="sc">*</span>b1c), <span class="at">sig2 =</span> sigma21c, <span class="at">v =</span> v)</span>
<span id="cb7-62"><a href="sec13_6.html#cb7-62" tabindex="-1"></a>    p1a <span class="ot">&lt;-</span> etaa <span class="sc">*</span> <span class="fu">dens_t_locscale</span>(Y[i], <span class="at">mu =</span> <span class="fu">sum</span>(W[i, ]<span class="sc">*</span>b1a), <span class="at">sig2 =</span> sigma21a, <span class="at">v =</span> v)</span>
<span id="cb7-63"><a href="sec13_6.html#cb7-63" tabindex="-1"></a>    pc1 <span class="ot">&lt;-</span> p1c <span class="sc">/</span> (p1c <span class="sc">+</span> p1a <span class="sc">+</span> <span class="fl">1e-12</span>)</span>
<span id="cb7-64"><a href="sec13_6.html#cb7-64" tabindex="-1"></a>    <span class="fu">return</span>(pc1)</span>
<span id="cb7-65"><a href="sec13_6.html#cb7-65" tabindex="-1"></a>}</span>
<span id="cb7-66"><a href="sec13_6.html#cb7-66" tabindex="-1"></a>rtype <span class="ot">&lt;-</span> <span class="cf">function</span>(alphas){</span>
<span id="cb7-67"><a href="sec13_6.html#cb7-67" tabindex="-1"></a>    types <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">rdirichlet</span>(<span class="dv">1</span>, alphas)</span>
<span id="cb7-68"><a href="sec13_6.html#cb7-68" tabindex="-1"></a>    <span class="fu">return</span>(types)</span>
<span id="cb7-69"><a href="sec13_6.html#cb7-69" tabindex="-1"></a>}</span>
<span id="cb7-70"><a href="sec13_6.html#cb7-70" tabindex="-1"></a>PostLambda_i <span class="ot">&lt;-</span> <span class="cf">function</span>(sig2, Beta, yi, hi, v){</span>
<span id="cb7-71"><a href="sec13_6.html#cb7-71" tabindex="-1"></a>    shape <span class="ot">&lt;-</span> (v <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb7-72"><a href="sec13_6.html#cb7-72" tabindex="-1"></a>    rate  <span class="ot">&lt;-</span> (v <span class="sc">+</span> (yi <span class="sc">-</span> <span class="fu">sum</span>(hi <span class="sc">*</span> Beta))<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> sig2)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb7-73"><a href="sec13_6.html#cb7-73" tabindex="-1"></a>    <span class="fu">rgamma</span>(<span class="dv">1</span>, <span class="at">shape =</span> shape, <span class="at">rate =</span> rate)</span>
<span id="cb7-74"><a href="sec13_6.html#cb7-74" tabindex="-1"></a>}</span>
<span id="cb7-75"><a href="sec13_6.html#cb7-75" tabindex="-1"></a>PostBeta <span class="ot">&lt;-</span> <span class="cf">function</span>(sig2, lambda, y, H){</span>
<span id="cb7-76"><a href="sec13_6.html#cb7-76" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="fu">dim</span>(H)[<span class="dv">2</span>]; B0i <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="dv">1000</span><span class="sc">*</span><span class="fu">diag</span>(k))</span>
<span id="cb7-77"><a href="sec13_6.html#cb7-77" tabindex="-1"></a>    b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, k)</span>
<span id="cb7-78"><a href="sec13_6.html#cb7-78" tabindex="-1"></a>    Bn <span class="ot">&lt;-</span> <span class="fu">solve</span>(B0i <span class="sc">+</span> sig2<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">t</span>(H)<span class="sc">%*%</span><span class="fu">diag</span>(lambda)<span class="sc">%*%</span>H)</span>
<span id="cb7-79"><a href="sec13_6.html#cb7-79" tabindex="-1"></a>    bn <span class="ot">&lt;-</span> Bn<span class="sc">%*%</span>(B0i<span class="sc">%*%</span>b0 <span class="sc">+</span> sig2<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">t</span>(H)<span class="sc">%*%</span><span class="fu">diag</span>(lambda)<span class="sc">%*%</span>y)</span>
<span id="cb7-80"><a href="sec13_6.html#cb7-80" tabindex="-1"></a>    Beta <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">1</span>, bn, Bn)</span>
<span id="cb7-81"><a href="sec13_6.html#cb7-81" tabindex="-1"></a>    <span class="fu">return</span>(Beta)</span>
<span id="cb7-82"><a href="sec13_6.html#cb7-82" tabindex="-1"></a>}</span>
<span id="cb7-83"><a href="sec13_6.html#cb7-83" tabindex="-1"></a>PostSig2 <span class="ot">&lt;-</span> <span class="cf">function</span>(Beta, lambda, y, H){</span>
<span id="cb7-84"><a href="sec13_6.html#cb7-84" tabindex="-1"></a>    Ndk <span class="ot">&lt;-</span> <span class="fu">length</span>(y); an <span class="ot">&lt;-</span> a0 <span class="sc">+</span> Ndk </span>
<span id="cb7-85"><a href="sec13_6.html#cb7-85" tabindex="-1"></a>    dn <span class="ot">&lt;-</span> d0 <span class="sc">+</span> <span class="fu">t</span>(y <span class="sc">-</span> H<span class="sc">%*%</span>Beta)<span class="sc">%*%</span><span class="fu">diag</span>(lambda)<span class="sc">%*%</span>(y <span class="sc">-</span> H<span class="sc">%*%</span>Beta)</span>
<span id="cb7-86"><a href="sec13_6.html#cb7-86" tabindex="-1"></a>    sig2 <span class="ot">&lt;-</span> invgamma<span class="sc">::</span><span class="fu">rinvgamma</span>(<span class="dv">1</span>, <span class="at">shape =</span> an<span class="sc">/</span><span class="dv">2</span>, <span class="at">rate =</span> dn<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb7-87"><a href="sec13_6.html#cb7-87" tabindex="-1"></a>    <span class="fu">return</span>(sig2)</span>
<span id="cb7-88"><a href="sec13_6.html#cb7-88" tabindex="-1"></a>}</span>
<span id="cb7-89"><a href="sec13_6.html#cb7-89" tabindex="-1"></a><span class="co"># MCMC parameter</span></span>
<span id="cb7-90"><a href="sec13_6.html#cb7-90" tabindex="-1"></a>burnin <span class="ot">&lt;-</span> <span class="dv">1000</span>; S <span class="ot">&lt;-</span> <span class="dv">5000</span>; tot <span class="ot">&lt;-</span> S <span class="sc">+</span> burnin </span>
<span id="cb7-91"><a href="sec13_6.html#cb7-91" tabindex="-1"></a>ETAs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, <span class="dv">3</span>)</span>
<span id="cb7-92"><a href="sec13_6.html#cb7-92" tabindex="-1"></a>BETAS0C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, <span class="dv">3</span>); BETAS1C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, <span class="dv">3</span>)</span>
<span id="cb7-93"><a href="sec13_6.html#cb7-93" tabindex="-1"></a>BETASA <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, <span class="dv">2</span>); BETASN <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, <span class="dv">2</span>)</span>
<span id="cb7-94"><a href="sec13_6.html#cb7-94" tabindex="-1"></a>SIGMAS <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, tot, <span class="dv">4</span>)</span>
<span id="cb7-95"><a href="sec13_6.html#cb7-95" tabindex="-1"></a>b0c <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>); b1c <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>); b1a <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>); b0n <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb7-96"><a href="sec13_6.html#cb7-96" tabindex="-1"></a>sigma21c <span class="ot">&lt;-</span> <span class="fl">0.1</span>; sigma20c <span class="ot">&lt;-</span> <span class="fl">0.1</span>; sigma20n <span class="ot">&lt;-</span> <span class="fl">0.1</span>; sigma21a <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb7-97"><a href="sec13_6.html#cb7-97" tabindex="-1"></a>EtacNew <span class="ot">&lt;-</span> <span class="fl">0.5</span>; EtanNew <span class="ot">&lt;-</span> <span class="fl">0.25</span>; EtaaNew <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb7-98"><a href="sec13_6.html#cb7-98" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> tot, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb7-99"><a href="sec13_6.html#cb7-99" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tot){</span>
<span id="cb7-100"><a href="sec13_6.html#cb7-100" tabindex="-1"></a>    ProbC0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(I00, <span class="cf">function</span>(i)<span class="fu">Pc0</span>(b0c, sigma20c, EtacNew, b0n, sigma20n, EtanNew, <span class="at">i =</span> i))</span>
<span id="cb7-101"><a href="sec13_6.html#cb7-101" tabindex="-1"></a>    ProbC1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(I11, <span class="cf">function</span>(i)<span class="fu">Pc1</span>(b1c, sigma21c, EtacNew, b1a, sigma21a, EtaaNew, <span class="at">i =</span> i))</span>
<span id="cb7-102"><a href="sec13_6.html#cb7-102" tabindex="-1"></a>    Typec0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ProbC0, <span class="cf">function</span>(p) {<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;n&quot;</span>), <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">c</span>(p, <span class="dv">1</span><span class="sc">-</span>p))})</span>
<span id="cb7-103"><a href="sec13_6.html#cb7-103" tabindex="-1"></a>    Typec1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ProbC1, <span class="cf">function</span>(p) {<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>), <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">c</span>(p, <span class="dv">1</span><span class="sc">-</span>p))})</span>
<span id="cb7-104"><a href="sec13_6.html#cb7-104" tabindex="-1"></a>    typeNew <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_character_</span>, N)</span>
<span id="cb7-105"><a href="sec13_6.html#cb7-105" tabindex="-1"></a>    typeNew[I10] <span class="ot">&lt;-</span> <span class="st">&quot;n&quot;</span>; typeNew[I01] <span class="ot">&lt;-</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb7-106"><a href="sec13_6.html#cb7-106" tabindex="-1"></a>    typeNew[I00]  <span class="ot">&lt;-</span> Typec0; typeNew[I11]  <span class="ot">&lt;-</span> Typec1</span>
<span id="cb7-107"><a href="sec13_6.html#cb7-107" tabindex="-1"></a>    Nc <span class="ot">&lt;-</span> <span class="fu">sum</span>(typeNew <span class="sc">==</span> <span class="st">&quot;c&quot;</span>); Na <span class="ot">&lt;-</span> <span class="fu">sum</span>(typeNew <span class="sc">==</span> <span class="st">&quot;a&quot;</span>)</span>
<span id="cb7-108"><a href="sec13_6.html#cb7-108" tabindex="-1"></a>    Nn <span class="ot">&lt;-</span> <span class="fu">sum</span>(typeNew <span class="sc">==</span> <span class="st">&quot;n&quot;</span>);</span>
<span id="cb7-109"><a href="sec13_6.html#cb7-109" tabindex="-1"></a>    anc <span class="ot">&lt;-</span> a0c <span class="sc">+</span> Nc; ann <span class="ot">&lt;-</span> a0n <span class="sc">+</span> Nn; ana <span class="ot">&lt;-</span> a0a <span class="sc">+</span> Na</span>
<span id="cb7-110"><a href="sec13_6.html#cb7-110" tabindex="-1"></a>    alphas <span class="ot">&lt;-</span> <span class="fu">c</span>(anc, ann, ana)</span>
<span id="cb7-111"><a href="sec13_6.html#cb7-111" tabindex="-1"></a>    EtasNew <span class="ot">&lt;-</span> <span class="fu">rtype</span>(<span class="at">alphas =</span> alphas)</span>
<span id="cb7-112"><a href="sec13_6.html#cb7-112" tabindex="-1"></a>    EtacNew <span class="ot">&lt;-</span> EtasNew[<span class="dv">1</span>]; EtanNew <span class="ot">&lt;-</span> EtasNew[<span class="dv">2</span>]</span>
<span id="cb7-113"><a href="sec13_6.html#cb7-113" tabindex="-1"></a>    EtaaNew <span class="ot">&lt;-</span> EtasNew[<span class="dv">3</span>]</span>
<span id="cb7-114"><a href="sec13_6.html#cb7-114" tabindex="-1"></a>    ETAs[s, ] <span class="ot">&lt;-</span> EtasNew; Lambda <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb7-115"><a href="sec13_6.html#cb7-115" tabindex="-1"></a>    idx_n <span class="ot">&lt;-</span> <span class="fu">which</span>(typeNew <span class="sc">==</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb7-116"><a href="sec13_6.html#cb7-116" tabindex="-1"></a>    idx_a <span class="ot">&lt;-</span> <span class="fu">which</span>(typeNew <span class="sc">==</span> <span class="st">&quot;a&quot;</span>)</span>
<span id="cb7-117"><a href="sec13_6.html#cb7-117" tabindex="-1"></a>    idx_c0 <span class="ot">&lt;-</span> <span class="fu">which</span>(typeNew <span class="sc">==</span> <span class="st">&quot;c&quot;</span> <span class="sc">&amp;</span> D <span class="sc">==</span> <span class="dv">0</span>); idx_c1 <span class="ot">&lt;-</span> <span class="fu">which</span>(typeNew <span class="sc">==</span> <span class="st">&quot;c&quot;</span> <span class="sc">&amp;</span> D <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb7-118"><a href="sec13_6.html#cb7-118" tabindex="-1"></a>    Lambda[idx_n]  <span class="ot">&lt;-</span> <span class="fu">sapply</span>(idx_n,  <span class="cf">function</span>(i) <span class="fu">PostLambda_i</span>(sigma20n, b0n, Y[i],  W[i, ], v))</span>
<span id="cb7-119"><a href="sec13_6.html#cb7-119" tabindex="-1"></a>    Lambda[idx_a]  <span class="ot">&lt;-</span> <span class="fu">sapply</span>(idx_a,  <span class="cf">function</span>(i) <span class="fu">PostLambda_i</span>(sigma21a, b1a, Y[i],  W[i, ], v))</span>
<span id="cb7-120"><a href="sec13_6.html#cb7-120" tabindex="-1"></a>    Lambda[idx_c0] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(idx_c0, <span class="cf">function</span>(i) <span class="fu">PostLambda_i</span>(sigma20c, b0c, Y[i], Wc[i, ], v))</span>
<span id="cb7-121"><a href="sec13_6.html#cb7-121" tabindex="-1"></a>    Lambda[idx_c1] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(idx_c1, <span class="cf">function</span>(i) <span class="fu">PostLambda_i</span>(sigma21c, b1c, Y[i], Wc[i, ], v))</span>
<span id="cb7-122"><a href="sec13_6.html#cb7-122" tabindex="-1"></a>    b1a <span class="ot">&lt;-</span> <span class="fu">PostBeta</span>(<span class="at">sig2 =</span> sigma21a, <span class="at">lambda =</span> Lambda[idx_a], <span class="at">y =</span> Y[idx_a], <span class="at">H =</span> W[idx_a,])</span>
<span id="cb7-123"><a href="sec13_6.html#cb7-123" tabindex="-1"></a>    b0n <span class="ot">&lt;-</span> <span class="fu">PostBeta</span>(<span class="at">sig2 =</span> sigma20n, <span class="at">lambda =</span> Lambda[idx_n], <span class="at">y =</span> Y[idx_n], <span class="at">H =</span> W[idx_n,])</span>
<span id="cb7-124"><a href="sec13_6.html#cb7-124" tabindex="-1"></a>    b0c <span class="ot">&lt;-</span> <span class="fu">PostBeta</span>(<span class="at">sig2 =</span> sigma20c, <span class="at">lambda =</span> Lambda[idx_c0], <span class="at">y =</span> Y[idx_c0], <span class="at">H =</span> Wc[idx_c0,])</span>
<span id="cb7-125"><a href="sec13_6.html#cb7-125" tabindex="-1"></a>    b1c <span class="ot">&lt;-</span> <span class="fu">PostBeta</span>(<span class="at">sig2 =</span> sigma21c, <span class="at">lambda =</span> Lambda[idx_c1], <span class="at">y =</span> Y[idx_c1], <span class="at">H =</span> Wc[idx_c1,])</span>
<span id="cb7-126"><a href="sec13_6.html#cb7-126" tabindex="-1"></a>    BETASA[s, ] <span class="ot">&lt;-</span> b1a; BETASN[s, ] <span class="ot">&lt;-</span> b0n</span>
<span id="cb7-127"><a href="sec13_6.html#cb7-127" tabindex="-1"></a>    BETAS0C[s, ] <span class="ot">&lt;-</span> b0c; BETAS1C[s, ] <span class="ot">&lt;-</span> b1c </span>
<span id="cb7-128"><a href="sec13_6.html#cb7-128" tabindex="-1"></a>    sigma21a <span class="ot">&lt;-</span> <span class="fu">PostSig2</span>(<span class="at">Beta =</span> b1a, <span class="at">lambda =</span> Lambda[idx_a], <span class="at">y =</span> Y[idx_a], <span class="at">H =</span> W[idx_a,])</span>
<span id="cb7-129"><a href="sec13_6.html#cb7-129" tabindex="-1"></a>    sigma20n <span class="ot">&lt;-</span> <span class="fu">PostSig2</span>(<span class="at">Beta =</span> b0n, <span class="at">lambda =</span> Lambda[idx_n], <span class="at">y =</span> Y[idx_n], <span class="at">H =</span> W[idx_n,])</span>
<span id="cb7-130"><a href="sec13_6.html#cb7-130" tabindex="-1"></a>    sigma20c <span class="ot">&lt;-</span> <span class="fu">PostSig2</span>(<span class="at">Beta =</span> b0c, <span class="at">lambda =</span> Lambda[idx_c0], <span class="at">y =</span> Y[idx_c0], <span class="at">H =</span> Wc[idx_c0,])</span>
<span id="cb7-131"><a href="sec13_6.html#cb7-131" tabindex="-1"></a>    sigma21c <span class="ot">&lt;-</span> <span class="fu">PostSig2</span>(<span class="at">Beta =</span> b1c, <span class="at">lambda =</span> Lambda[idx_c1], <span class="at">y =</span> Y[idx_c1], <span class="at">H =</span> Wc[idx_c1,])</span>
<span id="cb7-132"><a href="sec13_6.html#cb7-132" tabindex="-1"></a>    SIGMAS[s, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma21a, sigma20n, sigma20c, sigma21c)</span>
<span id="cb7-133"><a href="sec13_6.html#cb7-133" tabindex="-1"></a>    <span class="fu">setTxtProgressBar</span>(pb, s)</span>
<span id="cb7-134"><a href="sec13_6.html#cb7-134" tabindex="-1"></a>}</span>
<span id="cb7-135"><a href="sec13_6.html#cb7-135" tabindex="-1"></a><span class="fu">close</span>(pb)</span>
<span id="cb7-136"><a href="sec13_6.html#cb7-136" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">seq</span>((burnin<span class="sc">+</span><span class="dv">1</span>), tot)</span>
<span id="cb7-137"><a href="sec13_6.html#cb7-137" tabindex="-1"></a>LATE <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(BETAS1C[keep, <span class="dv">1</span>] <span class="sc">-</span> BETAS0C[keep, <span class="dv">1</span>])</span>
<span id="cb7-138"><a href="sec13_6.html#cb7-138" tabindex="-1"></a><span class="co"># Extract samples as numeric</span></span>
<span id="cb7-139"><a href="sec13_6.html#cb7-139" tabindex="-1"></a>late_draws <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(LATE)</span>
<span id="cb7-140"><a href="sec13_6.html#cb7-140" tabindex="-1"></a><span class="co"># Posterior mean and 95% CI</span></span>
<span id="cb7-141"><a href="sec13_6.html#cb7-141" tabindex="-1"></a>LATEmean <span class="ot">&lt;-</span> <span class="fu">mean</span>(late_draws)</span>
<span id="cb7-142"><a href="sec13_6.html#cb7-142" tabindex="-1"></a>LATEci   <span class="ot">&lt;-</span> <span class="fu">quantile</span>(late_draws, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb7-143"><a href="sec13_6.html#cb7-143" tabindex="-1"></a><span class="co"># Plot posterior density</span></span>
<span id="cb7-144"><a href="sec13_6.html#cb7-144" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">LATE =</span> late_draws)</span>
<span id="cb7-145"><a href="sec13_6.html#cb7-145" tabindex="-1"></a></span>
<span id="cb7-146"><a href="sec13_6.html#cb7-146" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> LATE)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> LATEmean, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> LATEci, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Posterior distribution of LATE&quot;</span>,</span>
<span id="cb7-147"><a href="sec13_6.html#cb7-147" tabindex="-1"></a><span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Mean = &quot;</span>, <span class="fu">round</span>(LATEmean,<span class="dv">3</span>), <span class="st">&quot; | 95% CI = [&quot;</span>, <span class="fu">round</span>(LATEci[<span class="dv">1</span>],<span class="dv">3</span>), <span class="st">&quot;, &quot;</span>, <span class="fu">round</span>(LATEci[<span class="dv">2</span>],<span class="dv">3</span>), <span class="st">&quot;]&quot;</span>), <span class="at">x =</span> <span class="st">&quot;LATE&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-148"><a href="sec13_6.html#cb7-148" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code></pre></div>
<p>A difference in this example is that, unlike most of the Frequentist literature, the entire dataset on the forcing variable is used. <span class="citation">Chib, Greenberg, and Simoni (<a href="#ref-chib2023nonparametric">2023</a>)</span> propose a non-parametric Bayesian framework that emphasizes the data near the cutoff using a <em>soft-window</em> approach. Other Bayesian approaches to inference in RD include <span class="citation">Branson et al. (<a href="#ref-branson2019nonparametric">2019</a>)</span>, who use Gaussian process regression to model the conditional expectation function, and <span class="citation">Rischard et al. (<a href="#ref-rischard2020bayesian">2020</a>)</span>, who develop a non-parametric Bayesian framework for spatial RD.</p>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-branson2019nonparametric" class="csl-entry">
Branson, Zach, Maxime Rischard, Luke Bornn, and Luke W. Miratrix. 2019. <span>“A Nonparametric <span>Bayesian</span> Methodology for Regression Discontinuity Designs.”</span> <em>Journal of Statistical Planning and Inference</em> 202: 14–30. <a href="https://doi.org/10.1016/j.jspi.2019.01.003">https://doi.org/10.1016/j.jspi.2019.01.003</a>.
</div>
<div id="ref-cattaneo2019practical" class="csl-entry">
Cattaneo, Matias D., Nicolas Idrobo, and Rocı́o Titiunik. 2019. <span>“A Practical Introduction to Regression Discontinuity Designs: Foundations.”</span> <em>Cambridge Elements: Quantitative and Computational Methods for Social Science</em>. <a href="https://doi.org/10.1017/9781108684606">https://doi.org/10.1017/9781108684606</a>.
</div>
<div id="ref-chib2023nonparametric" class="csl-entry">
Chib, Siddhartha, Edward Greenberg, and Anna Simoni. 2023. <span>“Nonparametric Bayes Analysis of the Sharp and Fuzzy Regression Discontinuity Designs.”</span> <em>Econometric Theory</em> 39 (3): 481–533.
</div>
<div id="ref-chib2016bayesian" class="csl-entry">
Chib, Siddhartha, and Liana Jacobi. 2016. <span>“Bayesian Fuzzy Regression Discontinuity Analysis and Returns to Compulsory Schooling.”</span> <em>Journal of Applied Econometrics</em> 31 (6): 1026–47.
</div>
<div id="ref-hahn2001rdd" class="csl-entry">
Hahn, Jinyong, Petra Todd, and Wilbert van der Klaauw. 2001. <span>“Identification and Estimation of Treatment Effects with a Regression-Discontinuity Design.”</span> <em>Econometrica</em> 69 (1): 201–9. <a href="https://doi.org/10.1111/1468-0262.00183">https://doi.org/10.1111/1468-0262.00183</a>.
</div>
<div id="ref-imbens2008regression" class="csl-entry">
Imbens, Guido W., and Thomas Lemieux. 2008. <span>“Regression Discontinuity Designs: A Guide to Practice.”</span> <em>Journal of Econometrics</em> 142 (2): 615–35. <a href="https://doi.org/10.1016/j.jeconom.2007.05.001">https://doi.org/10.1016/j.jeconom.2007.05.001</a>.
</div>
<div id="ref-rischard2020bayesian" class="csl-entry">
Rischard, Maxime, Zach Branson, Luke Bornn, and Luke W. Miratrix. 2020. <span>“Do School Districts Affect NYC House Prices? Identifying Border Differences Using a Bayesian Nonparametric Approach to Geographic Regression Discontinuity Designs.”</span> <em>Journal of the American Statistical Association</em> 115 (531): 1149–65. <a href="https://doi.org/10.1080/01621459.2019.1617155">https://doi.org/10.1080/01621459.2019.1617155</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec13_5.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec13_7.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/aramir21/IntroductionBayesianEconometricsBook/10-Diagnostics.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
