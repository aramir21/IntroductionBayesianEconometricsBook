\chapter{Multivariate models}\label{chap7}

\section{Solutions of Exercises}\label{sec71}
\begin{enumerate}[leftmargin=*]

	\item Show that $\mathbb{E}[u_1\text{PAER}]=\frac{\alpha_1}{1-\beta_1\alpha_1}\sigma^2_1$ assuming that $\mathbb{E}[u_1u_2]=0$ where $Var(u_1)=\sigma^2_1$ in the effect of institutions on per capita GDP.
	
	\textbf{Answer}:
	
	The point of departure is the following \textit{simultaneous structural} economic model:
	\begin{align}\label{eq:str1}
		\log(\text{pcGDP95}_i)=\beta_1+\beta_2\text{PAER}_i+\beta_3 \text{Africa}+\beta_4 \text{Asia}+\beta_5 \text{Other}+u_{1i},
	\end{align}
	\begin{align}\label{eq:str2}
		\text{PAER}_i=\alpha_1+\alpha_2\log(\text{pcGDP95}_i)+\alpha_3\log(\text{Mort}_i)+u_{2i},
	\end{align}

where \textit{pcGDP95}, \textit{PAER} and \textit{Mort} are the per capita gross domestic product (GDP) in 1995, the average index of protection against expropriation between 1985 and 1995, and the settler mortality rate during the time of colonization. \textit{Africa}, \textit{Asia} and \textit{Other} are dummies for continents, with \textit{America} as the baseline group.

Replacing Equation \ref{eq:str2} into Equation \ref{eq:str1}, and solving for $\log(\textit{pcGDP95})$,
\begin{align}\label{eq:red1}
	\log(\text{pcGDP95}_i)=\pi_1+\pi_2\log(\text{Mort}_i)+\pi_3 \text{Africa}+\pi_4 \text{Asia}+\pi_5 \text{Other}+e_{1i},   
\end{align}

where $\pi_1=\frac{\beta_1+\beta_2\alpha_1}{1-\beta_2\alpha_2}$, $\pi_2=\frac{\beta_2\alpha_3}{1-\beta_2\alpha_2}$, $\pi_3=\frac{\beta_3}{1-\beta_2\alpha_2}$, $\pi_4=\frac{\beta_4}{1-\beta_2\alpha_2}$, 
$\pi_5=\frac{\beta_5}{1-\beta_2\alpha_2}$, and $e_1=\frac{\beta_2u_2+u_1}{1-\beta_2\alpha_2}$.

Then, replacing Equation \ref{eq:red1} into Equation \ref{eq:str2}, and solving for \textit{PAER},
\begin{align}\label{eq:red2}
	\text{PAER}_i=\gamma_1+\gamma_2\log(\text{Mort}_i)+\gamma_3 \text{Africa}+\gamma_4 \text{Asia}+\gamma_5 \text{Other}+e_{2i},
\end{align}
where $\gamma_1=\frac{\alpha_1+\alpha_2\beta_1}{1-\beta_2\alpha_2}$, $\gamma_2=\frac{\alpha_3}{1-\beta_2\alpha_2}$, $\gamma_3=\frac{\alpha_2\beta_3}{1-\beta_2\alpha_2}$, $\gamma_4=\frac{\alpha_2\beta_4}{1-\beta_2\alpha_2}$,
$\gamma_5=\frac{\alpha_2\beta_5}{1-\beta_2\alpha_2}$, and $e_2=\frac{\alpha_2u_1+u_2}{1-\beta_2\alpha_2}$.

Then, $\mathbb{E}[u_1\text{PAER}]=\mathbb{E}\left[u_1(\gamma_1+\gamma_2\log(\text{Mort}_i)+\gamma_3 \text{Africa}+\gamma_4 \text{Asia}+\gamma_5 \text{Other}+e_{2i})\right]=\mathbb{E}\left[u_1\left(\frac{\alpha_2u_1+u_2}{1-\beta_2\alpha_2}\right)\right]=\frac{\alpha_2}{1-\beta_2\alpha_2}\sigma^2_1$ given the assumptions.      

\item Show that $\beta_2=\pi_2/\gamma_2$ in the effect of institutions on per capita GDP.

\textbf{Answer}

Given that $\pi_2=\frac{\beta_2\alpha_3}{1-\beta_2\alpha_2}$ and $\gamma_2=\frac{\alpha_3}{1-\beta_2\alpha_2}$ from the previous exercise, consequently, $\beta_2=\pi_2/\gamma_2$.

\item \textbf{The effect of institutions on per capita gross domestic product continues}

Use the \textit{rmultireg} command from the \textit{bayesm} package to perform inference in the example of the effect of institutions on per capita GDP.

\textbf{Answer}

\begin{tcolorbox}[enhanced,width=4.67in,center upper,
	fontupper=\large\bfseries,drop shadow southwest,sharp corners]
	\textit{R code. The effect of institutions on per capita GDP}
	\begin{VF}
		\begin{lstlisting}[language=R]
rm(list = ls())
set.seed(010101)
DataInst <- read.csv("DataApplications/4Institutions.csv", sep = ",", header = TRUE, fileEncoding = "latin1")
attach(DataInst)
Y <- cbind(logpcGDP95, PAER)
X <- cbind(1, logMort, Africa, Asia, Other)
M <- dim(Y)[2]
K <- dim(X)[2]
# Hyperparameters
B0 <- matrix(0, K, M)
c0 <- 100
V0 <- c0*diag(K)
Psi0 <- 5*diag(M)
a0 <- 5
S <- 10000 #Number of posterior draws
betadraw = matrix(double(S*K*M), ncol=K*M)
Sigmadraw = matrix(double(S*M*M), ncol=M*M)
pb <- winProgressBar(title = "progress bar", min = 0, max = S, width = 300)
for (s in 1:S) {
	Results <- bayesm::rmultireg(Y, X, Bbar = B0, A = solve(V0), nu = a0, V = Psi0)
	betadraw[s,] <- Results$B
	Sigmadraw[s,] <- Results$Sigma
	setWinProgressBar(pb, s, title=paste( round(s/S*100, 0), "% done"))
}
close(pb)
summary(coda::mcmc(betadraw))
summary(coda::mcmc(Sigmadraw))
\end{lstlisting}
	\end{VF}
\end{tcolorbox} 
 
	\item \textbf{Demand and supply simulation}

Given the structural demand-supply model:
\begin{align*}
	q_i^d&=\beta_1+\beta_2p_i+\beta_3y_i+\beta_4pc_i+\beta_5ps_i+u_{i1}\\
	q_i^s&=\alpha_1+\alpha_2p_i+\alpha_3er_i+u_{i2},
\end{align*}
where $q^d$ is demand, $q^s$ is supply, $p$, $y$, $pc$, $ps$ and $er$ are price, income, complementary price, substitute price, and exchange rate. Complementary and substitute prices are prices of a complementary and substitute goods of $q$. Assume that $\bm{\beta}=\left[5 \ -0.5 \ 0.8 \ -0.4 \ 0.7\right]^{\top}$, $\bm{\alpha}=\left[-2 \ 0.5 \ -0.4\right]^{\top}$, $u_1\sim N(0, 0.5^2)$ and $u_2\sim N(0, 0.5^2)$. In addition, assume that $y\sim N(10,1)$, $pc\sim N(5,1)$, $ps\sim N(5,1)$ and $tc\sim N(15,1)$.
\begin{itemize}
	\item Find the \textit{reduce-form} model using that in equilibrium demand and supply are equal, that is, $q^d=q^s$. This condition defines the observable quantity ($q$).
	\item Simulate $p$ and $q$ from the \textit{reduce-form} equations.
	\item Preform inference of the \textit{reduce-form} model using the \textit{rmultireg} command from the \textit{bayesm} package.
	\item Use the posterior draws of the \textit{reduce-form} parameters to perform inference of the \textit{structural} parameters. Any issue? Hint: Are all \textit{structural} parameters exactly identified?   
\end{itemize}

\textbf{Answer}

We should equal demand and supply, and solve for price,
\begin{align*}
	p=\pi_1+\pi_2 er + \pi_3 y + \pi_4 pc + \pi_5 ps + v_1,
\end{align*}
where $\pi_1=\frac{\alpha_1-\beta_1}{\beta_2-\alpha_2}$, $\pi_2=\frac{\alpha_3}{\beta_2-\alpha_2}$, $\pi_3=\frac{-\beta_3}{\beta_2-\alpha_2}$, $\pi_4=\frac{-\beta_4}{\beta_2-\alpha_2}$, $\pi_5=\frac{-\beta_5}{\beta_2-\alpha_2}$, and $v_1=\frac{u_2-u_1}{\beta_2-\alpha_2}$ given $\beta_2\neq\alpha_2$, that is, the equations should be independent. This condition is given by economic theory due to $\beta_2<0$ and $\alpha_2>0$, the effect of price on demand and supply should be negative and positive, respectively.

The equation of price into the demand equation gives
\begin{align*}
	q=\tau_1+\tau_2 er + \tau_3 y + \tau_4 pc + \tau_5 ps + v_2,
\end{align*}

where $\tau_1=\beta_1+\beta_2\pi_1$, $\tau_2=\beta_2\pi_2$, $\tau_3=\beta_2\pi_3+\beta_3$, $\tau_4=\beta_2\pi_4+\beta_4$, $\tau_5=\beta_2\pi_5+\beta_5$, and $v_2=\beta_2v_1+u_1$. We can use the equations para $\pi_k$ and $\tau_k$, $k=\left\{1,2,3,4,5\right\}$ to simulate the \textit{reduced-form} equations.

Observe that estimating the \textit{reduced-form} equations, we can get the \textit{structural} parameters for the demand equation, $\beta_2=\tau_2/\pi_2$ ($\pi_2\neq 0$), $\beta_3=\tau_3-\beta_2\pi_3$, $\beta_4=\tau_4-\beta_2\pi_4$ and $\beta_5=\tau_5-\beta_2\pi_5$, whereas the \textit{structural} parameters of the supply equation cannot be recovered just in one way, $\alpha_2=\beta_2+\beta_3/\pi_3=\beta_2+\beta_4/\pi_4=\beta_2+\beta_5/\pi_5$. This in turn implies different values for  $\alpha_3=\pi_2(\beta_2-\alpha_2)$. This is because the demand equation is \textit{exactly identified}, whereas the supply equation is \textit{over identified}. 

In this exercise, $K=5$, $M=2$, $K_1=4$, $K_2=2$, $M_1=2$ and $M_2=2$. This means that $K-K_1=1=M-1$ and $K-K_2=3>M-1=1$, that is, the order condition says that both equations (demand and supply) satisfy the necessary condition of identification, the demand would be \textit{exactly identified}, and the supply equation would be \textit{over identified}.

Regarding the rank condition (necessary and sufficient), let's see the identification matrix:
\begin{table}[!h]
	%\noautomaticrules
	\tabletitle{Identification matrix.}\label{tab:71}%
	\begin{tabular}{ccccccc}
		q    & p & constant & er & y & pc & ps \\
		\hline
		1 & -$\beta_2$ & -$\beta_1$ & 0 & -$\beta_3$ & -$\beta_4$ & -$\beta_5$\\
		1 & -$\alpha_2$ & $-\alpha_1$ & -$\alpha_3$ & 0 & 0 & 0 \\
	\end{tabular}
\end{table}

The demand equation excludes the exchange rate (\textit{exclusion restriction}), and given $\alpha_3\neq 0$, that is, the exchange rate is relevant in the supply equation, then the rank condition is satisfied in the demand equation. The supply equation excludes the income, the complementary price and substitute price (\textit{exclusion restrictions}), then as far as $\beta_k\neq 0$ for any $k=\left\{3,4,5\right\}$, the rank condition is satisfied in the supply equation.

The following code shows how to do the simulation, and perform inference in this exercise. We can see that all 95\% credible intervals encompass the population parameters, and the posterior means are very close to them.
 
\begin{tcolorbox}[enhanced,width=4.67in,center upper,
	fontupper=\large\bfseries,drop shadow southwest,sharp corners]
	\textit{R code. Demand and supply simulation}
	\begin{VF}
		\begin{lstlisting}[language=R]
rm(list = ls()); set.seed(12345)
B0 <- 5; B1 <- -0.5; B2 <- 0.8; B3 <- -0.4; B4 <- 0.7; SD <- 0.5
A0 <- -2; A1 <- 0.5; A2 <- -0.4; SS <- 0.5
P0 <- (A0-B0)/(B1-A1); P2 <- -B2/(B1-A1); P3 <- -B3/(B1-A1); P1 <- A2/(B1-A1); P4 <- -B4/(B1-A1)
T0 <- B0+B1*P0; T2 <- B2+B1*P2; T3 <- B3+B1*P3; T1 <- B1*P1; T4 <- B4+B1*P4;
n <- 5000
ED <- rnorm(n, 0, SD); ES <- rnorm(n, 0, SS)
VP <- (ES-ED)/(B1-A1); UQ <- B1*VP+ED
y <- rnorm(n, 10, 1); pc <- rnorm(n, 5, 1); er <- rnorm(n, 15, 1); ps <- rnorm(n, 5, 1);
p <- P0+P1*er+P2*y+P3*pc+P4*ps+VP
q <- T0+T1*er+T2*y+T3*pc+T4*ps+UQ
#Inference
Y <- cbind(p, q); X <- cbind(1, er, y, pc, ps)
M <- dim(Y)[2]; K <- dim(X)[2]
# Hyperparameters
B0 <- matrix(0, K, M); c0 <- 100; V0 <- c0*diag(K)
Psi0 <- 5*diag(M); a0 <- 5; S <- 10000 #Posterior draws
betadraw = matrix(double(S*K*M), ncol=K*M)
Sigmadraw = matrix(double(S*M*M), ncol=M*M)
pb <- winProgressBar(title = "progress bar", min = 0, max = S, width = 300)
for (s in 1:S) {
	Results <- bayesm::rmultireg(Y, X, Bbar = B0, A = solve(V0), nu = a0, V = Psi0)
	betadraw[s,] <- Results$B
	Sigmadraw[s,] <- Results$Sigma
	setWinProgressBar(pb, s, title=paste( round(s/S*100, 0), "% done"))
}
close(pb)
summary(coda::mcmc(betadraw))
summary(coda::mcmc(Sigmadraw))
beta2 <- betadraw[,7]/betadraw[,2] # Effect of price on demand 
summary(coda::mcmc(beta2))
beta3 <- betadraw[,8] - beta2*betadraw[,3] # Effect of income on demand
summary(coda::mcmc(beta3))
beta4 <- betadraw[,9] - beta2*betadraw[,4] # Effect of complementary price on demand
summary(coda::mcmc(beta4))
beta5 <- betadraw[,10] - beta2*betadraw[,5] # Effect of substitute price  on demand
summary(coda::mcmc(beta5))
\end{lstlisting}
	\end{VF}
\end{tcolorbox} 



\end{enumerate}